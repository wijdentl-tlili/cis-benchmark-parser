[
    {
        "id": "1.1",
        "title": "Users"
    },
    {
        "id": "1.1.1",
        "title": "(L1) Ensure Administrative accounts are cloud-only (Automated)",
        "profile": "• E3 Level 1",
        "description": "Administrative accounts are special privileged accounts that could have varying levels\nof access to data, users, and settings. Regular user accounts should never be utilized\nfor administrative tasks and care should be taken, in the case of a hybrid environment,\nto keep Administrative accounts separated from on-prem accounts. Administrative\naccounts should not have applications assigned so that they have no access to\npotentially vulnerable services (EX. email, Teams, SharePoint, etc.) and only access to\nperform tasks as needed for administrative purposes.\nEnsure administrative accounts are not On-premises sync enabled.",
        "rationale": "In a hybrid environment, having separate accounts will help ensure that in the event of a\nbreach in the cloud, that the breach does not affect the on-prem environment and vice\nversa.",
        "impact": "Administrative users will have to switch accounts and utilizing login/logout functionality\nwhen performing administrative tasks, as well as not benefiting from SSO. This will\nrequire a migration process from the 'daily driver' account to a dedicated admin account.\nWhen migrating permissions to the admin account, both M365 and Azure RBAC roles\nshould be migrated as well. Once the new admin accounts are created both of these\npermission sets should be moved from the daily driver account to the new admin\naccount. Failure to migrate Azure RBAC roles can cause an admin to not be able to see\ntheir subscriptions/resources while using their admin accounts.\nPage 17",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Identity > Users select All users.\n3. To the right of the search box click the Add filter button.\n4. Add the On-premises sync enabled filter and click Apply.\n5. For each user account known to be in an administrative role verify it is not\npresent in the filtered list.\nTo audit using PowerShell:\n1. Connect to Microsoft Graph using Connect-MgGraph -Scopes\n\"RoleManagement.Read.Directory\",\"User.Read.All\"\n2. Run the following PowerShell script:\n# Get privileged role IDs\n$PrivilegedRoles = $DirectoryRoles | Where-Object {\n$_.DisplayName -like \"*Administrator*\" -or $_.DisplayName -eq \"Global\nReader\"\n}\n# Get the members of these various roles\n$RoleMembers = $PrivilegedRoles | ForEach-Object { Get-MgDirectoryRoleMember\n-DirectoryRoleId $_.Id } |\nSelect-Object Id -Unique\n# Retrieve details about the members in these roles\n$PrivilegedUsers = $RoleMembers | ForEach-Object {\nGet-MgUser -UserId $_.Id -Property UserPrincipalName, DisplayName, Id,\nOnPremisesSyncEnabled\n}\n$PrivilegedUsers | Where-Object { $_.OnPremisesSyncEnabled -eq $true } |\nft DisplayName,UserPrincipalName,OnPremisesSyncEnabled\n3. The script will output any hybrid users that are also members of privileged roles.\nIf nothing returns then no users with that criteria exist.",
        "remediation": "Remediation will require first identifying the privileged accounts that are synced from on-\npremises and then creating a new cloud-only account for that user. Once a replacement\naccount is established, the hybrid account should have its role reduced to that of a non-\nprivileged user or removed depending on the need.",
        "default_value": "N/A\nPage 18",
        "references": "1. https://learn.microsoft.com/en-us/microsoft-365/admin/add-users/add-\nusers?view=o365-worldwide\n2. https://learn.microsoft.com/en-us/microsoft-365/enterprise/protect-your-global-\nadministrator-accounts?view=o365-worldwide\n3. https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/best-\npractices#9-use-cloud-native-accounts-for-microsoft-entra-roles\n4. https://learn.microsoft.com/en-us/entra/fundamentals/whatis\n5. https://learn.microsoft.com/en-us/entra/identity/role-based-access-\ncontrol/permissions-reference"
    },
    {
        "id": "1.1.2",
        "title": "(L1) Ensure two emergency access accounts have been defined (Manual)",
        "profile": "• E3 Level 1",
        "description": "Emergency access or \"break glass\" accounts are limited for emergency scenarios\nwhere normal administrative accounts are unavailable. They are not assigned to a\nspecific user and will have a combination of physical and technical controls to prevent\nthem from being accessed outside a true emergency. These emergencies could be due\nto several things, including:\n• Technical failures of a cellular provider or Microsoft related service such as MFA.\n• The last remaining Global Administrator account is inaccessible.\nEnsure two Emergency Access accounts have been defined.\nNote: Microsoft provides several recommendations for these accounts and how to\nconfigure them. For more information on this, please refer to the references section.\nThe CIS Benchmark outlines the more critical things to consider.",
        "rationale": "In various situations, an organization may require the use of a break glass account to\ngain emergency access. In the event of losing access to administrative functions, an\norganization may experience a significant loss in its ability to provide support, lose\ninsight into its security posture, and potentially suffer financial losses.",
        "impact": "If care is not taken in properly implementing an emergency access account this could\nweaken security posture. Microsoft recommends excluding at least one of these\naccounts from all conditional access rules therefore passwords must have sufficient\nentropy and length to protect against random guesses. FIDO2 security keys may be\nused instead of a password for secure passwordless solution.\nPage 20",
        "audit": "Step 1 - Ensure a policy and procedure is in place at the organization:\n• In order for accounts to be effectively used in a break-glass situation the proper\npolicies and procedures must be authorized and distributed by senior\nmanagement.\n• FIDO2 Security Keys should be locked in a secure separate fireproof location.\n• Passwords should be at least 16 characters, randomly generated and MAY be\nseparated in multiple pieces to be joined on emergency.\nStep 2 - Ensure two emergency access accounts are defined:\n1. Navigate to Microsoft 365 admin center https://admin.microsoft.com\n2. Expand Users > Active Users\n3. Inspect the designated emergency access accounts and ensure the following:\no The accounts are named correctly, and do NOT identify with a particular\nperson.\no The accounts use the default .onmicrosoft.com domain and not the\norganization's.\no The accounts are cloud-only.\no The accounts are unlicensed.\no The accounts are assigned the Global Administrator directory role.\nStep 3 - Ensure at least one account is excluded from all conditional access\nrules:\n1. Navigate Microsoft Entra admin center https://entra.microsoft.com/\n2. Expand Protection > Conditional Access.\n3. Inspect the conditional access rules.\n4. Ensure one of the emergency access accounts is excluded from all rules.\nWarning: As of 10/15/2024 MFA is required for all users including Break Glass\nAccounts. It is recommended to update these accounts to use passkey\n(FIDO2) or configure certificate-based authentication for MFA. Both methods satisfy the\nMFA requirement.\nPage 21",
        "remediation": "Step 1 - Create two emergency access accounts:\n1. Navigate to Microsoft 365 admin center https://admin.microsoft.com\n2. Expand Users > Active Users\n3. Click Add user and create a new user with this criteria:\no Name the account in a way that does NOT identify it with a particular\nperson.\no Assign the account to the default .onmicrosoft.com domain and not the\norganization's.\no The password must be at least 16 characters and generated randomly.\no Do not assign a license.\no Assign the user the Global Administrator role.\n4. Repeat the above steps for the second account.\nStep 2 - Exclude at least one account from conditional access policies:\n1. Navigate Microsoft Entra admin center https://entra.microsoft.com/\n2. Expand Protection > Conditional Access.\n3. Inspect the conditional access policies.\n4. For each rule add an exclusion for at least one of the emergency access\naccounts.\n5.\nUsers > Exclude > Users and groups and select one emergency access\naccount.\nStep 3 - Ensure the necessary procedures and policies are in place:\n• In order for accounts to be effectively used in a break glass situation the proper\npolicies and procedures must be authorized and distributed by senior\nmanagement.\n• FIDO2 Security Keys should be locked in a secure separate fireproof location.\n• Passwords should be at least 16 characters, randomly generated and MAY be\nseparated in multiple pieces to be joined on emergency.\nWarning: As of 10/15/2024 MFA is required for all users including Break Glass\nAccounts. It is recommended to update these accounts to use passkey\n(FIDO2) or configure certificate-based authentication for MFA. Both methods satisfy the\nMFA requirement.\nAdditional suggestions for emergency account management:\n• Create access reviews for these users.\n• Exclude users from conditional access rules.\n• Add the account to a restricted management administrative unit.\nPage 22\nWarning: If CA (conditional access) exclusion is managed by a group, this group should\nbe added to PIM for groups (licensing required) or be created as a role-assignable\ngroup. If it is a regular security group, then users with the Group Administrators role are\nable to bypass CA entirely.",
        "default_value": "Not defined.",
        "references": "1. https://learn.microsoft.com/en-us/entra/identity/role-based-access-\ncontrol/security-planning#stage-1-critical-items-to-do-right-now\n2. https://learn.microsoft.com/en-us/entra/identity/role-based-access-\ncontrol/security-emergency-access\n3. https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/admin-\nunits-restricted-management\n4. https://learn.microsoft.com/en-us/entra/identity/authentication/concept-\nmandatory-multifactor-authentication#accounts\nAdditional Information:\nMicrosoft has additional instructions regarding using Azure Monitor to capture events in\nthe Log Analytics workspace, and then generate alerts for Emergency Access accounts.\nThis requires an Azure subscription but should be strongly considered as a method of\nmonitoring activity on these accounts:\nhttps://learn.microsoft.com/en-us/entra/identity/role-based-access-control/security-\nemergency-access#monitor-sign-in-and-audit-logs"
    },
    {
        "id": "1.1.3",
        "title": "(L1) Ensure that between two and four global admins are designated (Automated)",
        "profile": "• E3 Level 1",
        "description": "More than one global administrator should be designated so a single admin can be\nmonitored and to provide redundancy should a single admin leave an organization.\nAdditionally, there should be no more than four global admins set for any tenant. Ideally\nglobal administrators will have no licenses assigned to them.",
        "rationale": "If there is only one global tenant administrator, he or she can perform malicious activity\nwithout the possibility of being discovered by another admin. If there are numerous\nglobal tenant administrators, the more likely it is that one of their accounts will be\nsuccessfully breached by an external attacker.",
        "impact": "The potential impact associated with ensuring compliance with this requirement is\ndependent upon the current number of global administrators configured in the tenant. If\nthere is only one global administrator in a tenant, an additional global administrator will\nneed to be identified and configured. If there are more than four global administrators, a\nreview of role requirements for current global administrators will be required to identify\nwhich of the users require global administrator access.\nPage 24",
        "audit": "To audit using the UI:\n1. Navigate to the Microsoft 365 admin center https://admin.microsoft.com\n2. Select Users > Active Users.\n3. Select Filter then select Global Admins.\n4. Review the list of Global Admins to confirm there are from two to four such\naccounts.\nTo audit using PowerShell:\n1. Connect to Microsoft Graph using Connect-MgGraph -Scopes\nDirectory.Read.All\n2. Run the following PowerShell script:\n# Determine Id of role using the immutable RoleTemplateId value.\n$globalAdminRole = Get-MgDirectoryRole -Filter \"RoleTemplateId eq '62e90394-\n69f5-4237-9190-012177145e10'\"\n$globalAdmins = Get-MgDirectoryRoleMember -DirectoryRoleId\n$globalAdminRole.Id\nWrite-Host \"*** There are\" $globalAdmins.AdditionalProperties.Count \"Global\nAdministrators assigned.\"\nThis information is also available via the Microsoft Graph Security API:\nGET https://graph.microsoft.com/beta/security/secureScores\nNote: When tallying the number of Global Administrators the above does not account\nfor Partner relationships. Those are located under Settings > Partner\nRelationships and should be reviewed on a reoccurring basis.\nPage 25",
        "remediation": "To remediate using the UI:\n1. Navigate to the Microsoft 365 admin center https://admin.microsoft.com\n2. Select Users > Active Users.\n3. In the Search field enter the name of the user to be made a Global Administrator.\n4. To create a new Global Admin:\n1. Select the user's name.\n2. A window will appear to the right.\n3. Select Manage roles.\n4. Select Admin center access.\n5. Check Global Administrator.\n6. Click Save changes.\n5. To remove Global Admins:\n1. Select User.\n2. Under Roles select Manage roles\n3. De-Select the appropriate role.\n4. Click Save changes.\nReferences:\n1. https://learn.microsoft.com/en-\nus/powershell/module/microsoft.graph.identity.directorymanagement/get-\nmgdirectoryrole?view=graph-powershell-1.0\n2. https://learn.microsoft.com/en-us/entra/identity/role-based-access-\ncontrol/permissions-reference#all-roles\nCIS Controls:\nControls\nControl IG 1 IG 2 IG 3\nVersion\n5.1 Establish and Maintain an Inventory of Accounts\nEstablish and maintain an inventory of all accounts managed in the enterprise.\nv8 The inventory must include both user and administrator accounts. The inventory, at ● ● ●\na minimum, should contain the person’s name, username, start/stop dates, and\ndepartment. Validate that all active accounts are authorized, on a recurring\nschedule at a minimum quarterly, or more frequently.\n4.1 Maintain Inventory of Administrative Accounts\nv7 Use automated tools to inventory all administrative accounts, including domain ● ●\nand local accounts, to ensure that only authorized individuals have elevated\nprivileges.\nPage 26",
        "references": "1. https://learn.microsoft.com/en-\nus/powershell/module/microsoft.graph.identity.directorymanagement/get-\nmgdirectoryrole?view=graph-powershell-1.0\n2. https://learn.microsoft.com/en-us/entra/identity/role-based-access-\ncontrol/permissions-reference#all-roles"
    },
    {
        "id": "1.1.4",
        "title": "(L1) Ensure administrative accounts use licenses with a reduced application footprint\n(Automated)",
        "profile": "• E3 Level 1",
        "description": "Administrative accounts are special privileged accounts that could have varying levels\nof access to data, users, and settings. A license can enable an account to gain access\nto a variety of different applications, depending on the license assigned.\nThe recommended state is to not license a privileged account or use Microsoft Entra\nID P1 or Microsoft Entra ID P2 licenses.",
        "rationale": "Ensuring administrative accounts do not use licenses with applications assigned to\nthem will reduce the attack surface of high privileged identities in the organization's\nenvironment. Granting access to a mailbox or other collaborative tools increases the\nlikelihood that privileged users might interact with these applications, raising the risk of\nexposure to social engineering attacks or malicious content. These activities should be\nrestricted to an unprivileged 'daily driver' account.\nNote: In order to participate in Microsoft 365 security services such as Identity\nProtection, PIM and Conditional Access an administrative account will need a license\nattached to it. Ensure that the license used does not include any applications with\npotentially vulnerable services by using either Microsoft Entra ID P1 or Microsoft\nEntra ID P2 for the cloud-only account with administrator roles.",
        "impact": "Administrative users will have to switch accounts and utilize login/logout functionality\nwhen performing administrative tasks, as well as not benefiting from SSO.\nNote: Alerts will be sent to the TenantAdmins, including Global Administrators, by\ndefault. To ensure proper receipt, configure alerts to be sent to security or operations\nstaff with valid email addresses or a security operations center. Otherwise, after\nadoption of this recommendation, alerts sent to TenantAdmins may go unreceived due\nto the lack of an application-based license assigned to the Global Administrator\naccounts.\nPage 27",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft 365 admin center https://admin.microsoft.com.\n2. Click to expand Users select Active users.\n3. Sort by the Licenses column.\n4. For each user account in an administrative role verify the account is assigned a\nlicense that is not associated with applications i.e. (Microsoft Entra ID P1,\nMicrosoft Entra ID P2).\nTo audit using PowerShell:\n1. Connect to Microsoft Graph using Connect-MgGraph -Scopes\n\"RoleManagement.Read.Directory\",\"User.Read.All\"\n2. Run the following PowerShell script:\n$DirectoryRoles = Get-MgDirectoryRole\n# Get privileged role IDs\n$PrivilegedRoles = $DirectoryRoles | Where-Object {\n$_.DisplayName -like \"*Administrator*\" -or $_.DisplayName -eq \"Global\nReader\"\n}\n# Get the members of these various roles\n$RoleMembers = $PrivilegedRoles | ForEach-Object { Get-MgDirectoryRoleMember\n-DirectoryRoleId $_.Id } |\nSelect-Object Id -Unique\n# Retrieve details about the members in these roles\n$PrivilegedUsers = $RoleMembers | ForEach-Object {\nGet-MgUser -UserId $_.Id -Property UserPrincipalName, DisplayName, Id\n}\n$Report = [System.Collections.Generic.List[Object]]::new()\nforeach ($Admin in $PrivilegedUsers) {\n$License = $null\n$License = (Get-MgUserLicenseDetail -UserId $Admin.id).SkuPartNumber -\njoin \", \"\n$Object = [pscustomobject][ordered]@{\nDisplayName = $Admin.DisplayName\nUserPrincipalName = $Admin.UserPrincipalName\nLicense = $License\n}\n$Report.Add($Object)\n}\n$Report\nPage 28\n3. The output will display users assigned privileged roles alongside their assigned\nlicenses. Additional manual assessment is required to determine if the licensing\nis appropriate for the user.",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft 365 admin center https://admin.microsoft.com.\n2. Click to expand Users select Active users\n3. Click Add a user.\n4. Fill out the appropriate fields for Name, user, etc.\n5. When prompted to assign licenses select as needed Microsoft Entra ID P1\nor Microsoft Entra ID P2, then click Next.\n6. Under the Option settings screen you may choose from several types of\nprivileged roles. Choose Admin center access followed by the appropriate role\nthen click Next.\n7. Select Finish adding.",
        "default_value": "N/A",
        "references": "1. https://learn.microsoft.com/en-us/microsoft-365/admin/add-users/add-\nusers?view=o365-worldwide\n2. https://learn.microsoft.com/en-us/microsoft-365/enterprise/protect-your-global-\nadministrator-accounts?view=o365-worldwide\n3. https://learn.microsoft.com/en-us/entra/fundamentals/whatis\n4. https://learn.microsoft.com/en-us/entra/identity/role-based-access-\ncontrol/permissions-reference\nPage 29"
    },
    {
        "id": "1.2",
        "title": "Teams & groups",
        "profile": "• E3 Level 1",
        "description": "Emergency access or \"break glass\" accounts are limited for emergency scenarios\nwhere normal administrative accounts are unavailable. They are not assigned to a\nspecific user and will have a combination of physical and technical controls to prevent\nthem from being accessed outside a true emergency. These emergencies could be due\nto several things, including:\n• Technical failures of a cellular provider or Microsoft related service such as MFA.\n• The last remaining Global Administrator account is inaccessible.\nEnsure two Emergency Access accounts have been defined.\nNote: Microsoft provides several recommendations for these accounts and how to\nconfigure them. For more information on this, please refer to the references section.\nThe CIS Benchmark outlines the more critical things to consider.",
        "rationale": "In various situations, an organization may require the use of a break glass account to\ngain emergency access. In the event of losing access to administrative functions, an\norganization may experience a significant loss in its ability to provide support, lose\ninsight into its security posture, and potentially suffer financial losses.",
        "impact": "If care is not taken in properly implementing an emergency access account this could\nweaken security posture. Microsoft recommends excluding at least one of these\naccounts from all conditional access rules therefore passwords must have sufficient\nentropy and length to protect against random guesses. FIDO2 security keys may be\nused instead of a password for secure passwordless solution.\nPage 20",
        "audit": "Step 1 - Ensure a policy and procedure is in place at the organization:\n• In order for accounts to be effectively used in a break-glass situation the proper\npolicies and procedures must be authorized and distributed by senior\nmanagement.\n• FIDO2 Security Keys should be locked in a secure separate fireproof location.\n• Passwords should be at least 16 characters, randomly generated and MAY be\nseparated in multiple pieces to be joined on emergency.\nStep 2 - Ensure two emergency access accounts are defined:\n1. Navigate to Microsoft 365 admin center https://admin.microsoft.com\n2. Expand Users > Active Users\n3. Inspect the designated emergency access accounts and ensure the following:\no The accounts are named correctly, and do NOT identify with a particular\nperson.\no The accounts use the default .onmicrosoft.com domain and not the\norganization's.\no The accounts are cloud-only.\no The accounts are unlicensed.\no The accounts are assigned the Global Administrator directory role.\nStep 3 - Ensure at least one account is excluded from all conditional access\nrules:\n1. Navigate Microsoft Entra admin center https://entra.microsoft.com/\n2. Expand Protection > Conditional Access.\n3. Inspect the conditional access rules.\n4. Ensure one of the emergency access accounts is excluded from all rules.\nWarning: As of 10/15/2024 MFA is required for all users including Break Glass\nAccounts. It is recommended to update these accounts to use passkey\n(FIDO2) or configure certificate-based authentication for MFA. Both methods satisfy the\nMFA requirement.\nPage 21",
        "remediation": "Step 1 - Create two emergency access accounts:\n1. Navigate to Microsoft 365 admin center https://admin.microsoft.com\n2. Expand Users > Active Users\n3. Click Add user and create a new user with this criteria:\no Name the account in a way that does NOT identify it with a particular\nperson.\no Assign the account to the default .onmicrosoft.com domain and not the\norganization's.\no The password must be at least 16 characters and generated randomly.\no Do not assign a license.\no Assign the user the Global Administrator role.\n4. Repeat the above steps for the second account.\nStep 2 - Exclude at least one account from conditional access policies:\n1. Navigate Microsoft Entra admin center https://entra.microsoft.com/\n2. Expand Protection > Conditional Access.\n3. Inspect the conditional access policies.\n4. For each rule add an exclusion for at least one of the emergency access\naccounts.\n5.\nUsers > Exclude > Users and groups and select one emergency access\naccount.\nStep 3 - Ensure the necessary procedures and policies are in place:\n• In order for accounts to be effectively used in a break glass situation the proper\npolicies and procedures must be authorized and distributed by senior\nmanagement.\n• FIDO2 Security Keys should be locked in a secure separate fireproof location.\n• Passwords should be at least 16 characters, randomly generated and MAY be\nseparated in multiple pieces to be joined on emergency.\nWarning: As of 10/15/2024 MFA is required for all users including Break Glass\nAccounts. It is recommended to update these accounts to use passkey\n(FIDO2) or configure certificate-based authentication for MFA. Both methods satisfy the\nMFA requirement.\nAdditional suggestions for emergency account management:\n• Create access reviews for these users.\n• Exclude users from conditional access rules.\n• Add the account to a restricted management administrative unit.\nPage 22\nWarning: If CA (conditional access) exclusion is managed by a group, this group should\nbe added to PIM for groups (licensing required) or be created as a role-assignable\ngroup. If it is a regular security group, then users with the Group Administrators role are\nable to bypass CA entirely.",
        "default_value": "Not defined.",
        "references": "1. https://learn.microsoft.com/en-us/entra/identity/role-based-access-\ncontrol/security-planning#stage-1-critical-items-to-do-right-now\n2. https://learn.microsoft.com/en-us/entra/identity/role-based-access-\ncontrol/security-emergency-access\n3. https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/admin-\nunits-restricted-management\n4. https://learn.microsoft.com/en-us/entra/identity/authentication/concept-\nmandatory-multifactor-authentication#accounts\nAdditional Information:\nMicrosoft has additional instructions regarding using Azure Monitor to capture events in\nthe Log Analytics workspace, and then generate alerts for Emergency Access accounts.\nThis requires an Azure subscription but should be strongly considered as a method of\nmonitoring activity on these accounts:\nhttps://learn.microsoft.com/en-us/entra/identity/role-based-access-control/security-\nemergency-access#monitor-sign-in-and-audit-logs"
    },
    {
        "id": "1.2.1",
        "title": "(L2) Ensure that only organizationally managed/approved public groups exist\n(Automated)",
        "profile": "• E3 Level 2",
        "description": "Microsoft 365 Groups is the foundational membership service that drives all teamwork\nacross Microsoft 365. With Microsoft 365 Groups, you can give a group of people\naccess to a collection of shared resources. While there are several different group types\nthis recommendation concerns Microsoft 365 Groups.\nIn the Administration panel, when a group is created, the default privacy value is\n\"Public\".",
        "rationale": "Ensure that only organizationally managed and approved public groups exist. When a\ngroup has a \"public\" privacy, users may access data related to this group (e.g.\nSharePoint), through three methods:\n• By using the Azure portal, and adding themselves into the public group\n• By requesting access to the group from the Group application of the Access\nPanel\n• By accessing the SharePoint URL\nAdministrators are notified when a user uses the Azure Portal. Requesting access to the\ngroup forces users to send a message to the group owner, but they still have immediate\naccess to the group. The SharePoint URL is usually guessable and can be found from\nthe Group application of the Access Panel. If group privacy is not controlled, any user\nmay access sensitive information, according to the group they try to access.\nNote: Public in this case means public to the identities within the organization.",
        "impact": "If the recommendation is applied, group owners could receive more access requests\nthan usual, especially regarding groups originally meant to be public.\nPage 32",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft 365 admin center https://admin.microsoft.com.\n2. Click to expand Teams & groups select Active teams & groups.\n3. On the Active teams and groups page, check that no groups have the status\n'Public' in the privacy column.\nTo audit using PowerShell:\n1. Connect to the Microsoft Graph service using Connect-MgGraph -Scopes\n\"Group.Read.All\".\n2. Run the following Microsoft Graph PowerShell command:\nGet-MgGroup | where {$_.Visibility -eq \"Public\"} | select\nDisplayName,Visibility\n3. Ensure Visibility is Private for each group.",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft 365 admin center https://admin.microsoft.com.\n2. Click to expand Teams & groups select Active teams & groups..\n3. On the Active teams and groups page, select the group's name that is public.\n4. On the popup groups name page, Select Settings.\n5. Under Privacy, select Private.",
        "default_value": "Public when created from the Administration portal; private otherwise.",
        "references": "1. https://learn.microsoft.com/en-us/entra/identity/users/groups-self-service-\nmanagement\n2. https://learn.microsoft.com/en-us/microsoft-365/admin/create-groups/compare-\ngroups?view=o365-worldwide\nPage 33"
    },
    {
        "id": "1.2.2",
        "title": "(L1) Ensure sign-in to shared mailboxes is blocked (Automated)",
        "profile": "• E3 Level 1",
        "description": "Shared mailboxes are used when multiple people need access to the same mailbox,\nsuch as a company information or support email address, reception desk, or other\nfunction that might be shared by multiple people.\nUsers with permissions to the group mailbox can send as or send on behalf of the\nmailbox email address if the administrator has given that user permissions to do that.\nThis is particularly useful for help and support mailboxes because users can send\nemails from \"Contoso Support\" or \"Building A Reception Desk.\"\nShared mailboxes are created with a corresponding user account using a system\ngenerated password that is unknown at the time of creation.\nThe recommended state is Sign in blocked for Shared mailboxes.",
        "rationale": "The intent of the shared mailbox is the only allow delegated access from other\nmailboxes. An admin could reset the password, or an attacker could potentially gain\naccess to the shared mailbox allowing the direct sign-in to the shared mailbox and\nsubsequently the sending of email from a sender that does not have a unique identity.\nTo prevent this, block sign-in for the account that is associated with the shared mailbox.\nPage 35",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft 365 admin center https://admin.microsoft.com/\n2. Click to expand Teams & groups and select Shared mailboxes.\n3. Take note of all shared mailboxes.\n4. Click to expand Users and select Active users.\n5. Select a shared mailbox account to open its properties pane, and review.\n6. Ensure the text under the name reads Sign-in blocked.\n7. Repeat for any additional shared mailboxes.\nNote: If sign-in is not blocked where will be an option to Block sign-in. This means\nthe shared mailbox is out of compliance with this recommendation.\nTo audit using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline\n2. Connect to Microsoft Graph using Connect-MgGraph -Scopes\n\"Policy.Read.All\"\n3. Run the following PowerShell commands:\n$MBX = Get-EXOMailbox -RecipientTypeDetails SharedMailbox\n$MBX | ForEach-Object { Get-MgUser -UserId $_.ExternalDirectoryObjectId `\n-Property DisplayName, UserPrincipalName, AccountEnabled } |\nFormat-Table DisplayName, UserPrincipalName, AccountEnabled\n4. Ensure AccountEnabled is set to False for all Shared Mailboxes.\nPage 36",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft 365 admin center https://admin.microsoft.com/\n2. Click to expand Teams & groups and select Shared mailboxes.\n3. Take note of all shared mailboxes.\n4. Click to expand Users and select Active users.\n5. Select a shared mailbox account to open it's properties pane and then select\nBlock sign-in.\n6. Check the box for Block this user from signing in.\n7. Repeat for any additional shared mailboxes.\nTo remediate using PowerShell:\n1. Connect to Microsoft Graph using Connect-MgGraph -Scopes\n\"User.ReadWrite.All\"\n2. Connect to Exchange Online using Connect-ExchangeOnline.\n3. To disable sign-in for a single account:\n$MBX = Get-EXOMailbox -Identity TestUser@example.com\nUpdate-MgUser -UserId $MBX.ExternalDirectoryObjectId -AccountEnabled:$false\n3. The following will block sign-in to all Shared Mailboxes.\n$MBX = Get-EXOMailbox -RecipientTypeDetails SharedMailbox\n$MBX | ForEach-Object { Update-MgUser -UserId $_.ExternalDirectoryObjectId -\nAccountEnabled:$false }",
        "default_value": "AccountEnabled: True",
        "references": "1. https://learn.microsoft.com/en-us/microsoft-365/admin/email/about-shared-\nmailboxes?view=o365-worldwide\n2. https://learn.microsoft.com/en-us/microsoft-365/admin/email/create-a-shared-\nmailbox?view=o365-worldwide#block-sign-in-for-the-shared-mailbox-account\n3. https://learn.microsoft.com/en-us/microsoft-365/enterprise/block-user-accounts-\nwith-microsoft-365-powershell?view=o365-worldwide#block-individual-user-\naccounts\nPage 37"
    },
    {
        "id": "1.3",
        "title": "Settings",
        "profile": "• E3 Level 1",
        "description": "More than one global administrator should be designated so a single admin can be\nmonitored and to provide redundancy should a single admin leave an organization.\nAdditionally, there should be no more than four global admins set for any tenant. Ideally\nglobal administrators will have no licenses assigned to them.",
        "rationale": "If there is only one global tenant administrator, he or she can perform malicious activity\nwithout the possibility of being discovered by another admin. If there are numerous\nglobal tenant administrators, the more likely it is that one of their accounts will be\nsuccessfully breached by an external attacker.",
        "impact": "The potential impact associated with ensuring compliance with this requirement is\ndependent upon the current number of global administrators configured in the tenant. If\nthere is only one global administrator in a tenant, an additional global administrator will\nneed to be identified and configured. If there are more than four global administrators, a\nreview of role requirements for current global administrators will be required to identify\nwhich of the users require global administrator access.\nPage 24",
        "audit": "To audit using the UI:\n1. Navigate to the Microsoft 365 admin center https://admin.microsoft.com\n2. Select Users > Active Users.\n3. Select Filter then select Global Admins.\n4. Review the list of Global Admins to confirm there are from two to four such\naccounts.\nTo audit using PowerShell:\n1. Connect to Microsoft Graph using Connect-MgGraph -Scopes\nDirectory.Read.All\n2. Run the following PowerShell script:\n# Determine Id of role using the immutable RoleTemplateId value.\n$globalAdminRole = Get-MgDirectoryRole -Filter \"RoleTemplateId eq '62e90394-\n69f5-4237-9190-012177145e10'\"\n$globalAdmins = Get-MgDirectoryRoleMember -DirectoryRoleId\n$globalAdminRole.Id\nWrite-Host \"*** There are\" $globalAdmins.AdditionalProperties.Count \"Global\nAdministrators assigned.\"\nThis information is also available via the Microsoft Graph Security API:\nGET https://graph.microsoft.com/beta/security/secureScores\nNote: When tallying the number of Global Administrators the above does not account\nfor Partner relationships. Those are located under Settings > Partner\nRelationships and should be reviewed on a reoccurring basis.\nPage 25",
        "remediation": "To remediate using the UI:\n1. Navigate to the Microsoft 365 admin center https://admin.microsoft.com\n2. Select Users > Active Users.\n3. In the Search field enter the name of the user to be made a Global Administrator.\n4. To create a new Global Admin:\n1. Select the user's name.\n2. A window will appear to the right.\n3. Select Manage roles.\n4. Select Admin center access.\n5. Check Global Administrator.\n6. Click Save changes.\n5. To remove Global Admins:\n1. Select User.\n2. Under Roles select Manage roles\n3. De-Select the appropriate role.\n4. Click Save changes.\nReferences:\n1. https://learn.microsoft.com/en-\nus/powershell/module/microsoft.graph.identity.directorymanagement/get-\nmgdirectoryrole?view=graph-powershell-1.0\n2. https://learn.microsoft.com/en-us/entra/identity/role-based-access-\ncontrol/permissions-reference#all-roles\nCIS Controls:\nControls\nControl IG 1 IG 2 IG 3\nVersion\n5.1 Establish and Maintain an Inventory of Accounts\nEstablish and maintain an inventory of all accounts managed in the enterprise.\nv8 The inventory must include both user and administrator accounts. The inventory, at ● ● ●\na minimum, should contain the person’s name, username, start/stop dates, and\ndepartment. Validate that all active accounts are authorized, on a recurring\nschedule at a minimum quarterly, or more frequently.\n4.1 Maintain Inventory of Administrative Accounts\nv7 Use automated tools to inventory all administrative accounts, including domain ● ●\nand local accounts, to ensure that only authorized individuals have elevated\nprivileges.\nPage 26\n1.1.4 (L1) Ensure administrative accounts use licenses with a\nreduced application footprint (Automated)\nProfile Applicability:\n• E3 Level 1\nDescription:\nAdministrative accounts are special privileged accounts that could have varying levels\nof access to data, users, and settings. A license can enable an account to gain access\nto a variety of different applications, depending on the license assigned.\nThe recommended state is to not license a privileged account or use Microsoft Entra\nID P1 or Microsoft Entra ID P2 licenses.\nRationale:\nEnsuring administrative accounts do not use licenses with applications assigned to\nthem will reduce the attack surface of high privileged identities in the organization's\nenvironment. Granting access to a mailbox or other collaborative tools increases the\nlikelihood that privileged users might interact with these applications, raising the risk of\nexposure to social engineering attacks or malicious content. These activities should be\nrestricted to an unprivileged 'daily driver' account.\nNote: In order to participate in Microsoft 365 security services such as Identity\nProtection, PIM and Conditional Access an administrative account will need a license\nattached to it. Ensure that the license used does not include any applications with\npotentially vulnerable services by using either Microsoft Entra ID P1 or Microsoft\nEntra ID P2 for the cloud-only account with administrator roles.\nImpact:\nAdministrative users will have to switch accounts and utilize login/logout functionality\nwhen performing administrative tasks, as well as not benefiting from SSO.\nNote: Alerts will be sent to the TenantAdmins, including Global Administrators, by\ndefault. To ensure proper receipt, configure alerts to be sent to security or operations\nstaff with valid email addresses or a security operations center. Otherwise, after\nadoption of this recommendation, alerts sent to TenantAdmins may go unreceived due\nto the lack of an application-based license assigned to the Global Administrator\naccounts.\nPage 27\nAudit:\nTo audit using the UI:\n1. Navigate to Microsoft 365 admin center https://admin.microsoft.com.\n2. Click to expand Users select Active users.\n3. Sort by the Licenses column.\n4. For each user account in an administrative role verify the account is assigned a\nlicense that is not associated with applications i.e. (Microsoft Entra ID P1,\nMicrosoft Entra ID P2).\nTo audit using PowerShell:\n1. Connect to Microsoft Graph using Connect-MgGraph -Scopes\n\"RoleManagement.Read.Directory\",\"User.Read.All\"\n2. Run the following PowerShell script:\n$DirectoryRoles = Get-MgDirectoryRole\n# Get privileged role IDs\n$PrivilegedRoles = $DirectoryRoles | Where-Object {\n$_.DisplayName -like \"*Administrator*\" -or $_.DisplayName -eq \"Global\nReader\"\n}\n# Get the members of these various roles\n$RoleMembers = $PrivilegedRoles | ForEach-Object { Get-MgDirectoryRoleMember\n-DirectoryRoleId $_.Id } |\nSelect-Object Id -Unique\n# Retrieve details about the members in these roles\n$PrivilegedUsers = $RoleMembers | ForEach-Object {\nGet-MgUser -UserId $_.Id -Property UserPrincipalName, DisplayName, Id\n}\n$Report = [System.Collections.Generic.List[Object]]::new()\nforeach ($Admin in $PrivilegedUsers) {\n$License = $null\n$License = (Get-MgUserLicenseDetail -UserId $Admin.id).SkuPartNumber -\njoin \", \"\n$Object = [pscustomobject][ordered]@{\nDisplayName = $Admin.DisplayName\nUserPrincipalName = $Admin.UserPrincipalName\nLicense = $License\n}\n$Report.Add($Object)\n}\n$Report\nPage 28\n3. The output will display users assigned privileged roles alongside their assigned\nlicenses. Additional manual assessment is required to determine if the licensing\nis appropriate for the user.\nRemediation:\nTo remediate using the UI:\n1. Navigate to Microsoft 365 admin center https://admin.microsoft.com.\n2. Click to expand Users select Active users\n3. Click Add a user.\n4. Fill out the appropriate fields for Name, user, etc.\n5. When prompted to assign licenses select as needed Microsoft Entra ID P1\nor Microsoft Entra ID P2, then click Next.\n6. Under the Option settings screen you may choose from several types of\nprivileged roles. Choose Admin center access followed by the appropriate role\nthen click Next.\n7. Select Finish adding.",
        "default_value": "N/A",
        "references": "1. https://learn.microsoft.com/en-\nus/powershell/module/microsoft.graph.identity.directorymanagement/get-\nmgdirectoryrole?view=graph-powershell-1.0\n2. https://learn.microsoft.com/en-us/entra/identity/role-based-access-\ncontrol/permissions-reference#all-roles"
    },
    {
        "id": "1.3.1",
        "title": "(L1) Ensure the 'Password expiration policy' is set to 'Set passwords to never expire\n(recommended)' (Automated)",
        "profile": "• E3 Level 1",
        "description": "Microsoft cloud-only accounts have a pre-defined password policy that cannot be\nchanged. The only items that can change are the number of days until a password\nexpires and whether or whether passwords expire at all.",
        "rationale": "Organizations such as NIST and Microsoft have updated their password policy\nrecommendations to not arbitrarily require users to change their passwords after a\nspecific amount of time, unless there is evidence that the password is compromised, or\nthe user forgot it. They suggest this even for single factor (Password Only) use cases,\nwith a reasoning that forcing arbitrary password changes on users actually make the\npasswords less secure. Other recommendations within this Benchmark suggest the use\nof MFA authentication for at least critical accounts (at minimum), which makes\npassword expiration even less useful as well as password protection for Entra ID.",
        "impact": "When setting passwords not to expire it is important to have other controls in place to\nsupplement this setting. See below for related recommendations and user guidance.\n• Ban common passwords.\n• Educate users to not reuse organization passwords anywhere else.\n• Enforce Multi-Factor Authentication registration for all users.\nPage 40",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft 365 admin center https://admin.microsoft.com.\n2. Click to expand Settings select Org Settings.\n3. Click on Security & privacy.\n4. Select Password expiration policy ensure that Set passwords to never\nexpire (recommended) has been checked.\nTo audit using PowerShell:\n1. Connect to the Microsoft Graph service using Connect-MgGraph -Scopes\n\"Domain.Read.All\".\n2. Run the following Microsoft Online PowerShell command:\nGet-MgDomain | ft id,PasswordValidityPeriodInDays\n3. Verify the value returned for valid domains is 2147483647",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft 365 admin center https://admin.microsoft.com.\n2. Click to expand Settings select Org Settings.\n3. Click on Security & privacy.\n4. Check the Set passwords to never expire (recommended) box.\n5. Click Save.\nTo remediate using PowerShell:\n1. Connect to the Microsoft Graph service using Connect-MgGraph -Scopes\n\"Domain.ReadWrite.All\".\n2. Run the following Microsoft Graph PowerShell command:\nUpdate-MgDomain -DomainId <Domain> -PasswordValidityPeriodInDays 2147483647",
        "default_value": "If the property is not set, a default value of 90 days will be used\nPage 41",
        "references": "1. https://pages.nist.gov/800-63-3/sp800-63b.html\n2. https://www.cisecurity.org/white-papers/cis-password-policy-guide/\n3. https://learn.microsoft.com/en-us/microsoft-365/admin/misc/password-policy-\nrecommendations?view=o365-worldwide"
    },
    {
        "id": "1.3.2",
        "title": "(L1) Ensure 'Idle session timeout' is set to '3 hours (or less)' for unmanaged devices\n(Manual)",
        "profile": "• E3 Level 1",
        "description": "Idle session timeout allows the configuration of a setting which will timeout inactive\nusers after a pre-determined amount of time. When a user reaches the set idle timeout\nsession, they'll get a notification that they're about to be signed out. They have to select\nto stay signed in or they'll be automatically signed out of all Microsoft 365 web apps.\nCombined with a Conditional Access rule this will only impact unmanaged devices. A\nmanaged device is considered a device managed that is compliant or joined to a\ndomain and using a supported browser like Microsoft Edge or Google Chrome (with the\nMicrosoft Single Sign On) extension.\nThe following Microsoft 365 web apps are supported.\n• Outlook Web App\n• OneDrive\n• SharePoint\n• Microsoft Fabric\n• Microsoft365.com and other start pages\n• Microsoft 365 web apps (Word, Excel, PowerPoint)\n• Microsoft 365 Admin Center\n• M365 Defender Portal\n• Microsoft Purview Compliance Portal\nThe recommended setting is 3 hours (or less) for unmanaged devices.\nNote: Idle session timeout doesn't affect Microsoft 365 desktop and mobile apps.",
        "rationale": "Ending idle sessions through an automatic process can help protect sensitive company\ndata and will add another layer of security for end users who work on unmanaged\ndevices that can potentially be accessed by the public. Unauthorized individuals onsite\nor remotely can take advantage of systems left unattended over time. Automatic timing\nout of sessions makes this more difficult.\nPage 43",
        "impact": "If step 2 in the Audit/Remediation procedure is left out, then there is no issue with this\nfrom a security standpoint. However, it will require users on trusted devices to sign in\nmore frequently which could result in credential prompt fatigue.\nNote: Idle session timeout also affects the Azure Portal idle timeout if this is not\nexplicitly set to a different timeout. The Azure Portal idle timeout applies to all kind of\ndevices, not just unmanaged. See : change the directory timeout setting admin",
        "audit": "Step 1 - Ensure Idle session timeout is configured:\n1. Navigate to the Microsoft 365 admin center https://admin.microsoft.com/.\n2. Click to expand Settings Select Org settings.\n3. Click Security & Privacy tab.\n4. Select Idle session timeout.\n5. Verify Turn on to set the period of inactivity for users to be\nsigned off of Microsoft 365 web apps is set to 3 hours (or less).\nStep 2 - Ensure the Conditional Access policy is in place:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/\n2. Expand Protect > Conditional Access.\n3. Inspect existing conditional access rules for one that meets the below conditions:\no Users is set to All users.\no Cloud apps or actions > Select apps is set to Office 365.\no Conditions > Client apps is Browser and nothing else.\no Session is set to Use app enforced restrictions.\no Enable Policy is set to On\nNote: To ensure that idle timeouts affect only unmanaged devices, both steps must be\ncompleted.\nPage 44",
        "remediation": "Step 1 - Configure Idle session timeout:\n1. Navigate to the Microsoft 365 admin center https://admin.microsoft.com/.\n2. Click to expand Settings Select Org settings.\n3. Click Security & Privacy tab.\n4. Select Idle session timeout.\n5. Check the box Turn on to set the period of inactivity for users to\nbe signed off of Microsoft 365 web apps\n6. Set a maximum value of 3 hours.\n7. Click save.\nStep 2 - Ensure the Conditional Access policy is in place:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/\n2. Expand Protect > Conditional Access.\n3. Click New policy and give the policy a name.\no Select Users > All users.\no Select Cloud apps or actions > Select apps and select Office 365\no Select Conditions > Client apps > Yes check only Browser unchecking\nall other boxes.\no Select Sessions and check Use app enforced restrictions.\n4. Set Enable policy to On and click Create.\nNote: To ensure that idle timeouts affect only unmanaged devices, both steps must be\ncompleted.",
        "default_value": "Not configured. (Idle sessions will not timeout.)",
        "references": "1. https://learn.microsoft.com/en-us/microsoft-365/admin/manage/idle-session-\ntimeout-web-apps?view=o365-worldwide\nAdditional Information:\nAccording to Microsoft idle session timeout isn't supported when third party cookies are\ndisabled in the browser. Users won't see any sign-out prompts.\nPage 45"
    },
    {
        "id": "1.3.3",
        "title": "(L2) Ensure 'External sharing' of calendars is not available (Automated)",
        "profile": "• E3 Level 2",
        "description": "External calendar sharing allows an administrator to enable the ability for users to share\ncalendars with anyone outside of the organization. Outside users will be sent a URL that\ncan be used to view the calendar.",
        "rationale": "Attackers often spend time learning about organizations before launching an attack.\nPublicly available calendars can help attackers understand organizational relationships\nand determine when specific users may be more vulnerable to an attack, such as when\nthey are traveling.",
        "impact": "This functionality is not widely used. As a result, it is unlikely that implementation of this\nsetting will cause an impact to most users. Users that do utilize this functionality are\nlikely to experience a minor inconvenience when scheduling meetings or synchronizing\ncalendars with people outside the tenant.",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft 365 admin center https://admin.microsoft.com.\n2. Click to expand Settings select Org settings.\n3. In the Services section click Calendar.\n4. Verify Let your users share their calendars with people outside of\nyour organization who have Office 365 or Exchange is unchecked.\nTo audit using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following Exchange Online PowerShell command:\nGet-SharingPolicy -Identity \"Default Sharing Policy\"\n3. Verify Enabled is set to False\nPage 47",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft 365 admin center https://admin.microsoft.com.\n2. Click to expand Settings select Org settings.\n3. In the Services section click Calendar.\n4. Uncheck Let your users share their calendars with people outside\nof your organization who have Office 365 or Exchange.\n5. Click Save.\nTo remediate using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following Exchange Online PowerShell command:\nSet-SharingPolicy -Identity \"Default Sharing Policy\" -Enabled $False",
        "default_value": "Enabled (True)",
        "references": "1. https://learn.microsoft.com/en-us/microsoft-365/admin/manage/share-calendars-\nwith-external-users?view=o365-worldwide\nPage 48\nAdditional Information:\nThe following script can be used to audit any mailboxes that might be sharing\ncalendars prior to disabling the feature globally:\n$mailboxes = Get-Mailbox -ResultSize Unlimited\nforeach ($mailbox in $mailboxes) {\n# Get the name of the default calendar folder (depends on the mailbox's\nlanguage)\n$calendarFolder = [string](Get-ExoMailboxFolderStatistics\n$mailbox.PrimarySmtpAddress -FolderScope Calendar| Where-Object {\n$_.FolderType -eq 'Calendar' }).Name\n# Get users calendar folder settings for their default Calendar folder\n# calendar has the format identity:\\<calendar folder name>\n$calendar = Get-MailboxCalendarFolder -Identity\n\"$($mailbox.PrimarySmtpAddress):\\$calendarFolder\"\nif ($calendar.PublishEnabled) {\nWrite-Host -ForegroundColor Yellow \"Calendar publishing is enabled\nfor $($mailbox.PrimarySmtpAddress) on $($calendar.PublishedCalendarUrl)\"\n}\n}"
    },
    {
        "id": "1.3.4",
        "title": "(L1) Ensure 'User owned apps and services' is restricted (Manual)",
        "profile": "• E3 Level 1",
        "description": "By default, users can install add-ins in their Microsoft Word, Excel, and PowerPoint\napplications, allowing data access within the application.\nDo not allow users to install add-ins in Word, Excel, or PowerPoint.",
        "rationale": "Attackers commonly use vulnerable and custom-built add-ins to access data in user\napplications.\nWhile allowing users to install add-ins by themselves does allow them to easily acquire\nuseful add-ins that integrate with Microsoft applications, it can represent a risk if not\nused and monitored carefully.\nDisable future user's ability to install add-ins in Microsoft Word, Excel, or PowerPoint\nhelps reduce your threat-surface and mitigate this risk.",
        "impact": "Implementation of this change will impact both end users and administrators. End users\nwill not be able to install add-ins that they may want to install.",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft 365 admin center https://admin.microsoft.com.\n2. Click to expand Settings > Org settings.\n3. In Services select User owned apps and services.\n4. Verify Let users access the Office Store and Let users start trials\non behalf of your organization are not checked.\nPage 50",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft 365 admin center https://admin.microsoft.com.\n2. Click to expand Settings > Org settings.\n3. In Services select User owned apps and services.\n4. Uncheck Let users access the Office Store and Let users start\ntrials on behalf of your organization.\n5. Click Save.",
        "default_value": "Let users access the Office Store is Checked\nLet users start trials on behalf of your organization is Checked",
        "references": "1. https://learn.microsoft.com/en-us/microsoft-365/admin/manage/manage-addins-\nin-the-admin-center?view=o365-worldwide#manage-add-in-downloads-by-\nturning-onoff-the-office-store-across-all-apps-except-outlook"
    },
    {
        "id": "1.3.5",
        "title": "(L1) Ensure internal phishing protection for Forms is enabled (Manual)",
        "profile": "• E3 Level 1",
        "description": "Microsoft Forms can be used for phishing attacks by asking personal or sensitive\ninformation and collecting the results. Microsoft 365 has built-in protection that will\nproactively scan for phishing attempt in forms such personal information request.",
        "rationale": "Enabling internal phishing protection for Microsoft Forms will prevent attackers using\nforms for phishing attacks by asking personal or other sensitive information and URLs.",
        "impact": "If potential phishing was detected, the form will be temporarily blocked and cannot be\ndistributed, and response collection will not happen until it is unblocked by the\nadministrator or keywords were removed by the creator.",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft 365 admin center https://admin.microsoft.com.\n2. Click to expand Settings then select Org settings.\n3. Under Services select Microsoft Forms.\n4. Ensure the checkbox labeled Add internal phishing protection is checked\nunder Phishing protection.",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft 365 admin center https://admin.microsoft.com.\n2. Click to expand Settings then select Org settings.\n3. Under Services select Microsoft Forms.\n4. Click the checkbox labeled Add internal phishing protection under\nPhishing protection.\n5. Click Save.",
        "default_value": "Internal Phishing Protection is enabled.\nPage 52",
        "references": "1. https://learn.microsoft.com/en-US/microsoft-forms/administrator-settings-\nmicrosoft-forms\n2. https://learn.microsoft.com/en-US/microsoft-forms/review-unblock-forms-users-\ndetected-blocked-potential-phishing"
    },
    {
        "id": "1.3.6",
        "title": "(L2) Ensure the customer lockbox feature is enabled (Automated)",
        "profile": "• E5 Level 2",
        "description": "Customer Lockbox is a security feature that provides an additional layer of control and\ntransparency to customer data in Microsoft 365. It offers an approval process for\nMicrosoft support personnel to access organization data and creates an audited trail to\nmeet compliance requirements.",
        "rationale": "Enabling this feature protects organizational data against data spillage and exfiltration.",
        "impact": "Administrators will need to grant Microsoft access to the tenant environment prior to a\nMicrosoft engineer accessing the environment for support or troubleshooting.",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft 365 admin center https://admin.microsoft.com.\n2. Click to expand Settings then select Org settings.\n3. Select Security & privacy tab.\n4. Click Customer lockbox.\n5. Ensure the box labeled Require approval for all data access requests\nis checked.\nTo audit using SecureScore:\n1. Navigate to the Microsoft 365 SecureScore portal.\nhttps://securescore.microsoft.com\n2. Search for Turn on customer lockbox feature under Improvement\nactions.\nPage 54\nTo audit using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\nGet-OrganizationConfig | Select-Object CustomerLockBoxEnabled\n3. Verify the value is set to True.",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft 365 admin center https://admin.microsoft.com.\n2. Click to expand Settings then select Org settings.\n3. Select Security & privacy tab.\n4. Click Customer lockbox.\n5. Check the box Require approval for all data access requests.\n6. Click Save.\nTo remediate using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\nSet-OrganizationConfig -CustomerLockBoxEnabled $true",
        "default_value": "Require approval for all data access requests - Unchecked\nCustomerLockboxEnabled - False",
        "references": "1. https://learn.microsoft.com/en-us/azure/security/fundamentals/customer-lockbox-\noverview"
    },
    {
        "id": "1.3.7",
        "title": "(L2) Ensure 'third-party storage services' are restricted in 'Microsoft 365 on the web'\n(Manual)",
        "profile": "• E3 Level 2",
        "description": "Third-party storage can be enabled for users in Microsoft 365, allowing them to store\nand share documents using services such as Dropbox, alongside OneDrive and team\nsites.\nEnsure Microsoft 365 on the web third-party storage services are restricted.",
        "rationale": "By using external storage services an organization may increase the risk of data\nbreaches and unauthorized access to confidential information. Additionally, third-party\nservices may not adhere to the same security standards as the organization, making it\ndifficult to maintain data privacy and security.",
        "impact": "Impact associated with this change is highly dependent upon current practices in the\ntenant. If users do not use other storage providers, then minimal impact is likely.\nHowever, if users do regularly utilize providers outside of the tenant this will affect their\nability to continue to do so.",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft 365 admin center https://admin.microsoft.com\n2. Go to Settings > Org Settings > Services > Microsoft 365 on the web\n3. Ensure Let users open files stored in third-party storage services\nin Microsoft 365 on the web is not checked.",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft 365 admin center https://admin.microsoft.com\n2. Go to Settings > Org Settings > Services > Microsoft 365 on the web\n3. Uncheck Let users open files stored in third-party storage\nservices in Microsoft 365 on the web\nPage 56",
        "default_value": "Enabled - Users are able to open files stored in third-party storage services",
        "references": "1. https://learn.microsoft.com/en-us/microsoft-365/admin/setup/set-up-file-storage-\nand-sharing?view=o365-worldwide#enable-or-disable-third-party-storage-\nservices"
    },
    {
        "id": "1.3.8",
        "title": "(L2) Ensure that Sways cannot be shared with people outside of your organization\n(Manual)",
        "profile": "• E3 Level 2",
        "description": "Sway is a Microsoft 365 app that lets organizations create interactive, web-based\npresentations using images, text, videos and other media. Its design engine simplifies\nthe process, allowing for quick customization. Presentations can then be shared via a\nlink.\nThis setting controls user Sway sharing capability, both within and outside of the\norganization. By default, Sway is enabled for everyone in the organization.",
        "rationale": "Disable external sharing of Sway documents that can contain sensitive information to\nprevent accidental or arbitrary data leaks.",
        "impact": "Interactive reports, presentations, newsletters, and other items created in Sway will not\nbe shared outside the organization by users.",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft 365 admin center https://admin.microsoft.com.\n2. Click to expand Settings then select Org settings.\n3. Under Services select Sway.\n4. Confirm that under Sharing the following is not checked\no Option: Let people in your organization share their sways\nwith people outside your organization.",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft 365 admin center https://admin.microsoft.com.\n2. Click to expand Settings then select Org settings.\n3. Under Services select Sway\no Uncheck: Let people in your organization share their sways\nwith people outside your organization.\n4. Click Save.\nPage 58",
        "default_value": "Let people in your organization share their sways with people outside\nyour organization - Enabled",
        "references": "1. https://support.microsoft.com/en-us/office/administrator-settings-for-sway-\nd298e79b-b6ab-44c6-9239-aa312f5784d4\n2. https://learn.microsoft.com/en-us/office365/servicedescriptions/microsoft-sway-\nservice-description"
    },
    {
        "id": "2.1",
        "title": "Email & collaboration",
        "profile": "• E3 Level 2",
        "description": "Microsoft 365 Groups is the foundational membership service that drives all teamwork\nacross Microsoft 365. With Microsoft 365 Groups, you can give a group of people\naccess to a collection of shared resources. While there are several different group types\nthis recommendation concerns Microsoft 365 Groups.\nIn the Administration panel, when a group is created, the default privacy value is\n\"Public\".",
        "rationale": "Ensure that only organizationally managed and approved public groups exist. When a\ngroup has a \"public\" privacy, users may access data related to this group (e.g.\nSharePoint), through three methods:\n• By using the Azure portal, and adding themselves into the public group\n• By requesting access to the group from the Group application of the Access\nPanel\n• By accessing the SharePoint URL\nAdministrators are notified when a user uses the Azure Portal. Requesting access to the\ngroup forces users to send a message to the group owner, but they still have immediate\naccess to the group. The SharePoint URL is usually guessable and can be found from\nthe Group application of the Access Panel. If group privacy is not controlled, any user\nmay access sensitive information, according to the group they try to access.\nNote: Public in this case means public to the identities within the organization.",
        "impact": "If the recommendation is applied, group owners could receive more access requests\nthan usual, especially regarding groups originally meant to be public.\nPage 32",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft 365 admin center https://admin.microsoft.com.\n2. Click to expand Teams & groups select Active teams & groups.\n3. On the Active teams and groups page, check that no groups have the status\n'Public' in the privacy column.\nTo audit using PowerShell:\n1. Connect to the Microsoft Graph service using Connect-MgGraph -Scopes\n\"Group.Read.All\".\n2. Run the following Microsoft Graph PowerShell command:\nGet-MgGroup | where {$_.Visibility -eq \"Public\"} | select\nDisplayName,Visibility\n3. Ensure Visibility is Private for each group.",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft 365 admin center https://admin.microsoft.com.\n2. Click to expand Teams & groups select Active teams & groups..\n3. On the Active teams and groups page, select the group's name that is public.\n4. On the popup groups name page, Select Settings.\n5. Under Privacy, select Private.",
        "default_value": "Public when created from the Administration portal; private otherwise.",
        "references": "1. https://learn.microsoft.com/en-us/entra/identity/users/groups-self-service-\nmanagement\n2. https://learn.microsoft.com/en-us/microsoft-365/admin/create-groups/compare-\ngroups?view=o365-worldwide\nPage 33"
    },
    {
        "id": "2.1.1",
        "title": "(L2) Ensure Safe Links for Office Applications is Enabled (Automated)",
        "profile": "• E5 Level 2",
        "description": "Enabling Safe Links policy for Office applications allows URL's that exist inside of Office\ndocuments and email applications opened by Office, Office Online and Office mobile to\nbe processed against Defender for Office time-of-click verification and rewritten if\nrequired.\nNote: E5 Licensing includes a number of Built-in Protection policies. When auditing\npolicies note which policy you are viewing, and keep in mind CIS recommendations\noften extend the Default or Build-in Policies provided by MS. In order to Pass the\nhighest priority policy must match all settings recommended.",
        "rationale": "Safe Links for Office applications extends phishing protection to documents and emails\nthat contain hyperlinks, even after they have been delivered to a user.",
        "impact": "User impact associated with this change is minor - users may experience a very short\ndelay when clicking on URLs in Office documents before being directed to the\nrequested site. Users should be informed of the change as, in the event a link is unsafe\nand blocked, they will receive a message that it has been blocked.\nPage 61",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft 365 Defender https://security.microsoft.com\n2. Under Email & collaboration select Policies & rules\n3. Select Threat policies then Safe Links\n4. Inspect each policy and attempt to identify one that matches the parameters\noutlined below.\n5. Scroll down the pane and click on Edit Protection settings (Global Readers\nwill look for on or off values)\n6. Ensure the following protection settings are set as outlined:\nEmail\no Checked On: Safe Links checks a list of known, malicious\nlinks when users click links in email. URLs are rewritten by\ndefault\no Checked Apply Safe Links to email messages sent within the\norganization\no Checked Apply real-time URL scanning for suspicious links\nand links that point to files\no Checked Wait for URL scanning to complete before delivering\nthe message\no Unchecked Do not rewrite URLs, do checks via Safe Links API\nonly.\nTeams\no Checked On: Safe Links checks a list of known, malicious\nlinks when users click links in Microsoft Teams. URLs are\nnot rewritten\nOffice 365 Apps\no Checked On: Safe Links checks a list of known, malicious\nlinks when users click links in Microsoft Office apps. URLs\nare not rewritten\nClick protection settings\no Checked Track user clicks\no Unchecked Let users click through the original URL\n7. There is no recommendation for organization branding.\n8. Click close\nPage 62\nTo audit using PowerShell:\n1. Connect using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\nGet-SafeLinksPolicy | Format-Table Name\n3. Once this returns the list of policies run the following command to view the\npolicies.\nGet-SafeLinksPolicy -Identity \"Policy Name\"\n4. Verify the value for the following.\no EnableSafeLinksForEmail: True\no EnableSafeLinksForTeams: True\no EnableSafeLinksForOffice: True\no TrackClicks: True\no AllowClickThrough: False\no ScanUrls: True\no EnableForInternalSenders: True\no DeliverMessageAfterScan: True\no DisableUrlRewrite: False\nPage 63",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft 365 Defender https://security.microsoft.com\n2. Under Email & collaboration select Policies & rules\n3. Select Threat policies then Safe Links\n4. Click on +Create\n5. Name the policy then click Next\n6. In Domains select all valid domains for the organization and Next\n7. Ensure the following URL & click protection settings are defined:\nEmail\no Checked On: Safe Links checks a list of known, malicious\nlinks when users click links in email. URLs are rewritten by\ndefault\no Checked Apply Safe Links to email messages sent within the\norganization\no Checked Apply real-time URL scanning for suspicious links\nand links that point to files\no Checked Wait for URL scanning to complete before delivering\nthe message\no Unchecked Do not rewrite URLs, do checks via Safe Links API\nonly.\nTeams\no Checked On: Safe Links checks a list of known, malicious\nlinks when users click links in Microsoft Teams. URLs are\nnot rewritten\nOffice 365 Apps\no Checked On: Safe Links checks a list of known, malicious\nlinks when users click links in Microsoft Office apps. URLs\nare not rewritten\nClick protection settings\no Checked Track user clicks\no Unchecked Let users click through the original URL\no There is no recommendation for organization branding.\n8. Click Next twice and finally Submit\nPage 64\nTo remediate using PowerShell:\n1. Connect using Connect-ExchangeOnline.\n2. Run the following PowerShell script to create a policy at highest priority that will\napply to all valid domains on the tenant:\n# Create the Policy\n$params = @{\nName = \"CIS SafeLinks Policy\"\nEnableSafeLinksForEmail = $true\nEnableSafeLinksForTeams = $true\nEnableSafeLinksForOffice = $true\nTrackClicks = $true\nAllowClickThrough = $false\nScanUrls = $true\nEnableForInternalSenders = $true\nDeliverMessageAfterScan = $true\nDisableUrlRewrite = $false\n}\nNew-SafeLinksPolicy @params\n# Create the rule for all users in all valid domains and associate with\nPolicy\nNew-SafeLinksRule -Name \"CIS SafeLinks\" -SafeLinksPolicy \"CIS SafeLinks\nPolicy\" -RecipientDomainIs (Get-AcceptedDomain).Name -Priority 0\nReferences:\n1. https://learn.microsoft.com/en-us/defender-office-365/safe-links-policies-\nconfigure?view=o365-worldwide\n2. https://learn.microsoft.com/en-us/powershell/module/exchange/set-\nsafelinkspolicy?view=exchange-ps\n3. https://learn.microsoft.com/en-us/defender-office-365/preset-security-\npolicies?view=o365-worldwide\nCIS Controls:\nControls\nControl IG 1 IG 2 IG 3\nVersion\n10.1 Deploy and Maintain Anti-Malware Software\nv8 ● ● ●\nDeploy and maintain anti-malware software on all enterprise assets.\n7.4 Maintain and Enforce Network-Based URL Filters\nEnforce network-based URL filters that limit a system's ability to connect to\nv7\nwebsites not approved by the organization. This filtering shall be enforced for each\n● ●\nof the organization's systems, whether they are physically at an organization's\nfacilities or not.\nPage 65",
        "references": "1. https://learn.microsoft.com/en-us/defender-office-365/safe-links-policies-\nconfigure?view=o365-worldwide\n2. https://learn.microsoft.com/en-us/powershell/module/exchange/set-\nsafelinkspolicy?view=exchange-ps\n3. https://learn.microsoft.com/en-us/defender-office-365/preset-security-\npolicies?view=o365-worldwide"
    },
    {
        "id": "2.1.2",
        "title": "(L1) Ensure the Common Attachment Types Filter is enabled (Automated)",
        "profile": "• E3 Level 1",
        "description": "The Common Attachment Types Filter lets a user block known and custom malicious\nfile types from being attached to emails.",
        "rationale": "Blocking known malicious file types can help prevent malware-infested files from\ninfecting a host.",
        "impact": "Blocking common malicious file types should not cause an impact in modern computing\nenvironments.",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft 365 Defender https://security.microsoft.com.\n2. Click to expand Email & collaboration select Policies & rules.\n3. On the Policies & rules page select Threat policies.\n4. Under Policies select Anti-malware and click on the Default (Default)\npolicy.\n5. On the policy page that appears on the righthand pane, under Protection\nsettings, verify that the Enable the common attachments filter has the\nvalue of On.\nTo audit using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following Exchange Online PowerShell command:\nGet-MalwareFilterPolicy -Identity Default | Select-Object EnableFileFilter\n3. Verify EnableFileFilter is set to True.\nNote: Audit and Remediation guidance may focus on the Default policy however, if a\nCustom Policy exists in the organization's tenant, then ensure the setting is set as\noutlined in the highest priority policy listed.\nPage 66",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft 365 Defender https://security.microsoft.com.\n2. Click to expand Email & collaboration select Policies & rules.\n3. On the Policies & rules page select Threat policies.\n4. Under polices select Anti-malware and click on the Default (Default) policy.\n5. On the Policy page that appears on the right hand pane scroll to the bottom and\nclick on Edit protection settings, check the Enable the common\nattachments filter.\n6. Click Save.\nTo remediate using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following Exchange Online PowerShell command:\nSet-MalwareFilterPolicy -Identity Default -EnableFileFilter $true\nNote: Audit and Remediation guidance may focus on the Default policy however, if a\nCustom Policy exists in the organization's tenant, then ensure the setting is set as\noutlined in the highest priority policy listed.",
        "default_value": "Always on",
        "references": "1. https://learn.microsoft.com/en-us/powershell/module/exchange/get-\nmalwarefilterpolicy?view=exchange-ps\n2. https://learn.microsoft.com/en-us/defender-office-365/anti-malware-policies-\nconfigure?view=o365-worldwide\nPage 67"
    },
    {
        "id": "2.1.3",
        "title": "(L1) Ensure notifications for internal users sending malware is Enabled (Automated)",
        "profile": "• E3 Level 1",
        "description": "Exchange Online Protection (EOP) is the cloud-based filtering service that protects\norganizations against spam, malware, and other email threats. EOP is included in all\nMicrosoft 365 organizations with Exchange Online mailboxes.\nEOP uses flexible anti-malware policies for malware protection settings. These policies\ncan be set to notify Admins of malicious activity.",
        "rationale": "This setting alerts administrators that an internal user sent a message that contained\nmalware. This may indicate an account or machine compromise that would need to be\ninvestigated.",
        "impact": "Notification of account with potential issues should not have an impact on the user.\nPage 69",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft 365 Defender https://security.microsoft.com.\n2. Click to expand E-mail & Collaboration select Policies & rules.\n3. On the Policies & rules page select Threat policies.\n4. Under Policies select Anti-malware.\n5. Click on the Default (Default) policy.\n6. Ensure the setting Notify an admin about undelivered messages from\ninternal senders is set to On and that there is at least one email address\nunder Administrator email address.\nTo audit using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following command:\nGet-MalwareFilterPolicy | fl Identity,\nEnableInternalSenderAdminNotifications, InternalSenderAdminAddress\nNote: Audit and Remediation guidance may focus on the Default policy however, if a\nCustom Policy exists in the organization's tenant, then ensure the setting is set as\noutlined in the highest priority policy listed.\nPage 70",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft 365 Defender https://security.microsoft.com.\n2. Click to expand E-mail & Collaboration select Policies & rules.\n3. On the Policies & rules page select Threat policies.\n4. Under Policies select Anti-malware.\n5. Click on the Default (Default) policy.\n6. Click on Edit protection settings and change the settings for Notify an\nadmin about undelivered messages from internal senders to On and\nenter the email address of the administrator who should be notified under\nAdministrator email address.\n7. Click Save.\nTo remediate using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following command:\nSet-MalwareFilterPolicy -Identity '{Identity Name}' -\nEnableInternalSenderAdminNotifications $True -InternalSenderAdminAddress\n{admin@domain1.com}\nNote: Audit and Remediation guidance may focus on the Default policy however, if a\nCustom Policy exists in the organization's tenant, then ensure the setting is set as\noutlined in the highest priority policy listed.",
        "default_value": "EnableInternalSenderAdminNotifications : False\nInternalSenderAdminAddress : $null\nPage 71",
        "references": "1. https://learn.microsoft.com/en-us/defender-office-365/anti-malware-protection-\nabout\n2. https://learn.microsoft.com/en-us/defender-office-365/anti-malware-policies-\nconfigure"
    },
    {
        "id": "2.1.4",
        "title": "(L2) Ensure Safe Attachments policy is enabled (Automated)",
        "profile": "• E5 Level 2",
        "description": "The Safe Attachments policy helps protect users from malware in email attachments by\nscanning attachments for viruses, malware, and other malicious content. When an email\nattachment is received by a user, Safe Attachments will scan the attachment in a secure\nenvironment and provide a verdict on whether the attachment is safe or not.",
        "rationale": "Enabling Safe Attachments policy helps protect against malware threats in email\nattachments by analyzing suspicious attachments in a secure, cloud-based environment\nbefore they are delivered to the user's inbox. This provides an additional layer of\nsecurity and can prevent new or unseen types of malware from infiltrating the\norganization's network.",
        "impact": "Delivery of email with attachments may be delayed while scanning is occurring.\nPage 73",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft 365 Defender https://security.microsoft.com.\n2. Click to expand E-mail & Collaboration select Policies & rules.\n3. On the Policies & rules page select Threat policies.\n4. Under Policies select Safe Attachments.\n5. Inspect the highest priority policy.\n6. Ensure Users and domains and Included recipient domains are in scope\nfor the organization.\n7. Ensure Safe Attachments detection response: is set to Block - Block\ncurrent and future messages and attachments with detected\nmalware.\n8. Ensure the Quarantine Policy is set to AdminOnlyAccessPolicy.\n9. Ensure the policy is not disabled.\nTo audit using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\nGet-SafeAttachmentPolicy | where-object {$_.Enable -eq \"True\"}",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft 365 Defender https://security.microsoft.com.\n2. Click to expand E-mail & Collaboration select Policies & rules.\n3. On the Policies & rules page select Threat policies.\n4. Under Policies select Safe Attachments.\n5. Click + Create.\n6. Create a Policy Name and Description, and then click Next.\n7. Select all valid domains and click Next.\n8. Select Block.\n9. Quarantine policy is AdminOnlyAccessPolicy.\n10. Leave Enable redirect unchecked.\n11. Click Next and finally Submit.",
        "default_value": "disabled\nPage 74",
        "references": "1. https://learn.microsoft.com/en-us/defender-office-365/safe-attachments-about\n2. https://learn.microsoft.com/en-us/defender-office-365/safe-attachments-policies-\nconfigure"
    },
    {
        "id": "2.1.5",
        "title": "(L2) Ensure Safe Attachments for SharePoint, OneDrive, and Microsoft Teams is\nEnabled (Automated)",
        "profile": "• E5 Level 2",
        "description": "Safe Attachments for SharePoint, OneDrive, and Microsoft Teams scans these services\nfor malicious files.",
        "rationale": "Safe Attachments for SharePoint, OneDrive, and Microsoft Teams protect organizations\nfrom inadvertently sharing malicious files. When a malicious file is detected that file is\nblocked so that no one can open, copy, move, or share it until further actions are taken\nby the organization's security team.",
        "impact": "Impact associated with Safe Attachments is minimal, and equivalent to impact\nassociated with anti-virus scanners in an environment.\nPage 76",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft 365 Defender https://security.microsoft.com\n2. Under Email & collaboration select Policies & rules\n3. Select Threat policies then Safe Attachments.\n4. Click on Global settings\n5. Ensure the toggle is Enabled to Turn on Defender for Office 365 for\nSharePoint, OneDrive, and Microsoft Teams.\n6. Ensure the toggle is Enabled to Turn on Safe Documents for Office\nclients.\n7. Ensure the toggle is Deselected/Disabled to Allow people to click\nthrough Protected View even if Safe Documents identified the file\nas malicious.\nTo audit using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\nGet-AtpPolicyForO365 | fl\nName,EnableATPForSPOTeamsODB,EnableSafeDocs,AllowSafeDocsOpen\nVerify the values for each parameter as below:\nEnableATPForSPOTeamsODB : True\nEnableSafeDocs : True\nAllowSafeDocsOpen : False\nPage 77",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft 365 Defender https://security.microsoft.com\n2. Under Email & collaboration select Policies & rules\n3. Select Threat policies then Safe Attachments.\n4. Click on Global settings\n5. Click to Enable Turn on Defender for Office 365 for SharePoint,\nOneDrive, and Microsoft Teams\n6. Click to Enable Turn on Safe Documents for Office clients\n7. Click to Disable Allow people to click through Protected View even\nif Safe Documents identified the file as malicious.\n8. Click Save\nTo remediate using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\nSet-AtpPolicyForO365 -EnableATPForSPOTeamsODB $true -EnableSafeDocs $true -\nAllowSafeDocsOpen $false\nReferences:\n1. https://learn.microsoft.com/en-us/defender-office-365/safe-attachments-for-spo-\nodfb-teams-about\nCIS Controls:\nControls\nControl IG 1 IG 2 IG 3\nVersion\n9.7 Deploy and Maintain Email Server Anti-Malware\nv8 Protections ●\nDeploy and maintain email server anti-malware protections, such as\nattachment scanning and/or sandboxing.\n10.1 Deploy and Maintain Anti-Malware Software\nv8 ● ● ●\nDeploy and maintain anti-malware software on all enterprise assets.\n7.10 Sandbox All Email Attachments\nv7\nUse sandboxing to analyze and block inbound email attachments with\n●\nmalicious behavior.\n8.1 Utilize Centrally Managed Anti-malware Software\nv7\nUtilize centrally managed anti-malware software to continuously monitor and\n● ●\ndefend each of the organization's workstations and servers.\nPage 78",
        "references": "1. https://learn.microsoft.com/en-us/defender-office-365/safe-attachments-for-spo-\nodfb-teams-about"
    },
    {
        "id": "2.1.6",
        "title": "(L1) Ensure Exchange Online Spam Policies are set to notify administrators (Automated)",
        "profile": "• E3 Level 1",
        "description": "In Microsoft 365 organizations with mailboxes in Exchange Online or standalone\nExchange Online Protection (EOP) organizations without Exchange Online mailboxes,\nemail messages are automatically protected against spam (junk email) by EOP.\nConfigure Exchange Online Spam Policies to copy emails and notify someone when a\nsender in the organization has been blocked for sending spam emails.",
        "rationale": "A blocked account is a good indication that the account in question has been breached\nand an attacker is using it to send spam emails to other people.",
        "impact": "Notification of users that have been blocked should not cause an impact to the user.",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft 365 Defender https://security.microsoft.com.\n2. Click to expand Email & collaboration select Policies & rules > Threat\npolicies.\n3. Under Policies select Anti-spam.\n4. Click on the Anti-spam outbound policy (default).\n5. Verify that Send a copy of suspicious outbound messages or message\nthat exceed these limits to these users and groups is set to On,\nensure the email address is correct.\nTo audit using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\nGet-HostedOutboundSpamFilterPolicy | Select-Object Bcc*, Notify*\n3. Verify both BccSuspiciousOutboundMail and NotifyOutboundSpam are set to\nTrue and the email addresses to be notified are correct.\nPage 79\nNote: Audit and Remediation guidance may focus on the Default policy however, if a\nCustom Policy exists in the organization's tenant, then ensure the setting is set as\noutlined in the highest priority policy listed.",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft 365 Defender https://security.microsoft.com.\n2. Click to expand Email & collaboration select Policies & rules> Threat\npolicies.\n3. Under Policies select Anti-spam.\n4. Click on the Anti-spam outbound policy (default).\n5. Select Edit protection settings then under Notifications\n6. Check Send a copy of suspicious outbound messages or message that\nexceed these limits to these users and groups then enter the desired\nemail addresses.\n7. Check Notify these users and groups if a sender is blocked due to\nsending outbound spam then enter the desired email addresses.\n8. Click Save.\nTo remediate using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\n$BccEmailAddress = @(\"<INSERT-EMAIL>\")\n$NotifyEmailAddress = @(\"<INSERT-EMAIL>\")\nSet-HostedOutboundSpamFilterPolicy -Identity Default -\nBccSuspiciousOutboundAdditionalRecipients $BccEmailAddress -\nBccSuspiciousOutboundMail $true -NotifyOutboundSpam $true -\nNotifyOutboundSpamRecipients $NotifyEmailAddress\nNote: Audit and Remediation guidance may focus on the Default policy however, if a\nCustom Policy exists in the organization's tenant, then ensure the setting is set as\noutlined in the highest priority policy listed.",
        "default_value": "BccSuspiciousOutboundAdditionalRecipients : {}\nBccSuspiciousOutboundMail : False\nNotifyOutboundSpamRecipients : {}\nNotifyOutboundSpam : False",
        "references": "1. https://learn.microsoft.com/en-us/defender-office-365/outbound-spam-protection-\nabout\nPage 80"
    },
    {
        "id": "2.1.7",
        "title": "(L2) Ensure that an anti-phishing policy has been created (Automated)",
        "profile": "• E5 Level 2",
        "description": "By default, Office 365 includes built-in features that help protect users from phishing\nattacks. Set up anti-phishing polices to increase this protection, for example by refining\nsettings to better detect and prevent impersonation and spoofing attacks. The default\npolicy applies to all users within the organization and is a single view to fine-tune anti-\nphishing protection. Custom policies can be created and configured for specific users,\ngroups or domains within the organization and will take precedence over the default\npolicy for the scoped users.",
        "rationale": "Protects users from phishing attacks (like impersonation and spoofing) and uses safety\ntips to warn users about potentially harmful messages.",
        "impact": "Mailboxes that are used for support systems such as helpdesk and billing systems send\nmail to internal users and are often not suitable candidates for impersonation protection.\nCare should be taken to ensure that these systems are excluded from Impersonation\nProtection.\nPage 82",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft 365 Defender https://security.microsoft.com.\n2. Click to expand Email & collaboration select Policies & rules\n3. Select Threat policies.\n4. Under Policies select Anti-phishing.\n5. Ensure an AntiPhish policy exists that is On and meets the following criteria:\n6. Under Users, groups, and domains.\no Verify that the included domains and groups includes a majority of the\norganization.\n7. Under Phishing threshold & protection\no Verify Phishing email threshold is at least 3 - More Aggressive.\no Verify User impersonation protection is On and contains a subset of\nusers.\no Verify Domain impersonation protection is On for owned domains.\no Verify Mailbox intelligence and Mailbox intelligence for\nimpersonations and Spoof intelligence are On.\n8. Under Actions review the following:\no Verify If a message is detected as user impersonation is set to\nQuarantine the message.\no Verify If a message is detected as domain impersonation is set to\nQuarantine the message.\no Verify If Mailbox Intelligence detects an impersonated user is\nset to Quarantine the message.\no Verify First contact safety tip is On.\no Verify User impersonation safety tip is On.\no Verify Domain impersonation safety tip is On.\no Verify Unusual characters safety tip is On.\no Verify Honor DMARC record policy when the message is detected\nas spoof is On.\nNote: DefaultFullAccessWithNotificationPolicy is suggested but not required.\nUsers will be notified that impersonation emails are in the Quarantine.\nPage 83\nTo audit using PowerShell:\n1. Connect to Exchange Online service using Connect-ExchangeOnline.\n2. Run the following Exchange Online PowerShell commands:\n$params = @(\n\"name\",\"Enabled\",\"PhishThresholdLevel\",\"EnableTargetedUserProtection\"\n\"EnableOrganizationDomainsProtection\",\"EnableMailboxIntelligence\"\n\"EnableMailboxIntelligenceProtection\",\"EnableSpoofIntelligence\"\n\"TargetedUserProtectionAction\",\"TargetedDomainProtectionAction\"\n\"MailboxIntelligenceProtectionAction\",\"EnableFirstContactSafetyTips\"\n\"EnableSimilarUsersSafetyTips\",\"EnableSimilarDomainsSafetyTips\"\n\"EnableUnusualCharactersSafetyTips\",\"TargetedUsersToProtect\"\n\"HonorDmarcPolicy\"\n)\nGet-AntiPhishPolicy | fl $params\n3. Verify there is a policy created the matches the values for the following\nparameters:\nEnabled : True\nPhishThresholdLevel : 3\nEnableTargetedUserProtection : True\nEnableOrganizationDomainsProtection : True\nEnableMailboxIntelligence : True\nEnableMailboxIntelligenceProtection : True\nEnableSpoofIntelligence : True\nTargetedUserProtectionAction : Quarantine\nTargetedDomainProtectionAction : Quarantine\nMailboxIntelligenceProtectionAction : Quarantine\nEnableFirstContactSafetyTips : True\nEnableSimilarUsersSafetyTips : True\nEnableSimilarDomainsSafetyTips : True\nEnableUnusualCharactersSafetyTips : True\nTargetedUsersToProtect : {<contains users>}\nHonorDmarcPolicy : True\n4. Verify that TargetedUsersToProtect contains a subset of the organization, up\nto 350 users, for targeted Impersonation Protection.\n5. Use PowerShell to verify the AntiPhishRule is configured and enabled.\nGet-AntiPhishRule |\nft AntiPhishPolicy,Priority,State,SentToMemberOf,RecipientDomainIs\n6. Identity correct rule from the matching AntiPhishPolicy name in step 3. Ensure\nthe rule defines groups or domains that include the majority of the organization\nby inspecting SentToMemberOf or RecipientDomainIs.\nPage 84\nNote: Audit guidance is intended to help identify a qualifying AntiPhish policy+rule that\nmeets the recommended criteria while protecting the majority of the organization. It's\nunderstood some individual user exceptions may exist or exceptions for the entire policy\nif another product stands in as an equivalent control.",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft 365 Defender https://security.microsoft.com.\n2. Click to expand Email & collaboration select Policies & rules\n3. Select Threat policies.\n4. Under Policies select Anti-phishing and click Create.\n5. Name the policy, continuing and clicking Next as needed:\no Add Groups and/or Domains that contain a majority of the organization.\no Set Phishing email threshold to 3 - More Aggressive\no Check Enable users to protect and add up to 350 users.\no Check Enable domains to protect and check Include domains I\nown.\no Check Enable mailbox intelligence (Recommended).\no Check Enable Intelligence for impersonation protection\n(Recommended).\no Check Enable spoof intelligence (Recommended).\n6. Under Actions configure the following:\no Set If a message is detected as user impersonation to\nQuarantine the message.\no Set If a message is detected as domain impersonation to\nQuarantine the message.\no Set If Mailbox Intelligence detects an impersonated user to\nQuarantine the message.\no Leave Honor DMARC record policy when the message is detected\nas spoof checked.\no Check Show first contact safety tip (Recommended).\no Check Show user impersonation safety tip.\no Check Show domain impersonation safety tip.\no Check Show user impersonation unusual characters safety tip.\n7. Finally click Next and Submit the policy.\nNote: DefaultFullAccessWithNotificationPolicy is suggested but not required.\nUsers will be notified that impersonation emails are in the Quarantine.\nPage 85\nTo remediate using PowerShell:\n1. Connect to Exchange Online service using Connect-ExchangeOnline.\n2. Run the following Exchange Online PowerShell script to create an AntiPhish\npolicy:\n# Create the Policy\n$params = @{\nName = \"CIS AntiPhish Policy\"\nPhishThresholdLevel = 3\nEnableTargetedUserProtection = $true\nEnableOrganizationDomainsProtection = $true\nEnableMailboxIntelligence = $true\nEnableMailboxIntelligenceProtection = $true\nEnableSpoofIntelligence = $true\nTargetedUserProtectionAction = 'Quarantine'\nTargetedDomainProtectionAction = 'Quarantine'\nMailboxIntelligenceProtectionAction = 'Quarantine'\nTargetedUserQuarantineTag = 'DefaultFullAccessWithNotificationPolicy'\nMailboxIntelligenceQuarantineTag =\n'DefaultFullAccessWithNotificationPolicy'\nTargetedDomainQuarantineTag = 'DefaultFullAccessWithNotificationPolicy'\nEnableFirstContactSafetyTips = $true\nEnableSimilarUsersSafetyTips = $true\nEnableSimilarDomainsSafetyTips = $true\nEnableUnusualCharactersSafetyTips = $true\nHonorDmarcPolicy = $true\n}\nNew-AntiPhishPolicy @params\n# Create the rule for all users in all valid domains and associate with\nPolicy\nNew-AntiPhishRule -Name $params.Name -AntiPhishPolicy $params.Name -\nRecipientDomainIs (Get-AcceptedDomain).Name -Priority 0\n3. The new policy can be edited in the UI or via PowerShell.\nNote: Remediation guidance is intended to help create a qualifying AntiPhish policy that\nmeets the recommended criteria while protecting the majority of the organization. It's\nunderstood some individual user exceptions may exist or exceptions for the entire policy\nif another product acts as a similiar control.\nReferences:\n1. https://learn.microsoft.com/en-us/defender-office-365/anti-phishing-protection-\nabout\n2. https://learn.microsoft.com/en-us/defender-office-365/anti-phishing-policies-eop-\nconfigure\nPage 86\nCIS Controls:\nControls\nControl IG 1 IG 2 IG 3\nVersion\n9.7 Deploy and Maintain Email Server Anti-Malware\nv8 Protections ●\nDeploy and maintain email server anti-malware protections, such as\nattachment scanning and/or sandboxing.\nv7\n7 Email and Web Browser Protections\nEmail and Web Browser Protections\nPage 87",
        "references": "1. https://learn.microsoft.com/en-us/defender-office-365/anti-phishing-protection-\nabout\n2. https://learn.microsoft.com/en-us/defender-office-365/anti-phishing-policies-eop-\nconfigure\nPage 86"
    },
    {
        "id": "2.1.8",
        "title": "(L1) Ensure that SPF records are published for all Exchange Domains (Manual)",
        "profile": "• E3 Level 1",
        "description": "For each domain that is configured in Exchange, a corresponding Sender Policy\nFramework (SPF) record should be created.",
        "rationale": "SPF records allow Exchange Online Protection and other mail systems to know where\nmessages from domains are allowed to originate. This information can be used by that\nsystem to determine how to treat the message based on if it is being spoofed or is valid.",
        "impact": "There should be minimal impact of setting up SPF records however, organizations\nshould ensure proper SPF record setup as email could be flagged as spam if SPF is not\nsetup appropriately.",
        "audit": "To audit using PowerShell:\n1. Open a command prompt.\n2. Type the following command in PowerShell:\nResolve-DnsName [domain1.com] txt | fl\n3. Ensure that a value exists and that it includes v=spf1\ninclude:spf.protection.outlook.com. This designates Exchange Online as\na designated sender.\nTo verify the SPF records are published, use the REST API for each domain:\nhttps://graph.microsoft.com/v1.0/domains/[DOMAIN.COM]/serviceConfigurationRec\nords\n1. Ensure that a value exists that includes v=spf1\ninclude:spf.protection.outlook.com. This designates Exchange Online as\na designated sender.\nNote: Resolve-DnsName is not available on older versions of Windows prior to\nWindows 8 and Server 2012.\nPage 88",
        "remediation": "To remediate using a DNS Provider:\n1. If all email in your domain is sent from and received by Exchange Online, add the\nfollowing TXT record for each Accepted Domain:\nv=spf1 include:spf.protection.outlook.com -all\n2. If there are other systems that send email in the environment, refer to this article\nfor the proper SPF configuration: https://docs.microsoft.com/en-\nus/office365/SecurityCompliance/set-up-spf-in-office-365-to-help-prevent-\nspoofing.\nReferences:\n1. https://learn.microsoft.com/en-us/microsoft-365/security/office-365-\nsecurity/email-authentication-spf-configure?view=o365-worldwide\nCIS Controls:\nControls\nControl IG 1 IG 2 IG 3\nVersion\n9.5 Implement DMARC\nv8 To lower the chance of spoofed or modified emails from valid domains, ● ●\nimplement DMARC policy and verification, starting with implementing the Sender\nPolicy Framework (SPF) and the DomainKeys Identified Mail (DKIM) standards.\n7.8 Implement DMARC and Enable Receiver-Side\nVerification\nv7 To lower the chance of spoofed or modified emails from valid domains, ● ●\nimplement Domain-based Message Authentication, Reporting and Conformance\n(DMARC) policy and verification, starting by implementing the Sender Policy\nFramework (SPF) and the DomainKeys Identified Mail(DKIM) standards.\nPage 89",
        "references": "1. https://learn.microsoft.com/en-us/microsoft-365/security/office-365-\nsecurity/email-authentication-spf-configure?view=o365-worldwide"
    },
    {
        "id": "2.1.9",
        "title": "(L1) Ensure that DKIM is enabled for all Exchange Online Domains (Automated)",
        "profile": "• E3 Level 1",
        "description": "DKIM is one of the trio of Authentication methods (SPF, DKIM and DMARC) that help\nprevent attackers from sending messages that look like they come from your domain.\nDKIM lets an organization add a digital signature to outbound email messages in the\nmessage header. When DKIM is configured, the organization authorizes it's domain to\nassociate, or sign, its name to an email message using cryptographic authentication.\nEmail systems that get email from this domain can use a digital signature to help verify\nwhether incoming email is legitimate.\nUse of DKIM in addition to SPF and DMARC to help prevent malicious actors using\nspoofing techniques from sending messages that look like they are coming from your\ndomain.",
        "rationale": "By enabling DKIM with Office 365, messages that are sent from Exchange Online will\nbe cryptographically signed. This will allow the receiving email system to validate that\nthe messages were generated by a server that the organization authorized and not\nbeing spoofed.",
        "impact": "There should be no impact of setting up DKIM however, organizations should ensure\nappropriate setup to ensure continuous mail-flow.\nPage 90",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft 365 Defender https://security.microsoft.com/\n2. Expand Email & collaboration > Policies & rules > Threat policies.\n3. Under Rules section click Email authentication settings.\n4. Select DKIM\n5. Click on each domain and confirm that Sign messages for this domain with\nDKIM signatures is Enabled.\n6. A status of Not signing DKIM signatures for this domain is an audit fail.\nTo audit using PowerShell:\n1. Connect to Exchange Online service using Connect-ExchangeOnline.\n2. Run the following Exchange Online PowerShell command:\nGet-DkimSigningConfig\n3. Verify Enabled is set to True\nPage 91",
        "remediation": "To remediate using a DNS Provider:\n1. For each accepted domain in Exchange Online, two DNS entries are required.\nHost name: selector1._domainkey\nPoints to address or value: selector1-\n<domainGUID>._domainkey.<initialDomain>\nTTL: 3600\nHost name: selector2._domainkey\nPoints to address or value: selector2-\n<domainGUID>._domainkey.<initialDomain>\nTTL: 3600\nFor Office 365, the selectors will always be selector1 or selector2.\ndomainGUID is the same as the domainGUID in the customized MX record for your\ncustom domain that appears before mail.protection.outlook.com. For example, in the\nfollowing MX record for the domain contoso.com, the domainGUID is contoso-com:\ncontoso.com. 3600 IN MX 5 contoso-com.mail.protection.outlook.com\nThe initial domain is the domain that you used when you signed up for Office 365. Initial\ndomains always end with on.microsoft.com.\n1. After the DNS records are created, enable DKIM signing in Defender.\n2. Navigate to Microsoft 365 Defender https://security.microsoft.com/\n3. Expand Email & collaboration > Policies & rules > Threat policies.\n4. Under Rules section click Email authentication settings.\n5. Select DKIM\n6. Click on each domain and click Enable next to Sign messages for this\ndomain with DKIM signature.\nFinal remediation step using the Exchange Online PowerShell Module:\n1. Connect to Exchange Online service using Connect-ExchangeOnline.\n2. Run the following Exchange Online PowerShell command:\nSet-DkimSigningConfig -Identity < domainName > -Enabled $True\nReferences:\n1. https://learn.microsoft.com/en-us/microsoft-365/security/office-365-\nsecurity/email-authentication-dkim-configure?view=o365-worldwide\nPage 92\nCIS Controls:\nControls\nControl IG 1 IG 2 IG 3\nVersion\n9.5 Implement DMARC\nv8 To lower the chance of spoofed or modified emails from valid domains, ● ●\nimplement DMARC policy and verification, starting with implementing the Sender\nPolicy Framework (SPF) and the DomainKeys Identified Mail (DKIM) standards.\n7.8 Implement DMARC and Enable Receiver-Side\nVerification\nv7 To lower the chance of spoofed or modified emails from valid domains, ● ●\nimplement Domain-based Message Authentication, Reporting and Conformance\n(DMARC) policy and verification, starting by implementing the Sender Policy\nFramework (SPF) and the DomainKeys Identified Mail(DKIM) standards.\nPage 93",
        "references": "1. https://learn.microsoft.com/en-us/microsoft-365/security/office-365-\nsecurity/email-authentication-dkim-configure?view=o365-worldwide\nPage 92"
    },
    {
        "id": "2.1.10",
        "title": "(L1) Ensure DMARC Records for all Exchange Online domains are published (Manual)",
        "profile": "• E3 Level 1",
        "description": "DMARC, or Domain-based Message Authentication, Reporting, and Conformance,\nassists recipient mail systems in determining the appropriate action to take when\nmessages from a domain fail to meet SPF or DKIM authentication criteria.",
        "rationale": "DMARC strengthens the trustworthiness of messages sent from an organization's\ndomain to destination email systems. By integrating DMARC with SPF (Sender Policy\nFramework) and DKIM (DomainKeys Identified Mail), organizations can significantly\nenhance their defenses against email spoofing and phishing attempts.\nLeaving a DMARC policy set to p=none can result in failed action when a spear phishing\nemail fails DMARC but passes SPF and DKIM checks. Having DMARC fully configured\nis a critical part in preventing business email compromise.",
        "impact": "There should be no impact of setting up DMARC however, organizations should ensure\nappropriate setup to ensure continuous mail-flow.\nPage 94",
        "audit": "To audit using PowerShell:\n1. Open a command prompt.\n2. For each of the Accepted Domains in Exchange Online run the following in\nPowerShell:\nResolve-DnsName _dmarc.[domain1.com] txt\n3. Ensure that the record exists and has at minimum the following flags defined as\nfollows:\nv=DMARC1; (p=quarantine OR p=reject), pct=100, rua=mailto:<reporting\nemail address> and ruf=mailto:<reporting email address>\nThe below example records would pass as they contain a policy that would either\nquarantine or reject messages failing DMARC, the policy affects 100% of mail\npct=100 as well as containing valid reporting addresses:\nv=DMARC1; p=reject; pct=100; rua=mailto:rua@contoso.com;\nruf=mailto:ruf@contoso.com; fo=1\nv=DMARC1; p=reject; pct=100; fo=1; ri=3600; rua=mailto:rua@contoso.com;\nruf=mailto:ruf@contoso.com\nv=DMARC1; p=quarantine; pct=100; sp=none; fo=1; ri=3600;\nrua=mailto:rua@contoso.com; ruf=ruf@contoso.com;\n4. Ensure the Microsoft MOERA domain is also configured.\nResolve-DnsName _dmarc.[tenant].onmicrosoft.com txt\n5. Ensure the record meets the same criteria listed in step #3.\nNote: Resolve-DnsName is not available on older versions of Windows prior to\nWindows 8 and Server 2012.\nPage 95",
        "remediation": "To remediate using a DNS Provider:\n1. For each Exchange Online Accepted Domain, add the following record to DNS:\nRecord: _dmarc.domain1.com\nType: TXT\nValue: v=DMARC1; p=none; rua=mailto:<rua-report@example.com>;\nruf=mailto:<ruf-report@example.com>\n2. This will create a basic DMARC policy that will allow the organization to start\nmonitoring message statistics.\n3. One week is enough time for data generated by the reports to be useful in\nunderstanding email trends and traffic. The final step requires implementing a\npolicy of p=reject OR p=quarantine and pct=100 with the necessary rua and\nruf email addresses defined:\nRecord: _dmarc.domain1.com\nType: TXT\nValue: v=DMARC1; p=reject; pct=100; rua=mailto:<rua-report@example.com>;\nruf=mailto:<ruf-report@example.com>\nAlso remediate the MOREA domain using the UI:\n1. Navigate to the Microsoft 365 admin center https://admin.microsoft.com/\n2. Expand Settings and select Domains.\n3. Select your tenant domain (for example, contoso.onmicrosoft.com).\n4. Select DNS records and click + Add record.\n5. Add a new record with the TXT name of _dmarc with the appropriate values\noutlined above.\nNote: The remediation portion involves a multi-staged approach over a period of time.\nFirst, a baseline of the current state of email will be established with p=none and rua\nand ruf. Once the environment is better understood and reports have been analyzed\nan organization will move to the final state with dmarc record values as outlined in the\naudit section\n.\nMicrosoft has a list of best practices for implementing DMARC that cover these steps in\ndetail.\nPage 96\nReferences:\n1. https://learn.microsoft.com/en-us/defender-office-365/email-authentication-\ndmarc-configure?view=o365-worldwide\n2. https://learn.microsoft.com/en-us/defender-office-365/step-by-step-guides/how-\nto-enable-dmarc-reporting-for-microsoft-online-email-routing-address-moera-and-\nparked-domains?view=o365-worldwide\n3. https://media.defense.gov/2024/May/02/2003455483/-1/-1/0/CSA-NORTH-\nKOREAN-ACTORS-EXPLOIT-WEAK-DMARC.PDF\nCIS Controls:\nControls\nControl IG 1 IG 2 IG 3\nVersion\n9.5 Implement DMARC\nv8 To lower the chance of spoofed or modified emails from valid domains, ● ●\nimplement DMARC policy and verification, starting with implementing the Sender\nPolicy Framework (SPF) and the DomainKeys Identified Mail (DKIM) standards.\n7.8 Implement DMARC and Enable Receiver-Side\nVerification\nv7 To lower the chance of spoofed or modified emails from valid domains, ● ●\nimplement Domain-based Message Authentication, Reporting and Conformance\n(DMARC) policy and verification, starting by implementing the Sender Policy\nFramework (SPF) and the DomainKeys Identified Mail(DKIM) standards.\nPage 97",
        "references": "1. https://learn.microsoft.com/en-us/defender-office-365/email-authentication-\ndmarc-configure?view=o365-worldwide\n2. https://learn.microsoft.com/en-us/defender-office-365/step-by-step-guides/how-\nto-enable-dmarc-reporting-for-microsoft-online-email-routing-address-moera-and-\nparked-domains?view=o365-worldwide\n3. https://media.defense.gov/2024/May/02/2003455483/-1/-1/0/CSA-NORTH-\nKOREAN-ACTORS-EXPLOIT-WEAK-DMARC.PDF"
    },
    {
        "id": "2.1.11",
        "title": "(L2) Ensure comprehensive attachment filtering is applied (Automated)",
        "profile": "• E3 Level 2",
        "description": "The Common Attachment Types Filter lets a user block known and custom malicious\nfile types from being attached to emails. The policy provided by Microsoft covers 53\nextensions, and an additional custom list of extensions can be defined.\nThe list of 186 extensions provided in this recommendation is comprehensive but not\nexhaustive.",
        "rationale": "Blocking known malicious file types can help prevent malware-infested files from\ninfecting a host or performing other malicious attacks such as phishing and data\nextraction.\nDefining a comprehensive list of attachments can help protect against additional\nunknown and known threats. Many legacy file formats, binary files and compressed files\nhave been used as delivery mechanisms for malicious software. Organizations can\nprotect themselves from Business E-mail Compromise (BEC) by allow-listing only the\nfile types relevant to their line of business and blocking all others.",
        "impact": "For file types that are business necessary users will need to use other organizationally\napproved methods to transfer blocked extension types between business partners.",
        "audit": "Note: Utilizing the UI for auditing Anti-malware policies can be very time consuming so\nit is recommended to use a script like the one supplied below.\nTo Audit using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following script:\nPage 98\n# Evaluate each Malware policy. If one exist with more than 120 extensions\nthen\n# the script will output a report showing a list of missing extensions along\nwith\n# other parameters.\n$L2Extensions = @(\n\"7z\", \"a3x\", \"ace\", \"ade\", \"adp\", \"ani\", \"app\", \"appinstaller\",\n\"applescript\", \"application\", \"appref-ms\", \"appx\", \"appxbundle\", \"arj\",\n\"asd\", \"asx\", \"bas\", \"bat\", \"bgi\", \"bz2\", \"cab\", \"chm\", \"cmd\", \"com\",\n\"cpl\", \"crt\", \"cs\", \"csh\", \"daa\", \"dbf\", \"dcr\", \"deb\",\n\"desktopthemepackfile\", \"dex\", \"diagcab\", \"dif\", \"dir\", \"dll\", \"dmg\",\n\"doc\", \"docm\", \"dot\", \"dotm\", \"elf\", \"eml\", \"exe\", \"fxp\", \"gadget\", \"gz\",\n\"hlp\", \"hta\", \"htc\", \"htm\", \"htm\", \"html\", \"html\", \"hwpx\", \"ics\", \"img\",\n\"inf\", \"ins\", \"iqy\", \"iso\", \"isp\", \"jar\", \"jnlp\", \"js\", \"jse\", \"kext\",\n\"ksh\", \"lha\", \"lib\", \"library-ms\", \"lnk\", \"lzh\", \"macho\", \"mam\", \"mda\",\n\"mdb\", \"mde\", \"mdt\", \"mdw\", \"mdz\", \"mht\", \"mhtml\", \"mof\", \"msc\", \"msi\",\n\"msix\", \"msp\", \"msrcincident\", \"mst\", \"ocx\", \"odt\", \"ops\", \"oxps\", \"pcd\",\n\"pif\", \"plg\", \"pot\", \"potm\", \"ppa\", \"ppam\", \"ppkg\", \"pps\", \"ppsm\", \"ppt\",\n\"pptm\", \"prf\", \"prg\", \"ps1\", \"ps11\", \"ps11xml\", \"ps1xml\", \"ps2\",\n\"ps2xml\", \"psc1\", \"psc2\", \"pub\", \"py\", \"pyc\", \"pyo\", \"pyw\", \"pyz\",\n\"pyzw\", \"rar\", \"reg\", \"rev\", \"rtf\", \"scf\", \"scpt\", \"scr\", \"sct\",\n\"searchConnector-ms\", \"service\", \"settingcontent-ms\", \"sh\", \"shb\", \"shs\",\n\"shtm\", \"shtml\", \"sldm\", \"slk\", \"so\", \"spl\", \"stm\", \"svg\", \"swf\", \"sys\",\n\"tar\", \"theme\", \"themepack\", \"timer\", \"uif\", \"url\", \"uue\", \"vb\", \"vbe\",\n\"vbs\", \"vhd\", \"vhdx\", \"vxd\", \"wbk\", \"website\", \"wim\", \"wiz\", \"ws\", \"wsc\",\n\"wsf\", \"wsh\", \"xla\", \"xlam\", \"xlc\", \"xll\", \"xlm\", \"xls\", \"xlsb\", \"xlsm\",\n\"xlt\", \"xltm\", \"xlw\", \"xnk\", \"xps\", \"xsl\", \"xz\", \"z\"\n)\n$MissingCount = 0\n$ExtensionPolicies = $null\n$RLine = $ExtensionReport = @()\n$FilterRules = Get-MalwareFilterRule\n$DateTime = $(((Get-Date).ToUniversalTime()).ToString(\"yyyyMMddTHHmmssZ\"))\n$OutputFilePath = \"$PWD\\CIS-Report_$($DateTime).txt\"\n$RLine += \"$(Get-Date)`n\"\nfunction Test-MalwarePolicy {\nparam (\n$PolicyId\n)\n# Find the matching rule for custom policies\n$FoundRule = $null\n$FoundRule = $FilterRules |\nWhere-Object { $_.MalwareFilterPolicy -eq $PolicyId }\nif ($PolicyId.EnableFileFilter -eq $false) {\n$script:RLine += \"WARNING: Common attachments filter is disabled.\"\n}\nif ($FoundRule.State -eq 'Disabled') {\n$script:RLine += \"WARNING: The Anti-malware rule is disabled.\"\n}\n$script:RLine += \"`nManual review needed - Domains, inclusions and\nexclusions must be valid:\"\nPage 99\n$script:RLine += $FoundRule |\nFormat-List Name, RecipientDomainIs, Sent*, Except*\n}\n# Match any policy that has over 120 extensions defined\n$ExtensionPolicies = Get-MalwareFilterPolicy |\nWhere-Object {$_.FileTypes.Count -gt 120 }\nif (!$ExtensionPolicies) {\nWrite-Host \"`nFAIL: A policy containing the minimum number of extensions\nwas not found.\" -ForegroundColor Red\nWrite-Host \"Only policies with over 120 extensions defined will be\nevaluated.\" -ForegroundColor Red\nExit\n}\n# Check each policy for missing extensions\nforeach ($policy in $ExtensionPolicies) {\n$MissingExtensions = $L2Extensions |\nWhere-Object {\n$extension = $_; -not $policy.FileTypes.Contains($extension)\n}\nif ($MissingExtensions.Count -eq 0) {\n$RLine += \"-\" * 60\n$RLine += \"[FOUND] $($policy.Identity)\"\n$RLine += \"-\" * 60\n$RLine += \"PASS: Policy contains all extensions\"\nTest-MalwarePolicy -PolicyId $policy\n} else {\n$MissingCount++\n$ExtensionReport += @{\nIdentity = $policy.Identity\nMissingExtensions = $MissingExtensions -join ', '\n}\n}\n}\nif ($MissingCount -gt 0) {\nforeach ($fpolicy in $ExtensionReport) {\n$RLine += \"-\" * 60\n$RLine += \"[PARTIAL] $($fpolicy.Identity)\"\n$RLine += \"-\" * 60\n$RLine += \"NOTICE - The following extensions were not found:`n\"\n$RLine += \"$($fpolicy.MissingExtensions)`n\"\nTest-MalwarePolicy -PolicyId $fpolicy.Identity\n}\n}\n# Output the report to a text file\nOut-File -FilePath $OutputFilePath -InputObject $RLine\nGet-Content $OutputFilePath\nWrite-Host \"`nLog file exported to\" $OutputFilePath\n3. Review the exported results which are stored in the present working directory.\n4. A pass for this recommendation is made when an active policy is in place that\ncovers all extensions except for those explicitly defined as an exception by the\nPage 100\norganization. A passing policy must also be enabled and have the\nEnableFileFilter parameter enabled.\n5. Review any manual steps listed in the output, exceptions and inclusions are\norganizational specific.\nNote: The audit procedure intentionally does not include the action taken for matched\nextensions, e.g. Reject with NDR or Quarantine the message. These are considered\norganization specific and are not scored. When FileTypeAction is not specified the\naction will default to Reject the message with a non-delivery receipt (NDR).\nThe Quarantine Policy is also considered organization specific.\nNote 2: Weighting by individual extension risk is beyond the scope of this document.\nOrganizations should evaluate these both independently and based on business need.",
        "remediation": "To Remediate using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following script:\nPage 101\n# Create an attachment policy and associated rule. The rule is\n# intentionally disabled allowing the org to enable it when ready\n$Policy = @{\nName = \"CIS L2 Attachment Policy\"\nEnableFileFilter = $true\nZapEnabled = $true\nEnableInternalSenderAdminNotifications = $true\nInternalSenderAdminAddress = 'admin@contoso.com' # Change this.\n}\n$L2Extensions = @(\n\"7z\", \"a3x\", \"ace\", \"ade\", \"adp\", \"ani\", \"app\", \"appinstaller\",\n\"applescript\", \"application\", \"appref-ms\", \"appx\", \"appxbundle\", \"arj\",\n\"asd\", \"asx\", \"bas\", \"bat\", \"bgi\", \"bz2\", \"cab\", \"chm\", \"cmd\", \"com\",\n\"cpl\", \"crt\", \"cs\", \"csh\", \"daa\", \"dbf\", \"dcr\", \"deb\",\n\"desktopthemepackfile\", \"dex\", \"diagcab\", \"dif\", \"dir\", \"dll\", \"dmg\",\n\"doc\", \"docm\", \"dot\", \"dotm\", \"elf\", \"eml\", \"exe\", \"fxp\", \"gadget\", \"gz\",\n\"hlp\", \"hta\", \"htc\", \"htm\", \"htm\", \"html\", \"html\", \"hwpx\", \"ics\", \"img\",\n\"inf\", \"ins\", \"iqy\", \"iso\", \"isp\", \"jar\", \"jnlp\", \"js\", \"jse\", \"kext\",\n\"ksh\", \"lha\", \"lib\", \"library-ms\", \"lnk\", \"lzh\", \"macho\", \"mam\", \"mda\",\n\"mdb\", \"mde\", \"mdt\", \"mdw\", \"mdz\", \"mht\", \"mhtml\", \"mof\", \"msc\", \"msi\",\n\"msix\", \"msp\", \"msrcincident\", \"mst\", \"ocx\", \"odt\", \"ops\", \"oxps\", \"pcd\",\n\"pif\", \"plg\", \"pot\", \"potm\", \"ppa\", \"ppam\", \"ppkg\", \"pps\", \"ppsm\", \"ppt\",\n\"pptm\", \"prf\", \"prg\", \"ps1\", \"ps11\", \"ps11xml\", \"ps1xml\", \"ps2\",\n\"ps2xml\", \"psc1\", \"psc2\", \"pub\", \"py\", \"pyc\", \"pyo\", \"pyw\", \"pyz\",\n\"pyzw\", \"rar\", \"reg\", \"rev\", \"rtf\", \"scf\", \"scpt\", \"scr\", \"sct\",\n\"searchConnector-ms\", \"service\", \"settingcontent-ms\", \"sh\", \"shb\", \"shs\",\n\"shtm\", \"shtml\", \"sldm\", \"slk\", \"so\", \"spl\", \"stm\", \"svg\", \"swf\", \"sys\",\n\"tar\", \"theme\", \"themepack\", \"timer\", \"uif\", \"url\", \"uue\", \"vb\", \"vbe\",\n\"vbs\", \"vhd\", \"vhdx\", \"vxd\", \"wbk\", \"website\", \"wim\", \"wiz\", \"ws\", \"wsc\",\n\"wsf\", \"wsh\", \"xla\", \"xlam\", \"xlc\", \"xll\", \"xlm\", \"xls\", \"xlsb\", \"xlsm\",\n\"xlt\", \"xltm\", \"xlw\", \"xnk\", \"xps\", \"xsl\", \"xz\", \"z\"\n)\n# Create the policy\nNew-MalwareFilterPolicy @Policy -FileTypes $L2Extensions\n# Create the rule for all accepted domains\n$Rule = @{\nName = $Policy.Name\nEnabled = $false\nMalwareFilterPolicy = $Policy.Name\nRecipientDomainIs = (Get-AcceptedDomain).Name\nPriority = 0\n}\nNew-MalwareFilterRule @Rule\n3. When prepared enable the rule either through the UI or PowerShell.\nNote: Due to the number of extensions the UI method is not covered. The objects can\nhowever be edited in the UI or manually added using the list from the script.\n1. Navigate to Microsoft Defender at https://security.microsoft.com/\n2. Browse to Policies & rules > Threat policies > Anti-malware.\nPage 102",
        "default_value": "The following extensions are blocked by default:\nace, ani, apk, app, appx, arj, bat, cab, cmd, com, deb, dex, dll, docm, elf, exe, hta, img,\niso, jar, jnlp, kext, lha, lib, library, lnk, lzh, macho, msc, msi, msix, msp, mst, pif, ppa,\nppam, reg, rev, scf, scr, sct, sys, uif, vb, vbe, vbs, vxd, wsc, wsf, wsh, xll, xz, z",
        "references": "1. https://learn.microsoft.com/en-us/powershell/module/exchange/get-\nmalwarefilterpolicy?view=exchange-ps\n2. https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/anti-\nmalware-policies-configure?view=o365-worldwide\n3. https://learn.microsoft.com/en-us/office/compatibility/office-file-format-reference"
    },
    {
        "id": "2.1.12",
        "title": "(L1) Ensure the connection filter IP allow list is not used (Automated)",
        "profile": "• E3 Level 1",
        "description": "In Microsoft 365 organizations with Exchange Online mailboxes or standalone\nExchange Online Protection (EOP) organizations without Exchange Online mailboxes,\nconnection filtering and the default connection filter policy identify good or bad source\nemail servers by IP addresses. The key components of the default connection filter\npolicy are IP Allow List, IP Block List and Safe list.\nThe recommended state is IP Allow List empty or undefined.",
        "rationale": "Without additional verification like mail flow rules, email from sources in the IP Allow List\nskips spam filtering and sender authentication (SPF, DKIM, DMARC) checks. This\nmethod creates a high risk of attackers successfully delivering email to the Inbox that\nwould otherwise be filtered. Messages that are determined to be malware or high\nconfidence phishing are filtered.",
        "impact": "This is the default behavior. IP Allow lists may reduce false positives, however, this\nbenefit is outweighed by the importance of a policy which scans all messages\nregardless of the origin. This supports the principle of zero trust.\nPage 104",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft 365 Defender https://security.microsoft.com.\n2. Click to expand Email & collaboration select Policies & rules > Threat\npolicies.\n3. Under Policies select Anti-spam.\n4. Click on the Connection filter policy (Default).\n5. Ensure IP Allow list contains no entries.\nTo audit using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\nGet-HostedConnectionFilterPolicy -Identity Default | fl IPAllowList\n3. Ensure IPAllowList is empty or {}",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft 365 Defender https://security.microsoft.com.\n2. Click to expand Email & collaboration select Policies & rules> Threat\npolicies.\n3. Under Policies select Anti-spam.\n4. Click on the Connection filter policy (Default).\n5. Click Edit connection filter policy.\n6. Remove any IP entries from Always allow messages from the following\nIP addresses or address range:.\n7. Click Save.\nTo remediate using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\nSet-HostedConnectionFilterPolicy -Identity Default -IPAllowList @{}",
        "default_value": "IPAllowList : {}\nPage 105",
        "references": "1. https://learn.microsoft.com/en-us/defender-office-365/connection-filter-policies-\nconfigure\n2. https://learn.microsoft.com/en-us/defender-office-365/create-safe-sender-lists-in-\noffice-365#use-the-ip-allow-list\n3. https://learn.microsoft.com/en-us/defender-office-365/how-policies-and-\nprotections-are-combined#user-and-tenant-settings-conflict"
    },
    {
        "id": "2.1.13",
        "title": "(L1) Ensure the connection filter safe list is off (Automated)",
        "profile": "• E3 Level 1",
        "description": "In Microsoft 365 organizations with Exchange Online mailboxes or standalone\nExchange Online Protection (EOP) organizations without Exchange Online mailboxes,\nconnection filtering and the default connection filter policy identify good or bad source\nemail servers by IP addresses. The key components of the default connection filter\npolicy are IP Allow List, IP Block List and Safe list.\nThe safe list is a pre-configured allow list that is dynamically updated by Microsoft.\nThe recommended safe list state is: Off or False",
        "rationale": "Without additional verification like mail flow rules, email from sources in the IP Allow List\nskips spam filtering and sender authentication (SPF, DKIM, DMARC) checks. This\nmethod creates a high risk of attackers successfully delivering email to the Inbox that\nwould otherwise be filtered. Messages that are determined to be malware or high\nconfidence phishing are filtered.\nThe safe list is managed dynamically by Microsoft, and administrators do not have\nvisibility into which sender are included. Incoming messages from email servers on the\nsafe list bypass spam filtering.",
        "impact": "This is the default behavior. IP Allow lists may reduce false positives, however, this\nbenefit is outweighed by the importance of a policy which scans all messages\nregardless of the origin. This supports the principle of zero trust.\nPage 107",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft 365 Defender https://security.microsoft.com.\n2. Click to expand Email & collaboration select Policies & rules > Threat\npolicies.\n3. Under Policies select Anti-spam.\n4. Click on the Connection filter policy (Default).\n5. Ensure Safe list is Off.\nTo audit using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\nGet-HostedConnectionFilterPolicy -Identity Default | fl EnableSafeList\n3. Ensure EnableSafeList is False",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft 365 Defender https://security.microsoft.com.\n2. Click to expand Email & collaboration select Policies & rules> Threat\npolicies.\n3. Under Policies select Anti-spam.\n4. Click on the Connection filter policy (Default).\n5. Click Edit connection filter policy.\n6. Uncheck Turn on safe list.\n7. Click Save.\nTo remediate using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\nSet-HostedConnectionFilterPolicy -Identity Default -EnableSafeList $false",
        "default_value": "EnableSafeList : False\nPage 108",
        "references": "1. https://learn.microsoft.com/en-us/defender-office-365/connection-filter-policies-\nconfigure\n2. https://learn.microsoft.com/en-us/defender-office-365/create-safe-sender-lists-in-\noffice-365#use-the-ip-allow-list\n3. https://learn.microsoft.com/en-us/defender-office-365/how-policies-and-\nprotections-are-combined#user-and-tenant-settings-conflict"
    },
    {
        "id": "2.1.14",
        "title": "(L1) Ensure inbound anti-spam policies do not contain allowed domains (Automated)",
        "profile": "• E3 Level 1",
        "description": "Anti-spam protection is a feature of Exchange Online that utilizes policies to help to\nreduce the amount of junk email, bulk and phishing emails a mailbox receives. These\npolicies contain lists to allow or block specific senders or domains.\n• The allowed senders list\n• The allowed domains list\n• The blocked senders list\n• The blocked domains list\nThe recommended state is: Do not define any Allowed domains",
        "rationale": "Messages from entries in the allowed senders list or the allowed domains list bypass\nmost email protection (except malware and high confidence phishing) and email\nauthentication checks (SPF, DKIM and DMARC). Entries in the allowed senders list or\nthe allowed domains list create a high risk of attackers successfully delivering email to\nthe Inbox that would otherwise be filtered. The risk is increased even more when\nallowing common domain names as these can be easily spoofed by attackers.\nMicrosoft specifies in its documentation that allowed domains should be used for testing\npurposes only.",
        "impact": "This is the default behavior. Allowed domains may reduce false positives, however, this\nbenefit is outweighed by the importance of having a policy which scans all messages\nregardless of the origin. As an alternative consider sender based lists. This supports the\nprinciple of zero trust.\nPage 110",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft 365 Defender https://security.microsoft.com.\n2. Click to expand Email & collaboration select Policies & rules > Threat\npolicies.\n3. Under Policies select Anti-spam.\n4. Inspect each inbound anti-spam policy\n5. Ensure Allowed domains does not contain any domain names.\n6. Repeat as needed for any additional inbound anti-spam policy.\nTo audit using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\nGet-HostedContentFilterPolicy | ft Identity,AllowedSenderDomains\n3. Ensure AllowedSenderDomains is undefined for each inbound policy.\nNote: Each inbound policy must pass for this recommendation to be considered to be in\na passing state.\nPage 111",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft 365 Defender https://security.microsoft.com.\n2. Click to expand Email & collaboration select Policies & rules> Threat\npolicies.\n3. Under Policies select Anti-spam.\n4. Open each out of compliance inbound anti-spam policy by clicking on it.\n5. Click Edit allowed and blocked senders and domains.\n6. Select Allow domains.\n7. Delete each domain from the domains list.\n8. Click Done > Save.\n9. Repeat as needed.\nTo remediate using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\nSet-HostedContentFilterPolicy -Identity <Policy name> -AllowedSenderDomains\n@{}\nOr, run this to remove allowed domains from all inbound anti-spam policies:\n$AllowedDomains = Get-HostedContentFilterPolicy | Where-Object\n{$_.AllowedSenderDomains}\n$AllowedDomains | Set-HostedContentFilterPolicy -AllowedSenderDomains @{}",
        "default_value": "AllowedSenderDomains : {}",
        "references": "1. https://learn.microsoft.com/en-us/defender-office-365/anti-spam-protection-\nabout#allow-and-block-lists-in-anti-spam-policies"
    },
    {
        "id": "2.2",
        "title": "Cloud apps",
        "profile": "• E3 Level 1",
        "description": "Administrative accounts are special privileged accounts that could have varying levels\nof access to data, users, and settings. Regular user accounts should never be utilized\nfor administrative tasks and care should be taken, in the case of a hybrid environment,\nto keep Administrative accounts separated from on-prem accounts. Administrative\naccounts should not have applications assigned so that they have no access to\npotentially vulnerable services (EX. email, Teams, SharePoint, etc.) and only access to\nperform tasks as needed for administrative purposes.\nEnsure administrative accounts are not On-premises sync enabled.",
        "rationale": "In a hybrid environment, having separate accounts will help ensure that in the event of a\nbreach in the cloud, that the breach does not affect the on-prem environment and vice\nversa.",
        "impact": "Administrative users will have to switch accounts and utilizing login/logout functionality\nwhen performing administrative tasks, as well as not benefiting from SSO. This will\nrequire a migration process from the 'daily driver' account to a dedicated admin account.\nWhen migrating permissions to the admin account, both M365 and Azure RBAC roles\nshould be migrated as well. Once the new admin accounts are created both of these\npermission sets should be moved from the daily driver account to the new admin\naccount. Failure to migrate Azure RBAC roles can cause an admin to not be able to see\ntheir subscriptions/resources while using their admin accounts.\nPage 17",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Identity > Users select All users.\n3. To the right of the search box click the Add filter button.\n4. Add the On-premises sync enabled filter and click Apply.\n5. For each user account known to be in an administrative role verify it is not\npresent in the filtered list.\nTo audit using PowerShell:\n1. Connect to Microsoft Graph using Connect-MgGraph -Scopes\n\"RoleManagement.Read.Directory\",\"User.Read.All\"\n2. Run the following PowerShell script:\n# Get privileged role IDs\n$PrivilegedRoles = $DirectoryRoles | Where-Object {\n$_.DisplayName -like \"*Administrator*\" -or $_.DisplayName -eq \"Global\nReader\"\n}\n# Get the members of these various roles\n$RoleMembers = $PrivilegedRoles | ForEach-Object { Get-MgDirectoryRoleMember\n-DirectoryRoleId $_.Id } |\nSelect-Object Id -Unique\n# Retrieve details about the members in these roles\n$PrivilegedUsers = $RoleMembers | ForEach-Object {\nGet-MgUser -UserId $_.Id -Property UserPrincipalName, DisplayName, Id,\nOnPremisesSyncEnabled\n}\n$PrivilegedUsers | Where-Object { $_.OnPremisesSyncEnabled -eq $true } |\nft DisplayName,UserPrincipalName,OnPremisesSyncEnabled\n3. The script will output any hybrid users that are also members of privileged roles.\nIf nothing returns then no users with that criteria exist.",
        "remediation": "Remediation will require first identifying the privileged accounts that are synced from on-\npremises and then creating a new cloud-only account for that user. Once a replacement\naccount is established, the hybrid account should have its role reduced to that of a non-\nprivileged user or removed depending on the need.",
        "default_value": "N/A\nPage 18",
        "references": "1. https://learn.microsoft.com/en-us/microsoft-365/admin/add-users/add-\nusers?view=o365-worldwide\n2. https://learn.microsoft.com/en-us/microsoft-365/enterprise/protect-your-global-\nadministrator-accounts?view=o365-worldwide\n3. https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/best-\npractices#9-use-cloud-native-accounts-for-microsoft-entra-roles\n4. https://learn.microsoft.com/en-us/entra/fundamentals/whatis\n5. https://learn.microsoft.com/en-us/entra/identity/role-based-access-\ncontrol/permissions-reference"
    },
    {
        "id": "2.3",
        "title": "Audit"
    },
    {
        "id": "2.4",
        "title": "System"
    },
    {
        "id": "2.4.1",
        "title": "(L1) Ensure Priority account protection is enabled and configured (Manual)",
        "profile": "• E5 Level 1",
        "description": "Identify priority accounts to utilize Microsoft 365's advanced custom security features.\nThis is an essential tool to bolster protection for users who are frequently targeted due\nto their critical positions, such as executives, leaders, managers, or others who have\naccess to sensitive, confidential, financial, or high-priority information.\nOnce these accounts are identified, several services and features can be enabled,\nincluding threat policies, enhanced sign-in protection through conditional access\npolicies, and alert policies, enabling faster response times for incident response teams.",
        "rationale": "Enabling priority account protection for users in Microsoft 365 is necessary to enhance\nsecurity for accounts with access to sensitive data and high privileges, such as CEOs,\nCISOs, CFOs, and IT admins. These priority accounts are often targeted by spear\nphishing or whaling attacks and require stronger protection to prevent account\ncompromise.\nTo address this, Microsoft 365 and Microsoft Defender for Office 365 offer several key\nfeatures that provide extra security, including the identification of incidents and alerts\ninvolving priority accounts and the use of built-in custom protections designed\nspecifically for them.\nPage 114",
        "audit": "Audit with a 3-step process\nStep 1: Verify Priority account protection is enabled:\n1. Navigate to Microsoft 365 Defender https://security.microsoft.com/\n2. Click to expand System select Settings.\n3. Select E-mail & collaboration > Priority account protection\n4. Ensure Priority account protection is set to On\nStep 2: Verify that priority accounts are identified and tagged accordingly:\n5. Select User tags\n6. Select the PRIORITY ACCOUNT tag and click Edit\n7. Verify the assigned members match the organization's defined priority accounts\nor groups.\n8. Repeat the previous 2 steps for any additional tags identified, such as Finance or\nHR.\nStep 3: Ensure alerts are configured:\n9. Expand E-mail & Collaboration on the left column.\n10. Select Policies & rules > Alert policy\n11. Ensure alert policies are configured for priority accounts, enabled and have a\nvalid recipient. The tags column can be used to identify policies using a specific\ntag.\nPage 115",
        "remediation": "Remediate with a 3-step process\nStep 1: Enable Priority account protection in Microsoft 365 Defender:\n1. Navigate to Microsoft 365 Defender https://security.microsoft.com/\n2. Click to expand System select Settings.\n3. Select E-mail & Collaboration > Priority account protection\n4. Ensure Priority account protection is set to On\nStep 2: Tag priority accounts:\n5. Select User tags\n6. Select the PRIORITY ACCOUNT tag and click Edit\n7. Select Add members to add users, or groups. Groups are recommended.\n8. Repeat the previous 2 steps for any additional tags needed, such as Finance or\nHR.\n9. Next and Submit.\nStep 3: Configure E-mail alerts for Priority Accounts:\n10. Expand E-mail & Collaboration on the left column.\n11. Select New Alert Policy\n12. Enter a valid policy Name & Description. Set Severity to High and Category to\nThreat management.\n13. Set Activity is to Detected malware in an e-mail message\n14. Mail direction is Inbound\n15. Select Add Condition and User: recipient tags are\n16. In the Selection option field add chosen priority tags such as Priority account.\n17. Select Every time an activity matches the rule.\n18. Next and verify valid recipient(s) are selected.\n19. Next and select Yes, turn it on right away. Click Submit to save the alert.\n20. Repeat steps 10 - 18 for the Activity field Activity is: Phishing email\ndetected at time of delivery\nNOTE: Any additional activity types may be added as needed. Above are the minimum\nrecommended.",
        "default_value": "By default, priority accounts are undefined.\nPage 116",
        "references": "1. https://learn.microsoft.com/en-us/microsoft-365/admin/setup/priority-accounts\n2. https://learn.microsoft.com/en-us/defender-office-365/priority-accounts-security-\nrecommendations"
    },
    {
        "id": "2.4.2",
        "title": "(L1) Ensure Priority accounts have 'Strict protection' presets applied (Manual)",
        "profile": "• E5 Level 1",
        "description": "Preset security policies have been established by Microsoft, utilizing observations and\nexperiences within datacenters to strike a balance between the exclusion of malicious\ncontent from users and limiting unwarranted disruptions. These policies can apply to all,\nor select users and encompass recommendations for addressing spam, malware, and\nphishing threats. The policy parameters are pre-determined and non-adjustable.\nStrict protection has the most aggressive protection of the 3 presets.\n• EOP: Anti-spam, Anti-malware and Anti-phishing\n• Defender: Spoof protection, Impersonation protection and Advanced phishing\n• Defender: Safe Links and Safe Attachments\nNOTE: The preset security polices cannot target Priority account TAGS currently,\ngroups should be used instead.",
        "rationale": "Enabling priority account protection for users in Microsoft 365 is necessary to enhance\nsecurity for accounts with access to sensitive data and high privileges, such as CEOs,\nCISOs, CFOs, and IT admins. These priority accounts are often targeted by spear\nphishing or whaling attacks and require stronger protection to prevent account\ncompromise.\nThe implementation of stringent, pre-defined policies may result in instances of false\npositive, however, the benefit of requiring the end-user to preview junk email before\naccessing their inbox outweighs the potential risk of mistakenly perceiving a malicious\nemail as safe due to its placement in the inbox.",
        "impact": "Strict policies are more likely to cause false positives in anti-spam, phishing,\nimpersonation, spoofing and intelligence responses.\nPage 118",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft 365 Defender https://security.microsoft.com/\n2. Select to expand E-mail & collaboration.\n3. Select Policies & rules > Threat policies.\n4. From here visit each section in turn: Anti-phishing Anti-spam Anti-malware\nSafe Attachments Safe Links\n5. Ensure in each there is a policy named Strict Preset Security Policy\nwhich includes the organization's priority Accounts/Groups.",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft 365 Defender https://security.microsoft.com/\n2. Select to expand E-mail & collaboration.\n3. Select Policies & rules > Threat policies > Preset security policies.\n4. Click to Manage protection settings for Strict protection preset.\n5. For Apply Exchange Online Protection select at minimum Specific\nrecipients and include the Accounts/Groups identified as Priority Accounts.\n6. For Apply Defender for Office 365 Protection select at minimum\nSpecific recipients and include the Accounts/Groups identified as Priority\nAccounts.\n7. For Impersonation protection click Next and add valid e-mails or priority\naccounts both internal and external that may be subject to impersonation.\n8. For Protected custom domains add the organization's domain name, along\nside other key partners.\n9. Click Next and finally Confirm",
        "default_value": "By default, presets are not applied to any users or groups.",
        "references": "1. https://learn.microsoft.com/en-us/defender-office-365/preset-security-\npolicies?view=o365-worldwide\n2. https://learn.microsoft.com/en-us/defender-office-365/priority-accounts-security-\nrecommendations\n3. https://learn.microsoft.com/en-us/defender-office-365/recommended-settings-for-\neop-and-office365?view=o365-worldwide#impersonation-settings-in-anti-\nphishing-policies-in-microsoft-defender-for-office-365\nPage 119"
    },
    {
        "id": "2.4.3",
        "title": "(L2) Ensure Microsoft Defender for Cloud Apps is enabled and configured (Manual)",
        "profile": "• E5 Level 2",
        "description": "Microsoft Defender for Cloud Apps is a Cloud Access Security Broker (CASB). It\nprovides visibility into suspicious activity in Microsoft 365, enabling investigation into\npotential security issues and facilitating the implementation of remediation measures if\nnecessary.\nSome risk detection methods provided by Entra Identity Protection also require\nMicrosoft Defender for Cloud Apps:\n• Suspicious manipulation of inbox rules\n• Suspicious inbox forwarding\n• New country detection\n• Impossible travel detection\n• Activity from anonymous IP addresses\n• Mass access to sensitive files",
        "rationale": "Security teams can receive notifications of triggered alerts for atypical or suspicious\nactivities, see how the organization's data in Microsoft 365 is accessed and used,\nsuspend user accounts exhibiting suspicious activity, and require users to log back in to\nMicrosoft 365 apps after an alert has been triggered.",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft 365 Defender https://security.microsoft.com/\n2. Click to expand System select Settings > Cloud apps.\n3. Scroll to Connected apps and select App connectors.\n4. Ensure that Microsoft 365 and Microsoft Azure both show in the list as\nConnected.\n5. Go to Cloud Discovery > Microsoft Defender for Endpoint and check if\nthe integration is enabled.\n6. Go to Information Protection > Files and verify Enable file monitoring\nis checked.\nPage 121",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft 365 Defender https://security.microsoft.com/\n2. Click to expand System select Settings > Cloud apps.\n3. Scroll to Information Protection and select Files.\n4. Check Enable file monitoring.\n5. Scroll up to Cloud Discovery and select Microsoft Defender for\nEndpoint.\n6. Check Enforce app access, configure a Notification URL and Save.\nNote: Defender for Endpoint requires a Defender for Endpoint license.\nConfigure App Connectors:\n1. Scroll to Connected apps and select App connectors.\n2. Click on Connect an app and select Microsoft 365.\n3. Check all Azure and Office 365 boxes then click Connect Office 365.\n4. Repeat for the Microsoft Azure application.",
        "default_value": "Disabled",
        "references": "1. https://learn.microsoft.com/en-us/defender-cloud-apps/protect-office-\n365#connect-microsoft-365-to-microsoft-defender-for-cloud-apps\n2. https://learn.microsoft.com/en-us/defender-cloud-apps/protect-azure#connect-\nazure-to-microsoft-defender-for-cloud-apps\n3. https://learn.microsoft.com/en-us/defender-cloud-apps/best-practices\n4. https://learn.microsoft.com/en-us/defender-cloud-apps/get-started\n5. https://learn.microsoft.com/en-us/entra/id-protection/concept-identity-protection-\nrisks\nPage 122\nAdditional Information:\nAdditional Microsoft 365 Defender features include:\n• The option to use Defender for cloud apps as a reverse proxy, allowing for the\napplication of access or session controls through the definition of a conditional\naccess policy.\n• The purchase and implementation of the \"App Governance\" add-on, which\nprovides more precise control over OAuth app permissions and includes\nadditional built-in policies.\nA list of Defender for Cloud Apps built-in policies for Office 365 can be found at\nhttps://learn.microsoft.com/en-us/defender-cloud-apps/protect-office-365."
    },
    {
        "id": "2.4.4",
        "title": "(L1) Ensure Zero-hour auto purge for Microsoft Teams is on (Automated)",
        "profile": "• E5 Level 1",
        "description": "Zero-hour auto purge (ZAP) is a protection feature that retroactively detects and\nneutralizes malware and high confidence phishing. When ZAP for Teams protection\nblocks a message, the message is blocked for everyone in the chat. The initial block\nhappens right after delivery, but ZAP occurs up to 48 hours after delivery.",
        "rationale": "ZAP is intended to protect users that have received zero-day malware messages or\ncontent that is weaponized after being delivered to users. It does this by continually\nmonitoring spam and malware signatures taking automated retroactive action on\nmessages that have already been delivered.",
        "impact": "As with any anti-malware or anti-phishing product, false positives may occur.\nPage 124",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Defender https://security.microsoft.com/\n2. Click to expand System select Settings > Email & collaboration >\nMicrosoft Teams protection.\n3. Ensure Zero-hour auto purge (ZAP) is set to On (Default)\n4. Under Exclude these participants review the list of exclusions and ensure\nthey are justified and within tolerance for the organization.\nTo audit using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following cmdlets:\nGet-TeamsProtectionPolicy | fl ZapEnabled\nGet-TeamsProtectionPolicyRule | fl ExceptIf*\n3. Ensure ZapEnabled is True.\n4. Review the list of exclusions and ensure they are justified and within tolerance for\nthe organization. If nothing returns from the 2nd cmdlet then there are no\nexclusions defined.",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Defender https://security.microsoft.com/\n2. Click to expand System select Settings > Email & collaboration >\nMicrosoft Teams protection.\n3. Set Zero-hour auto purge (ZAP) to On (Default)\nTo remediate using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following cmdlet:\nSet-TeamsProtectionPolicy -Identity \"Teams Protection Policy\" -ZapEnabled\n$true",
        "default_value": "On (Default)\nPage 125",
        "references": "1. https://learn.microsoft.com/en-us/defender-office-365/zero-hour-auto-\npurge?view=o365-worldwide#zero-hour-auto-purge-zap-in-microsoft-teams\n2. https://learn.microsoft.com/en-us/defender-office-365/mdo-support-teams-\nabout?view=o365-worldwide#configure-zap-for-teams-protection-in-defender-for-\noffice-365-plan-2"
    },
    {
        "id": "3.1",
        "title": "Audit",
        "profile": "• E3 Level 1",
        "description": "Shared mailboxes are used when multiple people need access to the same mailbox,\nsuch as a company information or support email address, reception desk, or other\nfunction that might be shared by multiple people.\nUsers with permissions to the group mailbox can send as or send on behalf of the\nmailbox email address if the administrator has given that user permissions to do that.\nThis is particularly useful for help and support mailboxes because users can send\nemails from \"Contoso Support\" or \"Building A Reception Desk.\"\nShared mailboxes are created with a corresponding user account using a system\ngenerated password that is unknown at the time of creation.\nThe recommended state is Sign in blocked for Shared mailboxes.",
        "rationale": "The intent of the shared mailbox is the only allow delegated access from other\nmailboxes. An admin could reset the password, or an attacker could potentially gain\naccess to the shared mailbox allowing the direct sign-in to the shared mailbox and\nsubsequently the sending of email from a sender that does not have a unique identity.\nTo prevent this, block sign-in for the account that is associated with the shared mailbox.\nPage 35",
        "impact": "When setting passwords not to expire it is important to have other controls in place to\nsupplement this setting. See below for related recommendations and user guidance.\n• Ban common passwords.\n• Educate users to not reuse organization passwords anywhere else.\n• Enforce Multi-Factor Authentication registration for all users.\nPage 40",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft 365 admin center https://admin.microsoft.com/\n2. Click to expand Teams & groups and select Shared mailboxes.\n3. Take note of all shared mailboxes.\n4. Click to expand Users and select Active users.\n5. Select a shared mailbox account to open its properties pane, and review.\n6. Ensure the text under the name reads Sign-in blocked.\n7. Repeat for any additional shared mailboxes.\nNote: If sign-in is not blocked where will be an option to Block sign-in. This means\nthe shared mailbox is out of compliance with this recommendation.\nTo audit using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline\n2. Connect to Microsoft Graph using Connect-MgGraph -Scopes\n\"Policy.Read.All\"\n3. Run the following PowerShell commands:\n$MBX = Get-EXOMailbox -RecipientTypeDetails SharedMailbox\n$MBX | ForEach-Object { Get-MgUser -UserId $_.ExternalDirectoryObjectId `\n-Property DisplayName, UserPrincipalName, AccountEnabled } |\nFormat-Table DisplayName, UserPrincipalName, AccountEnabled\n4. Ensure AccountEnabled is set to False for all Shared Mailboxes.\nPage 36",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft 365 admin center https://admin.microsoft.com/\n2. Click to expand Teams & groups and select Shared mailboxes.\n3. Take note of all shared mailboxes.\n4. Click to expand Users and select Active users.\n5. Select a shared mailbox account to open it's properties pane and then select\nBlock sign-in.\n6. Check the box for Block this user from signing in.\n7. Repeat for any additional shared mailboxes.\nTo remediate using PowerShell:\n1. Connect to Microsoft Graph using Connect-MgGraph -Scopes\n\"User.ReadWrite.All\"\n2. Connect to Exchange Online using Connect-ExchangeOnline.\n3. To disable sign-in for a single account:\n$MBX = Get-EXOMailbox -Identity TestUser@example.com\nUpdate-MgUser -UserId $MBX.ExternalDirectoryObjectId -AccountEnabled:$false\n3. The following will block sign-in to all Shared Mailboxes.\n$MBX = Get-EXOMailbox -RecipientTypeDetails SharedMailbox\n$MBX | ForEach-Object { Update-MgUser -UserId $_.ExternalDirectoryObjectId -\nAccountEnabled:$false }",
        "default_value": "AccountEnabled: True",
        "references": "1. https://learn.microsoft.com/en-us/microsoft-365/admin/email/about-shared-\nmailboxes?view=o365-worldwide\n2. https://learn.microsoft.com/en-us/microsoft-365/admin/email/create-a-shared-\nmailbox?view=o365-worldwide#block-sign-in-for-the-shared-mailbox-account\n3. https://learn.microsoft.com/en-us/microsoft-365/enterprise/block-user-accounts-\nwith-microsoft-365-powershell?view=o365-worldwide#block-individual-user-\naccounts\nPage 37"
    },
    {
        "id": "3.1.1",
        "title": "(L1) Ensure Microsoft 365 audit log search is Enabled (Automated)",
        "profile": "• E3 Level 1",
        "description": "When audit log search is enabled in the Microsoft Purview compliance portal, user and\nadmin activity within the organization is recorded in the audit log and retained for 90\ndays. However, some organizations may prefer to use a third-party security information\nand event management (SIEM) application to access their auditing data. In this\nscenario, a global admin can choose to turn off audit log search in Microsoft 365.",
        "rationale": "Enabling audit log search in the Microsoft Purview compliance portal can help\norganizations improve their security posture, meet regulatory compliance requirements,\nrespond to security incidents, and gain valuable operational insights.",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Purview https://compliance.microsoft.com.\n2. Select Audit to open the audit search.\n3. Choose a date and time frame in the past 30 days.\n4. Verify search capabilities (e.g. try searching for Activities as Accessed file and\nresults should be displayed).\nTo audit using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\nGet-AdminAuditLogConfig | Select-Object UnifiedAuditLogIngestionEnabled\n3. Ensure UnifiedAuditLogIngestionEnabled is set to True.\nPage 128",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Purview https://compliance.microsoft.com.\n2. Select Audit to open the audit search.\n3. Click Start recording user and admin activity next to the information\nwarning at the top.\n4. Click Yes on the dialog box to confirm.\nTo remediate using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\nSet-AdminAuditLogConfig -UnifiedAuditLogIngestionEnabled $true\nReferences:\n1. https://learn.microsoft.com/en-us/purview/audit-log-enable-disable?view=o365-\nworldwide&tabs=microsoft-purview-portal\n2. https://learn.microsoft.com/en-us/powershell/module/exchange/set-\nadminauditlogconfig?view=exchange-ps\nCIS Controls:\nControls\nControl IG 1 IG 2 IG 3\nVersion\n8.2 Collect Audit Logs\nv8\nCollect audit logs. Ensure that logging, per the enterprise’s audit log\n● ● ●\nmanagement process, has been enabled across enterprise assets.\n6.2 Activate audit logging\nv7\nEnsure that local logging has been enabled on all systems and networking\n● ● ●\ndevices.\nPage 129",
        "references": "1. https://learn.microsoft.com/en-us/purview/audit-log-enable-disable?view=o365-\nworldwide&tabs=microsoft-purview-portal\n2. https://learn.microsoft.com/en-us/powershell/module/exchange/set-\nadminauditlogconfig?view=exchange-ps"
    },
    {
        "id": "3.2",
        "title": "Data loss protection",
        "profile": "• E3 Level 1",
        "description": "Idle session timeout allows the configuration of a setting which will timeout inactive\nusers after a pre-determined amount of time. When a user reaches the set idle timeout\nsession, they'll get a notification that they're about to be signed out. They have to select\nto stay signed in or they'll be automatically signed out of all Microsoft 365 web apps.\nCombined with a Conditional Access rule this will only impact unmanaged devices. A\nmanaged device is considered a device managed that is compliant or joined to a\ndomain and using a supported browser like Microsoft Edge or Google Chrome (with the\nMicrosoft Single Sign On) extension.\nThe following Microsoft 365 web apps are supported.\n• Outlook Web App\n• OneDrive\n• SharePoint\n• Microsoft Fabric\n• Microsoft365.com and other start pages\n• Microsoft 365 web apps (Word, Excel, PowerPoint)\n• Microsoft 365 Admin Center\n• M365 Defender Portal\n• Microsoft Purview Compliance Portal\nThe recommended setting is 3 hours (or less) for unmanaged devices.\nNote: Idle session timeout doesn't affect Microsoft 365 desktop and mobile apps.",
        "rationale": "Ending idle sessions through an automatic process can help protect sensitive company\ndata and will add another layer of security for end users who work on unmanaged\ndevices that can potentially be accessed by the public. Unauthorized individuals onsite\nor remotely can take advantage of systems left unattended over time. Automatic timing\nout of sessions makes this more difficult.\nPage 43",
        "impact": "If step 2 in the Audit/Remediation procedure is left out, then there is no issue with this\nfrom a security standpoint. However, it will require users on trusted devices to sign in\nmore frequently which could result in credential prompt fatigue.\nNote: Idle session timeout also affects the Azure Portal idle timeout if this is not\nexplicitly set to a different timeout. The Azure Portal idle timeout applies to all kind of\ndevices, not just unmanaged. See : change the directory timeout setting admin",
        "audit": "Step 1 - Ensure Idle session timeout is configured:\n1. Navigate to the Microsoft 365 admin center https://admin.microsoft.com/.\n2. Click to expand Settings Select Org settings.\n3. Click Security & Privacy tab.\n4. Select Idle session timeout.\n5. Verify Turn on to set the period of inactivity for users to be\nsigned off of Microsoft 365 web apps is set to 3 hours (or less).\nStep 2 - Ensure the Conditional Access policy is in place:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/\n2. Expand Protect > Conditional Access.\n3. Inspect existing conditional access rules for one that meets the below conditions:\no Users is set to All users.\no Cloud apps or actions > Select apps is set to Office 365.\no Conditions > Client apps is Browser and nothing else.\no Session is set to Use app enforced restrictions.\no Enable Policy is set to On\nNote: To ensure that idle timeouts affect only unmanaged devices, both steps must be\ncompleted.\nPage 44",
        "remediation": "Step 1 - Configure Idle session timeout:\n1. Navigate to the Microsoft 365 admin center https://admin.microsoft.com/.\n2. Click to expand Settings Select Org settings.\n3. Click Security & Privacy tab.\n4. Select Idle session timeout.\n5. Check the box Turn on to set the period of inactivity for users to\nbe signed off of Microsoft 365 web apps\n6. Set a maximum value of 3 hours.\n7. Click save.\nStep 2 - Ensure the Conditional Access policy is in place:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/\n2. Expand Protect > Conditional Access.\n3. Click New policy and give the policy a name.\no Select Users > All users.\no Select Cloud apps or actions > Select apps and select Office 365\no Select Conditions > Client apps > Yes check only Browser unchecking\nall other boxes.\no Select Sessions and check Use app enforced restrictions.\n4. Set Enable policy to On and click Create.\nNote: To ensure that idle timeouts affect only unmanaged devices, both steps must be\ncompleted.",
        "default_value": "Not configured. (Idle sessions will not timeout.)",
        "references": "1. https://learn.microsoft.com/en-us/microsoft-365/admin/manage/idle-session-\ntimeout-web-apps?view=o365-worldwide\nAdditional Information:\nAccording to Microsoft idle session timeout isn't supported when third party cookies are\ndisabled in the browser. Users won't see any sign-out prompts.\nPage 45"
    },
    {
        "id": "3.2.1",
        "title": "(L1) Ensure DLP policies are enabled (Manual)",
        "profile": "• E3 Level 1",
        "description": "Data Loss Prevention (DLP) policies allow Exchange Online and SharePoint Online\ncontent to be scanned for specific types of data like social security numbers, credit card\nnumbers, or passwords.",
        "rationale": "Enabling DLP policies alerts users and administrators that specific types of data should\nnot be exposed, helping to protect the data from accidental exposure.",
        "impact": "Enabling a Teams DLP policy will allow sensitive data in Exchange Online and\nSharePoint Online to be detected or blocked. Always ensure to follow appropriate\nprocedures during testing and implementation of DLP policies based on organizational\nstandards.",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Purview https://compliance.microsoft.com.\n2. Under Solutions select Data loss prevention then Policies.\n3. Verify that policies exist and are enabled.",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Purview https://compliance.microsoft.com.\n2. Under Solutions select Data loss prevention then Policies.\n3. Click Create policy.\nReferences:\n1. https://learn.microsoft.com/en-us/purview/dlp-learn-about-dlp?view=o365-\nworldwide\nPage 131\nCIS Controls:\nControls\nControl IG 1 IG 2 IG 3\nVersion\n3.1 Establish and Maintain a Data Management Process\nEstablish and maintain a data management process. In the process, address\nv8 data sensitivity, data owner, handling of data, data retention limits, and disposal ● ● ●\nrequirements, based on sensitivity and retention standards for the enterprise.\nReview and update documentation annually, or when significant enterprise changes\noccur that could impact this Safeguard.\nv7\n13 Data Protection\nData Protection\n14.7 Enforce Access Control to Data through Automated\nv7 Tools ●\nUse an automated tool, such as host-based Data Loss Prevention, to enforce\naccess controls to data even when data is copied off a system.\nPage 132",
        "references": "1. https://learn.microsoft.com/en-us/purview/dlp-learn-about-dlp?view=o365-\nworldwide\nPage 131"
    },
    {
        "id": "3.2.2",
        "title": "(L1) Ensure DLP policies are enabled for Microsoft Teams (Manual)",
        "profile": "• E5 Level 1",
        "description": "The default Teams Data Loss Prevention (DLP) policy rule in Microsoft 365 is a\npreconfigured rule that is automatically applied to all Teams conversations and\nchannels. The default rule helps prevent accidental sharing of sensitive information by\ndetecting and blocking certain types of content that are deemed sensitive or\ninappropriate by the organization.\nBy default, the rule includes a check for the sensitive info type Credit Card Number\nwhich is pre-defined by Microsoft.",
        "rationale": "Enabling the default Teams DLP policy rule in Microsoft 365 helps protect an\norganization's sensitive information by preventing accidental sharing or leakage Credit\nCard information in Teams conversations and channels.\nDLP rules are not one size fits all, but at a minimum something should be defined. The\norganization should identify sensitive information important to them and seek to\nintercept it using DLP.",
        "impact": "End-users may be prevented from sharing certain types of content, which may require\nthem to adjust their behavior or seek permission from administrators to share specific\ncontent. Administrators may receive requests from end-users for permission to share\ncertain types of content or to modify the policy to better fit the needs of their teams.\nPage 133",
        "audit": "To audit the using the UI:\n1. Navigate to Microsoft Purview compliance portal\nhttps://compliance.microsoft.com.\n2. Under Solutions select Data loss prevention then Policies.\n3. Locate the Default policy for Teams.\n4. Verify the Status is On.\n5. Verify Locations include Teams chat and channel messages - All\naccounts.\n6. Verify Policy settings incudes the Default Teams DLP policy rule or one\nspecific to the organization.\nNote: If there is not a default policy for teams inspect existing policies starting with step\n4. DLP rules are specific to the organization and each organization should take steps to\nprotect the data that matters to them. The default teams DLP rule will only alert on\nCredit Card matches.\nTo audit using PowerShell:\n1. Connect to the Security & Compliance PowerShell using Connect-IPPSSession.\n2. Run the following to return policies that include Teams chat and channel\nmessages:\n$DlpPolicy = Get-DlpCompliancePolicy\n$DlpPolicy | Where-Object {$_.Workload -match \"Teams\"} |\nft Name,Mode,TeamsLocation*\n3. If nothing returns, then there are no policies that include Teams and remediation\nis required.\n4. For any returned policy verify Mode is set to Enable.\n5. Verify TeamsLocation includes All.\n6. Verify TeamsLocationException includes only permitted exceptions.\nNote: Some tenants may not have a default policy for teams as Microsoft started\ncreating these by default at a particular point in time. In this case a new policy will have\nto be created that includes a rule to protect data important to the organization such as\ncredit cards and PII.\nPage 134",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Purview compliance portal\nhttps://compliance.microsoft.com.\n2. Under Solutions select Data loss prevention then Policies.\n3. Click Policies tab.\n4. Check Default policy for Teams then click Edit policy.\n5. The edit policy window will appear click Next\n6. At the Choose locations to apply the policy page, turn the status toggle\nto On for Teams chat and channel messages location and then click Next.\n7. On Customized advanced DLP rules page, ensure the Default Teams DLP\npolicy rule Status is On and click Next.\n8. On the Policy mode page, select the radial for Turn it on right away and\nclick Next.\n9. Review all the settings for the created policy on the Review your policy and\ncreate it page, and then click submit.\n10. Once the policy has been successfully submitted click Done.\nNote: Some tenants may not have a default policy for teams as Microsoft started\ncreating these by default at a particular point in time. In this case a new policy will have\nto be created that includes a rule to protect data important to the organization such as\ncredit cards and PII.",
        "default_value": "Enabled (On)",
        "references": "1. https://learn.microsoft.com/en-us/powershell/exchange/connect-to-scc-\npowershell?view=exchange-ps\n2. https://learn.microsoft.com/en-us/purview/dlp-teams-default-policy\n3. https://learn.microsoft.com/en-us/powershell/module/exchange/connect-\nippssession?view=exchange-ps\nPage 135"
    },
    {
        "id": "3.3",
        "title": "Information Protection",
        "profile": "• E3 Level 1",
        "description": "Shared mailboxes are used when multiple people need access to the same mailbox,\nsuch as a company information or support email address, reception desk, or other\nfunction that might be shared by multiple people.\nUsers with permissions to the group mailbox can send as or send on behalf of the\nmailbox email address if the administrator has given that user permissions to do that.\nThis is particularly useful for help and support mailboxes because users can send\nemails from \"Contoso Support\" or \"Building A Reception Desk.\"\nShared mailboxes are created with a corresponding user account using a system\ngenerated password that is unknown at the time of creation.\nThe recommended state is Sign in blocked for Shared mailboxes.",
        "rationale": "The intent of the shared mailbox is the only allow delegated access from other\nmailboxes. An admin could reset the password, or an attacker could potentially gain\naccess to the shared mailbox allowing the direct sign-in to the shared mailbox and\nsubsequently the sending of email from a sender that does not have a unique identity.\nTo prevent this, block sign-in for the account that is associated with the shared mailbox.\nPage 35",
        "impact": "When setting passwords not to expire it is important to have other controls in place to\nsupplement this setting. See below for related recommendations and user guidance.\n• Ban common passwords.\n• Educate users to not reuse organization passwords anywhere else.\n• Enforce Multi-Factor Authentication registration for all users.\nPage 40",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft 365 admin center https://admin.microsoft.com/\n2. Click to expand Teams & groups and select Shared mailboxes.\n3. Take note of all shared mailboxes.\n4. Click to expand Users and select Active users.\n5. Select a shared mailbox account to open its properties pane, and review.\n6. Ensure the text under the name reads Sign-in blocked.\n7. Repeat for any additional shared mailboxes.\nNote: If sign-in is not blocked where will be an option to Block sign-in. This means\nthe shared mailbox is out of compliance with this recommendation.\nTo audit using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline\n2. Connect to Microsoft Graph using Connect-MgGraph -Scopes\n\"Policy.Read.All\"\n3. Run the following PowerShell commands:\n$MBX = Get-EXOMailbox -RecipientTypeDetails SharedMailbox\n$MBX | ForEach-Object { Get-MgUser -UserId $_.ExternalDirectoryObjectId `\n-Property DisplayName, UserPrincipalName, AccountEnabled } |\nFormat-Table DisplayName, UserPrincipalName, AccountEnabled\n4. Ensure AccountEnabled is set to False for all Shared Mailboxes.\nPage 36",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft 365 admin center https://admin.microsoft.com/\n2. Click to expand Teams & groups and select Shared mailboxes.\n3. Take note of all shared mailboxes.\n4. Click to expand Users and select Active users.\n5. Select a shared mailbox account to open it's properties pane and then select\nBlock sign-in.\n6. Check the box for Block this user from signing in.\n7. Repeat for any additional shared mailboxes.\nTo remediate using PowerShell:\n1. Connect to Microsoft Graph using Connect-MgGraph -Scopes\n\"User.ReadWrite.All\"\n2. Connect to Exchange Online using Connect-ExchangeOnline.\n3. To disable sign-in for a single account:\n$MBX = Get-EXOMailbox -Identity TestUser@example.com\nUpdate-MgUser -UserId $MBX.ExternalDirectoryObjectId -AccountEnabled:$false\n3. The following will block sign-in to all Shared Mailboxes.\n$MBX = Get-EXOMailbox -RecipientTypeDetails SharedMailbox\n$MBX | ForEach-Object { Update-MgUser -UserId $_.ExternalDirectoryObjectId -\nAccountEnabled:$false }",
        "default_value": "AccountEnabled: True",
        "references": "1. https://learn.microsoft.com/en-us/microsoft-365/admin/email/about-shared-\nmailboxes?view=o365-worldwide\n2. https://learn.microsoft.com/en-us/microsoft-365/admin/email/create-a-shared-\nmailbox?view=o365-worldwide#block-sign-in-for-the-shared-mailbox-account\n3. https://learn.microsoft.com/en-us/microsoft-365/enterprise/block-user-accounts-\nwith-microsoft-365-powershell?view=o365-worldwide#block-individual-user-\naccounts\nPage 37"
    },
    {
        "id": "3.3.1",
        "title": "(L1) Ensure SharePoint Online Information Protection policies are set up and used\n(Manual)",
        "profile": "• E3 Level 1",
        "description": "SharePoint Online Data Classification Policies enables organizations to classify and\nlabel content in SharePoint Online based on its sensitivity and business impact. This\nsetting helps organizations to manage and protect sensitive data by automatically\napplying labels to content, which can then be used to apply policy-based protection and\ngovernance controls.",
        "rationale": "By categorizing and applying policy-based protection, SharePoint Online Data\nClassification Policies can help reduce the risk of data loss or exposure and enable\nmore effective incident response if a breach does occur.",
        "impact": "The creation of data classification policies is unlikely to have a significant impact on an\norganization. However, maintaining long-term adherence to policies may require\nongoing training and compliance efforts across the organization. Therefore,\norganizations should include training and compliance planning as part of the data\nclassification policy creation process.\nPage 138",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Purview compliance portal\nhttps://compliance.microsoft.com.\n2. Under Solutions select Information protection.\n3. Click on the Label policies tab.\n4. Ensure that a Label policy exists and is published accordingly.",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Purview compliance portal\nhttps://compliance.microsoft.com.\n2. Under Solutions select Information protection.\n3. Click on the Label policies tab.\n4. Click Create a label to create a label.\n5. Select the label and click on the Publish label.\n6. Fill out the forms to create the policy.\nReferences:\n1. https://learn.microsoft.com/en-us/purview/data-classification-\noverview?view=o365-worldwide#top-sensitivity-labels-applied-to-content\n2. https://learn.microsoft.com/en-us/purview/sensitivity-labels-sharepoint-onedrive-\nfiles\nPage 139\nCIS Controls:\nControls\nControl IG 1 IG 2 IG 3\nVersion\n3.7 Establish and Maintain a Data Classification Scheme\nEstablish and maintain an overall data classification scheme for the enterprise.\nv8 Enterprises may use labels, such as “Sensitive,” “Confidential,” and “Public,” and ● ●\nclassify their data according to those labels. Review and update the classification\nscheme annually, or when significant enterprise changes occur that could impact\nthis Safeguard.\n13.1 Maintain an Inventory Sensitive Information\nv7 Maintain an inventory of all sensitive information stored, processed, or ● ● ●\ntransmitted by the organization's technology systems, including those located\nonsite or at a remote service provider.\n14.6 Protect Information through Access Control Lists\nProtect all information stored on systems with file system, network share, claims,\nv7\napplication, or database specific access control lists. These controls will enforce the\n● ● ●\nprinciple that only authorized individuals should have access to the information\nbased on their need to access the information as a part of their responsibilities.\nPage 140\n4 Microsoft Intune admin center\nThis section is intentionally blank and exists to ensure the structure of the benchmark is\nconsistent.\nCIS has platform specific benchmarks for Intune which are intended to harden\nendpoints through Endpoint Manager (Microsoft Intune admin center). Those are\ndeveloped in the following WorkBench communities:\nCIS Microsoft Intune for Windows:\nhttps://workbench.cisecurity.org/communities/116\nCIS Intune Apple iOS and iPadOS Benchmarks:\nhttps://workbench.cisecurity.org/communities/179\nPage 141\n5 Microsoft Entra admin center\nMicrosoft Entra, also known as Identity, contains settings related to identity, conditional\naccess, and was formerly named Azure AD.\nDirect link: https://entra.microsoft.com/",
        "references": "1. https://learn.microsoft.com/en-us/purview/data-classification-\noverview?view=o365-worldwide#top-sensitivity-labels-applied-to-content\n2. https://learn.microsoft.com/en-us/purview/sensitivity-labels-sharepoint-onedrive-\nfiles\nPage 139"
    },
    {
        "id": "5.1",
        "title": "Identity",
        "profile": "• E3 Level 1",
        "description": "Administrative accounts are special privileged accounts that could have varying levels\nof access to data, users, and settings. Regular user accounts should never be utilized\nfor administrative tasks and care should be taken, in the case of a hybrid environment,\nto keep Administrative accounts separated from on-prem accounts. Administrative\naccounts should not have applications assigned so that they have no access to\npotentially vulnerable services (EX. email, Teams, SharePoint, etc.) and only access to\nperform tasks as needed for administrative purposes.\nEnsure administrative accounts are not On-premises sync enabled.",
        "rationale": "In a hybrid environment, having separate accounts will help ensure that in the event of a\nbreach in the cloud, that the breach does not affect the on-prem environment and vice\nversa.",
        "impact": "Administrative users will have to switch accounts and utilizing login/logout functionality\nwhen performing administrative tasks, as well as not benefiting from SSO. This will\nrequire a migration process from the 'daily driver' account to a dedicated admin account.\nWhen migrating permissions to the admin account, both M365 and Azure RBAC roles\nshould be migrated as well. Once the new admin accounts are created both of these\npermission sets should be moved from the daily driver account to the new admin\naccount. Failure to migrate Azure RBAC roles can cause an admin to not be able to see\ntheir subscriptions/resources while using their admin accounts.\nPage 17",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Identity > Users select All users.\n3. To the right of the search box click the Add filter button.\n4. Add the On-premises sync enabled filter and click Apply.\n5. For each user account known to be in an administrative role verify it is not\npresent in the filtered list.\nTo audit using PowerShell:\n1. Connect to Microsoft Graph using Connect-MgGraph -Scopes\n\"RoleManagement.Read.Directory\",\"User.Read.All\"\n2. Run the following PowerShell script:\n# Get privileged role IDs\n$PrivilegedRoles = $DirectoryRoles | Where-Object {\n$_.DisplayName -like \"*Administrator*\" -or $_.DisplayName -eq \"Global\nReader\"\n}\n# Get the members of these various roles\n$RoleMembers = $PrivilegedRoles | ForEach-Object { Get-MgDirectoryRoleMember\n-DirectoryRoleId $_.Id } |\nSelect-Object Id -Unique\n# Retrieve details about the members in these roles\n$PrivilegedUsers = $RoleMembers | ForEach-Object {\nGet-MgUser -UserId $_.Id -Property UserPrincipalName, DisplayName, Id,\nOnPremisesSyncEnabled\n}\n$PrivilegedUsers | Where-Object { $_.OnPremisesSyncEnabled -eq $true } |\nft DisplayName,UserPrincipalName,OnPremisesSyncEnabled\n3. The script will output any hybrid users that are also members of privileged roles.\nIf nothing returns then no users with that criteria exist.",
        "remediation": "Remediation will require first identifying the privileged accounts that are synced from on-\npremises and then creating a new cloud-only account for that user. Once a replacement\naccount is established, the hybrid account should have its role reduced to that of a non-\nprivileged user or removed depending on the need.",
        "default_value": "N/A\nPage 18",
        "references": "1. https://learn.microsoft.com/en-us/microsoft-365/admin/add-users/add-\nusers?view=o365-worldwide\n2. https://learn.microsoft.com/en-us/microsoft-365/enterprise/protect-your-global-\nadministrator-accounts?view=o365-worldwide\n3. https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/best-\npractices#9-use-cloud-native-accounts-for-microsoft-entra-roles\n4. https://learn.microsoft.com/en-us/entra/fundamentals/whatis\n5. https://learn.microsoft.com/en-us/entra/identity/role-based-access-\ncontrol/permissions-reference"
    },
    {
        "id": "5.1.1",
        "title": "Overview"
    },
    {
        "id": "5.1.1.1",
        "title": "(L1) Ensure Security Defaults is disabled (Manual)",
        "profile": "• E3 Level 1",
        "description": "Security defaults in Microsoft Entra ID make it easier to be secure and help protect the\norganization. Security defaults contain preconfigured security settings for common\nattacks.\nBy default, Microsoft enables security defaults. The goal is to ensure that all\norganizations have a basic level of security enabled. The security default setting is\nmanipulated in the Entra admin center.\nThe use of security defaults, however, will prohibit custom settings which are being set\nwith more advanced settings from this benchmark.",
        "rationale": "Security defaults provide secure default settings that are managed on behalf of\norganizations to keep customers safe until they are ready to manage their own identity\nsecurity settings.\nFor example, doing the following:\n• Requiring all users and admins to register for MFA.\n• Challenging users with MFA - mostly when they show up on a new device or app,\nbut more often for critical roles and tasks.\n• Disabling authentication from legacy authentication clients, which can’t do MFA.",
        "impact": "The potential impact associated with disabling of Security Defaults is dependent upon\nthe security controls implemented in the environment. It is likely that most organizations\ndisabling Security Defaults plan to implement equivalent controls to replace Security\nDefaults.\nIt may be necessary to check settings in other Microsoft products, such as Azure, to\nensure settings and functionality are as expected when disabling security defaults for\nMS365.\nPage 143",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com.\n2. Click to expand Identity select Overview\n3. Click Properties.\n4. Review the section Security Defaults near the bottom\n5. If Manage security defaults appears clickable then proceed to the\nremediation section, otherwise read the note below.\nNote: If Manage Conditional Access appears in blue then Security defaults are\nalready disabled, and CA is in use. The audit can be considered a Pass.\nTo audit using PowerShell:\n1. Connect to the Microsoft Graph service using Connect-MgGraph -Scopes\n\"Policy.Read.All\".\n2. Run the following Microsoft Graph PowerShell command:\nGet-MgPolicyIdentitySecurityDefaultEnforcementPolicy | ft IsEnabled\n3. If the value is false then Security Defaults is disabled.\nPage 144",
        "remediation": "To remediate using the UI:\n1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com.\n2. Click to expand Identity select Overview\n3. Click Properties.\n4. Click Manage security defaults.\n5. Set the Security defaults dropdown to Disabled.\n6. Select Save.\nTo remediate using PowerShell:\n1. Connect to the Microsoft Graph service using Connect-MgGraph -Scopes\n\"Policy.ReadWrite.ConditionalAccess\".\n2. Run the following Microsoft Graph PowerShell command:\n$params = @{ IsEnabled = $false }\nUpdate-MgPolicyIdentitySecurityDefaultEnforcementPolicy -BodyParameter\n$params\nWarning: It is recommended not to disable security defaults until you are ready to\nimplement conditional access rules in the benchmark. Rules such as requiring MFA for\nall users and blocking legacy protocols are required in CA to make up for the gap\ncreated by disabling defaults. Plan accordingly. See the reference section for more\ndetails on what coverage Security Defaults provide.",
        "default_value": "Enabled.",
        "references": "1. https://learn.microsoft.com/en-us/entra/fundamentals/security-defaults\n2. https://techcommunity.microsoft.com/t5/microsoft-entra-blog/introducing-security-\ndefaults/ba-p/1061414"
    },
    {
        "id": "5.1.2",
        "title": "Users"
    },
    {
        "id": "5.1.2.1",
        "title": "(L1) Ensure 'Per-user MFA' is disabled (Manual)",
        "profile": "• E3 Level 1",
        "description": "Legacy per-user Multi-Factor Authentication (MFA) can be configured to require\nindividual users to provide multiple authentication factors, such as passwords and\nadditional verification codes, to access their accounts. It was introduced in earlier\nversions of Office 365, prior to the more comprehensive implementation of Conditional\nAccess (CA).",
        "rationale": "Both security defaults and conditional access with security defaults turned off are not\ncompatible with per-user multi-factor authentication (MFA), which can lead to\nundesirable user authentication states. The CIS Microsoft 365 Benchmark explicitly\nemploys Conditional Access for MFA as an enhancement over security defaults and as\na replacement for the outdated per-user MFA. To ensure a consistent authentication\nstate disable per-user MFA on all accounts.",
        "impact": "Accounts using per-user MFA will need to be migrated to use CA.\nPrior to disabling per-user MFA the organization must be prepared to implement\nconditional access MFA to avoid security gaps and allow for a smooth transition. This\nwill help ensure relevant accounts are covered by MFA during the change phase from\ndisabling per-user MFA to enabling CA MFA. Section 5.2.2 in this document covers\ncreating of a CA rule for both administrators and all users in the tenant.\nMicrosoft has documentation on migrating from per-user MFA Convert users from per-\nuser MFA to Conditional Access based MFA\nPage 147",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Identity > Users select All users.\n3. Click on Per-user MFA on the top row.\n4. Ensure under the column Multi-factor Auth Status that each account is set\nto Disabled",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Identity > Users select All users.\n3. Click on Per-user MFA on the top row.\n4. Click the empty box next to Display Name to select all accounts.\n5. On the far right under quick steps click Disable.",
        "default_value": "Disabled",
        "references": "1. https://learn.microsoft.com/en-us/entra/identity/authentication/howto-mfa-\nuserstates#convert-users-from-per-user-mfa-to-conditional-access\n2. https://learn.microsoft.com/en-us/microsoft-365/admin/security-and-\ncompliance/set-up-multi-factor-authentication?view=o365-worldwide#use-\nconditional-access-policies\n3. https://learn.microsoft.com/en-us/entra/identity/authentication/howto-mfa-\nuserstates#convert-per-user-mfa-enabled-and-enforced-users-to-disabled"
    },
    {
        "id": "5.1.2.2",
        "title": "(L2) Ensure third party integrated applications are not allowed (Automated)",
        "profile": "• E3 Level 2",
        "description": "App registration allows users to register custom-developed applications for use within\nthe directory.",
        "rationale": "Third-party integrated applications connection to services should be disabled unless\nthere is a very clear value and robust security controls are in place. While there are\nlegitimate uses, attackers can grant access from breached accounts to third party\napplications to exfiltrate data from your tenancy without having to maintain the breached\naccount.",
        "impact": "Implementation of this change will impact both end users and administrators. End users\nwill not be able to integrate third-party applications that they may wish to use.\nAdministrators are likely to receive requests from end users to grant them permission to\nnecessary third-party applications.\nPage 149",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Identity > Users select Users settings.\n3. Verify Users can register applications is set to No.\nTo audit using PowerShell:\n1. Connect to Microsoft Graph using Connect-MgGraph -Scopes\n\"Policy.Read.All\"\n2. Run the following command:\n(Get-MgPolicyAuthorizationPolicy).DefaultUserRolePermissions | fl\nAllowedToCreateApps\n3. Ensure the returned value is False.",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Identity > Users select Users settings.\n3. Set Users can register applications to No.\n4. Click Save.\nTo remediate using PowerShell:\n1. Connect to Microsoft Graph using Connect-MgGraph -Scopes\n\"Policy.ReadWrite.Authorization\"\n2. Run the following commands:\n$param = @{ AllowedToCreateApps = \"$false\" }\nUpdate-MgPolicyAuthorizationPolicy -DefaultUserRolePermissions $param",
        "default_value": "Yes (Users can register applications.)",
        "references": "1. https://learn.microsoft.com/en-us/entra/identity-platform/how-applications-are-\nadded\nPage 150"
    },
    {
        "id": "5.1.2.3",
        "title": "(L1) Ensure 'Restrict non-admin users from creating tenants' is set to 'Yes'\n(Automated)",
        "profile": "• E3 Level 1",
        "description": "Non-privileged users can create tenants in the Entra administration portal under\nManage tenant. The creation of a tenant is recorded in the Audit log as category\n\"DirectoryManagement\" and activity \"Create Company\". Anyone who creates a tenant\nbecomes the Global Administrator of that tenant. The newly created tenant doesn't\ninherit any settings or configurations.",
        "rationale": "Restricting tenant creation prevents unauthorized or uncontrolled deployment of\nresources and ensures that the organization retains control over its infrastructure. User\ngeneration of shadow IT could lead to multiple, disjointed environments that can make it\ndifficult for IT to manage and secure the organization's data, especially if other users in\nthe organization began using these tenants for business purposes under the\nmisunderstanding that they were secured by the organization's security team.",
        "impact": "Non-admin users will need to contact I.T. if they have a valid reason to create a tenant.",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/\n2. Click to expand Identity> Users > User settings.\n3. Ensure Restrict non-admin users from creating tenants is set to Yes\nTo audit using PowerShell:\n1. Connect to Microsoft Graph using Connect-MgGraph -Scopes\n\"Policy.Read.All\"\n2. Run the following commands:\n(Get-MgPolicyAuthorizationPolicy).DefaultUserRolePermissions |\nSelect-Object AllowedToCreateTenants\n3. Ensure the returned value is False\nPage 152",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/\n2. Click to expand Identity> Users > User settings.\n3. Set Restrict non-admin users from creating tenants to Yes then Save.\nTo remediate using PowerShell:\n1. Connect to Microsoft Graph using Connect-MgGraph -Scopes\n\"Policy.ReadWrite.Authorization\"\n2. Run the following commands:\n# Create hashtable and update the auth policy\n$params = @{ AllowedToCreateTenants = $false }\nUpdate-MgPolicyAuthorizationPolicy -DefaultUserRolePermissions $params",
        "default_value": "No - Non-administrators can create tenants.\nAllowedToCreateTenants is True",
        "references": "1. https://learn.microsoft.com/en-us/entra/fundamentals/users-default-\npermissions#restrict-member-users-default-permissions"
    },
    {
        "id": "5.1.2.4",
        "title": "(L1) Ensure access to the Entra admin center is restricted (Manual)",
        "profile": "• E3 Level 1",
        "description": "Restrict non-privileged users from signing into the Microsoft Entra admin center.\nNote: This recommendation only affects access to the web portal. It does not prevent\nprivileged users from using other methods such as Rest API or PowerShell to obtain\ninformation. Those channels are addressed elsewhere in this document.",
        "rationale": "The Microsoft Entra admin center contains sensitive data and permission settings,\nwhich are still enforced based on the user's role. However, an end user may\ninadvertently change properties or account settings that could result in increased\nadministrative overhead. Additionally, a compromised end user account could be used\nby a malicious attacker as a means to gather additional information and escalate an\nattack.\nNote: Users will still be able to sign into Microsoft Entra admin center but will be unable\nto see directory information.",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/\n2. Click to expand Identity> Users > User settings.\n3. Verify under the Administration center section that Restrict access to\nMicrosoft Entra admin center is set to Yes.",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/\n2. Click to expand Identity> Users > User settings.\n3. Set Restrict access to Microsoft Entra admin center to Yes then Save.",
        "default_value": "No - Non-administrators can access the Microsoft Entra admin center.\nPage 154",
        "references": "1. https://learn.microsoft.com/en-us/entra/fundamentals/users-default-\npermissions#restrict-member-users-default-permissions"
    },
    {
        "id": "5.1.2.5",
        "title": "(L2) Ensure the option to remain signed in is hidden (Manual)",
        "profile": "• E3 Level 2",
        "description": "The option for the user to Stay signed in, or the Keep me signed in option, will\nprompt a user after a successful login. When the user selects this option, a persistent\nrefresh token is created. The refresh token lasts for 90 days by default and does not\nprompt for sign-in or multifactor.",
        "rationale": "Allowing users to select this option presents risk, especially if the user signs into their\naccount on a publicly accessible computer/web browser. In this case it would be trivial\nfor an unauthorized person to gain access to any associated cloud data from that\naccount.",
        "impact": "Once this setting is hidden users will no longer be prompted upon sign-in with the\nmessage Stay signed in?. This may mean users will be forced to sign in more\nfrequently. Important: some features of SharePoint Online and Office 2010 have a\ndependency on users remaining signed in. If you hide this option, users may get\nadditional and unexpected sign in prompts.",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Identity> Users > User settings.\n3. Ensure Show keep user signed in is highlighted No.",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Identity> Users > User settings.\n3. Set Show keep user signed in to No.\n4. Click Save.\nPage 156",
        "default_value": "Users may select stay signed in",
        "references": "1. https://learn.microsoft.com/en-us/entra/identity/authentication/concepts-azure-\nmulti-factor-authentication-prompts-session-lifetime\n2. https://learn.microsoft.com/en-us/entra/fundamentals/how-to-manage-stay-\nsigned-in-prompt"
    },
    {
        "id": "5.1.2.6",
        "title": "(L2) Ensure 'LinkedIn account connections' is disabled (Manual)",
        "profile": "• E3 Level 2",
        "description": "LinkedIn account connections allow users to connect their Microsoft work or school\naccount with LinkedIn. After a user connects their accounts, information and highlights\nfrom LinkedIn are available in some Microsoft apps and services.",
        "rationale": "Disabling LinkedIn integration prevents potential phishing attacks and risk scenarios\nwhere an external party could accidentally disclose sensitive information.",
        "impact": "Users will not be able to sync contacts or use LinkedIn integration.",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Identity > Users select User settings.\n3. Under LinkedIn account connections ensure No is highlighted.",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Identity > Users select User settings.\n3. Under LinkedIn account connections select No.\n4. Click Save.",
        "default_value": "LinkedIn integration is enabled by default.",
        "references": "1. https://learn.microsoft.com/en-us/entra/identity/users/linkedin-integration\n2. https://learn.microsoft.com/en-us/entra/identity/users/linkedin-user-consent\nPage 158"
    },
    {
        "id": "5.1.3",
        "title": "Groups"
    },
    {
        "id": "5.1.3.1",
        "title": "(L1) Ensure a dynamic group for guest users is created (Automated)",
        "profile": "• E3 Level 1",
        "description": "A dynamic group is a dynamic configuration of security group membership for Microsoft\nEntra ID. Administrators can set rules to populate groups that are created in Entra ID\nbased on user attributes (such as userType, department, or country/region). Members\ncan be automatically added to or removed from a security group based on their\nattributes.\nThe recommended state is to create a dynamic group that includes guest accounts.",
        "rationale": "Dynamic groups allow for an automated method to assign group membership.\nGuest user accounts will be automatically added to this group and through this existing\nconditional access rules, access controls and other security measures will ensure that\nnew guest accounts are restricted in the same manner as existing guest accounts.\nPage 161",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Identity > Groups select All groups.\n3. On the right of the search field click Add filter.\n4. Set Filter to Membership type and Value to Dynamic then apply.\n5. Identify a dynamic group and select it.\n6. Under manage, select Dynamic membership rules and ensure the rule syntax\ncontains (user.userType -eq \"Guest\")\n7. If necessary, inspect other dynamic groups for the value above.\nTo audit using PowerShell:\n1. Connect to Microsoft Graph using Connect-MgGraph -Scopes\n\"Group.Read.All\"\n2. Run the following commands:\n$groups = Get-MgGroup | Where-Object { $_.GroupTypes -contains\n\"DynamicMembership\" }\n$groups | ft DisplayName,GroupTypes,MembershipRule\n3. Look for a dynamic group containing the rule (user.userType -eq \"Guest\")",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Identity > Groups select All groups.\n3. Select New group and assign the following values:\no Group type: Security\no Microsoft Entra roles can be assigned to the group: No\no Membership type: Dynamic User\n4. Select Add dynamic query.\n5. Above the Rule syntax text box, select Edit.\n6. Place the following expression in the box:\n(user.userType -eq \"Guest\")\n7. Select OK and Save\nPage 162\nTo remediate using PowerShell:\n1. Connect to Microsoft Graph using Connect-MgGraph -Scopes\n\"Group.ReadWrite.All\"\n2. In the script below edit DisplayName and MailNickname as needed and run:\n$params = @{\nDisplayName = \"Dynamic Test Group\"\nMailNickname = \"DynGuestUsers\"\nMailEnabled = $false\nSecurityEnabled = $true\nGroupTypes = \"DynamicMembership\"\nMembershipRule = '(user.userType -eq \"Guest\")'\nMembershipRuleProcessingState = \"On\"\n}\nNew-MgGroup @params",
        "default_value": "Undefined",
        "references": "1. https://learn.microsoft.com/en-us/entra/identity/users/groups-create-rule\n2. https://learn.microsoft.com/en-us/entra/identity/users/groups-dynamic-\nmembership\n3. https://learn.microsoft.com/en-us/entra/external-id/use-dynamic-groups"
    },
    {
        "id": "5.1.4",
        "title": "Devices"
    },
    {
        "id": "5.1.5",
        "title": "Applications"
    },
    {
        "id": "5.1.5.1",
        "title": "(L2) Ensure user consent to apps accessing company data on their behalf is not\nallowed (Automated)",
        "profile": "• E3 Level 2",
        "description": "Control when end users and group owners are allowed to grant consent to applications,\nand when they will be required to request administrator review and approval. Allowing\nusers to grant apps access to data helps them acquire useful applications and be\nproductive but can represent a risk in some situations if it's not monitored and controlled\ncarefully.",
        "rationale": "Attackers commonly use custom applications to trick users into granting them access to\ncompany data. Disabling future user consent operations setting mitigates this risk and\nhelps to reduce the threat-surface. If user consent is disabled previous consent grants\nwill still be honored but all future consent operations must be performed by an\nadministrator.",
        "impact": "If user consent is disabled, previous consent grants will still be honored but all future\nconsent operations must be performed by an administrator. Tenant-wide admin consent\ncan be requested by users through an integrated administrator consent request\nworkflow or through organizational support processes.\nPage 165",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Identity > Applications select Enterprise applications.\n3. Under Security select Consent and permissions > User consent\nsettings.\n4. Verify User consent for applications is set to Do not allow user\nconsent.\nTo audit using PowerShell:\n1. Connect to Microsoft Graph using Connect-MgGraph -Scopes\n\"Policy.Read.All\"\n2. Run the following command:\n(Get-MgPolicyAuthorizationPolicy).DefaultUserRolePermissions |\nSelect-Object -ExpandProperty PermissionGrantPoliciesAssigned\n3. Ensure ManagePermissionGrantsForSelf.microsoft-user-default-low is\nnot present OR that nothing is returned.",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Identity > Applications select Enterprise applications.\n3. Under Security select Consent and permissions > User consent\nsettings.\n4. Under User consent for applications select Do not allow user\nconsent.\n5. Click the Save option at the top of the window.",
        "default_value": "UI - Allow user consent for apps",
        "references": "1. https://learn.microsoft.com/en-us/entra/identity/enterprise-apps/configure-user-\nconsent?pivots=portal\nPage 166"
    },
    {
        "id": "5.1.5.2",
        "title": "(L1) Ensure the admin consent workflow is enabled (Manual)",
        "profile": "• E3 Level 1",
        "description": "The admin consent workflow gives admins a secure way to grant access to applications\nthat require admin approval. When a user tries to access an application but is unable to\nprovide consent, they can send a request for admin approval. The request is sent via\nemail to admins who have been designated as reviewers. A reviewer takes action on\nthe request, and the user is notified of the action.",
        "rationale": "The admin consent workflow (Preview) gives admins a secure way to grant access to\napplications that require admin approval. When a user tries to access an application but\nis unable to provide consent, they can send a request for admin approval. The request\nis sent via email to admins who have been designated as reviewers. A reviewer acts on\nthe request, and the user is notified of the action.",
        "impact": "To approve requests, a reviewer must be a global administrator, cloud application\nadministrator, or application administrator. The reviewer must already have one of these\nadmin roles assigned; simply designating them as a reviewer doesn't elevate their\nprivileges.",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Identity > Applications select Enterprise applications.\n3. Under Security select Consent and permissions.\n4. Under Manage select Admin consent settings.\n5. Verify that Users can request admin consent to apps they are unable\nto consent to is set to Yes.\nPage 168",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Identity > Applications select Enterprise applications.\n3. Under Security select Consent and permissions.\n4. Under Manage select Admin consent settings.\n5. Set Users can request admin consent to apps they are unable to\nconsent to to Yes under Admin consent requests.\n6. Under the Reviewers choose the Roles and Groups that will review user\ngenerated app consent requests.\n7. Set Selected users will receive email notifications for requests to\nYes\n8. Select Save at the top of the window.",
        "default_value": "• Users can request admin consent to apps they are unable to\nconsent to: No\n• Selected users to review admin consent requests: None\n• Selected users will receive email notifications for requests: Yes\n• Selected users will receive request expiration reminders: Yes\n• Consent request expires after (days): 30",
        "references": "1. https://learn.microsoft.com/en-us/entra/identity/enterprise-apps/configure-admin-\nconsent-workflow"
    },
    {
        "id": "5.1.6",
        "title": "External Identities"
    },
    {
        "id": "5.1.6.1",
        "title": "(L2) Ensure that collaboration invitations are sent to allowed domains only (Manual)",
        "profile": "• E3 Level 2",
        "description": "B2B collaboration is a feature within Microsoft Entra External ID that allows for guest\ninvitations to an organization.\nEnsure users can only send invitations to specified domains.\nNote: This list works independently from OneDrive for Business and SharePoint Online\nallow/block lists. To restrict individual file sharing in SharePoint Online, set up an allow\nor blocklist for OneDrive for Business and SharePoint Online. For instance, in\nSharePoint or OneDrive users can still share with external users from prohibited\ndomains by using Anyone links if they haven't been disabled.",
        "rationale": "By specifying allowed domains for collaborations, external user's companies are\nexplicitly identified. Also, this prevents internal users from inviting unknown external\nusers such as personal accounts and granting them access to resources.",
        "impact": "This could make harder collaboration if the setting is not quickly updated when a new\ndomain is identified as \"allowed\".",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Identity > External Identities select External\ncollaboration settings.\n3. Under Collaboration restrictions, verify that Allow invitations only to\nthe specified domains (most restrictive) is selected. Then verify\nallowed domains are specified under Target domains.\nPage 171",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Identity > External Identities select External\ncollaboration settings.\n3. Under Collaboration restrictions, select Allow invitations only to the\nspecified domains (most restrictive) is selected. Then specify the\nallowed domains under Target domains.",
        "default_value": "Allow invitations to be sent to any domain (most inclusive)",
        "references": "1. https://learn.microsoft.com/en-us/entra/external-id/allow-deny-list\n2. https://learn.microsoft.com/en-us/entra/external-id/what-is-b2b"
    },
    {
        "id": "5.1.6.2",
        "title": "(L1) Ensure that guest user access is restricted (Automated)",
        "profile": "• E3 Level 1",
        "description": "Microsoft Entra ID, part of Microsoft Entra, allows you to restrict what external guest\nusers can see in their organization in Microsoft Entra ID. Guest users are set to a limited\npermission level by default in Microsoft Entra ID, while the default for member users is\nthe full set of user permissions.\nThese directory level permissions are enforced across Microsoft Entra services\nincluding Microsoft Graph, PowerShell v2, the Azure portal, and My Apps portal.\nMicrosoft 365 services leveraging Microsoft 365 groups for collaboration scenarios are\nalso affected, specifically Outlook, Microsoft Teams, and SharePoint. They do not\noverride the SharePoint or Microsoft Teams guest settings.\nThe recommended state is at least Guest users have limited access to\nproperties and memberships of directory objects or more restrictive.",
        "rationale": "By limiting guest access to the most restrictive state this helps prevent malicious group\nand user object enumeration in the Microsoft 365 environment. This first step, known as\nreconnaissance in The Cyber Kill Chain, is often conducted by attackers prior to more\nadvanced targeted attacks.",
        "impact": "The default is Guest users have limited access to properties and\nmemberships of directory objects.\nWhen using the 'most restrictive' setting, guests will only be able to access their own\nprofiles and will not be allowed to see other users' profiles, groups, or group\nmemberships.\nThere are some known issues with Yammer that will prevent guests that are signed in\nfrom leaving the group.\nPage 173",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Identity > External Identities select External\ncollaboration settings.\n3. Under Guest user access verify that Guest user access restrictions is set\nto one of the following:\no State: Guest users have limited access to properties and\nmemberships of directory objects\no State: Guest user access is restricted to properties and\nmemberships of their own directory objects (most\nrestrictive)\nTo audit using PowerShell:\n1. Connect to Microsoft Graph using Connect-MgGraph -Scopes\n\"Policy.Read.All\"\n2. Run the following command:\nGet-MgPolicyAuthorizationPolicy | fl GuestUserRoleId\n3. Ensure the value returned is 10dae51f-b6af-4016-8d66-8c2a99b929b3 or\n2af84b1e-32c8-42b7-82bc-daa82404023b (most restrictive)\nNote: Either setting allows for a passing state\n.\nNote 2: The value of a0b1b346-4d3e-4e8b-98f8-753987be4970 is equal to Guest\nusers have the same access as members (most inclusive) and should not be\nused.\nPage 174",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Identity > External Identities select External\ncollaboration settings.\n3. Under Guest user access set Guest user access restrictions to one of\nthe following:\no State: Guest users have limited access to properties and\nmemberships of directory objects\no State: Guest user access is restricted to properties and\nmemberships of their own directory objects (most\nrestrictive)\nTo remediate using PowerShell:\n1. Connect to Microsoft Graph using Connect-MgGraph -Scopes\n\"Policy.ReadWrite.Authorization\"\n2. Run the following command to set the guest user access restrictions to default:\n# Guest users have limited access to properties and memberships of directory\nobjects\nUpdate-MgPolicyAuthorizationPolicy -GuestUserRoleId '10dae51f-b6af-4016-8d66-\n8c2a99b929b3'\n3. Or, run the following command to set it to the \"most restrictive\":\n# Guest user access is restricted to properties and memberships of their own\ndirectory objects (most restrictive)\nUpdate-MgPolicyAuthorizationPolicy -GuestUserRoleId '2af84b1e-32c8-42b7-82bc-\ndaa82404023b'\nNote: Either setting allows for a passing state.",
        "default_value": "• UI: Guest users have limited access to properties and memberships\nof directory objects\n• PowerShell: 10dae51f-b6af-4016-8d66-8c2a99b929b3",
        "references": "1. https://learn.microsoft.com/en-us/entra/identity/users/users-restrict-guest-\npermissions\n2. https://www.lockheedmartin.com/en-us/capabilities/cyber/cyber-kill-chain.html\nPage 175"
    },
    {
        "id": "5.1.6.3",
        "title": "(L2) Ensure guest user invitations are limited to the Guest Inviter role (Automated)",
        "profile": "• E3 Level 2",
        "description": "By default, all users in the organization, including B2B collaboration guest users, can\ninvite external users to B2B collaboration. The ability to send invitations can be limited\nby turning it on or off for everyone, or by restricting invitations to certain roles.\nThe recommended state for guest invite restrictions is Only users assigned to\nspecific admin roles can invite guest users.",
        "rationale": "Restricting who can invite guests limits the exposure the organization might face from\nunauthorized accounts.",
        "impact": "This introduces an obstacle to collaboration by restricting who can invite guest users to\nthe organization. Designated Guest Inviters must be assigned, and an approval process\nestablished and clearly communicated to all users.",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Identity > External Identities select External\ncollaboration settings.\n3. Under Guest invite settings verify that Guest invite restrictions is set to\nOnly users assigned to specific admin roles can invite guest\nusers or more restrictive.\nTo audit using PowerShell:\n1. Connect to Microsoft Graph using Connect-MgGraph -Scopes\n\"Policy.Read.All\"\n2. Run the following command:\nGet-MgPolicyAuthorizationPolicy | fl AllowInvitesFrom\n3. Ensure the value returned is adminsAndGuestInviters or more restrictive.\nPage 177",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Identity > External Identities select External\ncollaboration settings.\n3. Under Guest invite settings set Guest invite restrictions to Only users\nassigned to specific admin roles can invite guest users.\nTo remediate using PowerShell:\n1. Connect to Microsoft Graph using Connect-MgGraph -Scopes\n\"Policy.ReadWrite.Authorization\"\n2. Run the following command:\nUpdate-MgPolicyAuthorizationPolicy -AllowInvitesFrom 'adminsAndGuestInviters'\nNote: The more restrictive position of the value will also pass audit, it is however not\nrequired.",
        "default_value": "• UI: Anyone in the organization can invite guest users including\nguests and non-admins (most inclusive)\n• PowerShell: everyone",
        "references": "1. https://learn.microsoft.com/en-us/entra/external-id/external-collaboration-settings-\nconfigure\n2. https://learn.microsoft.com/en-us/entra/identity/role-based-access-\ncontrol/permissions-reference#guest-inviter"
    },
    {
        "id": "5.1.7",
        "title": "User experiences"
    },
    {
        "id": "5.1.8",
        "title": "Hybrid management"
    },
    {
        "id": "5.1.8.1",
        "title": "(L1) Ensure that password hash sync is enabled for hybrid deployments (Automated)",
        "profile": "• E3 Level 1",
        "description": "Password hash synchronization is one of the sign-in methods used to accomplish hybrid\nidentity synchronization. Microsoft Entra Connect synchronizes a hash, of the hash, of a\nuser's password from an on-premises Active Directory instance to a cloud-based Entra\nID instance.\nNote: Audit and remediation procedures in this recommendation only apply to Microsoft\n365 tenants operating in a hybrid configuration using Entra Connect sync and does not\napply to federated domains.",
        "rationale": "Password hash synchronization helps by reducing the number of passwords your users\nneed to maintain to just one and enables leaked credential detection for your hybrid\naccounts. Leaked credential protection is leveraged through Entra ID Protection and is a\nsubset of that feature which can help identify if an organization's user account\npasswords have appeared on the dark web or public spaces.\nUsing other options for your directory synchronization may be less resilient as Microsoft\ncan still process sign-ins to 365 with Hash Sync even if a network connection to your\non-premises environment is not available.",
        "impact": "Compliance or regulatory restrictions may exist, depending on the organization's\nbusiness sector, that preclude hashed versions of passwords from being securely\ntransmitted to cloud data centers.\nPage 180",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Identity > Hybrid management > Microsoft Entra\nConnect.\n3. Select Connect Sync\n4. Under Microsoft Entra Connect sync, verify Password Hash Sync is Enabled.\nTo audit for the on-prem tool:\n1. Log in to the server that hosts the Microsoft Entra Connect tool.\n2. Run Azure AD Connect, and then click Configure and View or export\ncurrent configuration.\n3. Determine whether PASSWORD HASH SYNCHRONIZATION is enabled on your\ntenant.\nThis information is also available via the Microsoft Graph Security API:\nGET https://graph.microsoft.com/beta/security/secureScores\nTo audit using PowerShell:\n1. Connect to the Microsoft Graph service using Connect-MgGraph -Scopes\n\"Organization.Read.All\".\n2. Run the following Microsoft Graph PowerShell command:\nGet-MgOrganization | ft OnPremisesSyncEnabled\n3. If nothing returns then password sync is not enabled for the on premises AD.\nPage 181",
        "remediation": "To remediate using the on-prem Microsoft Entra Connect tool:\n1. Log in to the on-premises server that hosts the Microsoft Entra Connect tool\n2. Double-click the Azure AD Connect icon that was created on the desktop\n3. Click Configure.\n4. On the Additional tasks page, select Customize synchronization\noptions and click Next.\n5. Enter the username and password for your global administrator.\n6. On the Connect your directories screen, click Next.\n7. On the Domain and OU filtering screen, click Next.\n8. On the Optional features screen, check Password hash synchronization\nand click Next.\n9. On the Ready to configure screen click Configure.\n10. Once the configuration completes, click Exit.",
        "default_value": "• Microsoft Entra Connect sync disabled by default\n• Password Hash Sync is Microsoft's recommended setting for new deployments",
        "references": "1. https://learn.microsoft.com/en-us/entra/identity/hybrid/connect/whatis-phs\n2. https://www.microsoft.com/en-us/download/details.aspx?id=47594"
    },
    {
        "id": "5.2",
        "title": "Protection",
        "profile": "• E3 Level 1",
        "description": "Idle session timeout allows the configuration of a setting which will timeout inactive\nusers after a pre-determined amount of time. When a user reaches the set idle timeout\nsession, they'll get a notification that they're about to be signed out. They have to select\nto stay signed in or they'll be automatically signed out of all Microsoft 365 web apps.\nCombined with a Conditional Access rule this will only impact unmanaged devices. A\nmanaged device is considered a device managed that is compliant or joined to a\ndomain and using a supported browser like Microsoft Edge or Google Chrome (with the\nMicrosoft Single Sign On) extension.\nThe following Microsoft 365 web apps are supported.\n• Outlook Web App\n• OneDrive\n• SharePoint\n• Microsoft Fabric\n• Microsoft365.com and other start pages\n• Microsoft 365 web apps (Word, Excel, PowerPoint)\n• Microsoft 365 Admin Center\n• M365 Defender Portal\n• Microsoft Purview Compliance Portal\nThe recommended setting is 3 hours (or less) for unmanaged devices.\nNote: Idle session timeout doesn't affect Microsoft 365 desktop and mobile apps.",
        "rationale": "Ending idle sessions through an automatic process can help protect sensitive company\ndata and will add another layer of security for end users who work on unmanaged\ndevices that can potentially be accessed by the public. Unauthorized individuals onsite\nor remotely can take advantage of systems left unattended over time. Automatic timing\nout of sessions makes this more difficult.\nPage 43",
        "impact": "If step 2 in the Audit/Remediation procedure is left out, then there is no issue with this\nfrom a security standpoint. However, it will require users on trusted devices to sign in\nmore frequently which could result in credential prompt fatigue.\nNote: Idle session timeout also affects the Azure Portal idle timeout if this is not\nexplicitly set to a different timeout. The Azure Portal idle timeout applies to all kind of\ndevices, not just unmanaged. See : change the directory timeout setting admin",
        "audit": "Step 1 - Ensure Idle session timeout is configured:\n1. Navigate to the Microsoft 365 admin center https://admin.microsoft.com/.\n2. Click to expand Settings Select Org settings.\n3. Click Security & Privacy tab.\n4. Select Idle session timeout.\n5. Verify Turn on to set the period of inactivity for users to be\nsigned off of Microsoft 365 web apps is set to 3 hours (or less).\nStep 2 - Ensure the Conditional Access policy is in place:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/\n2. Expand Protect > Conditional Access.\n3. Inspect existing conditional access rules for one that meets the below conditions:\no Users is set to All users.\no Cloud apps or actions > Select apps is set to Office 365.\no Conditions > Client apps is Browser and nothing else.\no Session is set to Use app enforced restrictions.\no Enable Policy is set to On\nNote: To ensure that idle timeouts affect only unmanaged devices, both steps must be\ncompleted.\nPage 44",
        "remediation": "Step 1 - Configure Idle session timeout:\n1. Navigate to the Microsoft 365 admin center https://admin.microsoft.com/.\n2. Click to expand Settings Select Org settings.\n3. Click Security & Privacy tab.\n4. Select Idle session timeout.\n5. Check the box Turn on to set the period of inactivity for users to\nbe signed off of Microsoft 365 web apps\n6. Set a maximum value of 3 hours.\n7. Click save.\nStep 2 - Ensure the Conditional Access policy is in place:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/\n2. Expand Protect > Conditional Access.\n3. Click New policy and give the policy a name.\no Select Users > All users.\no Select Cloud apps or actions > Select apps and select Office 365\no Select Conditions > Client apps > Yes check only Browser unchecking\nall other boxes.\no Select Sessions and check Use app enforced restrictions.\n4. Set Enable policy to On and click Create.\nNote: To ensure that idle timeouts affect only unmanaged devices, both steps must be\ncompleted.",
        "default_value": "Not configured. (Idle sessions will not timeout.)",
        "references": "1. https://learn.microsoft.com/en-us/microsoft-365/admin/manage/idle-session-\ntimeout-web-apps?view=o365-worldwide\nAdditional Information:\nAccording to Microsoft idle session timeout isn't supported when third party cookies are\ndisabled in the browser. Users won't see any sign-out prompts.\nPage 45"
    },
    {
        "id": "5.2.1",
        "title": "Identity Protection"
    },
    {
        "id": "5.2.2",
        "title": "Conditional Access",
        "profile": "• E3 Level 2",
        "description": "App registration allows users to register custom-developed applications for use within\nthe directory.",
        "rationale": "Third-party integrated applications connection to services should be disabled unless\nthere is a very clear value and robust security controls are in place. While there are\nlegitimate uses, attackers can grant access from breached accounts to third party\napplications to exfiltrate data from your tenancy without having to maintain the breached\naccount.",
        "impact": "Implementation of this change will impact both end users and administrators. End users\nwill not be able to integrate third-party applications that they may wish to use.\nAdministrators are likely to receive requests from end users to grant them permission to\nnecessary third-party applications.\nPage 149",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Identity > Users select All users.\n3. Click on Per-user MFA on the top row.\n4. Ensure under the column Multi-factor Auth Status that each account is set\nto Disabled",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Identity > Users select All users.\n3. Click on Per-user MFA on the top row.\n4. Click the empty box next to Display Name to select all accounts.\n5. On the far right under quick steps click Disable.",
        "default_value": "Disabled",
        "references": "1. https://learn.microsoft.com/en-us/entra/identity/authentication/howto-mfa-\nuserstates#convert-users-from-per-user-mfa-to-conditional-access\n2. https://learn.microsoft.com/en-us/microsoft-365/admin/security-and-\ncompliance/set-up-multi-factor-authentication?view=o365-worldwide#use-\nconditional-access-policies\n3. https://learn.microsoft.com/en-us/entra/identity/authentication/howto-mfa-\nuserstates#convert-per-user-mfa-enabled-and-enforced-users-to-disabled"
    },
    {
        "id": "5.2.2.1",
        "title": "(L1) Ensure multifactor authentication is enabled for all users in administrative roles\n(Manual)",
        "profile": "• E3 Level 1",
        "description": "Multifactor authentication is a process that requires an additional form of identification\nduring the sign-in process, such as a code from a mobile device or a fingerprint scan, to\nenhance security.\nEnsure users in administrator roles have MFA capabilities enabled.",
        "rationale": "Multifactor authentication requires an individual to present a minimum of two separate\nforms of authentication before access is granted. Multifactor authentication provides\nadditional assurance that the individual attempting to gain access is who they claim to\nbe. With multifactor authentication, an attacker would need to compromise at least two\ndifferent authentication mechanisms, increasing the difficulty of compromise and thus\nreducing the risk.",
        "impact": "Implementation of multifactor authentication for all users in administrative roles will\nnecessitate a change to user routine. All users in administrative roles will be required to\nenroll in multifactor authentication using phone, SMS, or an authentication application.\nAfter enrollment, use of multifactor authentication will be required for future access to\nthe environment.\nPage 185",
        "audit": "To audit using the UI:\n1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com.\n2. Click to expand Protection > Conditional Access select Policies.\n3. Ensure that a policy exists with the following criteria and is set to On:\no Under Users verify Directory roles specific to administrators are\nincluded.\no Under Target resources verify All cloud apps is selected with no\nexclusions.\no Under Grant verify Grant Access and Require multifactor\nauthentication checked.\n4. Ensure Enable policy is set to On.\nTo audit using SecureScore:\n1. Navigate to Microsoft 365 Defender https://security.microsoft.com.\n2. Select Secure score.\n3. Select Recommended actions.\n4. Click on Ensure multifactor authentication is enabled for all users\nin administrative roles.\n5. Review the number of Admin users who do not have MFA configured.\nThis information is also available via the Microsoft Graph Security API:\nGET https://graph.microsoft.com/beta/security/secureScores\nNote: A list of required Directory roles can be found in the Remediation section.\nPage 186",
        "remediation": "To remediate using the UI:\n1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com.\n2. Click expand Protection > Conditional Access select Policies.\n3. Click New policy.\no Under Users include Select users and groups and check Directory\nroles.\no At a minimum, include the directory roles listed below in this section of the\ndocument.\no Under Target resources include All cloud apps and do not create\nany exclusions.\no Under Grant select Grant Access and check Require multifactor\nauthentication.\no Click Select at the bottom of the pane.\n4. Under Enable policy set it to Report Only until the organization is ready to\nenable it.\n5. Click Create.\nAt minimum these directory roles should be included for MFA:\n• Application administrator\n• Authentication administrator\n• Billing administrator\n• Cloud application administrator\n• Conditional Access administrator\n• Exchange administrator\n• Global administrator\n• Global reader\n• Helpdesk administrator\n• Password administrator\n• Privileged authentication administrator\n• Privileged role administrator\n• Security administrator\n• SharePoint administrator\n• User administrator\nNote: Report-only is an acceptable first stage when introducing any CA policy. The\ncontrol, however, is not complete until the policy is on.\nReferences:\n1. https://learn.microsoft.com/en-us/entra/identity/conditional-access/howto-\nconditional-access-policy-admin-mfa\nPage 187\nCIS Controls:\nControls\nControl IG 1 IG 2 IG 3\nVersion\n6.5 Require MFA for Administrative Access\nv8\nRequire MFA for all administrative access accounts, where supported, on all\n● ● ●\nenterprise assets, whether managed on-site or through a third-party provider.\n16.3 Require Multi-factor Authentication\nv7\nRequire multi-factor authentication for all user accounts, on all systems,\n● ●\nwhether managed onsite or by a third-party provider.\nPage 188",
        "references": "1. https://learn.microsoft.com/en-us/entra/identity/conditional-access/howto-\nconditional-access-policy-admin-mfa\nPage 187"
    },
    {
        "id": "5.2.2.2",
        "title": "(L1) Ensure multifactor authentication is enabled for all users (Manual)",
        "profile": "• E3 Level 1",
        "description": "Enable multifactor authentication for all users in the Microsoft 365 tenant. Users will be\nprompted to authenticate with a second factor upon logging in to Microsoft 365 services.\nThe second factor is most commonly a text message to a registered mobile phone\nnumber where they type in an authorization code, or with a mobile application like\nMicrosoft Authenticator.",
        "rationale": "Multifactor authentication requires an individual to present a minimum of two separate\nforms of authentication before access is granted. Multifactor authentication provides\nadditional assurance that the individual attempting to gain access is who they claim to\nbe. With multifactor authentication, an attacker would need to compromise at least two\ndifferent authentication mechanisms, increasing the difficulty of compromise and thus\nreducing the risk.",
        "impact": "Implementation of multifactor authentication for all users will necessitate a change to\nuser routine. All users will be required to enroll in multifactor authentication using phone,\nSMS, or an authentication application. After enrollment, use of multifactor authentication\nwill be required for future authentication to the environment.\nNote: Organizations that have difficulty enforcing MFA globally due lack of the budget to\nprovide company owned mobile devices to every user, or equally are unable to force\nend users to use their personal devices due to regulations, unions, or policy have\nanother option. FIDO2 Security keys may be used as a stand in for this\nrecommendation. They are more secure, phishing resistant, and are affordable for an\norganization to issue to every end user.\nPage 189",
        "audit": "To audit using the UI:\n1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com.\n2. Click expand Protection > Conditional Access select Policies.\n3. Ensure that a policy exists with the following criteria and is set to On:\no Under Users verify All users is included.\no Under Target resources verify All cloud apps is selected with no\nexclusions.\no Under Grant verify Grant Access and Require multifactor\nauthentication checked.\n4. Ensure Enable policy is set to On.\nTo audit using SecureScore:\n1. Navigate to Microsoft 365 Defender https://security.microsoft.com.\n2. Select Secure score.\n3. Select Recommended actions.\n4. Click on Ensure multifactor authentication is enabled for all\nusers.\n5. Review the list of users who do not have MFA configured.",
        "remediation": "To remediate using the UI:\n1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com.\n2. Click expand Protection > Conditional Access select Policies.\n3. Click New policy.\no Under Users include All users (and do not exclude any user).\no Under Target resources include All cloud apps and do not create\nany exclusions.\no Under Grant select Grant Access and check Require multifactor\nauthentication.\no Click Select at the bottom of the pane.\n4. Under Enable policy set it to Report Only until the organization is ready to\nenable it.\n5. Click Create.\nNote: Report-only is an acceptable first stage when introducing any CA policy. The\ncontrol, however, is not complete until the policy is on.",
        "default_value": "Disabled\nPage 190",
        "references": "1. https://learn.microsoft.com/en-us/entra/identity/conditional-access/howto-\nconditional-access-policy-all-users-mfa"
    },
    {
        "id": "5.2.2.3",
        "title": "(L1) Enable Conditional Access policies to block legacy authentication (Manual)",
        "profile": "• E3 Level 1",
        "description": "Entra ID supports the most widely used authentication and authorization protocols\nincluding legacy authentication. This authentication pattern includes basic\nauthentication, a widely used industry-standard method for collecting username and\npassword information.\nThe following messaging protocols support legacy authentication:\n• Authenticated SMTP - Used to send authenticated email messages.\n• Autodiscover - Used by Outlook and EAS clients to find and connect to\nmailboxes in Exchange Online.\n• Exchange ActiveSync (EAS) - Used to connect to mailboxes in Exchange Online.\n• Exchange Online PowerShell - Used to connect to Exchange Online with remote\nPowerShell. If you block Basic authentication for Exchange Online PowerShell,\nyou need to use the Exchange Online PowerShell Module to connect. For\ninstructions, see Connect to Exchange Online PowerShell using multifactor\nauthentication.\n• Exchange Web Services (EWS) - A programming interface that's used by\nOutlook, Outlook for Mac, and third-party apps.\n• IMAP4 - Used by IMAP email clients.\n• MAPI over HTTP (MAPI/HTTP) - Primary mailbox access protocol used by\nOutlook 2010 SP2 and later.\n• Offline Address Book (OAB) - A copy of address list collections that are\ndownloaded and used by Outlook.\n• Outlook Anywhere (RPC over HTTP) - Legacy mailbox access protocol\nsupported by all current Outlook versions.\n• POP3 - Used by POP email clients.\n• Reporting Web Services - Used to retrieve report data in Exchange Online.\n• Universal Outlook - Used by the Mail and Calendar app for Windows 10.\n• Other clients - Other protocols identified as utilizing legacy authentication.",
        "rationale": "Legacy authentication protocols do not support multi-factor authentication. These\nprotocols are often used by attackers because of this deficiency. Blocking legacy\nauthentication makes it harder for attackers to gain access.\nPage 192\nNote: Basic authentication is now disabled in all tenants. Before December 31 2022,\nyou could re-enable the affected protocols if users and apps in your tenant couldn't\nconnect. Now no one (you or Microsoft support) can re-enable Basic authentication in\nyour tenant.",
        "impact": "Enabling this setting will prevent users from connecting with older versions of Office,\nActiveSync or using protocols like IMAP, POP or SMTP and may require upgrades to\nolder versions of Office, and use of mobile mail clients that support modern\nauthentication.\nThis will also cause multifunction devices such as printers from using scan to e-mail\nfunction if they are using a legacy authentication method. Microsoft has mail flow best\npractices in the link below which can be used to configure a MFP to work with modern\nauthentication:\nhttps://learn.microsoft.com/en-us/exchange/mail-flow-best-practices/how-to-set-up-a-\nmultifunction-device-or-application-to-send-email-using-microsoft-365-or-office-365",
        "audit": "To audit using the UI:\n1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com.\n2. Click expand Protection > Conditional Access select Policies.\n3. Ensure that a policy exists with the following criteria and is set to On:\no Under Users verify All users is included and that there are only valid\nexclusions.\no Under Target resources verify All cloud apps is selected with no\nexclusions.\no Under Conditions select Client apps then verify Exchange\nActiveSync clients and Other clients is checked.\no Under Grant verify Block access is selected.\n4. Ensure Enable policy is set to On.\nThis information is also available via the Microsoft Graph Security API:\nGET https://graph.microsoft.com/beta/security/secureScores\nPage 193",
        "remediation": "To remediate using the UI:\n1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com.\n2. Click expand Protection > Conditional Access select Policies.\n3. Create a new policy by selecting New policy.\no Under Users include All users.\no Under Target resources include All cloud apps and do not create\nany exclusions.\no Under Conditions select Client apps and check the boxes for\nExchange ActiveSync clients and Other clients.\no Under Grant select Block Access.\no Click Select.\n4. Set the policy On and click Create.",
        "default_value": "Basic authentication is disabled by default as of January 2023.",
        "references": "1. https://learn.microsoft.com/en-us/exchange/clients-and-mobile-in-exchange-\nonline/disable-basic-authentication-in-exchange-online\n2. https://learn.microsoft.com/en-us/exchange/mail-flow-best-practices/how-to-set-\nup-a-multifunction-device-or-application-to-send-email-using-microsoft-365-or-\noffice-365\n3. https://learn.microsoft.com/en-us/exchange/clients-and-mobile-in-exchange-\nonline/deprecation-of-basic-authentication-exchange-online"
    },
    {
        "id": "5.2.2.4",
        "title": "(L1) Ensure Sign-in frequency is enabled and browser sessions are not persistent for\nAdministrative users (Manual)",
        "profile": "• E3 Level 1",
        "description": "In complex deployments, organizations might have a need to restrict authentication\nsessions. Conditional Access policies allow for the targeting of specific user accounts.\nSome scenarios might include:\n• Resource access from an unmanaged or shared device\n• Access to sensitive information from an external network\n• High-privileged users\n• Business-critical applications\nEnsure Sign-in frequency periodic reauthentication does not exceed 4 hours for E3\ntenants, or 24 hours for E5 tenants using Privileged Identity Management.\nEnsure Persistent browser session is set to Never persistent\nNote: This CA policy can be added to the previous CA policy in this benchmark \"Ensure\nmultifactor authentication is enabled for all users in administrative roles\"",
        "rationale": "Forcing a time out for MFA will help ensure that sessions are not kept alive for an\nindefinite period of time, ensuring that browser sessions are not persistent will help in\nprevention of drive-by attacks in web browsers, this also prevents creation and saving of\nsession cookies leaving nothing for an attacker to take.",
        "impact": "Users with Administrative roles will be prompted at the frequency set for MFA.\nPage 195",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Protection > Conditional Access Select Policies.\n3. Ensure that a policy exists with the following criteria and is set to On:\no Under Users verify Directory roles specific to administrators are\nincluded.\no Under Session verify Sign-in frequency is checked and set to\nPeriodic reauthentication.\no Verify the timeframe is set to the time determined by the organization.\no Ensure Periodic reauthentication does not exceed 4 hours for E3\ntenants. E5 tenants using PIM may be set to a maximum of 24 hours.\no Verify Persistent browser session is set to Never persistent.\n4. Ensure Enable policy is set to On\nNote: A list of directory roles applying to Administrators can be found in the remediation\nsection.\nPage 196",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Protection > Conditional Access Select Policies.\n3. Click New policy.\no Under Users include Select users and groups and check Directory\nroles.\no At a minimum, include the directory roles listed below in this section of the\ndocument.\no Under Target resources include All cloud apps and do not create\nany exclusions.\no Under Grant select Grant Access and check Require multifactor\nauthentication.\no Under Session select Sign-in frequency select Periodic\nreauthentication and set it to 4 hours for E3 tenants. E5 tenants with\nPIM can be set to a maximum value of 24 hours.\no Check Persistent browser session then select Never persistent in\nthe drop-down menu.\n4. Under Enable policy set it to Report Only until the organization is ready to\nenable it.\nAt minimum these directory roles should be included in the policy:\n• Application administrator\n• Authentication administrator\n• Billing administrator\n• Cloud application administrator\n• Conditional Access administrator\n• Exchange administrator\n• Global administrator\n• Global reader\n• Helpdesk administrator\n• Password administrator\n• Privileged authentication administrator\n• Privileged role administrator\n• Security administrator\n• SharePoint administrator\n• User administrator",
        "default_value": "The default configuration for user sign-in frequency is a rolling window of 90 days.\nPage 197",
        "references": "1. https://learn.microsoft.com/en-us/entra/identity/conditional-access/howto-\nconditional-access-session-lifetime"
    },
    {
        "id": "5.2.2.5",
        "title": "(L2) Ensure 'Phishing-resistant MFA strength' is required for Administrators (Manual)",
        "profile": "• E3 Level 2",
        "description": "Authentication strength is a Conditional Access control that allows administrators to\nspecify which combination of authentication methods can be used to access a resource.\nFor example, they can make only phishing-resistant authentication methods available to\naccess a sensitive resource. But to access a non-sensitive resource, they can allow less\nsecure multifactor authentication (MFA) combinations, such as password + SMS.\nMicrosoft has 3 built-in authentication strengths. MFA strength, Passwordless MFA\nstrength, and Phishing-resistant MFA strength. Ensure administrator roles are using a\nCA policy with Phishing-resistant MFA strength.\nAdministrators can then enroll using one of 3 methods:\n• FIDO2 Security Key\n• Windows Hello for Business\n• Certificate-based authentication (Multi-Factor)\nNote: Additional steps to configure methods such as FIDO2 keys are not covered here\nbut can be found in related MS articles in the references section. The Conditional\nAccess policy only ensures 1 of the 3 methods is used.\nWarning: Administrators should be pre-registered for a strong authentication\nmechanism before this Conditional Access Policy is enforced. Additionally, as stated\nelsewhere in the CIS Benchmark a break-glass administrator account should be\nexcluded from this policy to ensure unfettered access in the case of an emergency.",
        "rationale": "Sophisticated attacks targeting MFA are more prevalent as the use of it becomes more\nwidespread. These 3 methods are considered phishing-resistant as they remove\npasswords from the login workflow. It also ensures that public/private key exchange can\nonly happen between the devices and a registered provider which prevents login to fake\nor phishing websites.\nPage 199",
        "impact": "If administrators aren't pre-registered for a strong authentication method prior to a\nconditional access policy being created, then a condition could occur where a user can't\nregister for strong authentication because they don't meet the conditional access policy\nrequirements and therefore are prevented from signing in.\nAdditionally, Internet Explorer based credential prompts in PowerShell do not support\nprompting for a security key. Implementing phishing-resistant MFA with a security key\nmay prevent admins from running their existing sets of PowerShell scripts. Device\nAuthorization Grant Flow can be used as a workaround in some instances.",
        "audit": "To audit using the UI:\n1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com.\n2. Click expand Protection > Conditional Access select Policies.\n3. Ensure that a policy exists with the following criteria and is set to On:\no Under Users verify Directory roles specific to administrators are\nincluded.\no Directory Roles should include at minimum the roles listed in the\nremediation section.\no Under Target resources verify All cloud apps is selected with no\nexclusions.\no Under Grant verify Grant Access is selected and Require\nauthentication strength is checked with Phishing-resistant MFA\nset as the value.\n4. Ensure Enable policy is set to On.\nPage 200",
        "remediation": "To remediate using the UI:\n1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com.\n2. Click expand Protection > Conditional Access select Policies.\n3. Click New policy.\no Under Users include Select users and groups and check Directory\nroles.\no At a minimum, include the directory roles listed below in this section of the\ndocument.\no Under Target resources include All cloud apps and do not create\nany exclusions.\no Under Grant select Grant Access and check Require authentication\nstrength and set Phishing-resistant MFA in the dropdown box.\no Click Select.\n4. Under Enable policy set it to Report Only until the organization is ready to\nenable it.\n5. Click Create.\nAt minimum these directory roles should be included for the policy:\n• Application administrator\n• Authentication administrator\n• Billing administrator\n• Cloud application administrator\n• Conditional Access administrator\n• Exchange administrator\n• Global administrator\n• Global reader\n• Helpdesk administrator\n• Password administrator\n• Privileged authentication administrator\n• Privileged role administrator\n• Security administrator\n• SharePoint administrator\n• User administrator\nWarning: Ensure administrators are pre-registered with strong authentication before\nenforcing the policy. After which the policy must be set to On.\nPage 201\nReferences:\n1. https://learn.microsoft.com/en-us/entra/identity/authentication/concept-\nauthentication-passwordless#fido2-security-keys\n2. https://learn.microsoft.com/en-us/entra/identity/authentication/how-to-enable-\npasskey-fido2\n3. https://learn.microsoft.com/en-us/entra/identity/authentication/concept-\nauthentication-strengths\n4. https://learn.microsoft.com/en-us/entra/id-protection/howto-identity-protection-\nconfigure-mfa-policy\nCIS Controls:\nControls\nControl IG 1 IG 2 IG 3\nVersion\n6.5 Require MFA for Administrative Access\nv8\nRequire MFA for all administrative access accounts, where supported, on all\n● ● ●\nenterprise assets, whether managed on-site or through a third-party provider.\nPage 202",
        "references": "1. https://learn.microsoft.com/en-us/entra/identity/authentication/concept-\nauthentication-passwordless#fido2-security-keys\n2. https://learn.microsoft.com/en-us/entra/identity/authentication/how-to-enable-\npasskey-fido2\n3. https://learn.microsoft.com/en-us/entra/identity/authentication/concept-\nauthentication-strengths\n4. https://learn.microsoft.com/en-us/entra/id-protection/howto-identity-protection-\nconfigure-mfa-policy"
    },
    {
        "id": "5.2.2.6",
        "title": "(L1) Enable Identity Protection user risk policies (Manual)",
        "profile": "• E5 Level 1",
        "description": "Microsoft Entra ID Protection user risk policies detect the probability that a user account\nhas been compromised.\nNote: While Identity Protection also provides two risk policies with limited conditions,\nMicrosoft highly recommends setting up risk-based policies in Conditional Access as\nopposed to the \"legacy method\" for the following benefits:\n• Enhanced diagnostic data\n• Report-only mode integration\n• Graph API support\n• Use more Conditional Access attributes like sign-in frequency in the policy",
        "rationale": "With the user risk policy turned on, Entra ID protection detects the probability that a user\naccount has been compromised. Administrators can configure a user risk conditional\naccess policy to automatically respond to a specific user risk level.",
        "impact": "Upon policy activation, account access will be either blocked or the user will be required\nto use multi-factor authentication (MFA) and change their password. Users without\nregistered MFA will be denied access, necessitating an admin to recover the account.\nTo avoid inconvenience, it is advised to configure the MFA registration policy for all\nusers under the User Risk policy.\nAdditionally, users identified in the Risky Users section will be affected by this policy. To\ngain a better understanding of the impact on the organization's environment, the list of\nRisky Users should be reviewed before enforcing the policy.\nPage 203",
        "audit": "To audit using the UI:\n1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com.\n2. Click expand Protection > Conditional Access select Policies.\n3. Ensure that a policy exists with the following criteria and is set to On:\no Under Users or workload identities choose All users\no Under Cloud apps or actions choose All cloud apps\no Under Conditions choose User risk then Yes is set to High.\no Under Access Controls select Grant then in the right pane click Grant\naccess, then select Require multifactor authentication and\nRequire password change.\no Under Session ensure Sign-in frequency is set to Every time.\n4. Ensure Enable policy is set to On.",
        "remediation": "To remediate using the UI:\n1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com.\n2. Click expand Protection > Conditional Access select Policies.\n3. Create a new policy by selecting New policy.\n4. Set the following conditions within the policy:\no Under Users or workload identities choose All users\no Under Cloud apps or actions choose All cloud apps\no Under Conditions choose User risk then Yes and select the user risk\nlevel High.\no Under Access Controls select Grant then in the right pane click Grant\naccess then select Require multifactor authentication and\nRequire password change.\no Under Session ensure Sign-in frequency is set to Every time.\no Click Select.\n5. Under Enable policy set it to Report Only until the organization is ready to\nenable it.\n6. Click Create.\nNote: for more information regarding risk levels refer to Microsoft's Identity Protection &\nRisk Doc\nReferences:\n1. https://learn.microsoft.com/en-us/entra/id-protection/howto-identity-protection-\nrisk-feedback\n2. https://learn.microsoft.com/en-us/entra/id-protection/concept-identity-protection-\nrisks\nPage 204\nCIS Controls:\nControls\nControl IG 1 IG 2 IG 3\nVersion\n13.3 Deploy a Network Intrusion Detection Solution\nv8 Deploy a network intrusion detection solution on enterprise assets, where ● ●\nappropriate. Example implementations include the use of a Network Intrusion\nDetection System (NIDS) or equivalent cloud service provider (CSP) service.\n16.13 Alert on Account Login Behavior Deviation\nv7\nAlert when users deviate from normal login behavior, such as time-of-day,\n●\nworkstation location and duration.\nPage 205",
        "references": "1. https://learn.microsoft.com/en-us/entra/id-protection/howto-identity-protection-\nrisk-feedback\n2. https://learn.microsoft.com/en-us/entra/id-protection/concept-identity-protection-\nrisks\nPage 204"
    },
    {
        "id": "5.2.2.7",
        "title": "(L1) Enable Identity Protection sign-in risk policies (Manual)",
        "profile": "• E5 Level 1",
        "description": "Microsoft Entra ID Protection sign-in risk detects risks in real-time and offline. A risky\nsign-in is an indicator for a sign-in attempt that might not have been performed by the\nlegitimate owner of a user account.\nNote: While Identity Protection also provides two risk policies with limited conditions,\nMicrosoft highly recommends setting up risk-based policies in Conditional Access as\nopposed to the \"legacy method\" for the following benefits:\n• Enhanced diagnostic data\n• Report-only mode integration\n• Graph API support\n• Use more Conditional Access attributes like sign-in frequency in the policy",
        "rationale": "Turning on the sign-in risk policy ensures that suspicious sign-ins are challenged for\nmulti-factor authentication.",
        "impact": "When the policy triggers, the user will need MFA to access the account. In the case of a\nuser who hasn't registered MFA on their account, they would be blocked from accessing\ntheir account. It is therefore recommended that the MFA registration policy be\nconfigured for all users who are a part of the Sign-in Risk policy.\nPage 206",
        "audit": "To ensure Sign-In a risk policy is enabled:\n1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com.\n2. Click expand Protection > Conditional Access select Policies.\n3. Ensure that a policy exists with the following criteria and is set to On:\no Under Users or workload identities choose All users\no Under Cloud apps or actions choose All cloud apps\no Under Conditions choose Sign-in risk then Yes ensuring High and\nMedium are selected.\no Under Access Controls select Grant then in the right pane click Grant\naccess then select Require multifactor authentication.\no Under Session select Sign-in Frequency is set to Every time.\n4. Ensure Enable policy is set to On.",
        "remediation": "To configure a Sign-In risk policy, use the following steps:\n1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com.\n2. Click expand Protection > Conditional Access select Policies.\n3. Create a new policy by selecting New policy.\n4. Set the following conditions within the policy.\no Under Users or workload identities choose All users.\no Under Cloud apps or actions choose All cloud apps.\no Under Conditions choose Sign-in risk then Yes and check the risk\nlevel boxes High and Medium.\no Under Access Controls select Grant then in the right pane click Grant\naccess then select Require multifactor authentication.\no Under Session select Sign-in Frequency and set to Every time.\no Click Select.\n5. Under Enable policy set it to Report Only until the organization is ready to\nenable it.\n6. Click Create.\nNote: For more information regarding risk levels refer to Microsoft's Identity Protection &\nRisk Doc\nReferences:\n1. https://learn.microsoft.com/en-us/entra/id-protection/howto-identity-protection-\nrisk-feedback\n2. https://learn.microsoft.com/en-us/entra/id-protection/concept-identity-protection-\nrisks\nPage 207\nCIS Controls:\nControls\nControl IG 1 IG 2 IG 3\nVersion\n13.3 Deploy a Network Intrusion Detection Solution\nv8 Deploy a network intrusion detection solution on enterprise assets, where ● ●\nappropriate. Example implementations include the use of a Network Intrusion\nDetection System (NIDS) or equivalent cloud service provider (CSP) service.\n16.13 Alert on Account Login Behavior Deviation\nv7\nAlert when users deviate from normal login behavior, such as time-of-day,\n●\nworkstation location and duration.\nPage 208",
        "references": "1. https://learn.microsoft.com/en-us/entra/id-protection/howto-identity-protection-\nrisk-feedback\n2. https://learn.microsoft.com/en-us/entra/id-protection/concept-identity-protection-\nrisks\nPage 207"
    },
    {
        "id": "5.2.2.8",
        "title": "(L2) Ensure admin center access is limited to administrative roles (Manual)",
        "profile": "• E3 Level 2",
        "description": "When a Conditional Access policy targets the Microsoft Admin Portals cloud app, the\npolicy is enforced for tokens issued to application IDs of the following Microsoft\nadministrative portals:\n• Azure portal\n• Exchange admin center\n• Microsoft 365 admin center\n• Microsoft 365 Defender portal\n• Microsoft Entra admin center\n• Microsoft Intune admin center\n• Microsoft Purview compliance portal\n• Power Platform admin center\n• SharePoint admin center\n• Microsoft Teams admin center\nMicrosoft Admin Portals should be restricted to specific pre-determined\nadministrative roles.",
        "rationale": "Conditional Access (CA) policies are not enforced for other role types, including\nadministrative unit-scoped or custom roles. By restricting access to built-in directory\nroles, users granted privileged permissions outside of these roles will be blocked from\naccessing admin centers.\nFor example, the Organization Management admin role in Exchange Online has\nequivalent permissions to the built-in directory role Exchange Administrator. A user\nassigned only the Organization Management role would not be subject to CA policies\ntargeting the Exchange Administrator role, or any and all Directory Roles. This could\nalso allow a user with high privileges to be excluded from access reviews and other\ntechnical or management controls.\nRestricting access to Microsoft Admin Portals while impactful, covers a gap that is\notherwise not bridged by Conditional Access.\nPage 209",
        "impact": "PIM functionality will be impacted unless non-privileged users are first assigned to a\npermanent group or role that is excluded from this policy. When attempting to checkout\na role in the Entra ID PIM area they will receive the message \"You don't have access to\nthis Your sign-in was successful but you don't have permission to access this resource.\"\n• Users included in the policy will be unable to manually installs applications when\nclicking on Install Microsoft 365 apps.\n• Users included in the policy will be unable to access the Quarantine in the\nDefender admin center at https://security.microsoft.com/quarantine",
        "audit": "To audit using the UI:\n1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com.\n2. Click expand Protection > Conditional Access select Policies.\n3. Ensure that a policy exists with the following criteria and is set to On:\no Under Users verify All Users is included.\no Under Users > Exclude verify Guest or external users is checked\nand Users and groups contain only a group of PIM eligible users.\no Under Users > Exclude verify Directory Roles contains only\nadministrative roles. See below for details on roles.\no Under Target resources verify Cloud apps is selected and includes\nMicrosoft Admin Portals.\no Under Grant verify Block Access is selected.\n4. Ensure Enable policy is set to On.\nDirectory Roles and Exclusions\nIn Directory roles > Exclude the role Global Administrator at a minimum should\nbe selected to avoid I.T. being locked out. The organization should pre-determine roles\nin the exclusion list as there is not a one size fits all. Auditors and system administrators\nshould exercise due diligence balancing operation while exercising least privilege. As\nthe size of the organization increases so will the number of roles being utilized.\nA an example starting list of Administrator roles can be found under Additional\nInformation\nNote: In order for PIM to function a group of users eligible for PIM roles must be\nexcluded from the policy.\nPage 210",
        "remediation": "To remediate using the UI:\n1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com.\n2. Click expand Protection > Conditional Access select Policies.\n3. Click New Policy.\no Under Users include All Users.\no Under Users select Exclude and check Directory roles and select\nonly administrative roles and a group of PIM eligible users.\no Under Target resources select Cloud apps and Select apps then\nselect the Microsoft Admin Portals app.\no Confirm by clicking Select.\no Under Grant select Block access and click Select.\n4. Under Enable policy set it to Report Only until the organization is ready to\nenable it.\n5. Click Create.\nWarning: Exclude Global Administrator at a minimum to avoid being locked out.\nReport-only is a good option to use when testing any Conditional Access policy for the\nfirst time.\nNote: In order for PIM to function a group of users eligible for PIM roles must be\nexcluded from the policy.",
        "default_value": "No - Non-administrators can access the Microsoft admin portals.",
        "references": "1. https://learn.microsoft.com/en-us/entra/identity/conditional-access/concept-\nconditional-access-cloud-apps#microsoft-admin-portals\nPage 211\nAdditional Information:\nBelow is an example list of Administrator roles that could be excluded\n• Application administrator\n• Authentication administrator\n• Billing administrator\n• Cloud application administrator\n• Conditional Access administrator\n• Exchange administrator\n• Global administrator\n• Global reader\n• Helpdesk administrator\n• Password administrator\n• Privileged authentication administrator\n• Privileged role administrator\n• Security administrator\n• SharePoint administrator\n• User administrator"
    },
    {
        "id": "5.2.2.9",
        "title": "(L2) Ensure 'sign-in risk' is blocked for medium and high risk (Manual)",
        "profile": "• E5 Level 2",
        "description": "Microsoft Entra ID Protection sign-in risk detects risks in real-time and offline. A risky\nsign-in is an indicator for a sign-in attempt that might not have been performed by the\nlegitimate owner of a user account.\nNote: While Identity Protection also provides two risk policies with limited conditions,\nMicrosoft highly recommends setting up risk-based policies in Conditional Access as\nopposed to the \"legacy method\" for the following benefits:\n• Enhanced diagnostic data\n• Report-only mode integration\n• Graph API support\n• Use more Conditional Access attributes like sign-in frequency in the policy",
        "rationale": "Sign-in risk is determined at the time of sign-in and includes criteria across both real-\ntime and offline detections for risk. Blocking sign-in to accounts that have risk can\nprevent undesired access from potentially compromised devices or unauthorized users.",
        "impact": "Sign-in risk is heavily dependent on detecting risk based on atypical behaviors. Due to\nthis it is important to run this policy in a report-only mode to better understand how the\norganization's environment and user activity may influence sign-in risk before turning\nthe policy on. Once it's understood what actions may trigger a medium or high sign-in\nrisk event I.T. can then work to create an environment to reduce false positives. For\nexample, employees might be required to notify security personnel when they intend to\ntravel with intent to access work resources.\nNote: Break-glass accounts should always be excluded from risk detection.\nPage 213",
        "audit": "To audit using the UI:\n1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com.\n2. Click expand Protection > Conditional Access select Policies.\n3. Ensure that a policy exists with the following criteria and is set to On:\no Under Users verify All users are included and only valid users are\nexcluded.\no Under Target resources verify All cloud apps is selected with no\nexclusions.\no Under Conditions verify Sign-in risk values of High and Medium are\nselected.\no Under Grant verify Block access is selected.\n4. Ensure Enable policy is set to On.\nNote: Break-glass accounts should be excluded from sign-in risk policies",
        "remediation": "To remediate using the UI:\n1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com.\n2. Click expand Protection > Conditional Access select Policies.\n3. Create a new policy by selecting New policy.\n4. Set the following conditions within the policy.\no Under Users include All users and only exclude valid users.\no Under Target resources include All cloud apps and do not set any\nexclusions.\no Under Conditions choose Sign-in risk values of High and Medium\nand click Done.\no Under Grant choose Block access and click Select.\n5. Under Enable policy set it to Report Only until the organization is ready to\nenable it.\n6. Click Create.\nNote: Break-glass accounts should be excluded from sign-in risk policies.\nReferences:\n1. https://learn.microsoft.com/en-us/entra/id-protection/concept-identity-protection-\nrisks#risk-detections-mapped-to-riskeventtype\nPage 214\nCIS Controls:\nControls\nControl IG 1 IG 2 IG 3\nVersion\n13.3 Deploy a Network Intrusion Detection Solution\nv8 Deploy a network intrusion detection solution on enterprise assets, where ● ●\nappropriate. Example implementations include the use of a Network Intrusion\nDetection System (NIDS) or equivalent cloud service provider (CSP) service.\nPage 215",
        "references": "1. https://learn.microsoft.com/en-us/entra/id-protection/concept-identity-protection-\nrisks#risk-detections-mapped-to-riskeventtype\nPage 214"
    },
    {
        "id": "5.2.2.10",
        "title": "(L1) Ensure a managed device is required for authentication (Manual)",
        "profile": "• E3 Level 1",
        "description": "Conditional Access (CA) can be configured to enforce access based on the device's\ncompliance status or whether it is Entra hybrid joined. Collectively this allows CA to\nclassify devices as managed or unmanaged, providing more granular control over\nauthentication policies.\nWhen using Require device to be marked as compliant, the device must pass\nchecks configured in Compliance policies defined within Intune (Endpoint Manager).\nBefore these checks can be applied, the device must first be enrolled in Intune MDM.\nBy selecting Require Microsoft Entra hybrid joined device this means the\ndevice must first be synchronized from an on-premises Active Directory to qualify for\nauthentication.\nWhen configured to the recommended state below only one condition needs to be met\nfor the user to authenticate from the device. This functions as an \"OR\" operator.\nThe recommended state is:\n• Require device to be marked as compliant\n• Require Microsoft Entra hybrid joined device\n• Require one of the selected controls",
        "rationale": "“Managed” devices are considered more secure because they often have additional\nconfiguration hardening enforced through centralized management such as Intune or\nGroup Policy. These devices are also typically equipped with MDR/EDR, managed\npatching and alerting systems. As a result, they provide a safer environment for users to\nauthenticate and operate from.\nThis policy also ensures that attackers must first gain access to a compliant or trusted\ndevice before authentication is permitted, reducing the risk posed by compromised\naccount credentials. When combined with other distinct Conditional Access (CA)\npolicies, such as requiring multi-factor authentication, this adds one additional factor\nbefore authentication is permitted.\nPage 216\nNote: Avoid combining these two settings with other Grant settings in the same policy.\nIn a single policy you can only choose between Require all the selected\ncontrols or Require one of the selected controls, which limits the ability to\nintegrate this recommendation with others in this benchmark. CA policies function as an\n\"AND\" operator across multiple policies. The goal here is to both (Require MFA for all\nusers) AND (Require device to be marked as compliant OR Require Microsoft Entra\nhybrid joined device).",
        "impact": "Unmanaged devices will not be permitted as a valid authenticator. As a result this may\nrequire the organization to mature their device enrollment and management. The\nfollowing devices can be considered managed:\n• Entra hybrid joined from Active Directory\n• Entra joined and enrolled in Intune, with compliance policies\n• Entra registered and enrolled in Intune, with compliances policies",
        "audit": "To audit using the UI:\n1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com.\n2. Click expand Protection > Conditional Access select Policies.\n3. Ensure that a policy exists with the following criteria and is set to On:\no Under Users verify All users is included.\no Under Target resources verify All cloud apps is selected.\no Under Grant verify Require device to be marked as compliant and\nRequire Microsoft Entra hybrid joined device are checked.\no Under Grant verify Require one of the selected controls is\nselected.\n4. Ensure Enable policy is set to On.\nPage 217",
        "remediation": "To remediate using the UI:\n1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com.\n2. Click expand Protection > Conditional Access select Policies.\n3. Create a new policy by selecting New policy.\no Under Users include All users.\no Under Target resources include All cloud apps.\no Under Grant select Grant access.\no Check Require multifactor authentication and Require\nMicrosoft Entra hybrid joined device.\no Choose Require one of the selected controls and click Select at\nthe bottom.\n4. Under Enable policy set it to Report Only until the organization is ready to\nenable it.\n5. Click Create.\nReferences:\n1. https://learn.microsoft.com/en-us/entra/identity/conditional-access/concept-\nconditional-access-grant#require-device-to-be-marked-as-compliant\n2. https://learn.microsoft.com/en-us/entra/identity/devices/concept-hybrid-join\n3. https://learn.microsoft.com/en-us/mem/intune/fundamentals/deployment-guide-\nenrollment\nCIS Controls:\nControls\nControl IG 1 IG 2 IG 3\nVersion\n6.3 Require MFA for Externally-Exposed Applications\nv8 Require all externally-exposed enterprise or third-party applications to enforce ● ●\nMFA, where supported. Enforcing MFA through a directory service or SSO\nprovider is a satisfactory implementation of this Safeguard.\nPage 218",
        "references": "1. https://learn.microsoft.com/en-us/entra/identity/conditional-access/concept-\nconditional-access-grant#require-device-to-be-marked-as-compliant\n2. https://learn.microsoft.com/en-us/entra/identity/devices/concept-hybrid-join\n3. https://learn.microsoft.com/en-us/mem/intune/fundamentals/deployment-guide-\nenrollment"
    },
    {
        "id": "5.2.2.11",
        "title": "(L1) Ensure a managed device is required for MFA registration (Manual)",
        "profile": "• E3 Level 1",
        "description": "Conditional Access (CA) can be configured to enforce access based on the device's\ncompliance status or whether it is Entra hybrid joined. Collectively this allows CA to\nclassify devices as managed or not, providing more granular control over whether or not\na user can register MFA on a device.\nWhen using Require device to be marked as compliant, the device must pass\nchecks configured in Compliance policies defined within Intune (Endpoint Manager).\nBefore these checks can be applied, the device must first be enrolled in Intune MDM.\nBy selecting Require Microsoft Entra hybrid joined device this means the\ndevice must first be synchronized from an on-premises Active Directory to qualify for\nauthentication.\nWhen configured to the recommended state below only one condition needs to be met\nfor the user to register MFA from the device. This functions as an \"OR\" operator.\nThe recommended state is to restrict Register security information to a device\nthat is marked as compliant or Entra hybrid joined.",
        "rationale": "Requiring registration on a managed device significantly reduces the risk of bad actors\nusing stolen credentials to register security information. Accounts that are created but\nnever registered with an MFA method are particularly vulnerable to this type of attack.\nEnforcing this requirement will both reduce the attack surface for fake registrations and\nensure that legitimate users register using trusted devices which typically have\nadditional security measures in place already.\nPage 219",
        "impact": "The organization will be required to have a mature device management process. New\ndevices provided to users will need to be pre-enrolled in Intune, auto-enrolled or be\nEntra hybrid joined. Otherwise, the user will be unable to complete registration,\nrequiring additional resources from I.T. This could be more disruptive in remote worker\nenvironments where the MDM maturity is low.\nIn these cases where the person enrolling in MFA (enrollee) doesn't have physical\naccess to a managed device, a help desk process can be created using a Teams\nmeeting to complete enrollment using: 1) a durable process to verify the enrollee's\nidentity including government identification with a photograph held up to the camera,\ninformation only the enrollee should know, and verification by the enrollee's direct\nmanager in the same meeting; 2) complete enrollment in the same Teams meeting with\nthe enrollee being granted screen and keyboard access to the help desk person's\nInPrivate Edge browser session.",
        "audit": "To audit using the UI:\n1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com.\n2. Click expand Protection > Conditional Access select Policies.\n3. Ensure that a policy exists with the following criteria and is set to On:\no Under Users verify All users is included.\no Under Target resources verify User actions is selected with\nRegister security information checked.\no Under Grant verify Require device to be marked as compliant and\nRequire Microsoft Entra hybrid joined device are checked.\no Under Grant verify Require one of the selected controls is\nselected.\n4. Ensure Enable policy is set to On.\nPage 220",
        "remediation": "To remediate using the UI:\n1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com.\n2. Click expand Protection > Conditional Access select Policies.\n3. Create a new policy by selecting New policy.\no Under Users include All users.\no Under Target resources select User actions and check Register\nsecurity information.\no Under Grant select Grant access.\no Check Require multifactor authentication and Require\nMicrosoft Entra hybrid joined device.\no Choose Require one of the selected controls and click Select at\nthe bottom.\n4. Under Enable policy set it to Report Only until the organization is ready to\nenable it.\n5. Click Create.\nReferences:\n1. https://learn.microsoft.com/en-us/entra/identity/conditional-access/concept-\nconditional-access-grant#require-device-to-be-marked-as-compliant\n2. https://learn.microsoft.com/en-us/entra/identity/devices/concept-hybrid-join\n3. https://learn.microsoft.com/en-us/mem/intune/fundamentals/deployment-guide-\nenrollment\n4. https://learn.microsoft.com/en-us/entra/identity/conditional-access/concept-\nconditional-access-cloud-apps#user-actions\nCIS Controls:\nControls\nControl IG 1 IG 2 IG 3\nVersion\n6.3 Require MFA for Externally-Exposed Applications\nv8 Require all externally-exposed enterprise or third-party applications to enforce ● ●\nMFA, where supported. Enforcing MFA through a directory service or SSO\nprovider is a satisfactory implementation of this Safeguard.\nPage 221",
        "references": "1. https://learn.microsoft.com/en-us/entra/identity/conditional-access/concept-\nconditional-access-grant#require-device-to-be-marked-as-compliant\n2. https://learn.microsoft.com/en-us/entra/identity/devices/concept-hybrid-join\n3. https://learn.microsoft.com/en-us/mem/intune/fundamentals/deployment-guide-\nenrollment\n4. https://learn.microsoft.com/en-us/entra/identity/conditional-access/concept-\nconditional-access-cloud-apps#user-actions"
    },
    {
        "id": "5.2.3",
        "title": "Authentication Methods"
    },
    {
        "id": "5.2.3.1",
        "title": "(L1) Ensure Microsoft Authenticator is configured to protect against MFA fatigue\n(Manual)",
        "profile": "• E3 Level 1",
        "description": "Microsoft has released additional settings to enhance the configuration of the Microsoft\nAuthenticator application. These settings provide additional information and context to\nusers who receive MFA passwordless and push requests, such as geographic location\nthe request came from, the requesting application and requiring a number match.\nEnsure the following are Enabled.\n• Require number matching for push notifications\n• Show application name in push and passwordless notifications\n• Show geographic location in push and passwordless notifications\nNOTE: On February 27, 2023 Microsoft started enforcing number matching tenant-wide\nfor all users using Microsoft Authenticator.",
        "rationale": "As the use of strong authentication has become more widespread, attackers have\nstarted to exploit the tendency of users to experience \"MFA fatigue.\" This occurs when\nusers are repeatedly asked to provide additional forms of identification, leading them to\neventually approve requests without fully verifying the source. To counteract this,\nnumber matching can be employed to ensure the security of the authentication process.\nWith this method, users are prompted to confirm a number displayed on their original\ndevice and enter it into the device being used for MFA. Additionally, other information\nsuch as geolocation and application details are displayed to enhance the end user's\nawareness. Among these 3 options, number matching provides the strongest net\nsecurity gain.",
        "impact": "Additional interaction will be required by end users using number matching as opposed\nto simply pressing \"Approve\" for login attempts.\nPage 223",
        "audit": "To audit using the UI:\n1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com.\n2. Click to expand Protection > Authentication methods select Policies.\n3. Under Method select Microsoft Authenticator.\n4. Under Enable and Target verify the setting is set to Enable.\n5. In the Include tab ensure All users is selected.\n6. In the Exclude tab ensure only valid groups are present (i.e. Break Glass\naccounts).\n7. Select Configure\n8. Verify the following Microsoft Authenticator settings:\no\nRequire number matching for push notifications Status is set to\nEnabled, Target All users\no\nShow application name in push and passwordless notifications\nis set to Enabled, Target All users\no\nShow geographic location in push and passwordless\nnotifications is set to Enabled, Target All users\n9. In each setting select Exclude and verify only groups are present (i.e. Break\nGlass accounts).",
        "remediation": "To remediate using the UI:\n1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com.\n2. Click to expand Protection > Authentication methods select Policies.\n3. Select Microsoft Authenticator\n4. Under Enable and Target ensure the setting is set to Enable.\n5. Select Configure\n6. Set the following Microsoft Authenticator settings:\no Require number matching for push notifications Status is set to\nEnabled, Target All users\no Show application name in push and passwordless notifications\nis set to Enabled, Target All users\no Show geographic location in push and passwordless\nnotifications is set to Enabled, Target All users\nNote: Valid groups such as break glass accounts can be excluded per organization\npolicy.\nPage 224",
        "default_value": "Microsoft-managed",
        "references": "1. https://learn.microsoft.com/en-us/entra/identity/authentication/concept-\nauthentication-default-enablement\n2. https://techcommunity.microsoft.com/t5/microsoft-entra-blog/defend-your-users-\nfrom-mfa-fatigue-attacks/ba-p/2365677\n3. https://learn.microsoft.com/en-us/entra/identity/authentication/how-to-mfa-\nnumber-match"
    },
    {
        "id": "5.2.3.2",
        "title": "(L1) Ensure custom banned passwords lists are used (Manual)",
        "profile": "• E3 Level 1",
        "description": "With Entra Password Protection, default global banned password lists are automatically\napplied to all users in an Entra ID tenant. To support business and security needs,\ncustom banned password lists can be defined. When users change or reset their\npasswords, these banned password lists are checked to enforce the use of strong\npasswords.\nA custom banned password list should include some of the following examples:\n• Brand names\n• Product names\n• Locations, such as company headquarters\n• Company-specific internal terms\n• Abbreviations that have specific company meaning",
        "rationale": "Creating a new password can be difficult regardless of one's technical background. It is\ncommon to look around one's environment for suggestions when building a password,\nhowever, this may include picking words specific to the organization as inspiration for a\npassword. An adversary may employ what is called a 'mangler' to create permutations\nof these specific words in an attempt to crack passwords or hashes making it easier to\nreach their goal.",
        "impact": "If a custom banned password list includes too many common dictionary words, or short\nwords that are part of compound words, then perfectly secure passwords may be\nblocked. The organization should consider a balance between security and usability\nwhen creating a list.\nPage 226",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/\n2. Click to expand Protection > Authentication methods\n3. Select Password protection\n4. Verify Enforce custom list is set to Yes\n5. Verify Custom banned password list contains entries specific to the\norganization or matches a pre-determined list.",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/\n2. Click to expand Protection > Authentication methods\n3. Select Password protection\n4. Set Enforce custom list to Yes\n5. In Custom banned password list create a list using suggestions outlined in\nthis document.\n6. Click Save\nNote: Below is a list of examples that can be used as a starting place. The references\nsection contains more suggestions.\n• Brand names\n• Product names\n• Locations, such as company headquarters\n• Company-specific internal terms\n• Abbreviations that have specific company meaning\nReferences:\n1. https://learn.microsoft.com/en-us/entra/identity/authentication/concept-password-\nban-bad#custom-banned-password-list\n2. https://learn.microsoft.com/en-us/entra/identity/authentication/tutorial-configure-\ncustom-password-protection\nPage 227\nCIS Controls:\nControls\nControl IG 1 IG 2 IG 3\nVersion\n5.2 Use Unique Passwords\nv8 Use unique passwords for all enterprise assets. Best practice implementation ● ● ●\nincludes, at a minimum, an 8-character password for accounts using MFA and a\n14-character password for accounts not using MFA.\nPage 228",
        "references": "1. https://learn.microsoft.com/en-us/entra/identity/authentication/concept-password-\nban-bad#custom-banned-password-list\n2. https://learn.microsoft.com/en-us/entra/identity/authentication/tutorial-configure-\ncustom-password-protection\nPage 227"
    },
    {
        "id": "5.2.3.3",
        "title": "(L1) Ensure password protection is enabled for on-prem Active Directory (Manual)",
        "profile": "• E3 Level 1",
        "description": "Microsoft Entra Password Protection provides a global and custom banned password\nlist. A password change request fails if there's a match in these banned password list.\nTo protect on-premises Active Directory Domain Services (AD DS) environment, install\nand configure Entra Password Protection.\nNote: This recommendation applies to Hybrid deployments only and will have no impact\nunless working with on-premises Active Directory.",
        "rationale": "This feature protects an organization by prohibiting the use of weak or leaked\npasswords. In addition, organizations can create custom banned password lists to\nprevent their users from using easily guessed passwords that are specific to their\nindustry. Deploying this feature to Active Directory will strengthen the passwords that\nare used in the environment.",
        "impact": "The potential impact associated with implementation of this setting is dependent upon\nthe existing password policies in place in the environment. For environments that have\nstrong password policies in place, the impact will be minimal. For organizations that do\nnot have strong password policies in place, implementation of Microsoft Entra Password\nProtection may require users to change passwords and adhere to more stringent\nrequirements than they have been accustomed to.",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Protection select Authentication methods.\n3. Select Password protection and ensure that Enable password protection\non Windows Server Active Directory is set to Yes and that Mode is set to\nEnforced.\nPage 229",
        "remediation": "To remediate using the UI:\n• Download and install the Azure AD Password Proxies and DC Agents from\nthe following location:\nhttps://www.microsoft.com/download/details.aspx?id=57071 After installed follow\nthe steps below.\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Protection select Authentication methods.\n3. Select Password protection and set Enable password protection on\nWindows Server Active Directory to Yes and Mode to Enforced.",
        "default_value": "Enable - Yes\nMode - Audit",
        "references": "1. https://learn.microsoft.com/en-us/entra/identity/authentication/howto-password-\nban-bad-on-premises-operations"
    },
    {
        "id": "5.2.3.4",
        "title": "(L1) Ensure all member users are 'MFA capable' (Manual)",
        "profile": "• E3 Level 1",
        "description": "Microsoft defines Multifactor authentication capable as being registered and enabled for\na strong authentication method. The method must also be allowed by the authentication\nmethods policy.\nEnsure all member users are MFA capable.",
        "rationale": "Multifactor authentication requires an individual to present a minimum of two separate\nforms of authentication before access is granted.\nUsers who are not MFA Capable have never registered a strong authentication method\nfor multifactor authentication that is within policy and may not be using MFA. This could\nbe a result of having never signed in, exclusion from a Conditional Access (CA) policy\nrequiring MFA, or a CA policy does not exist. Reviewing this list of users will help\nidentify possible lapses in policy or procedure.",
        "impact": "When using the UI audit method guest users will appear in the report and unless the\norganization is applying MFA rules to guests then they will need to be manually filtered.\nAccounts that provide on-premises directory synchronization also appear in these\nreports.\nPage 231",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Protection select Authentication methods.\n3. Select User registration details.\n4. Set the filter option Multifactor authentication capable to Not Capable.\n5. Review the non-guest users in this list.\n6. Excluding any exceptions users found in this report may require remediation.\nTo audit using PowerShell:\n1. Connect to Graph using Connect-MgGraph -Scopes\n\"UserAuthenticationMethod.Read.All,AuditLog.Read.All\"\n2. Run the following:\nGet-MgReportAuthenticationMethodUserRegistrationDetail `\n-Filter \"IsMfaCapable eq false and UserType eq 'Member'\" |\nft UserPrincipalName,IsMfaCapable,IsAdmin\n3. Ensure IsMfaCapable is set to True.\n4. Excluding any exceptions users found in this report may require remediation.\nNote: The CA rule must be in place for a successful deployment of Multifactor\nAuthentication. This policy is outlined in the conditional access section 5.2.2\nNote 2: Possible exceptions include on-premises synchronization accounts.\nPage 232",
        "remediation": "Remediation steps will depend on the status of the personnel in question or\nconfiguration of Conditional Access policies and will not be covered in detail.\nAdministrators should review each user identified on a case-by-case basis using the\nconditions below.\nUser has never signed on:\n• Employment status should be reviewed, and appropriate action taken on the user\naccount's roles, licensing and enablement.\nConditional Access policy applicability:\n• Ensure a CA policy is in place requiring all users to use MFA.\n• Ensure the user is not excluded from the CA MFA policy.\n• Ensure the policy's state is set to On.\n• Use What if to determine applicable CA policies. (Protection > Conditional\nAccess > Policies)\n• Review the user account in Sign-in logs. Under the Activity Details pane\nclick the Conditional Access tab to view applied policies.\nNote: Conditional Access is covered step by step in section 5.2.2\nReferences:\n1. https://learn.microsoft.com/en-\nus/powershell/module/microsoft.graph.reports/update-\nmgreportauthenticationmethoduserregistrationdetail?view=graph-powershell-\n1.0#-ismfacapable\n2. https://learn.microsoft.com/en-us/entra/identity/monitoring-health/how-to-view-\napplied-conditional-access-policies\n3. https://learn.microsoft.com/en-us/entra/identity/conditional-access/what-if-tool\n4. https://learn.microsoft.com/en-us/entra/identity/authentication/howto-\nauthentication-methods-activity\nPage 233\nCIS Controls:\nControls\nControl IG 1 IG 2 IG 3\nVersion\n6.3 Require MFA for Externally-Exposed Applications\nv8 Require all externally-exposed enterprise or third-party applications to enforce ● ●\nMFA, where supported. Enforcing MFA through a directory service or SSO\nprovider is a satisfactory implementation of this Safeguard.\n16.3 Require Multi-factor Authentication\nv7\nRequire multi-factor authentication for all user accounts, on all systems,\n● ●\nwhether managed onsite or by a third-party provider.\nPage 234",
        "references": "1. https://learn.microsoft.com/en-\nus/powershell/module/microsoft.graph.reports/update-\nmgreportauthenticationmethoduserregistrationdetail?view=graph-powershell-\n1.0#-ismfacapable\n2. https://learn.microsoft.com/en-us/entra/identity/monitoring-health/how-to-view-\napplied-conditional-access-policies\n3. https://learn.microsoft.com/en-us/entra/identity/conditional-access/what-if-tool\n4. https://learn.microsoft.com/en-us/entra/identity/authentication/howto-\nauthentication-methods-activity\nPage 233"
    },
    {
        "id": "5.2.3.5",
        "title": "(L1) Ensure weak authentication methods are disabled (Manual)",
        "profile": "• E3 Level 1",
        "description": "Authentication methods support a wide variety of scenarios for signing in to Microsoft\n365 resources. Some of these methods are inherently more secure than others but\nrequire more investment in time to get users enrolled and operational.\nSMS and Voice Call rely on telephony carrier communication methods to deliver the\nauthenticating factor.\nThe email one-time passcode feature is a way to authenticate B2B collaboration users\nwhen they can't be authenticated through other means, such as Microsoft Entra ID,\nMicrosoft account (MSA), or social identity providers. When a B2B guest user tries to\nredeem your invitation or sign in to your shared resources, they can request a\ntemporary passcode, which is sent to their email address. Then they enter this\npasscode to continue signing in.\nThe recommended state is to Disable these methods:\n• SMS\n• Voice Call\n• Email OTP",
        "rationale": "The SMS and Voice call methods are vulnerable to SIM swapping which could allow an\nattacker to gain access to your Microsoft 365 account.",
        "impact": "Disabling Email OTP will prevent one-time pass codes from being sent to unverified\nguest users accessing Microsoft 365 resources on the tenant. They will be required to\nuse a personal Microsoft account, a managed Microsoft Entra account, be part of a\nfederation or be configured as a guest in the host tenant's Microsoft Entra ID.\nPage 235",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Protection select Authentication methods.\n3. Select Policies.\n4. Verify that the following methods in the Enabled column or set to No.\no Method: SMS\no Method: Voice call\no Method: Email OTP",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Protection select Authentication methods.\n3. Select Policies.\n4. Inspect each method that is out of compliance and remediate:\no Click on the method to open it.\no Change the Enable toggle to the off position.\no Click Save.\nNote: If the save button remains greyed out after toggling a method off, then first turn it\nback on and then change the position of the Target selection (all users or select\ngroups). Turn the method off again and save. This was observed to be a bug in the UI\nat the time this document was published.",
        "default_value": "• SMS : Disabled\n• Voice Call : Disabled\n• Email OTP : Enabled",
        "references": "1. https://learn.microsoft.com/en-us/entra/identity/authentication/concept-\nauthentication-methods-manage\n2. https://learn.microsoft.com/en-us/entra/external-id/one-time-passcode\n3. https://www.microsoft.com/en-us/microsoft-365-life-hacks/privacy-and-\nsafety/what-is-sim-swapping\nPage 236"
    },
    {
        "id": "5.2.4",
        "title": "Password reset"
    },
    {
        "id": "5.2.4.1",
        "title": "(L1) Ensure 'Self service password reset enabled' is set to 'All' (Manual)",
        "profile": "• E3 Level 1",
        "description": "Enabling self-service password reset allows users to reset their own passwords in Entra\nID. When users sign in to Microsoft 365, they will be prompted to enter additional\ncontact information that will help them reset their password in the future. If combined\nregistration is enabled additional information, outside of multi-factor, will not be needed.\nNote: Effective Oct. 1st, 2022, Microsoft will begin to enable combined registration for\nall users in Entra ID tenants created before August 15th, 2020. Tenants created after\nthis date are enabled with combined registration by default.",
        "rationale": "Users will no longer need to engage the helpdesk for password resets, and the\npassword reset mechanism will automatically block common, easily guessable\npasswords.",
        "impact": "Users will be required to provide additional contact information to enroll in self-service\npassword reset. Additionally, minor user education may be required for users that are\nused to calling a help desk for assistance with password resets.\nNote: This is unavailable if using Entra Connect / Sync in a hybrid environment.",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Protection > Password reset select Properties.\n3. Ensure Self service password reset enabled is set to All",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Protection > Password reset select Properties.\n3. Set Self service password reset enabled to All\nPage 239\nReferences:\n1. https://learn.microsoft.com/en-us/microsoft-365/admin/add-users/let-users-reset-\npasswords?view=o365-worldwide\n2. https://learn.microsoft.com/en-us/entra/identity/authentication/tutorial-enable-sspr\n3. https://learn.microsoft.com/en-us/entra/identity/authentication/howto-registration-\nmfa-sspr-combined\nCIS Controls:\nControls Version Control IG 1 IG 2 IG 3\nv8\n0.0 Explicitly Not Mapped\nExplicitly Not Mapped\nPage 240",
        "references": "1. https://learn.microsoft.com/en-us/microsoft-365/admin/add-users/let-users-reset-\npasswords?view=o365-worldwide\n2. https://learn.microsoft.com/en-us/entra/identity/authentication/tutorial-enable-sspr\n3. https://learn.microsoft.com/en-us/entra/identity/authentication/howto-registration-\nmfa-sspr-combined"
    },
    {
        "id": "5.3",
        "title": "Identity Governance"
    },
    {
        "id": "5.3.1",
        "title": "(L2) Ensure 'Privileged Identity Management' is used to manage roles (Manual)",
        "profile": "• E5 Level 2",
        "description": "Microsoft Entra Privileged Identity Management can be used to audit roles, allow just in\ntime activation of roles and allow for periodic role attestation. Organizations should\nremove permanent members from privileged Office 365 roles and instead make them\neligible, through a JIT activation workflow.",
        "rationale": "Organizations want to minimize the number of people who have access to secure\ninformation or resources, because that reduces the chance of a malicious actor getting\nthat access, or an authorized user inadvertently impacting a sensitive resource.\nHowever, users still need to carry out privileged operations in Entra ID. Organizations\ncan give users just-in-time (JIT) privileged access to roles. There is a need for oversight\nfor what those users are doing with their administrator privileges. PIM helps to mitigate\nthe risk of excessive, unnecessary, or misused access rights.",
        "impact": "Implementation of Just in Time privileged access is likely to necessitate changes to\nadministrator routine. Administrators will only be granted access to administrative roles\nwhen required. When administrators request role activation, they will need to document\nthe reason for requiring role access, anticipated time required to have the access, and\nto reauthenticate to enable role access.\nPage 242",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Identity Governance select Privileged Identity\nManagement.\n3. Under Manage select Microsoft Entra Roles.\n4. Under Manage select Roles.\n5. Inspect at a minimum the following sensitive roles to ensure the members are\nEligible and not Permanent:\n• Application Administrator\n• Authentication Administrator\n• Azure Information Protection Administrator\n• Billing Administrator\n• Cloud Application Administrator\n• Cloud Device Administrator\n• Compliance Administrator\n• Customer LockBox Access Approver\n• Exchange Administrator\n• Fabric Administrator\n• Global Administrator\n• HelpDesk Administrator\n• Intune Administrator\n• Kaizala Administrator\n• License Administrator\n• Microsoft Entra Joined Device Local Administrator\n• Password Administrator\n• Privileged Authentication Administrator\n• Privileged Role Administrator\n• Security Administrator\n• SharePoint Administrator\n• Skype for Business Administrator\n• Teams Administrator\n• User Administrator\nPage 243",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Identity Governance select Privileged Identity\nManagement.\n3. Under Manage select Microsoft Entra Roles.\n4. Under Manage select Roles.\n5. Inspect at a minimum the following sensitive roles. For each of the members that\nhave an ASSIGNMENT TYPE of Permanent, click on the ... and choose Make\neligible:\n• Application Administrator\n• Authentication Administrator\n• Azure Information Protection Administrator\n• Billing Administrator\n• Cloud Application Administrator\n• Cloud Device Administrator\n• Compliance Administrator\n• Customer LockBox Access Approver\n• Exchange Administrator\n• Fabric Administrator\n• Global Administrator\n• HelpDesk Administrator\n• Intune Administrator\n• Kaizala Administrator\n• License Administrator\n• Microsoft Entra Joined Device Local Administrator\n• Password Administrator\n• Privileged Authentication Administrator\n• Privileged Role Administrator\n• Security Administrator\n• SharePoint Administrator\n• Skype for Business Administrator\n• Teams Administrator\n• User Administrator\nReferences:\n1. https://learn.microsoft.com/en-us/entra/id-governance/privileged-identity-\nmanagement/pim-configure\nPage 244\nCIS Controls:\nControls\nControl IG 1 IG 2 IG 3\nVersion\n6.1 Establish an Access Granting Process\nv8\nEstablish and follow a process, preferably automated, for granting access to\n● ● ●\nenterprise assets upon new hire, rights grant, or role change of a user.\n6.2 Establish an Access Revoking Process\nEstablish and follow a process, preferably automated, for revoking access to\nv8\nenterprise assets, through disabling accounts immediately upon termination, rights\n● ● ●\nrevocation, or role change of a user. Disabling accounts, instead of deleting\naccounts, may be necessary to preserve audit trails.\n4.1 Maintain Inventory of Administrative Accounts\nv7 Use automated tools to inventory all administrative accounts, including domain ● ●\nand local accounts, to ensure that only authorized individuals have elevated\nprivileges.\nPage 245",
        "references": "1. https://learn.microsoft.com/en-us/entra/id-governance/privileged-identity-\nmanagement/pim-configure\nPage 244"
    },
    {
        "id": "5.3.2",
        "title": "(L1) Ensure 'Access reviews' for Guest Users are configured (Manual)",
        "profile": "• E5 Level 1",
        "description": "Access reviews enable administrators to establish an efficient automated process for\nreviewing group memberships, access to enterprise applications, and role assignments.\nThese reviews can be scheduled to recur regularly, with flexible options for delegating\nthe task of reviewing membership to different members of the organization.\nEnsure Access reviews for Guest Users are configured to be performed no less\nfrequently than monthly.",
        "rationale": "Access to groups and applications for guests can change over time. If a guest user's\naccess to a particular folder goes unnoticed, they may unintentionally gain access to\nsensitive data if a member adds new files or data to the folder or application. Access\nreviews can help reduce the risks associated with outdated assignments by requiring a\nmember of the organization to conduct the reviews. Furthermore, these reviews can\nenable a fail-closed mechanism to remove access to the subject if the reviewer does not\nrespond to the review.",
        "impact": "Access reviews that are ignored may cause guest users to lose access to resources\ntemporarily.\nPage 246",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/\n2. Click to expand Identity Governance and select Access reviews\n3. Inspect the access reviews, and ensure an access review is created with the\nfollowing criteria:\no Overview: Scope is set to Guest users only and status is Active\no Reviewers: Ensure appropriate reviewer(s) are designated.\no Settings > General: Mail notifications and Reminders are set to\nEnable\no Reviewers: Require reason on approval is set to Enable\no Scheduling: Frequency is Monthly or more frequent.\no When completed: Auto apply results to resource is set to Enable\no When completed: If reviewers don't respond is set to Remove\naccess",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/\n2. Click to expand Identity Governance and select Access reviews\n3. Click New access review.\n4. Select what to review choose Teams + Groups.\n5. Review Scope set to All Microsoft 365 groups with guest users, do not\nexclude groups.\n6. Scope set to Guest users only then click Next: Reviews.\n7. Select reviewers an appropriate user that is NOT the guest user themselves.\n8. Duration (in days) at most 3.\n9. Review recurrence is Monthly or more frequent.\n10. End is set to Never, then click Next: Settings.\n11. Check Auto apply results to resource.\n12. Set If reviewers don't respond to Remove access.\n13. Check the following: Justification required, E-mail notifications,\nReminders.\n14. Click Next: Review + Create and finally click Create.",
        "default_value": "By default access reviews are not configured.",
        "references": "1. https://learn.microsoft.com/en-us/entra/id-governance/access-reviews-overview\n2. https://learn.microsoft.com/en-us/entra/id-governance/create-access-review\nPage 247"
    },
    {
        "id": "5.3.3",
        "title": "(L1) Ensure 'Access reviews' for privileged roles are configured (Manual)",
        "profile": "• E5 Level 1",
        "description": "Access reviews enable administrators to establish an efficient automated process for\nreviewing group memberships, access to enterprise applications, and role assignments.\nThese reviews can be scheduled to recur regularly, with flexible options for delegating\nthe task of reviewing membership to different members of the organization.\nEnsure Access reviews for high privileged Entra ID roles are done monthly or more\nfrequently. These reviews should include at a minimum the roles listed below:\n• Global Administrator\n• Exchange Administrator\n• SharePoint Administrator\n• Teams Administrator\n• Security Administrator\nNote: An access review is created for each role selected after completing the process.",
        "rationale": "Regular review of critical high privileged roles in Entra ID will help identify role drift, or\npotential malicious activity. This will enable the practice and application of \"separation of\nduties\" where even non-privileged users like security auditors can be assigned to review\nassigned roles in an organization. Furthermore, if configured these reviews can enable\na fail-closed mechanism to remove access to the subject if the reviewer does not\nrespond to the review.\nPage 249",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/\n2. Click to expand Identity Governance and select Privileged Identity\nManagement\n3. Select Microsoft Entra Roles under Manage\n4. Select Access reviews\n5. Ensure there are access reviews configured for each high privileged roles and\neach meets the criteria laid out below:\no Scope - Everyone\no Status - Active\no Reviewers - Role reviewers should be designated personnel. Preferably\nnot a self-review.\no Mail notifications - Enable\no Reminders - Enable\no Require reason on approval - Enable\no Frequency - Monthly or more frequently.\no Duration (in days) - 4 at most\no Auto apply results to resource - Enable\no If reviewers don't respond - No change\nAny remaining settings are discretionary.\nNote: Reviewers will have the ability to revoke roles should be trusted individuals who\nunderstand the impact of the access reviews. The principle of separation of duties\nshould be considered so that no one administrator is reviewing their own access levels.\nNote2: The setting If reviewers don't respond is recommended to be set to\nRemove access due to the potential of all Global Administrators being unassigned if the\nreview is not addressed.\nPage 250",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/\n2. Click to expand Identity Governance and select Privileged Identity\nManagement\n3. Select Microsoft Entra Roles under Manage\n4. Select Access reviews and click New access review.\n5. Provide a name and description.\n6. Frequency set to Monthly or more frequently.\n7. Duration (in days) is set to at most 3.\n8. End set to Never.\n9. Role select these roles: Global Administrator,Exchange\nAdministrator,SharePoint Administrator,Teams\nAdministrator,Security Administrator\n10. Assignment type set to All active and eligible assignments.\n11. Reviewers set to Selected user(s) or group(s)\n12. Select reviewers are member(s) responsible for this type of review.\n13. Auto apply results to resource set to Enable\n14. If reviewers don't respond is set to No change\n15. Show recommendations set to Enable\n16. Require reason or approval set to Enable\n17. Mail notifications set to Enable\n18. Reminders set to Enable\n19. Click Start to save the review.\nNote: Reviewers will have the ability to revoke roles should be trusted individuals who\nunderstand the impact of the access reviews. The principle of separation of duties\nshould be considered so that no one administrator is reviewing their own access levels.",
        "default_value": "By default access reviews are not configured.",
        "references": "1. https://learn.microsoft.com/en-us/entra/id-governance/privileged-identity-\nmanagement/pim-create-roles-and-resource-roles-review\n2. https://learn.microsoft.com/en-us/entra/id-governance/access-reviews-overview\nPage 251"
    },
    {
        "id": "5.3.4",
        "title": "(L1) Ensure approval is required for Global Administrator role activation (Manual)",
        "profile": "• E5 Level 1",
        "description": "Microsoft Entra Privileged Identity Management can be used to audit roles, allow just in\ntime activation of roles and allow for periodic role attestation. Requiring approval before\nactivation allows one of the selected approvers to first review and then approve the\nactivation prior to PIM granted the role. The approver doesn't have to be a group\nmember or owner.\nThe recommended state is Require approval to activate for the Global\nAdministrator role.",
        "rationale": "Requiring approval for Global Administrator role activation enhances visibility and\naccountability every time this highly privileged role is used. This process reduces the\nrisk of an attacker elevating a compromised account to the highest privilege level, as\nany activation must first be reviewed and approved by a trusted party.\nNote: This only acts as protection for eligible users that are activating a role. Directly\nassigning a role does require an approval workflow so therefore it is important to\nimplement and use PIM correctly.",
        "impact": "Approvers do not need to be assigned the same role or be members of the same group.\nIt's important to have at least two approvers and an emergency access (break-glass)\naccount to prevent a scenario where no Global Administrators are available. For\nexample, if the last active Global Administrator leaves the organization, and only eligible\nbut inactive Global Administrators remain, a trusted approver without the Global\nAdministrator role or an emergency access account would be essential to avoid delays\nin critical administrative tasks.\nPage 253",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Identity Governance select Privileged Identity\nManagement.\n3. Under Manage select Microsoft Entra Roles.\n4. Under Manage select Roles.\n5. Select Global Administrator in the list.\n6. Select Role settings and click Edit.\n7. Verify Require approval to activate is set.\n8. Verify there are at least two approvers selected.\n9. Click Update.",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Identity Governance select Privileged Identity\nManagement.\n3. Under Manage select Microsoft Entra Roles.\n4. Under Manage select Roles.\n5. Select Global Administrator in the list.\n6. Select Role settings and click Edit.\n7. Check the Require approval to activate box.\n8. Add at least two approvers.\n9. Click Update.",
        "default_value": "Require approval to activate is unchecked.",
        "references": "1. https://learn.microsoft.com/en-us/entra/id-governance/privileged-identity-\nmanagement/pim-configure\n2. https://learn.microsoft.com/en-us/entra/id-governance/privileged-identity-\nmanagement/groups-role-settings#require-approval-to-activate\nPage 254"
    },
    {
        "id": "6.1",
        "title": "Audit",
        "profile": "• E3 Level 2",
        "description": "B2B collaboration is a feature within Microsoft Entra External ID that allows for guest\ninvitations to an organization.\nEnsure users can only send invitations to specified domains.\nNote: This list works independently from OneDrive for Business and SharePoint Online\nallow/block lists. To restrict individual file sharing in SharePoint Online, set up an allow\nor blocklist for OneDrive for Business and SharePoint Online. For instance, in\nSharePoint or OneDrive users can still share with external users from prohibited\ndomains by using Anyone links if they haven't been disabled.",
        "rationale": "By specifying allowed domains for collaborations, external user's companies are\nexplicitly identified. Also, this prevents internal users from inviting unknown external\nusers such as personal accounts and granting them access to resources.",
        "impact": "This could make harder collaboration if the setting is not quickly updated when a new\ndomain is identified as \"allowed\".",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Identity > External Identities select External\ncollaboration settings.\n3. Under Collaboration restrictions, verify that Allow invitations only to\nthe specified domains (most restrictive) is selected. Then verify\nallowed domains are specified under Target domains.\nPage 171",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Identity > External Identities select External\ncollaboration settings.\n3. Under Collaboration restrictions, select Allow invitations only to the\nspecified domains (most restrictive) is selected. Then specify the\nallowed domains under Target domains.",
        "default_value": "Allow invitations to be sent to any domain (most inclusive)",
        "references": "1. https://learn.microsoft.com/en-us/entra/external-id/allow-deny-list\n2. https://learn.microsoft.com/en-us/entra/external-id/what-is-b2b"
    },
    {
        "id": "6.1.1",
        "title": "(L1) Ensure 'AuditDisabled' organizationally is set to 'False' (Automated)",
        "profile": "• E3 Level 1",
        "description": "The value False indicates that mailbox auditing on by default is turned on for the\norganization. Mailbox auditing on by default in the organization overrides the mailbox\nauditing settings on individual mailboxes. For example, if mailbox auditing is turned off\nfor a mailbox (the AuditEnabled property on the mailbox is False), the default mailbox\nactions are still audited for the mailbox, because mailbox auditing on by default is turned\non for the organization.\nTurning off mailbox auditing on by default ($true) has the following results:\n• Mailbox auditing is turned off for your organization.\n• From the time you turn off mailbox auditing on by default, no mailbox actions are\naudited, even if mailbox auditing is enabled on a mailbox (the AuditEnabled\nproperty on the mailbox is True).\n• Mailbox auditing isn't turned on for new mailboxes and setting the AuditEnabled\nproperty on a new or existing mailbox to True is ignored.\n• Any mailbox audit bypass association settings (configured by using the Set-\nMailboxAuditBypassAssociation cmdlet) are ignored.\n• Existing mailbox audit records are retained until the audit log age limit for the\nrecord expires.\nThe recommended state for this setting is False at the organization level. This will\nenable auditing and enforce the default.",
        "rationale": "Enforcing the default ensures auditing was not turned off intentionally or accidentally.\nAuditing mailbox actions will allow forensics and IR teams to trace various malicious\nactivities that can generate TTPs caused by inbox access and tampering.\nNote: Without advanced auditing (E5 function) the logs are limited to 90 days.",
        "impact": "None - this is the default behavior as of 2019.\nPage 258",
        "audit": "To audit using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\nGet-OrganizationConfig | Format-List AuditDisabled\n3. Ensure AuditDisabled is set to False.",
        "remediation": "To remediate using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\nSet-OrganizationConfig -AuditDisabled $false",
        "default_value": "False",
        "references": "1. https://learn.microsoft.com/en-us/purview/audit-mailboxes?view=o365-worldwide\n2. https://learn.microsoft.com/en-us/powershell/module/exchange/set-\norganizationconfig?view=exchange-ps#-auditdisabled"
    },
    {
        "id": "6.1.2",
        "title": "(L1) Ensure mailbox auditing for E3 users is Enabled (Automated)",
        "profile": "• E3 Level 1",
        "description": "Mailbox audit logging is turned on by default in all organizations. This effort started in\nJanuary 2019, and means that certain actions performed by mailbox owners, delegates,\nand admins are automatically logged. The corresponding mailbox audit records are\navailable for admins to search in the mailbox audit log.\nMailboxes and shared mailboxes have actions assigned to them individually in order to\naudit the data the organization determines valuable at the mailbox level.\nThe recommended state is AuditEnabled to True on all user mailboxes along with\nadditional audit actions beyond the Microsoft defaults.\nNote: Due to some differences in defaults for audit actions this recommendation is\nspecific to users assigned an E3 license only.",
        "rationale": "Whether it is for regulatory compliance or for tracking unauthorized configuration\nchanges in Microsoft 365, enabling mailbox auditing, and ensuring the proper mailbox\nactions are accounted for allows for Microsoft 365 teams to run security operations,\nforensics or general investigations on mailbox activities.\nThe following mailbox types ignore the organizational default and must have\nAuditEnabled set to True at the mailbox level in order to capture relevant audit data.\n• Resource Mailboxes\n• Public Folder Mailboxes\n• DiscoverySearch Mailbox\nNote: Without advanced auditing (E5 function) the logs are limited to 90 days.",
        "impact": "None - this is the default behavior.\nPage 260",
        "audit": "To audit using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following PowerShell script:\n$MailAudit = Get-EXOMailbox -PropertySets Audit -ResultSize Unlimited |\nSelect-Object UserPrincipalName, AuditEnabled, AuditAdmin, AuditDelegate,\nAuditOwner\n$MailAudit | Export-Csv -Path C:\\CIS\\AuditSettings.csv -NoTypeInformation\n3. Analyze the output and verify AuditEnabled is set to True and all audit actions\nare included in what is defined in the script in the remediation section.\nOptionally, this more comprehensive script can assess each user mailbox:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following script:\nPage 261\n$AdminActions = @(\n\"ApplyRecord\", \"Copy\", \"Create\", \"FolderBind\", \"HardDelete\",\n\"Move\", \"MoveToDeletedItems\", \"SendAs\", \"SendOnBehalf\", \"SoftDelete\",\n\"Update\", \"UpdateCalendarDelegation\", \"UpdateFolderPermissions\",\n\"UpdateInboxRules\"\n)\n$DelegateActions = @(\n\"ApplyRecord\", \"Create\", \"FolderBind\", \"HardDelete\", \"Move\",\n\"MoveToDeletedItems\", \"SendAs\", \"SendOnBehalf\", \"SoftDelete\", \"Update\",\n\"UpdateFolderPermissions\", \"UpdateInboxRules\"\n)\n$OwnerActions = @(\n\"ApplyRecord\", \"Create\", \"HardDelete\", \"MailboxLogin\", \"Move\",\n\"MoveToDeletedItems\", \"SoftDelete\", \"Update\", \"UpdateCalendarDelegation\",\n\"UpdateFolderPermissions\", \"UpdateInboxRules\"\n)\nfunction VerifyActions {\nparam (\n[string]$type,\n[array]$actions,\n[array]$auditProperty,\n[string]$mailboxName\n)\n$missingActions = @()\n$actionCount = 0\nforeach ($action in $actions) {\nif ($auditProperty -notcontains $action) {\n$missingActions += \" Failure: Audit action '$action' missing\nfrom $type\"\n$actionCount++\n}\n}\nif ($actionCount -eq 0) {\nWrite-Host \"[$mailboxName]: $type actions are verified.\" -\nForegroundColor Green\n} else {\nWrite-Host \"[$mailboxName]: $type actions are not all verified.\" -\nForegroundColor Red\nforeach ($missingAction in $missingActions) {\nWrite-Host \" $missingAction\" -ForegroundColor Red\n}\n}\n}\n$mailboxes = Get-EXOMailbox -PropertySets Audit,Minimum -ResultSize Unlimited\n|\nWhere-Object { $_.RecipientTypeDetails -eq \"UserMailbox\" }\nforeach ($mailbox in $mailboxes) {\nWrite-Host \"--- Now assessing [$($mailbox.UserPrincipalName)] ---\"\nPage 262\nif ($mailbox.AuditEnabled) {\nWrite-Host \"[$($mailbox.UserPrincipalName)]: AuditEnabled is true\" -\nForegroundColor Green\n} else {\nWrite-Host \"[$($mailbox.UserPrincipalName)]: AuditEnabled is false\" -\nForegroundColor Red\n}\nVerifyActions -type \"AuditAdmin\" -actions $AdminActions -auditProperty\n$mailbox.AuditAdmin `\n-mailboxName $mailbox.UserPrincipalName\nVerifyActions -type \"AuditDelegate\" -actions $DelegateActions -\nauditProperty $mailbox.AuditDelegate `\n-mailboxName $mailbox.UserPrincipalName\nVerifyActions -type \"AuditOwner\" -actions $OwnerActions -auditProperty\n$mailbox.AuditOwner `\n-mailboxName $mailbox.UserPrincipalName\nWrite-Host\n}",
        "remediation": "To remediate using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following PowerShell script:\nPage 263\n$AuditAdmin = @(\n\"ApplyRecord\", \"Copy\", \"Create\", \"FolderBind\", \"HardDelete\", \"Move\",\n\"MoveToDeletedItems\", \"SendAs\", \"SendOnBehalf\", \"SoftDelete\", \"Update\",\n\"UpdateCalendarDelegation\", \"UpdateFolderPermissions\", \"UpdateInboxRules\"\n)\n$AuditDelegate = @(\n\"ApplyRecord\", \"Create\", \"FolderBind\", \"HardDelete\", \"Move\",\n\"MoveToDeletedItems\", \"SendAs\", \"SendOnBehalf\", \"SoftDelete\", \"Update\",\n\"UpdateFolderPermissions\", \"UpdateInboxRules\"\n)\n$AuditOwner = @(\n\"ApplyRecord\", \"Create\", \"HardDelete\", \"MailboxLogin\", \"Move\",\n\"MoveToDeletedItems\", \"SoftDelete\", \"Update\", \"UpdateCalendarDelegation\",\n\"UpdateFolderPermissions\", \"UpdateInboxRules\"\n)\n$MBX = Get-EXOMailbox -ResultSize Unlimited | Where-Object {\n$_.RecipientTypeDetails -eq \"UserMailbox\" }\n$MBX | Set-Mailbox -AuditEnabled $true `\n-AuditLogAgeLimit 90 -AuditAdmin $AuditAdmin -AuditDelegate $AuditDelegate `\n-AuditOwner $AuditOwner",
        "default_value": "AuditEnabled: True for all mailboxes except below:\n• Resource Mailboxes\n• Public Folder Mailboxes\n• DiscoverySearch Mailbox\nAuditAdmin: ApplyRecord, Create, HardDelete, MoveToDeletedItems, SendAs,\nSendOnBehalf, SoftDelete, Update, UpdateCalendarDelegation,\nUpdateFolderPermissions, UpdateInboxRules\nAuditDelegate: ApplyRecord, Create, HardDelete, MoveToDeletedItems, SendAs,\nSendOnBehalf, SoftDelete, Update, UpdateFolderPermissions, UpdateInboxRules\nAuditOwner: ApplyRecord, HardDelete, MoveToDeletedItems, SoftDelete, Update,\nUpdateCalendarDelegation, UpdateFolderPermissions, UpdateInboxRules",
        "references": "1. https://learn.microsoft.com/en-us/purview/audit-mailboxes?view=o365-worldwide\nPage 264\nAdditional Information:\nAdditional mailbox actions outside of the scope of this recommendations that can be\naudited for with an E5 license include:\n• MailItemsAccessed\n• SearchQueryInitiated\n• Send"
    },
    {
        "id": "6.1.3",
        "title": "(L1) Ensure mailbox auditing for E5 users is Enabled (Automated)",
        "profile": "• E5 Level 1",
        "description": "Mailbox audit logging is turned on by default in all organizations. This effort started in\nJanuary 2019, and means that certain actions performed by mailbox owners, delegates,\nand admins are automatically logged. The corresponding mailbox audit records are\navailable for admins to search in the mailbox audit log.\nMailboxes and shared mailboxes have actions assigned to them individually in order to\naudit the data the organization determines valuable at the mailbox level.\nThe recommended state is AuditEnabled to True on all user mailboxes along with\nadditional audit actions beyond the Microsoft defaults.\nNote: Due to some differences in defaults for audit actions this recommendation is\nspecific to users assigned an E5 license, or auditing addon license, only.",
        "rationale": "Whether it is for regulatory compliance or for tracking unauthorized configuration\nchanges in Microsoft 365, enabling mailbox auditing and ensuring the proper mailbox\nactions are accounted for allows for Microsoft 365 teams to run security operations,\nforensics or general investigations on mailbox activities.\nThe following mailbox types ignore the organizational default and must have\nAuditEnabled set to True at the mailbox level in order to capture relevant audit data.\n• Resource Mailboxes\n• Public Folder Mailboxes\n• DiscoverySearch Mailbox\nNOTE: Without advanced auditing (E5 function) the logs are limited to 90 days.",
        "impact": "None - this is the default behavior.\nPage 266",
        "audit": "To audit using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following PowerShell script:\n$MailAudit = Get-EXOMailbox -PropertySets Audit -ResultSize Unlimited |\nSelect-Object UserPrincipalName, AuditEnabled, AuditAdmin, AuditDelegate,\nAuditOwner\n$MailAudit | Export-Csv -Path C:\\CIS\\AuditSettings.csv -NoTypeInformation\n3. Analyze the output and verify AuditEnabled is set to True and all audit actions\nare included in what is defined in the script in the remediation section.\nOptionally, this more comprehensive script can assess each user mailbox:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following script:\nPage 267\n$AdminActions = @(\n\"ApplyRecord\", \"Copy\", \"Create\", \"FolderBind\", \"HardDelete\",\n\"MailItemsAccessed\", \"Move\", \"MoveToDeletedItems\", \"SendAs\",\n\"SendOnBehalf\", \"Send\", \"SoftDelete\", \"Update\",\n\"UpdateCalendarDelegation\",\n\"UpdateFolderPermissions\", \"UpdateInboxRules\"\n)\n$DelegateActions = @(\n\"ApplyRecord\", \"Create\", \"FolderBind\", \"HardDelete\", \"Move\",\n\"MailItemsAccessed\", \"MoveToDeletedItems\", \"SendAs\", \"SendOnBehalf\",\n\"SoftDelete\", \"Update\", \"UpdateFolderPermissions\", \"UpdateInboxRules\"\n)\n$OwnerActions = @(\n\"ApplyRecord\", \"Create\", \"HardDelete\", \"MailboxLogin\", \"Move\",\n\"MailItemsAccessed\", \"MoveToDeletedItems\", \"Send\", \"SoftDelete\",\n\"Update\",\n\"UpdateCalendarDelegation\", \"UpdateFolderPermissions\", \"UpdateInboxRules\"\n)\nfunction VerifyActions {\nparam (\n[string]$type,\n[array]$actions,\n[array]$auditProperty,\n[string]$mailboxName\n)\n$missingActions = @()\n$actionCount = 0\nforeach ($action in $actions) {\nif ($auditProperty -notcontains $action) {\n$missingActions += \" Failure: Audit action '$action' missing\nfrom $type\"\n$actionCount++\n}\n}\nif ($actionCount -eq 0) {\nWrite-Host \"[$mailboxName]: $type actions are verified.\" -\nForegroundColor Green\n} else {\nWrite-Host \"[$mailboxName]: $type actions are not all verified.\" -\nForegroundColor Red\nforeach ($missingAction in $missingActions) {\nWrite-Host \" $missingAction\" -ForegroundColor Red\n}\n}\n}\n$mailboxes = Get-EXOMailbox -PropertySets Audit,Minimum -ResultSize Unlimited\n|\nWhere-Object { $_.RecipientTypeDetails -eq \"UserMailbox\" }\nPage 268\nforeach ($mailbox in $mailboxes) {\nWrite-Host \"--- Now assessing [$($mailbox.UserPrincipalName)] ---\"\nif ($mailbox.AuditEnabled) {\nWrite-Host \"[$($mailbox.UserPrincipalName)]: AuditEnabled is true\" -\nForegroundColor Green\n} else {\nWrite-Host \"[$($mailbox.UserPrincipalName)]: AuditEnabled is false\" -\nForegroundColor Red\n}\nVerifyActions -type \"AuditAdmin\" -actions $AdminActions -auditProperty\n$mailbox.AuditAdmin `\n-mailboxName $mailbox.UserPrincipalName\nVerifyActions -type \"AuditDelegate\" -actions $DelegateActions -\nauditProperty $mailbox.AuditDelegate `\n-mailboxName $mailbox.UserPrincipalName\nVerifyActions -type \"AuditOwner\" -actions $OwnerActions -auditProperty\n$mailbox.AuditOwner `\n-mailboxName $mailbox.UserPrincipalName\nWrite-Host\n}\nNote: In order for a mailbox to pass the above it must have an E5 or Microsoft Purview\nAudit Premium addon license assigned to it. For the purposes of this recommendation\nshared mailboxes are ignored.",
        "remediation": "To remediate using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following PowerShell script:\nPage 269\n$AuditAdmin = @(\n\"ApplyRecord\", \"Copy\", \"Create\", \"FolderBind\", \"HardDelete\",\n\"MailItemsAccessed\", \"Move\", \"MoveToDeletedItems\", \"SendAs\",\n\"SendOnBehalf\", \"Send\", \"SoftDelete\", \"Update\",\n\"UpdateCalendarDelegation\",\n\"UpdateFolderPermissions\", \"UpdateInboxRules\"\n)\n$AuditDelegate = @(\n\"ApplyRecord\", \"Create\", \"FolderBind\", \"HardDelete\", \"Move\",\n\"MailItemsAccessed\", \"MoveToDeletedItems\", \"SendAs\", \"SendOnBehalf\",\n\"SoftDelete\", \"Update\", \"UpdateFolderPermissions\", \"UpdateInboxRules\"\n)\n$AuditOwner = @(\n\"ApplyRecord\", \"Create\", \"HardDelete\", \"MailboxLogin\", \"Move\",\n\"MailItemsAccessed\", \"MoveToDeletedItems\", \"Send\", \"SoftDelete\",\n\"Update\",\n\"UpdateCalendarDelegation\", \"UpdateFolderPermissions\", \"UpdateInboxRules\"\n)\n$MBX = Get-EXOMailbox -ResultSize Unlimited | Where-Object {\n$_.RecipientTypeDetails -eq \"UserMailbox\" }\n$MBX | Set-Mailbox -AuditEnabled $true `\n-AuditLogAgeLimit 180 -AuditAdmin $AuditAdmin -AuditDelegate $AuditDelegate `\n-AuditOwner $AuditOwner\nNote: When running this script mailboxes without an E5 or Azure Audit Premium license\napplied will generate an error as they are not licensed for the additional actions which\ncome default with E5.",
        "default_value": "AuditEnabled: True for all mailboxes except below:\n• Resource Mailboxes\n• Public Folder Mailboxes\n• DiscoverySearch Mailbox\nAuditAdmin: ApplyRecord, Create, HardDelete, MailItemsAccessed,\nMoveToDeletedItems, Send, SendAs, SendOnBehalf, SoftDelete, Update,\nUpdateCalendarDelegation, UpdateFolderPermissions, UpdateInboxRules\nAuditDelegate: ApplyRecord, Create, HardDelete, MailItemsAccessed,\nMoveToDeletedItems, SendAs, SendOnBehalf, SoftDelete, Update,\nUpdateFolderPermissions, UpdateInboxRules\nAuditOwner: ApplyRecord, HardDelete, MailItemsAccessed, MoveToDeletedItems,\nSend, SoftDelete, Update, UpdateCalendarDelegation, UpdateFolderPermissions,\nUpdateInboxRules\nPage 270",
        "references": "1. https://learn.microsoft.com/en-us/purview/audit-mailboxes?view=o365-worldwide"
    },
    {
        "id": "6.1.4",
        "title": "(L1) Ensure 'AuditBypassEnabled' is not enabled on mailboxes (Automated)",
        "profile": "• E3 Level 1",
        "description": "When configuring a user or computer account to bypass mailbox audit logging, the\nsystem will not record any access, or actions performed by the said user or computer\naccount on any mailbox. Administratively this was introduced to reduce the volume of\nentries in the mailbox audit logs on trusted user or computer accounts.\nEnsure AuditBypassEnabled is not enabled on accounts without a written exception.",
        "rationale": "If a mailbox audit bypass association is added for an account, the account can access\nany mailbox in the organization to which it has been assigned access permissions,\nwithout generating any mailbox audit logging entries for such access or recording any\nactions taken, such as message deletions.\nEnabling this parameter, whether intentionally or unintentionally, could allow insiders or\nmalicious actors to conceal their activity on specific mailboxes. Ensuring proper logging\nof user actions and mailbox operations in the audit log will enable comprehensive\nincident response and forensics.",
        "impact": "None - this is the default behavior.",
        "audit": "To audit using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\n$MBX = Get-MailboxAuditBypassAssociation -ResultSize unlimited\n$MBX | where {$_.AuditBypassEnabled -eq $true} | Format-Table\nName,AuditBypassEnabled\n3. If nothing is returned, then there are no accounts with Audit Bypass enabled.\nPage 272",
        "remediation": "To remediate using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. The following example PowerShell script will disable AuditBypass for all\nmailboxes which currently have it enabled:\n# Get mailboxes with AuditBypassEnabled set to $true\n$MBXAudit = Get-MailboxAuditBypassAssociation -ResultSize unlimited | Where-\nObject { $_.AuditBypassEnabled -eq $true }\nforeach ($mailbox in $MBXAudit) {\n$mailboxName = $mailbox.Name\nSet-MailboxAuditBypassAssociation -Identity $mailboxName -\nAuditBypassEnabled $false\nWrite-Host \"Audit Bypass disabled for mailbox Identity: $mailboxName\" -\nForegroundColor Green\n}",
        "default_value": "AuditBypassEnabled False",
        "references": "1. https://learn.microsoft.com/en-us/powershell/module/exchange/get-\nmailboxauditbypassassociation?view=exchange-ps"
    },
    {
        "id": "6.2",
        "title": "Mail flow",
        "profile": "• E5 Level 1",
        "description": "Zero-hour auto purge (ZAP) is a protection feature that retroactively detects and\nneutralizes malware and high confidence phishing. When ZAP for Teams protection\nblocks a message, the message is blocked for everyone in the chat. The initial block\nhappens right after delivery, but ZAP occurs up to 48 hours after delivery.",
        "rationale": "ZAP is intended to protect users that have received zero-day malware messages or\ncontent that is weaponized after being delivered to users. It does this by continually\nmonitoring spam and malware signatures taking automated retroactive action on\nmessages that have already been delivered.",
        "impact": "As with any anti-malware or anti-phishing product, false positives may occur.\nPage 124",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Defender https://security.microsoft.com/\n2. Click to expand System select Settings > Email & collaboration >\nMicrosoft Teams protection.\n3. Ensure Zero-hour auto purge (ZAP) is set to On (Default)\n4. Under Exclude these participants review the list of exclusions and ensure\nthey are justified and within tolerance for the organization.\nTo audit using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following cmdlets:\nGet-TeamsProtectionPolicy | fl ZapEnabled\nGet-TeamsProtectionPolicyRule | fl ExceptIf*\n3. Ensure ZapEnabled is True.\n4. Review the list of exclusions and ensure they are justified and within tolerance for\nthe organization. If nothing returns from the 2nd cmdlet then there are no\nexclusions defined.",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Defender https://security.microsoft.com/\n2. Click to expand System select Settings > Email & collaboration >\nMicrosoft Teams protection.\n3. Set Zero-hour auto purge (ZAP) to On (Default)\nTo remediate using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following cmdlet:\nSet-TeamsProtectionPolicy -Identity \"Teams Protection Policy\" -ZapEnabled\n$true",
        "default_value": "On (Default)\nPage 125",
        "references": "1. https://learn.microsoft.com/en-us/defender-office-365/zero-hour-auto-\npurge?view=o365-worldwide#zero-hour-auto-purge-zap-in-microsoft-teams\n2. https://learn.microsoft.com/en-us/defender-office-365/mdo-support-teams-\nabout?view=o365-worldwide#configure-zap-for-teams-protection-in-defender-for-\noffice-365-plan-2"
    },
    {
        "id": "6.2.1",
        "title": "(L1) Ensure all forms of mail forwarding are blocked and/or disabled (Automated)",
        "profile": "• E3 Level 1",
        "description": "Exchange Online offers several methods of managing the flow of email messages.\nThese are Remote domain, Transport Rules, and Anti-spam outbound policies. These\nmethods work together to provide comprehensive coverage for potential automatic\nforwarding channels:\n• Outlook forwarding using inbox rules.\n• Outlook forwarding configured using OOF rule.\n• OWA forwarding setting (ForwardingSmtpAddress).\n• Forwarding set by the admin using EAC (ForwardingAddress).\n• Forwarding using Power Automate / Flow.\nEnsure a Transport rule and Anti-spam outbound policy are used to block mail\nforwarding.\nNOTE: Any exclusions should be implemented based on organizational policy.",
        "rationale": "Attackers often create these rules to exfiltrate data from your tenancy, this could be\naccomplished via access to an end-user account or otherwise. An insider could also use\none of these methods as a secondary channel to exfiltrate sensitive data.",
        "impact": "Care should be taken before implementation to ensure there is no business need for\ncase-by-case auto-forwarding. Disabling auto-forwarding to remote domains will affect\nall users and in an organization. Any exclusions should be implemented based on\norganizational policy.\nPage 275",
        "audit": "Note: Audit is a two step procedure as follows:\nSTEP 1: Transport rules\nTo audit using the UI:\n1. Select Exchange to open the Exchange admin center.\n2. Select Mail Flow then Rules.\n3. Review the rules and verify that none of them are forwards or redirects e-mail to\nexternal domains.\nTo audit using PowerShell:\n1. Connect to Exchange online using Connect-ExchangeOnline.\n2. Run the following PowerShell command to review the Transport Rules that are\nredirecting email:\nGet-TransportRule | Where-Object {$_.RedirectMessageTo -ne $null} | ft\nName,RedirectMessageTo\n3. Verify that none of the addresses listed belong to external domains outside of the\norganization. If nothing returns then there are no transport rules set to redirect\nmessages.\nSTEP 2: Anti-spam outbound policy\nTo audit using the UI:\n1. Navigate to Microsoft 365 Defender https://security.microsoft.com/\n2. Expand E-mail & collaboration then select Policies & rules.\n3. Select Threat policies > Anti-spam.\n4. Inspect Anti-spam outbound policy (default) and ensure Automatic\nforwarding is set to Off - Forwarding is disabled\n5. Inspect any additional custom outbound policies and ensure Automatic\nforwarding is set to Off - Forwarding is disabled, in accordance with the\norganization's exclusion policies.\nPage 276\nTo audit using PowerShell:\n1. Connect to Exchange online using Connect-ExchangeOnline.\n2. Run the following PowerShell cmdlet:\nGet-HostedOutboundSpamFilterPolicy | ft Name, AutoForwardingMode\n3. In each outbound policy verify AutoForwardingMode is Off.\nNote: According to Microsoft if a recipient is defined in multiple policies of the same\ntype (anti-spam, anti-phishing, etc.), only the policy with the highest priority is applied to\nthe recipient. Any remaining policies of that type are not evaluated for the recipient\n(including the default policy). However, it is our recommendation to audit the default\npolicy as well in the case a higher priority custom policy is removed. This will keep the\norganization's security posture strong.\nPage 277",
        "remediation": "Note: Remediation is a two step procedure as follows:\nSTEP 1: Transport rules\nTo remediate using the UI:\n1. Select Exchange to open the Exchange admin center.\n2. Select Mail Flow then Rules.\n3. For each rule that redirects email to external domains, select the rule and click\nthe 'Delete' icon.\nTo remediate using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\nRemove-TransportRule {RuleName}\nSTEP 2: Anti-spam outbound policy\nTo remediate using the UI:\n1. Navigate to Microsoft 365 Defender https://security.microsoft.com/\n2. Expand E-mail & collaboration then select Policies & rules.\n3. Select Threat policies > Anti-spam.\n4. Select Anti-spam outbound policy (default)\n5. Click Edit protection settings\n6. Set Automatic forwarding rules dropdown to Off - Forwarding is\ndisabled and click Save\n7. Repeat steps 4-6 for any additional higher priority, custom policies.\nPage 278\nTo remediate using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\nSet-HostedOutboundSpamFilterPolicy -Identity {policyName} -AutoForwardingMode\nOff\n3. To remove AutoForwarding from all outbound policies you can also run:\nGet-HostedOutboundSpamFilterPolicy | Set-HostedOutboundSpamFilterPolicy -\nAutoForwardingMode Off\nReferences:\n1. https://learn.microsoft.com/en-us/exchange/security-and-compliance/mail-flow-\nrules/mail-flow-rules\n2. https://techcommunity.microsoft.com/t5/exchange-team-blog/all-you-need-to-\nknow-about-automatic-email-forwarding-in/ba-\np/2074888#:~:text=%20%20%20Automatic%20forwarding%20option%20%20,%\n3. https://learn.microsoft.com/en-us/defender-office-365/outbound-spam-policies-\nexternal-email-forwarding?view=o365-worldwide\nCIS Controls:\nControls Version Control IG 1 IG 2 IG 3\nv8\n0.0 Explicitly Not Mapped\nExplicitly Not Mapped\nPage 279",
        "references": "1. https://learn.microsoft.com/en-us/exchange/security-and-compliance/mail-flow-\nrules/mail-flow-rules\n2. https://techcommunity.microsoft.com/t5/exchange-team-blog/all-you-need-to-\nknow-about-automatic-email-forwarding-in/ba-\np/2074888#:~:text=%20%20%20Automatic%20forwarding%20option%20%20,%\n3. https://learn.microsoft.com/en-us/defender-office-365/outbound-spam-policies-\nexternal-email-forwarding?view=o365-worldwide"
    },
    {
        "id": "6.2.2",
        "title": "(L1) Ensure mail transport rules do not whitelist specific domains (Automated)",
        "profile": "• E3 Level 1",
        "description": "Mail flow rules (transport rules) in Exchange Online are used to identify and take action\non messages that flow through the organization.",
        "rationale": "Whitelisting domains in transport rules bypasses regular malware and phishing\nscanning, which can enable an attacker to launch attacks against your users from a\nsafe haven domain.",
        "impact": "Care should be taken before implementation to ensure there is no business need for\ncase-by-case whitelisting. Removing all whitelisted domains could affect incoming mail\nflow to an organization although modern systems sending legitimate mail should have\nno issue with this.",
        "audit": "To audit using the UI:\n1. Navigate to Exchange admin center https://admin.exchange.microsoft.com..\n2. Click to expand Mail Flow and then select Rules.\n3. Review the rules and verify that none of them whitelist any specific domains.\nTo audit using PowerShell:\n1. Connect to Exchange online using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\nGet-TransportRule | Where-Object {($_.setscl -eq -1 -and $_.SenderDomainIs -\nne $null)} | ft Name,SenderDomainIs\nPage 280",
        "remediation": "To remediate using the UI:\n1. Navigate to Exchange admin center https://admin.exchange.microsoft.com..\n2. Click to expand Mail Flow and then select Rules.\n3. For each rule that whitelists specific domains, select the rule and click the\n'Delete' icon.\nTo remediate using PowerShell:\n1. Connect to Exchange online using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\nRemove-TransportRule {RuleName}\n3. Verify the rules no longer exists.\nGet-TransportRule | Where-Object {($_.setscl -eq -1 -and $_.SenderDomainIs -\nne $null)} | ft Name,SenderDomainIs\nReferences:\n1. https://learn.microsoft.com/en-us/exchange/security-and-compliance/mail-flow-\nrules/configuration-best-practices\n2. https://learn.microsoft.com/en-us/exchange/security-and-compliance/mail-flow-\nrules/mail-flow-rules\nCIS Controls:\nControls Version Control IG 1 IG 2 IG 3\nv8\n0.0 Explicitly Not Mapped\nExplicitly Not Mapped\nPage 281",
        "references": "1. https://learn.microsoft.com/en-us/exchange/security-and-compliance/mail-flow-\nrules/configuration-best-practices\n2. https://learn.microsoft.com/en-us/exchange/security-and-compliance/mail-flow-\nrules/mail-flow-rules"
    },
    {
        "id": "6.2.3",
        "title": "(L1) Ensure email from external senders is identified (Automated)",
        "profile": "• E3 Level 1",
        "description": "External callouts provide a native experience to identify emails from senders outside the\norganization. This is achieved by presenting a new tag on emails called \"External\" (the\nstring is localized based on the client language setting) and exposing related user\ninterface at the top of the message reading view to see and verify the real sender's\nemail address.\nOnce this feature is enabled via PowerShell, it might take 24-48 hours for users to start\nseeing the External sender tag in email messages received from external sources\n(outside of your organization), providing their Outlook version supports it.\nThe recommended state is ExternalInOutlook set to Enabled True\nNote: Mail flow rules are often used by Exchange administrators to accomplish the\nExternal email tagging by appending a tag to the front of a subject line. There are\nlimitations to this outlined here. The preferred method in the CIS Benchmark is to use\nthe native experience.",
        "rationale": "Tagging emails from external senders helps to inform end users about the origin of the\nemail. This can allow them to proceed with more caution and make informed decisions\nwhen it comes to identifying spam or phishing emails.\nNote: Existing emails in a user's inbox from external senders are not tagged\nretroactively.",
        "impact": "Mail flow rules using external tagging will need to be disabled before enabling this to\navoid duplicate [External] tags.\nThe Outlook desktop client is the last to receive this update and the feature is only\navailable for certain versions see below:\nOutlook for Windows: Update 4/26/23: External Tag view in Outlook for Windows\n(matching other clients) released to production for Current Channel and Monthly\nEnterprise Channel in Version 2211 for builds 15831.20190 and higher. We anticipate\nthe External tag to reach Semi-Annual Preview Channel with Version 2308 on the\nSeptember 12th 2023 public update and reach Semi-Annual Enterprise Channel with\nVersion 2308 with the January 9th 2024 public update.\nPage 282",
        "audit": "To audit using PowerShell:\n1. Connect to Exchange online using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\nGet-ExternalInOutlook\n3. For each identity verify Enabled is set to True and the AllowList only contains\nemail addresses the organization has permitted to bypass external tagging.",
        "remediation": "To remediate using PowerShell:\n1. Connect to Exchange online using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\nSet-ExternalInOutlook -Enabled $true",
        "default_value": "Disabled (False)",
        "references": "1. https://techcommunity.microsoft.com/t5/exchange-team-blog/native-external-\nsender-callouts-on-email-in-outlook/ba-p/2250098\n2. https://learn.microsoft.com/en-us/powershell/module/exchange/set-\nexternalinoutlook?view=exchange-ps"
    },
    {
        "id": "6.3",
        "title": "Roles",
        "profile": "• E3 Level 2",
        "description": "App registration allows users to register custom-developed applications for use within\nthe directory.",
        "rationale": "Third-party integrated applications connection to services should be disabled unless\nthere is a very clear value and robust security controls are in place. While there are\nlegitimate uses, attackers can grant access from breached accounts to third party\napplications to exfiltrate data from your tenancy without having to maintain the breached\naccount.",
        "impact": "Implementation of this change will impact both end users and administrators. End users\nwill not be able to integrate third-party applications that they may wish to use.\nAdministrators are likely to receive requests from end users to grant them permission to\nnecessary third-party applications.\nPage 149",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Identity > Users select Users settings.\n3. Verify Users can register applications is set to No.\nTo audit using PowerShell:\n1. Connect to Microsoft Graph using Connect-MgGraph -Scopes\n\"Policy.Read.All\"\n2. Run the following command:\n(Get-MgPolicyAuthorizationPolicy).DefaultUserRolePermissions | fl\nAllowedToCreateApps\n3. Ensure the returned value is False.",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Identity > Users select Users settings.\n3. Set Users can register applications to No.\n4. Click Save.\nTo remediate using PowerShell:\n1. Connect to Microsoft Graph using Connect-MgGraph -Scopes\n\"Policy.ReadWrite.Authorization\"\n2. Run the following commands:\n$param = @{ AllowedToCreateApps = \"$false\" }\nUpdate-MgPolicyAuthorizationPolicy -DefaultUserRolePermissions $param",
        "default_value": "Yes (Users can register applications.)",
        "references": "1. https://learn.microsoft.com/en-us/entra/identity-platform/how-applications-are-\nadded\nPage 150"
    },
    {
        "id": "6.3.1",
        "title": "(L2) Ensure users installing Outlook add-ins is not allowed (Automated)",
        "profile": "• E3 Level 2",
        "description": "Specify the administrators and users who can install and manage add-ins for Outlook in\nExchange Online\nBy default, users can install add-ins in their Microsoft Outlook Desktop client, allowing\ndata access within the client application.",
        "rationale": "Attackers exploit vulnerable or custom add-ins to access user data. Disabling user-\ninstalled add-ins in Microsoft Outlook reduces this threat surface.",
        "impact": "Implementing this change will impact both end users and administrators. End users will\nbe unable to integrate third-party applications they desire, and administrators may\nreceive requests to grant permission for necessary third-party apps.\nPage 285",
        "audit": "To audit using the UI:\n1. Navigate to Exchange admin center https://admin.exchange.microsoft.com.\n2. Click to expand Roles select User roles.\n3. Select Default Role Assignment Policy.\n4. In the properties pane on the right click on Manage permissions.\n5. Under Other roles verify My Custom Apps, My Marketplace Apps and My\nReadWriteMailboxApps are unchecked.\nTo audit using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following command:\nGet-EXOMailbox | Select-Object -Unique RoleAssignmentPolicy |\nForEach-Object {\nGet-RoleAssignmentPolicy -Identity $_.RoleAssignmentPolicy |\nWhere-Object {$_.AssignedRoles -like \"*Apps*\"}\n} | Select-Object Identity, @{Name=\"AssignedRoles\"; Expression={\nGet-Mailbox | Select-Object -Unique RoleAssignmentPolicy |\nForEach-Object {\nGet-RoleAssignmentPolicy -Identity $_.RoleAssignmentPolicy |\nSelect-Object -ExpandProperty AssignedRoles |\nWhere-Object {$_ -like \"*Apps*\"}\n}\n}}\n3. Verify My Custom Apps, My Marketplace Apps and My\nReadWriteMailboxApps are not present.\nNote: As of the current release the manage permissions link no longer displays\nanything when a user assigned the Global Reader role clicks on it. Global Readers as\nan alternative can inspect the Roles column or use the PowerShell method to perform\nthe audit.\nPage 286",
        "remediation": "To remediate using the UI:\n1. Navigate to Exchange admin center https://admin.exchange.microsoft.com.\n2. Click to expand Roles select User roles.\n3. Select Default Role Assignment Policy.\n4. In the properties pane on the right click on Manage permissions.\n5. Under Other roles uncheck My Custom Apps, My Marketplace Apps and My\nReadWriteMailboxApps.\n6. Click Save changes.\nTo remediate using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following command:\n$policy = \"Role Assignment Policy - Prevent Add-ins\"\n$roles = \"MyTextMessaging\", \"MyDistributionGroups\", `\n\"MyMailSubscriptions\", \"MyBaseOptions\", \"MyVoiceMail\", `\n\"MyProfileInformation\", \"MyContactInformation\",\n\"MyRetentionPolicies\", `\n\"MyDistributionGroupMembership\"\nNew-RoleAssignmentPolicy -Name $policy -Roles $roles\nSet-RoleAssignmentPolicy -id $policy -IsDefault\n# Assign new policy to all mailboxes\nGet-EXOMailbox -ResultSize Unlimited | Set-Mailbox -RoleAssignmentPolicy\n$policy\nIf you have other Role Assignment Policies modify the last line to filter out your\ncustom policies",
        "default_value": "UI - My Custom Apps, My Marketplace Apps, and My ReadWriteMailboxApps are\nchecked\nPowerShell - My Custom Apps My Marketplace Apps and My\nReadWriteMailboxApps are assigned",
        "references": "1. https://learn.microsoft.com/en-us/exchange/clients-and-mobile-in-exchange-\nonline/add-ins-for-outlook/specify-who-can-install-and-manage-add-\nins?source=recommendations\n2. https://learn.microsoft.com/en-us/exchange/permissions-exo/role-assignment-\npolicies\nPage 287"
    },
    {
        "id": "6.4",
        "title": "Reports",
        "profile": "• E3 Level 1",
        "description": "Multifactor authentication is a process that requires an additional form of identification\nduring the sign-in process, such as a code from a mobile device or a fingerprint scan, to\nenhance security.\nEnsure users in administrator roles have MFA capabilities enabled.",
        "rationale": "Multifactor authentication requires an individual to present a minimum of two separate\nforms of authentication before access is granted. Multifactor authentication provides\nadditional assurance that the individual attempting to gain access is who they claim to\nbe. With multifactor authentication, an attacker would need to compromise at least two\ndifferent authentication mechanisms, increasing the difficulty of compromise and thus\nreducing the risk.",
        "impact": "Implementation of multifactor authentication for all users in administrative roles will\nnecessitate a change to user routine. All users in administrative roles will be required to\nenroll in multifactor authentication using phone, SMS, or an authentication application.\nAfter enrollment, use of multifactor authentication will be required for future access to\nthe environment.\nPage 185",
        "audit": "To audit using the UI:\n1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com.\n2. Click to expand Protection > Conditional Access select Policies.\n3. Ensure that a policy exists with the following criteria and is set to On:\no Under Users verify Directory roles specific to administrators are\nincluded.\no Under Target resources verify All cloud apps is selected with no\nexclusions.\no Under Grant verify Grant Access and Require multifactor\nauthentication checked.\n4. Ensure Enable policy is set to On.\nTo audit using SecureScore:\n1. Navigate to Microsoft 365 Defender https://security.microsoft.com.\n2. Select Secure score.\n3. Select Recommended actions.\n4. Click on Ensure multifactor authentication is enabled for all users\nin administrative roles.\n5. Review the number of Admin users who do not have MFA configured.\nThis information is also available via the Microsoft Graph Security API:\nGET https://graph.microsoft.com/beta/security/secureScores\nNote: A list of required Directory roles can be found in the Remediation section.\nPage 186",
        "remediation": "To remediate using the UI:\n1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com.\n2. Click expand Protection > Conditional Access select Policies.\n3. Click New policy.\no Under Users include Select users and groups and check Directory\nroles.\no At a minimum, include the directory roles listed below in this section of the\ndocument.\no Under Target resources include All cloud apps and do not create\nany exclusions.\no Under Grant select Grant Access and check Require multifactor\nauthentication.\no Click Select at the bottom of the pane.\n4. Under Enable policy set it to Report Only until the organization is ready to\nenable it.\n5. Click Create.\nAt minimum these directory roles should be included for MFA:\n• Application administrator\n• Authentication administrator\n• Billing administrator\n• Cloud application administrator\n• Conditional Access administrator\n• Exchange administrator\n• Global administrator\n• Global reader\n• Helpdesk administrator\n• Password administrator\n• Privileged authentication administrator\n• Privileged role administrator\n• Security administrator\n• SharePoint administrator\n• User administrator\nNote: Report-only is an acceptable first stage when introducing any CA policy. The\ncontrol, however, is not complete until the policy is on.\nReferences:\n1. https://learn.microsoft.com/en-us/entra/identity/conditional-access/howto-\nconditional-access-policy-admin-mfa\nPage 187\nCIS Controls:\nControls\nControl IG 1 IG 2 IG 3\nVersion",
        "references": "1. https://learn.microsoft.com/en-us/entra/identity/conditional-access/howto-\nconditional-access-policy-admin-mfa\nPage 187"
    },
    {
        "id": "6.5",
        "title": "Settings",
        "profile": "• E3 Level 1",
        "description": "Enable multifactor authentication for all users in the Microsoft 365 tenant. Users will be\nprompted to authenticate with a second factor upon logging in to Microsoft 365 services.\nThe second factor is most commonly a text message to a registered mobile phone\nnumber where they type in an authorization code, or with a mobile application like\nMicrosoft Authenticator.",
        "rationale": "Multifactor authentication requires an individual to present a minimum of two separate\nforms of authentication before access is granted. Multifactor authentication provides\nadditional assurance that the individual attempting to gain access is who they claim to\nbe. With multifactor authentication, an attacker would need to compromise at least two\ndifferent authentication mechanisms, increasing the difficulty of compromise and thus\nreducing the risk.",
        "impact": "Implementation of multifactor authentication for all users will necessitate a change to\nuser routine. All users will be required to enroll in multifactor authentication using phone,\nSMS, or an authentication application. After enrollment, use of multifactor authentication\nwill be required for future authentication to the environment.\nNote: Organizations that have difficulty enforcing MFA globally due lack of the budget to\nprovide company owned mobile devices to every user, or equally are unable to force\nend users to use their personal devices due to regulations, unions, or policy have\nanother option. FIDO2 Security keys may be used as a stand in for this\nrecommendation. They are more secure, phishing resistant, and are affordable for an\norganization to issue to every end user.\nPage 189",
        "audit": "To audit using the UI:\n1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com.\n2. Click expand Protection > Conditional Access select Policies.\n3. Ensure that a policy exists with the following criteria and is set to On:\no Under Users verify All users is included.\no Under Target resources verify All cloud apps is selected with no\nexclusions.\no Under Grant verify Grant Access and Require multifactor\nauthentication checked.\n4. Ensure Enable policy is set to On.\nTo audit using SecureScore:\n1. Navigate to Microsoft 365 Defender https://security.microsoft.com.\n2. Select Secure score.\n3. Select Recommended actions.\n4. Click on Ensure multifactor authentication is enabled for all\nusers.\n5. Review the list of users who do not have MFA configured.",
        "remediation": "To remediate using the UI:\n1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com.\n2. Click expand Protection > Conditional Access select Policies.\n3. Click New policy.\no Under Users include All users (and do not exclude any user).\no Under Target resources include All cloud apps and do not create\nany exclusions.\no Under Grant select Grant Access and check Require multifactor\nauthentication.\no Click Select at the bottom of the pane.\n4. Under Enable policy set it to Report Only until the organization is ready to\nenable it.\n5. Click Create.\nNote: Report-only is an acceptable first stage when introducing any CA policy. The\ncontrol, however, is not complete until the policy is on.",
        "default_value": "Disabled\nPage 190",
        "references": "1. https://learn.microsoft.com/en-us/entra/identity/conditional-access/howto-\nconditional-access-policy-all-users-mfa"
    },
    {
        "id": "6.5.1",
        "title": "(L1) Ensure modern authentication for Exchange Online is enabled (Automated)",
        "profile": "• E3 Level 1",
        "description": "Modern authentication in Microsoft 365 enables authentication features like multifactor\nauthentication (MFA) using smart cards, certificate-based authentication (CBA), and\nthird-party SAML identity providers. When you enable modern authentication in\nExchange Online, Outlook 2016 and Outlook 2013 use modern authentication to log in\nto Microsoft 365 mailboxes. When you disable modern authentication in Exchange\nOnline, Outlook 2016 and Outlook 2013 use basic authentication to log in to Microsoft\n365 mailboxes.\nWhen users initially configure certain email clients, like Outlook 2013 and Outlook 2016,\nthey may be required to authenticate using enhanced authentication mechanisms, such\nas multifactor authentication. Other Outlook clients that are available in Microsoft 365\n(for example, Outlook Mobile and Outlook for Mac 2016) always use modern\nauthentication to log in to Microsoft 365 mailboxes.",
        "rationale": "Strong authentication controls, such as the use of multifactor authentication, may be\ncircumvented if basic authentication is used by Exchange Online email clients such as\nOutlook 2016 and Outlook 2013. Enabling modern authentication for Exchange Online\nensures strong authentication mechanisms are used when establishing sessions\nbetween email clients and Exchange Online.",
        "impact": "Users of older email clients, such as Outlook 2013 and Outlook 2016, will no longer be\nable to authenticate to Exchange using Basic Authentication, which will necessitate\nmigration to modern authentication practices.\nPage 290",
        "audit": "To audit using PowerShell:\n1. Run the Microsoft Exchange Online PowerShell Module.\n2. Connect to Exchange Online using Connect-ExchangeOnline.\n3. Run the following PowerShell command:\nGet-OrganizationConfig | Format-Table -Auto Name, OAuth*\n4. Verify OAuth2ClientProfileEnabled is True.",
        "remediation": "To remediate using PowerShell:\n1. Run the Microsoft Exchange Online PowerShell Module.\n2. Connect to Exchange Online using Connect-ExchangeOnline.\n3. Run the following PowerShell command:\nSet-OrganizationConfig -OAuth2ClientProfileEnabled $True",
        "default_value": "True",
        "references": "1. https://learn.microsoft.com/en-us/exchange/clients-and-mobile-in-exchange-\nonline/enable-or-disable-modern-authentication-in-exchange-online"
    },
    {
        "id": "6.5.2",
        "title": "(L1) Ensure MailTips are enabled for end users (Automated)",
        "profile": "• E3 Level 1",
        "description": "MailTips are informative messages displayed to users while they're composing a\nmessage. While a new message is open and being composed, Exchange analyzes the\nmessage (including recipients). If a potential problem is detected, the user is notified\nwith a MailTip prior to sending the message. Using the information in the MailTip, the\nuser can adjust the message to avoid undesirable situations or non-delivery reports\n(also known as NDRs or bounce messages).",
        "rationale": "Setting up MailTips gives a visual aid to users when they send emails to large groups of\nrecipients or send emails to recipients not within the tenant.",
        "impact": "Not applicable.",
        "audit": "To audit using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\nGet-OrganizationConfig | fl MailTips*\n3. Verify the values for MailTipsAllTipsEnabled,\nMailTipsExternalRecipientsTipsEnabled, and\nMailTipsGroupMetricsEnabled are set to True and\nMailTipsLargeAudienceThreshold is set to an acceptable value; 25 is the\ndefault value.\nPage 292",
        "remediation": "To remediate using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\n$TipsParams = @{\nMailTipsAllTipsEnabled = $true\nMailTipsExternalRecipientsTipsEnabled = $true\nMailTipsGroupMetricsEnabled = $true\nMailTipsLargeAudienceThreshold = '25'\n}\nSet-OrganizationConfig @TipsParams",
        "default_value": "MailTipsAllTipsEnabled: True MailTipsExternalRecipientsTipsEnabled: False\nMailTipsGroupMetricsEnabled: True MailTipsLargeAudienceThreshold: 25",
        "references": "1. https://learn.microsoft.com/en-us/exchange/clients-and-mobile-in-exchange-\nonline/mailtips/mailtips\n2. https://learn.microsoft.com/en-us/powershell/module/exchange/set-\norganizationconfig?view=exchange-ps"
    },
    {
        "id": "6.5.3",
        "title": "(L2) Ensure additional storage providers are restricted in Outlook on the web\n(Automated)",
        "profile": "• E3 Level 2",
        "description": "This setting allows users to open certain external files while working in Outlook on the\nweb. If allowed, keep in mind that Microsoft doesn't control the use terms or privacy\npolicies of those third-party services.\nEnsure AdditionalStorageProvidersAvailable are restricted.",
        "rationale": "By default, additional storage providers are allowed in Office on the Web (such as Box,\nDropbox, Facebook, Google Drive, OneDrive Personal, etc.). This could lead to\ninformation leakage and additional risk of infection from organizational non-trusted\nstorage providers. Restricting this will inherently reduce risk as it will narrow\nopportunities for infection and data leakage.",
        "impact": "The impact associated with this change is highly dependent upon current practices in\nthe tenant. If users do not use other storage providers, then minimal impact is likely.\nHowever, if users do regularly utilize providers outside of the tenant this will affect their\nability to continue to do so.",
        "audit": "To audit using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\nGet-OwaMailboxPolicy | Format-Table Name, AdditionalStorageProvidersAvailable\n3. Verify that the value returned is False.\nPage 294",
        "remediation": "To remediate using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\nSet-OwaMailboxPolicy -Identity OwaMailboxPolicy-Default -\nAdditionalStorageProvidersAvailable $false",
        "default_value": "Additional Storage Providers - True",
        "references": "1. https://learn.microsoft.com/en-us/powershell/module/exchange/set-\nowamailboxpolicy?view=exchange-ps\n2. https://support.microsoft.com/en-us/topic/3rd-party-cloud-storage-services-\nsupported-by-office-apps-fce12782-eccc-4cf5-8f4b-d1ebec513f72"
    },
    {
        "id": "6.5.4",
        "title": "(L1) Ensure SMTP AUTH is disabled (Automated)",
        "profile": "• E3 Level 1",
        "description": "This setting enables or disables authenticated client SMTP submission (SMTP AUTH)\nat an organization level in Exchange Online.\nThe recommended state is Turn off SMTP AUTH protocol for your\norganization.",
        "rationale": "SMTP AUTH is a legacy protocol. Disabling it at the organization level supports the\nprinciple of least functionality and serves to further back additional controls that block\nlegacy protocols, such as in Conditional Access. Virtually all modern email clients that\nconnect to Exchange Online mailboxes in Microsoft 365 can do so without using SMTP\nAUTH.",
        "impact": "This enforces the default behavior, so no impact is expected unless the organization is\nusing it globally. A per-mailbox setting exists that overrides the tenant-wide setting,\nallowing an individual mailbox SMTP AUTH capability for special cases.",
        "audit": "To audit using the UI:\n1. Navigate to Exchange admin center https://admin.exchange.microsoft.com.\n2. Select Settings > Mail flow.\n3. Ensure Turn off SMTP AUTH protocol for your organization is checked.\nTo audit using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\nGet-TransportConfig | Format-List SmtpClientAuthenticationDisabled\n3. Verify that the value returned is True.\nPage 296",
        "remediation": "To remediate using the UI:\n1. Navigate to Exchange admin center https://admin.exchange.microsoft.com.\n2. Select Settings > Mail flow.\n3. Uncheck Turn off SMTP AUTH protocol for your organization.\nTo remediate using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\nSet-TransportConfig -SmtpClientAuthenticationDisabled $true",
        "default_value": "SmtpClientAuthenticationDisabled : True",
        "references": "1. https://learn.microsoft.com/en-us/exchange/clients-and-mobile-in-exchange-\nonline/authenticated-client-smtp-submission"
    },
    {
        "id": "7.1",
        "title": "Sites",
        "profile": "• E5 Level 2",
        "description": "The Safe Attachments policy helps protect users from malware in email attachments by\nscanning attachments for viruses, malware, and other malicious content. When an email\nattachment is received by a user, Safe Attachments will scan the attachment in a secure\nenvironment and provide a verdict on whether the attachment is safe or not.",
        "rationale": "Enabling Safe Attachments policy helps protect against malware threats in email\nattachments by analyzing suspicious attachments in a secure, cloud-based environment\nbefore they are delivered to the user's inbox. This provides an additional layer of\nsecurity and can prevent new or unseen types of malware from infiltrating the\norganization's network.",
        "impact": "Delivery of email with attachments may be delayed while scanning is occurring.\nPage 73",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft 365 Defender https://security.microsoft.com.\n2. Click to expand E-mail & Collaboration select Policies & rules.\n3. On the Policies & rules page select Threat policies.\n4. Under Policies select Safe Attachments.\n5. Inspect the highest priority policy.\n6. Ensure Users and domains and Included recipient domains are in scope\nfor the organization.\n7. Ensure Safe Attachments detection response: is set to Block - Block\ncurrent and future messages and attachments with detected\nmalware.\n8. Ensure the Quarantine Policy is set to AdminOnlyAccessPolicy.\n9. Ensure the policy is not disabled.\nTo audit using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\nGet-SafeAttachmentPolicy | where-object {$_.Enable -eq \"True\"}",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft 365 Defender https://security.microsoft.com.\n2. Click to expand E-mail & Collaboration select Policies & rules.\n3. On the Policies & rules page select Threat policies.\n4. Under Policies select Safe Attachments.\n5. Click + Create.\n6. Create a Policy Name and Description, and then click Next.\n7. Select all valid domains and click Next.\n8. Select Block.\n9. Quarantine policy is AdminOnlyAccessPolicy.\n10. Leave Enable redirect unchecked.\n11. Click Next and finally Submit.",
        "default_value": "disabled\nPage 74",
        "references": "1. https://learn.microsoft.com/en-us/defender-office-365/safe-attachments-about\n2. https://learn.microsoft.com/en-us/defender-office-365/safe-attachments-policies-\nconfigure"
    },
    {
        "id": "7.2",
        "title": "Policies"
    },
    {
        "id": "7.2.1",
        "title": "(L1) Ensure modern authentication for SharePoint applications is required (Automated)",
        "profile": "• E3 Level 1",
        "description": "Modern authentication in Microsoft 365 enables authentication features like multifactor\nauthentication (MFA) using smart cards, certificate-based authentication (CBA), and\nthird-party SAML identity providers.",
        "rationale": "Strong authentication controls, such as the use of multifactor authentication, may be\ncircumvented if basic authentication is used by SharePoint applications. Requiring\nmodern authentication for SharePoint applications ensures strong authentication\nmechanisms are used when establishing sessions between these applications,\nSharePoint, and connecting users.",
        "impact": "Implementation of modern authentication for SharePoint will require users to\nauthenticate to SharePoint using modern authentication. This may cause a minor\nimpact to typical user behavior.\nThis may also prevent third-party apps from accessing SharePoint Online resources.\nAlso, this will also block apps using the SharePointOnlineCredentials class to access\nSharePoint Online resources.\nPage 300",
        "audit": "To audit using the UI:\n1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint.\n2. Click to expand Policies select Access control.\n3. Select Apps that don't use modern authentication and ensure that it is\nset to Block access.\nTo audit using PowerShell:\n1. Connect to SharePoint Online using Connect-SPOService -Url\nhttps://tenant-admin.sharepoint.com replacing tenant with your value.\n2. Run the following SharePoint Online PowerShell command:\nGet-SPOTenant | ft LegacyAuthProtocolsEnabled\n3. Ensure the returned value is False.",
        "remediation": "To remediate using the UI:\n1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint.\n2. Click to expand Policies select Access control.\n3. Select Apps that don't use modern authentication.\n4. Select the radio button for Block access.\n5. Click Save.\nTo remediate using PowerShell:\n1. Connect to SharePoint Online using Connect-SPOService -Url\nhttps://tenant-admin.sharepoint.com replacing tenant with your value.\n2. Run the following SharePoint Online PowerShell command:\nSet-SPOTenant -LegacyAuthProtocolsEnabled $false",
        "default_value": "True (Apps that don't use modern authentication are allowed)",
        "references": "1. https://learn.microsoft.com/en-us/powershell/module/sharepoint-online/set-\nspotenant?view=sharepoint-ps\nPage 301"
    },
    {
        "id": "7.2.2",
        "title": "(L1) Ensure SharePoint and OneDrive integration with Azure AD B2B is enabled\n(Automated)",
        "profile": "• E3 Level 1",
        "description": "Entra ID B2B provides authentication and management of guests. Authentication\nhappens via one-time passcode when they don't already have a work or school account\nor a Microsoft account. Integration with SharePoint and OneDrive allows for more\ngranular control of how guest user accounts are managed in the organization's AAD,\nunifying a similar guest experience already deployed in other Microsoft 365 services\nsuch as Teams.\nNote: Global Reader role currently can't access SharePoint using PowerShell.",
        "rationale": "External users assigned guest accounts will be subject to Entra ID access policies, such\nas multi-factor authentication. This provides a way to manage guest identities and\ncontrol access to SharePoint and OneDrive resources. Without this integration, files can\nbe shared without account registration, making it more challenging to audit and manage\nwho has access to the organization's data.",
        "impact": "B2B collaboration is used with other Entra services so should not be new or unusual.\nMicrosoft also has made the experience seamless when turning on integration on\nSharePoint sites that already have active files shared with guest users. The referenced\nMicrosoft article on the subject has more details on this.",
        "audit": "To audit using PowerShell:\n1. Connect to SharePoint Online using Connect-SPOService\n2. Run the following command:\nGet-SPOTenant | ft EnableAzureADB2BIntegration\n3. Ensure the returned value is True.\nPage 303",
        "remediation": "To remediate using PowerShell:\n1. Connect to SharePoint Online using Connect-SPOService\n2. Run the following command:\nSet-SPOTenant -EnableAzureADB2BIntegration $true",
        "default_value": "False",
        "references": "1. https://learn.microsoft.com/en-us/sharepoint/sharepoint-azureb2b-\nintegration#enabling-the-integration\n2. https://learn.microsoft.com/en-us/entra/external-id/what-is-b2b\n3. https://learn.microsoft.com/en-us/powershell/module/sharepoint-online/set-\nspotenant?view=sharepoint-ps"
    },
    {
        "id": "7.2.3",
        "title": "(L1) Ensure external content sharing is restricted (Automated)",
        "profile": "• E3 Level 1",
        "description": "The external sharing settings govern sharing for the organization overall. Each site has\nits own sharing setting that can be set independently, though it must be at the same or\nmore restrictive setting as the organization.\nThe new and existing guests option requires people who have received invitations to\nsign in with their work or school account (if their organization uses Microsoft 365) or a\nMicrosoft account, or to provide a code to verify their identity. Users can share with\nguests already in your organization's directory, and they can send invitations to people\nwho will be added to the directory if they sign in.\nThe recommended state is New and existing guests or less permissive.",
        "rationale": "Forcing guest authentication on the organization's tenant enables the implementation of\ncontrols and oversight over external file sharing. When a guest is registered with the\norganization, they now have an identity which can be accounted for. This identity can\nalso have other restrictions applied to it through group membership and conditional\naccess rules.",
        "impact": "When using B2B integration, Entra ID external collaboration settings, such as guest\ninvite settings and collaboration restrictions apply.\nPage 305",
        "audit": "To audit using the UI:\n1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint\n2. Click to expand Policies > Sharing.\n3. Locate the External sharing section.\n4. Under SharePoint, ensure the slider bar is set to New and existing guests or\na less permissive level.\nTo audit using PowerShell:\n1. Connect to SharePoint Online service using Connect-SPOService.\n2. Run the following cmdlet:\nGet-SPOTenant | fl SharingCapability\n3. Ensure SharingCapability is set to one of the following values:\no Value1: ExternalUserSharingOnly\no Value2: ExistingExternalUserSharingOnly\no Value3: Disabled",
        "remediation": "To remediate using the UI:\n1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint\n2. Click to expand Policies > Sharing.\n3. Locate the External sharing section.\n4. Under SharePoint, move the slider bar to New and existing guests or a less\npermissive level.\no OneDrive will also be moved to the same level and can never be more\npermissive than SharePoint.\nTo remediate using PowerShell:\n1. Connect to SharePoint Online service using Connect-SPOService.\n2. Run the following cmdlet to establish the minimum recommended state:\nSet-SPOTenant -SharingCapability ExternalUserSharingOnly\nNote: Other acceptable values for this parameter that are more restrictive include:\nDisabled and ExistingExternalUserSharingOnly.",
        "default_value": "Anyone (ExternalUserAndGuestSharing)\nPage 306",
        "references": "1. https://learn.microsoft.com/en-us/sharepoint/turn-external-sharing-on-or-off\n2. https://learn.microsoft.com/en-us/powershell/module/sharepoint-online/set-\nspotenant?view=sharepoint-ps"
    },
    {
        "id": "7.2.4",
        "title": "(L2) Ensure OneDrive content sharing is restricted (Automated)",
        "profile": "• E3 Level 2",
        "description": "This setting governs the global permissiveness of OneDrive content sharing in the\norganization.\nOneDrive content sharing can be restricted independent of SharePoint but can never be\nmore permissive than the level established with SharePoint.\nThe recommended state is Only people in your organization.",
        "rationale": "OneDrive, designed for end-user cloud storage, inherently provides less oversight and\ncontrol compared to SharePoint, which often involves additional content overseers or\nsite administrators. This autonomy can lead to potential risks such as inadvertent\nsharing of privileged information by end users. Restricting external OneDrive sharing\nwill require users to transfer content to SharePoint folders first which have those tighter\ncontrols.",
        "impact": "Users will be required to take additional steps to share OneDrive content or use other\nofficial channels.",
        "audit": "To audit using the UI:\n1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint\n2. Click to expand Policies > Sharing.\n3. Locate the External sharing section.\n4. Under OneDrive, ensure the slider bar is set to Only people in your\norganization.\nTo audit using PowerShell:\n1. Connect to SharePoint Online service using Connect-SPOService.\n2. Run the following cmdlet:\nGet-SPOTenant | fl OneDriveSharingCapability\n3. Ensure the returned value is Disabled.\nPage 308\nAlternative audit method using PowerShell:\n1. Connect to SharePoint Online.\n2. Use one of the following methods:\n# Replace [tenant] with your tenant id\nGet-SPOSite -Identity https://[tenant]-my.sharepoint.com/ | fl\nUrl,SharingCapability\n# Or run this to filter to the specific site without supplying the tenant\nname.\n$OneDriveSite = Get-SPOSite -Filter { Url -like \"*-my.sharepoint.com/\" }\nGet-SPOSite -Identity $OneDriveSite | fl Url,SharingCapability\n2. Ensure the returned value for SharingCapability is Disabled\nNote: As of March 2024, using Get-SPOSite with Where-Object or filtering against the\nentire site and then returning the SharingCapability parameter can result in a\ndifferent value as opposed to running the cmdlet specifically against the OneDrive\nspecific site using the -Identity switch as shown in the example.\nNote 2: The parameter OneDriveSharingCapability may not be yet fully available in\nall tenants. It is demonstrated in official Microsoft documentation as linked in the\nreferences section but not in the Set-SPOTenant cmdlet itself. If the parameter is\nunavailable, then either use the UI method or alternative PowerShell audit method.\nPage 309",
        "remediation": "To remediate using the UI:\n1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint\n2. Click to expand Policies > Sharing.\n3. Locate the External sharing section.\n4. Under OneDrive, set the slider bar to Only people in your organization.\nTo remediate using PowerShell:\n1. Connect to SharePoint Online service using Connect-SPOService.\n2. Run the following cmdlet:\nSet-SPOTenant -OneDriveSharingCapability Disabled\nAlternative remediation method using PowerShell:\n1. Connect to SharePoint Online.\n2. Run one of the following:\n# Replace [tenant] with your tenant id\nSet-SPOSite -Identity https://[tenant]-my.sharepoint.com/ -SharingCapability\nDisabled\n# Or run this to filter to the specific site without supplying the tenant\nname.\n$OneDriveSite = Get-SPOSite -Filter { Url -like \"*-my.sharepoint.com/\" }\nSet-SPOSite -Identity $OneDriveSite -SharingCapability Disabled",
        "default_value": "Anyone (ExternalUserAndGuestSharing)",
        "references": "1. https://learn.microsoft.com/en-us/powershell/module/sharepoint-online/set-\nspotenant?view=sharepoint-ps#-onedrivesharingcapability"
    },
    {
        "id": "7.2.5",
        "title": "(L2) Ensure that SharePoint guest users cannot share items they don't own (Automated)",
        "profile": "• E3 Level 2",
        "description": "SharePoint gives users the ability to share files, folders, and site collections. Internal\nusers can share with external collaborators, and with the right permissions could share\nto other external parties.",
        "rationale": "Sharing and collaboration are key; however, file, folder, or site collection owners should\nhave the authority over what external users get shared with to prevent unauthorized\ndisclosures of information.",
        "impact": "The impact associated with this change is highly dependent upon current practices. If\nusers do not regularly share with external parties, then minimal impact is likely.\nHowever, if users do regularly share with guests/externally, minimum impacts could\noccur as those external users will be unable to 're-share' content.",
        "audit": "To audit using the UI:\n1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint\n2. Click to expand Policies then select Sharing.\n3. Expand More external sharing settings, verify that Allow guests to\nshare items they don't own is unchecked.\nTo audit using PowerShell:\n1. Connect to SharePoint Online service using Connect-SPOService.\n2. Run the following SharePoint Online PowerShell command:\nGet-SPOTenant | ft PreventExternalUsersFromResharing\n3. Ensure the returned value is True.\nPage 311",
        "remediation": "To remediate using the UI:\n1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint\n2. Click to expand Policies then select Sharing.\n3. Expand More external sharing settings, uncheck Allow guests to\nshare items they don't own.\n4. Click Save.\nTo remediate using PowerShell:\n1. Connect to SharePoint Online service using Connect-SPOService.\n2. Run the following SharePoint Online PowerShell command:\nSet-SPOTenant -PreventExternalUsersFromResharing $True",
        "default_value": "Checked (False)",
        "references": "1. https://learn.microsoft.com/en-us/sharepoint/turn-external-sharing-on-or-off\n2. https://learn.microsoft.com/en-us/sharepoint/external-sharing-overview"
    },
    {
        "id": "7.2.6",
        "title": "(L2) Ensure SharePoint external sharing is managed through domain whitelist/blacklists\n(Automated)",
        "profile": "• E3 Level 2",
        "description": "Control sharing of documents to external domains by either blocking domains or only\nallowing sharing with specific named domains.",
        "rationale": "Attackers will often attempt to expose sensitive information to external entities through\nsharing, and restricting the domains that users can share documents with will reduce\nthat surface area.",
        "impact": "Enabling this feature will prevent users from sharing documents with domains outside of\nthe organization unless allowed.",
        "audit": "To audit using the UI:\n1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint\n2. Expand Policies then click Sharing.\n3. Expand More external sharing settings and confirm that Limit external\nsharing by domain is checked.\n4. Verify that an accurate list of allowed domains is listed.\nTo audit using PowerShell:\n1. Connect to SharePoint Online using Connect-SPOService.\n2. Run the following PowerShell command:\nGet-SPOTenant | fl SharingDomainRestrictionMode,SharingAllowedDomainList\n3. Ensure that SharingDomainRestrictionMode is set to AllowList and\nSharingAllowedDomainList contains domains trusted by the organization for\nexternal sharing.\nPage 313",
        "remediation": "To remediate using the UI:\n1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint.\n2. Expand Policies then click Sharing.\n3. Expand More external sharing settings and check Limit external\nsharing by domain.\n4. Select Add domains to add a list of approved domains.\n5. Click Save at the bottom of the page.\nTo remediate using PowerShell:\n1. Connect to SharePoint Online using Connect-SPOService.\n2. Run the following PowerShell command:\nSet-SPOTenant -SharingDomainRestrictionMode AllowList -\nSharingAllowedDomainList \"domain1.com domain2.com\"",
        "default_value": "Limit external sharing by domain is unchecked\nSharingDomainRestrictionMode: None\nSharingDomainRestrictionMode: <Undefined>\nCIS Controls:\nControls\nControl IG 1 IG 2 IG 3\nVersion\n3.3 Configure Data Access Control Lists\nv8 Configure data access control lists based on a user’s need to know. Apply data ● ● ●\naccess control lists, also known as access permissions, to local and remote file\nsystems, databases, and applications.\n13.4 Only Allow Access to Authorized Cloud Storage or\nv7 Email Providers ● ●\nOnly allow access to authorized cloud storage or email providers.\n14.6 Protect Information through Access Control Lists\nProtect all information stored on systems with file system, network share,\nv7 claims, application, or database specific access control lists. These controls will ● ● ●\nenforce the principle that only authorized individuals should have access to the\ninformation based on their need to access the information as a part of their\nresponsibilities.\nPage 314"
    },
    {
        "id": "7.2.7",
        "title": "(L1) Ensure link sharing is restricted in SharePoint and OneDrive (Automated)",
        "profile": "• E3 Level 1",
        "description": "This setting sets the default link type that a user will see when sharing content in\nOneDrive or SharePoint. It does not restrict or exclude any other options.\nThe recommended state is Specific people (only the people the user\nspecifies)",
        "rationale": "By defaulting to specific people, the user will first need to consider whether or not the\ncontent being shared should be accessible by the entire organization versus select\nindividuals. This aids in reinforcing the concept of least privilege.",
        "audit": "To audit using the UI:\n1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint\n2. Click to expand Policies > Sharing.\n3. Scroll to File and folder links.\n4. Ensure that the setting Choose the type of link that's selected by\ndefault when users share files and folders in SharePoint and\nOneDrive is set to Specific people (only the people the user\nspecifies)\nTo audit using PowerShell:\n1. Connect to SharePoint Online using Connect-SPOService.\n2. Run the following PowerShell command:\nGet-SPOTenant | fl DefaultSharingLinkType\n3. Ensure the returned value is Direct.\nPage 315",
        "remediation": "To remediate using the UI:\n1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint\n2. Click to expand Policies > Sharing.\n3. Scroll to File and folder links.\n4. Set Choose the type of link that's selected by default when users\nshare files and folders in SharePoint and OneDrive to Specific\npeople (only the people the user specifies)\nTo remediate using PowerShell:\n1. Connect to SharePoint Online using Connect-SPOService.\n2. Run the following PowerShell command:\nSet-SPOTenant -DefaultSharingLinkType Direct",
        "default_value": "Only people in your organization (Internal)",
        "references": "1. https://learn.microsoft.com/en-us/powershell/module/sharepoint-online/set-\nspotenant?view=sharepoint-ps"
    },
    {
        "id": "7.2.8",
        "title": "(L2) Ensure external sharing is restricted by security group (Manual)",
        "profile": "• E3 Level 2",
        "description": "External sharing of content can be restricted to specific security groups. This setting is\nglobal, applies to sharing in both SharePoint and OneDrive and cannot be set at the site\nlevel in SharePoint.\nThe recommended state is Enabled or Checked.\nNote: Users in these security groups must be allowed to invite guests in the guest invite\nsettings in Microsoft Entra. Identity > External Identities > External collaboration settings",
        "rationale": "Organizations wishing to create tighter security controls for external sharing can set this\nto enforce role-based access control by using security groups already defined in\nMicrosoft Entra.",
        "impact": "OneDrive will also be governed by this and there is no granular control at the\nSharePoint site level.",
        "audit": "To audit using the UI:\n1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint\n2. Click to expand Policies > Sharing.\n3. Scroll to and expand More external sharing settings.\n4. Ensure the following:\no Verify Allow only users in specific security groups to share\nexternally is checked\no Verify Manage security groups is defined and accordance with\ncompany procedure.\nPage 317",
        "remediation": "To remediate using the UI:\n1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint\n2. Click to expand Policies > Sharing.\n3. Scroll to and expand More external sharing settings.\n4. Set the following:\no Check Allow only users in specific security groups to share\nexternally\no Define Manage security groups in accordance with company\nprocedure.",
        "default_value": "Unchecked/Undefined",
        "references": "1. https://learn.microsoft.com/en-us/sharepoint/manage-security-groups"
    },
    {
        "id": "7.2.9",
        "title": "(L1) Ensure guest access to a site or OneDrive will expire automatically (Automated) 319\n7",
        "profile": "• E3 Level 1",
        "description": "This policy setting configures the expiration time for each guest that is invited to the\nSharePoint site or with whom users share individual files and folders with.\nThe recommended state is 30 or less.",
        "rationale": "This setting ensures that guests who no longer need access to the site or link no longer\nhave access after a set period of time. Allowing guest access for an indefinite amount of\ntime could lead to loss of data confidentiality and oversight.\nNote: Guest membership applies at the Microsoft 365 group level. Guests who have\npermission to view a SharePoint site or use a sharing link may also have access to a\nMicrosoft Teams team or security group.",
        "impact": "Site collection administrators will have to renew access to guests who still need access\nafter 30 days. They will receive an e-mail notification once per week about guest access\nthat is about to expire.\nNote: The guest expiration policy only applies to guests who use sharing links or guests\nwho have direct permissions to a SharePoint site after the guest policy is enabled. The\nguest policy does not apply to guest users that have pre-existing permissions or access\nthrough a sharing link before the guest expiration policy is applied.\nPage 319",
        "audit": "To audit using the UI:\n1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint\n2. Click to expand Policies > Sharing.\n3. Scroll to and expand More external sharing settings.\n4. Ensure Guest access to a site or OneDrive will expire\nautomatically after this many days is checked and set to 30 or less.\nTo audit using PowerShell:\n1. Connect to SharePoint Online service using Connect-SPOService.\n2. Run the following cmdlet:\nGet-SPOTenant | fl ExternalUserExpirationRequired,ExternalUserExpireInDays\n3. Ensure the following values are returned:\no ExternalUserExpirationRequired is True.\no ExternalUserExpireInDays is 30 or less.",
        "remediation": "To remediate using the UI:\n1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint\n2. Click to expand Policies > Sharing.\n3. Scroll to and expand More external sharing settings.\n4. Set Guest access to a site or OneDrive will expire automatically\nafter this many days to 30\nTo remediate using PowerShell:\n1. Connect to SharePoint Online service using Connect-SPOService.\n2. Run the following cmdlet:\nSet-SPOTenant -ExternalUserExpireInDays 30 -ExternalUserExpirationRequired\n$True",
        "default_value": "ExternalUserExpirationRequired $false\nExternalUserExpireInDays 60 days\nPage 320",
        "references": "1. https://learn.microsoft.com/en-us/sharepoint/turn-external-sharing-on-or-\noff#change-the-organization-level-external-sharing-setting\n2. https://learn.microsoft.com/en-us/microsoft-365/community/sharepoint-security-a-\nteam-effort"
    },
    {
        "id": "7.2.11",
        "title": "(L1) Ensure the SharePoint default sharing link permission is set (Automated)",
        "profile": "• E3 Level 1",
        "description": "This setting configures the permission that is selected by default for sharing link from a\nSharePoint site.\nThe recommended state is View.",
        "rationale": "Setting the view permission as the default ensures that users must deliberately select\nthe edit permission when sharing a link. This approach reduces the risk of\nunintentionally granting edit privileges to a resource that only requires read access,\nsupporting the principle of least privilege.",
        "impact": "Not applicable.",
        "audit": "To audit using the UI:\n1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint\n2. Click to expand Policies > Sharing.\n3. Scroll to File and folder links.\n4. Ensure Choose the permission that's selected by default for\nsharing links is set to View.\nTo audit using PowerShell:\n1. Connect to SharePoint Online service using Connect-SPOService.\n2. Run the following cmdlet:\nGet-SPOTenant | fl DefaultLinkPermission\n3. Ensure the returned value is View.\nPage 325",
        "remediation": "To remediate using the UI:\n1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint\n2. Click to expand Policies > Sharing.\n3. Scroll to File and folder links.\n4. Set Choose the permission that's selected by default for sharing\nlinks to View.\nTo remediate using PowerShell:\n1. Connect to SharePoint Online service using Connect-SPOService.\n2. Run the following cmdlet:\nSet-SPOTenant -DefaultLinkPermission View",
        "default_value": "DefaultLinkPermission : Edit",
        "references": "1. https://learn.microsoft.com/en-us/sharepoint/turn-external-sharing-on-or-off#file-\nand-folder-links\nPage 326"
    },
    {
        "id": "7.3",
        "title": "Settings"
    },
    {
        "id": "7.3.1",
        "title": "(L2) Ensure Office 365 SharePoint infected files are disallowed for download\n(Automated)",
        "profile": "• E5 Level 2",
        "description": "By default, SharePoint online allows files that Defender for Office 365 has detected as\ninfected to be downloaded.",
        "rationale": "Defender for Office 365 for SharePoint, OneDrive, and Microsoft Teams protects your\norganization from inadvertently sharing malicious files. When an infected file is detected\nthat file is blocked so that no one can open, copy, move, or share it until further actions\nare taken by the organization's security team.",
        "impact": "The only potential impact associated with implementation of this setting is potential\ninconvenience associated with the small percentage of false positive detections that\nmay occur.",
        "audit": "To audit using PowerShell:\n1. Connect to SharePoint Online using Connect-SPOService -Url\nhttps://tenant-admin.sharepoint.com, replacing \"tenant\" with the\nappropriate value.\n2. Run the following PowerShell command:\nGet-SPOTenant | Select-Object DisallowInfectedFileDownload\n3. Ensure the value for DisallowInfectedFileDownload is set to True.\nNote: According to Microsoft, SharePoint cannot be accessed through PowerShell by\nusers with the Global Reader role. For further information, please refer to the reference\nsection.\nPage 328",
        "remediation": "To remediate using PowerShell:\n1. Connect to SharePoint Online using Connect-SPOService -Url\nhttps://tenant-admin.sharepoint.com, replacing \"tenant\" with the\nappropriate value.\n2. Run the following PowerShell command to set the recommended value:\nSet-SPOTenant –DisallowInfectedFileDownload $true\nNote: The Global Reader role cannot access SharePoint using PowerShell according to\nMicrosoft. See the reference section for more information.",
        "default_value": "False",
        "references": "1. https://learn.microsoft.com/en-us/defender-office-365/safe-attachments-for-spo-\nodfb-teams-configure?view=o365-worldwide\n2. https://learn.microsoft.com/en-us/defender-office-365/anti-malware-protection-\nfor-spo-odfb-teams-about?view=o365-worldwide\n3. https://learn.microsoft.com/en-us/entra/identity/role-based-access-\ncontrol/permissions-reference#global-reader"
    },
    {
        "id": "7.3.2",
        "title": "(L2) Ensure OneDrive sync is restricted for unmanaged devices (Automated)",
        "profile": "• E3 Level 2",
        "description": "Microsoft OneDrive allows users to sign in their cloud tenant account and begin syncing\nselect folders or the entire contents of OneDrive to a local computer. By default, this\nincludes any computer with OneDrive already installed, whether it is Entra Joined ,\nEntra Hybrid Joined or Active Directory Domain joined.\nThe recommended state for this setting is Allow syncing only on computers\njoined to specific domains Enabled: Specify the AD domain GUID(s)",
        "rationale": "Unmanaged devices pose a risk, since their security cannot be verified through existing\nsecurity policies, brokers or endpoint protection. Allowing users to sync data to these\ndevices takes that data out of the control of the organization. This increases the risk of\nthe data either being intentionally or accidentally leaked.\nNote: This setting is only applicable to Active Directory domains when operating in a\nhybrid configuration. It does not apply to Entra domains. If there are devices which are\nonly Entra ID joined, consider using a Conditional Access Policy instead.",
        "impact": "Enabling this feature will prevent users from using the OneDrive for Business Sync\nclient on devices that are not joined to the domains that were defined.\nPage 330",
        "audit": "To audit using the UI:\n1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint\n2. Click Settings followed by OneDrive - Sync\n3. Verify that Allow syncing only on computers joined to specific\ndomains is checked.\n4. Verify that the Active Directory domain GUIDS are listed in the box.\no Use the Get-ADDomain PowerShell command on the on-premises server\nto obtain the GUID for each on-premises domain.\nTo audit using PowerShell:\n1. Connect to SharePoint Online using Connect-SPOService -Url\nhttps://tenant-admin.sharepoint.com, replacing \"tenant\" with the\nappropriate value.\n2. Run the following PowerShell command:\nGet-SPOTenantSyncClientRestriction | fl\nTenantRestrictionEnabled,AllowedDomainList\n3. Ensure TenantRestrictionEnabled is set to True and AllowedDomainList\ncontains the trusted domains GUIDs from the on premises environment.\nPage 331",
        "remediation": "To remediate using the UI:\n1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint\n2. Click Settings then select OneDrive - Sync.\n3. Check the Allow syncing only on computers joined to specific\ndomains.\n4. Use the Get-ADDomain PowerShell command on the on-premises server to\nobtain the GUID for each on-premises domain.\n5. Click Save.\nTo remediate using PowerShell:\n1. Connect to SharePoint Online using Connect-SPOService\n2. Run the following PowerShell command and provide the DomainGuids from the\nGet-AADomain command:\nSet-SPOTenantSyncClientRestriction -Enable -DomainGuids \"786548DD-877B-4760-\nA749-6B1EFBC1190A; 877564FF-877B-4760-A749-6B1EFBC1190A\"\nNote: Utilize the -BlockMacSync:$true parameter if you are not using conditional\naccess to ensure Macs cannot sync.",
        "default_value": "By default there are no restrictions applied to the syncing of OneDrive.\nTenantRestrictionEnabled : False\nAllowedDomainList : {}",
        "references": "1. https://learn.microsoft.com/en-us/sharepoint/allow-syncing-only-on-specific-\ndomains\n2. https://learn.microsoft.com/en-us/powershell/module/sharepoint-online/set-\nspotenantsyncclientrestriction?view=sharepoint-ps"
    },
    {
        "id": "7.3.3",
        "title": "(L1) Ensure custom script execution is restricted on personal sites (Manual)",
        "profile": "• E3 Level 1",
        "description": "This setting controls custom script execution on self-service created sites.\nCustom scripts can allow users to change the look, feel and behavior of sites and\npages. Every script that runs in a SharePoint page (whether it's an HTML page in a\ndocument library or a JavaScript in a Script Editor Web Part) always runs in the context\nof the user visiting the page and the SharePoint application. This means:\n• Scripts have access to everything the user has access to.\n• Scripts can access content across several Microsoft 365 services and even\nbeyond with Microsoft Graph integration.\nThe recommended state is Prevent users from running custom script on\nself-service created sites.",
        "rationale": "Custom scripts could contain malicious instructions unknown to the user or\nadministrator. When users are allowed to run custom script, the organization can no\nlonger enforce governance, scope the capabilities of inserted code, block specific parts\nof code, or block all custom code that has been deployed. If scripting is allowed the\nfollowing things can't be audited:\n• What code has been inserted\n• Where the code has been inserted\n• Who inserted the code\nNote: Microsoft recommends using the SharePoint Framework instead of custom\nscripts.",
        "impact": "None - this is the default behavior.\nPage 333",
        "audit": "To audit using the UI:\n1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint\n2. Select Settings.\n3. At the bottom of the page click the classic settings page hyperlink.\n4. Scroll to locate the Custom Script section. On the right ensure the following:\no Verify Prevent users from running custom script on self-\nservice created sites is set.",
        "remediation": "To remediate using the UI:\n1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint\n2. Select Settings.\n3. At the bottom of the page click the classic settings page hyperlink.\n4. Scroll to locate the Custom Script section. On the right set the following:\no Select Prevent users from running custom script on self-\nservice created sites.",
        "default_value": "Selected Prevent users from running custom script on self-service\ncreated sites",
        "references": "1. https://learn.microsoft.com/en-us/sharepoint/allow-or-prevent-custom-script\n2. https://learn.microsoft.com/en-us/sharepoint/security-considerations-of-allowing-\ncustom-script\n3. https://learn.microsoft.com/en-us/powershell/module/sharepoint-online/set-\nsposite?view=sharepoint-ps"
    },
    {
        "id": "7.3.4",
        "title": "(L1) Ensure custom script execution is restricted on site collections (Automated)",
        "profile": "• E3 Level 1",
        "description": "This setting controls custom script execution on a particular site (previously called \"site\ncollection\").\nCustom scripts can allow users to change the look, feel and behavior of sites and\npages. Every script that runs in a SharePoint page (whether it's an HTML page in a\ndocument library or a JavaScript in a Script Editor Web Part) always runs in the context\nof the user visiting the page and the SharePoint application. This means:\n• Scripts have access to everything the user has access to.\n• Scripts can access content across several Microsoft 365 services and even\nbeyond with Microsoft Graph integration.\nThe recommended state is DenyAddAndCustomizePages set to $true.",
        "rationale": "Custom scripts could contain malicious instructions unknown to the user or\nadministrator. When users are allowed to run custom script, the organization can no\nlonger enforce governance, scope the capabilities of inserted code, block specific parts\nof code, or block all custom code that has been deployed. If scripting is allowed the\nfollowing things can't be audited:\n• What code has been inserted\n• Where the code has been inserted\n• Who inserted the code\nNote: Microsoft recommends using the SharePoint Framework instead of custom\nscripts.",
        "impact": "None - this is the default behavior.\nPage 335",
        "audit": "To audit using PowerShell:\n1. Connect to SharePoint Online using Connect-SPOService.\n2. Run the following PowerShell command to show non-compliant results:\nGet-SPOSite | Where-Object { $_.DenyAddAndCustomizePages -eq \"Disabled\" `\n-and $_.Url -notlike \"*-my.sharepoint.com/\" } |\nft Title, Url, DenyAddAndCustomizePages\n3. Ensure the returned value is for DenyAddAndCustomizePages is Enabled for\neach site.\nNote: The property DenyAddAndCustomizePages cannot be set on the MySite host,\nwhich is displayed with a URL like https://tenant id-my.sharepoint.com/",
        "remediation": "To remediate using PowerShell:\n1. Connect to SharePoint Online using Connect-SPOService.\n2. Edit the below and run for each site as needed:\nSet-SPOSite -Identity <SiteUrl> -DenyAddAndCustomizePages $true\nNote: The property DenyAddAndCustomizePages cannot be set on the MySite host,\nwhich is displayed with a URL like https://tenant id-my.sharepoint.com/",
        "default_value": "DenyAddAndCustomizePages $true or Enabled",
        "references": "1. https://learn.microsoft.com/en-us/sharepoint/allow-or-prevent-custom-script\n2. https://learn.microsoft.com/en-us/sharepoint/security-considerations-of-allowing-\ncustom-script\n3. https://learn.microsoft.com/en-us/powershell/module/sharepoint-online/set-\nsposite?view=sharepoint-ps\nPage 336"
    },
    {
        "id": "8.1",
        "title": "Teams",
        "profile": "• E3 Level 1",
        "description": "Exchange Online Protection (EOP) is the cloud-based filtering service that protects\norganizations against spam, malware, and other email threats. EOP is included in all\nMicrosoft 365 organizations with Exchange Online mailboxes.\nEOP uses flexible anti-malware policies for malware protection settings. These policies\ncan be set to notify Admins of malicious activity.",
        "rationale": "This setting alerts administrators that an internal user sent a message that contained\nmalware. This may indicate an account or machine compromise that would need to be\ninvestigated.",
        "impact": "Notification of account with potential issues should not have an impact on the user.\nPage 69",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft 365 Defender https://security.microsoft.com.\n2. Click to expand E-mail & Collaboration select Policies & rules.\n3. On the Policies & rules page select Threat policies.\n4. Under Policies select Anti-malware.\n5. Click on the Default (Default) policy.\n6. Ensure the setting Notify an admin about undelivered messages from\ninternal senders is set to On and that there is at least one email address\nunder Administrator email address.\nTo audit using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following command:\nGet-MalwareFilterPolicy | fl Identity,\nEnableInternalSenderAdminNotifications, InternalSenderAdminAddress\nNote: Audit and Remediation guidance may focus on the Default policy however, if a\nCustom Policy exists in the organization's tenant, then ensure the setting is set as\noutlined in the highest priority policy listed.\nPage 70",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft 365 Defender https://security.microsoft.com.\n2. Click to expand E-mail & Collaboration select Policies & rules.\n3. On the Policies & rules page select Threat policies.\n4. Under Policies select Anti-malware.\n5. Click on the Default (Default) policy.\n6. Click on Edit protection settings and change the settings for Notify an\nadmin about undelivered messages from internal senders to On and\nenter the email address of the administrator who should be notified under\nAdministrator email address.\n7. Click Save.\nTo remediate using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following command:\nSet-MalwareFilterPolicy -Identity '{Identity Name}' -\nEnableInternalSenderAdminNotifications $True -InternalSenderAdminAddress\n{admin@domain1.com}\nNote: Audit and Remediation guidance may focus on the Default policy however, if a\nCustom Policy exists in the organization's tenant, then ensure the setting is set as\noutlined in the highest priority policy listed.",
        "default_value": "EnableInternalSenderAdminNotifications : False\nInternalSenderAdminAddress : $null\nPage 71",
        "references": "1. https://learn.microsoft.com/en-us/defender-office-365/anti-malware-protection-\nabout\n2. https://learn.microsoft.com/en-us/defender-office-365/anti-malware-policies-\nconfigure"
    },
    {
        "id": "8.1.1",
        "title": "(L2) Ensure external file sharing in Teams is enabled for only approved cloud storage\nservices (Automated)",
        "profile": "• E3 Level 2",
        "description": "Microsoft Teams enables collaboration via file sharing. This file sharing is conducted\nwithin Teams, using SharePoint Online, by default; however, third-party cloud services\nare allowed as well.\nNote: Skype for business is deprecated as of July 31, 2021 although these settings may\nstill be valid for a period of time. See the link in the references section for more\ninformation.",
        "rationale": "Ensuring that only authorized cloud storage providers are accessible from Teams will\nhelp to dissuade the use of non-approved storage providers.",
        "impact": "The impact associated with this change is highly dependent upon current practices in\nthe tenant. If users do not use other storage providers, then minimal impact is likely.\nHowever, if users do regularly utilize providers outside of the tenant this will affect their\nability to continue to do so.\nPage 340",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Teams admin center\nhttps://admin.teams.microsoft.com.\n2. Click to expand Teams select Teams settings.\n3. Under files verify that only authorized cloud storage options are set to On and all\nothers Off.\nTo audit using PowerShell:\n1. Connect to Teams PowerShell using Connect-MicrosoftTeams\n2. Run the following to verify the recommended state:\nGet-CsTeamsClientConfiguration | fl\nAllowDropbox,AllowBox,AllowGoogleDrive,AllowShareFile,AllowEgnyte\n3. Verify that only authorized providers are set to True and all others False.",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Teams admin center\nhttps://admin.teams.microsoft.com.\n2. Click to expand Teams select Teams settings.\n3. Set any unauthorized providers to Off.\nTo remediate using PowerShell:\n1. Connect to Teams PowerShell using Connect-MicrosoftTeams\n2. Run the following PowerShell command to disable external providers that are not\nauthorized. (the example disables Citrix Files, DropBox, Box, Google Drive and\nEgnyte)\n$storageParams = @{\nAllowGoogleDrive = $false\nAllowShareFile = $false\nAllowBox = $false\nAllowDropBox = $false\nAllowEgnyte = $false\n}\nSet-CsTeamsClientConfiguration @storageParams\nPage 341",
        "default_value": "AllowDropBox : True\nAllowBox : True\nAllowGoogleDrive : True\nAllowShareFile : True\nAllowEgnyte : True",
        "references": "1. https://learn.microsoft.com/en-us/microsoft-365/enterprise/manage-skype-for-\nbusiness-online-with-microsoft-365-powershell?view=o365-worldwide"
    },
    {
        "id": "8.1.2",
        "title": "(L1) Ensure users can't send emails to a channel email address (Automated)",
        "profile": "• E3 Level 1",
        "description": "Teams channel email addresses are an optional feature that allows users to email the\nTeams channel directly.",
        "rationale": "Channel email addresses are not under the tenant’s domain and organizations do not\nhave control over the security settings for this email address. An attacker could email\nchannels directly if they discover the channel email address.",
        "impact": "Users will not be able to email the channel directly.",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Teams admin center\nhttps://admin.teams.microsoft.com.\n2. Click to expand Teams select Teams settings.\n3. Under email integration verify that Users can send emails to a channel\nemail address is Off.\nTo audit using PowerShell:\n1. Connect to Teams PowerShell using Connect-MicrosoftTeams.\n2. Run the following command to verify the recommended state:\nGet-CsTeamsClientConfiguration -Identity Global | fl AllowEmailIntoChannel\n3. Ensure the returned value is False.\nPage 343",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Teams admin center\nhttps://admin.teams.microsoft.com.\n2. Click to expand Teams select Teams settings.\n3. Under email integration set Users can send emails to a channel email\naddress to Off.\nTo remediate using PowerShell:\n1. Connect to Teams PowerShell using Connect-MicrosoftTeams.\n2. Run the following command to set the recommended state:\nSet-CsTeamsClientConfiguration -Identity Global -AllowEmailIntoChannel $false",
        "default_value": "On (True)",
        "references": "1. https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/step-\nby-step-guides/reducing-attack-surface-in-microsoft-teams?view=o365-\nworldwide#restricting-channel-email-messages-to-approved-domains\n2. https://learn.microsoft.com/en-us/powershell/module/skype/set-\ncsteamsclientconfiguration?view=skype-ps\n3. https://support.microsoft.com/en-us/office/send-an-email-to-a-channel-in-\nmicrosoft-teams-d91db004-d9d7-4a47-82e6-fb1b16dfd51e"
    },
    {
        "id": "8.2",
        "title": "Users",
        "profile": "• E3 Level 1",
        "description": "Data Loss Prevention (DLP) policies allow Exchange Online and SharePoint Online\ncontent to be scanned for specific types of data like social security numbers, credit card\nnumbers, or passwords.",
        "rationale": "Enabling DLP policies alerts users and administrators that specific types of data should\nnot be exposed, helping to protect the data from accidental exposure.",
        "impact": "Enabling a Teams DLP policy will allow sensitive data in Exchange Online and\nSharePoint Online to be detected or blocked. Always ensure to follow appropriate\nprocedures during testing and implementation of DLP policies based on organizational\nstandards.",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Purview https://compliance.microsoft.com.\n2. Under Solutions select Data loss prevention then Policies.\n3. Verify that policies exist and are enabled.",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Purview https://compliance.microsoft.com.\n2. Under Solutions select Data loss prevention then Policies.\n3. Click Create policy.\nReferences:\n1. https://learn.microsoft.com/en-us/purview/dlp-learn-about-dlp?view=o365-\nworldwide\nPage 131\nCIS Controls:\nControls\nControl IG 1 IG 2 IG 3\nVersion\n3.1 Establish and Maintain a Data Management Process\nEstablish and maintain a data management process. In the process, address\nv8 data sensitivity, data owner, handling of data, data retention limits, and disposal ● ● ●\nrequirements, based on sensitivity and retention standards for the enterprise.\nReview and update documentation annually, or when significant enterprise changes\noccur that could impact this Safeguard.\nv7\n13 Data Protection\nData Protection\n14.7 Enforce Access Control to Data through Automated\nv7 Tools ●\nUse an automated tool, such as host-based Data Loss Prevention, to enforce\naccess controls to data even when data is copied off a system.\nPage 132\n3.2.2 (L1) Ensure DLP policies are enabled for Microsoft Teams\n(Manual)\nProfile Applicability:\n• E5 Level 1\nDescription:\nThe default Teams Data Loss Prevention (DLP) policy rule in Microsoft 365 is a\npreconfigured rule that is automatically applied to all Teams conversations and\nchannels. The default rule helps prevent accidental sharing of sensitive information by\ndetecting and blocking certain types of content that are deemed sensitive or\ninappropriate by the organization.\nBy default, the rule includes a check for the sensitive info type Credit Card Number\nwhich is pre-defined by Microsoft.\nRationale:\nEnabling the default Teams DLP policy rule in Microsoft 365 helps protect an\norganization's sensitive information by preventing accidental sharing or leakage Credit\nCard information in Teams conversations and channels.\nDLP rules are not one size fits all, but at a minimum something should be defined. The\norganization should identify sensitive information important to them and seek to\nintercept it using DLP.\nImpact:\nEnd-users may be prevented from sharing certain types of content, which may require\nthem to adjust their behavior or seek permission from administrators to share specific\ncontent. Administrators may receive requests from end-users for permission to share\ncertain types of content or to modify the policy to better fit the needs of their teams.\nPage 133\nAudit:\nTo audit the using the UI:\n1. Navigate to Microsoft Purview compliance portal\nhttps://compliance.microsoft.com.\n2. Under Solutions select Data loss prevention then Policies.\n3. Locate the Default policy for Teams.\n4. Verify the Status is On.\n5. Verify Locations include Teams chat and channel messages - All\naccounts.\n6. Verify Policy settings incudes the Default Teams DLP policy rule or one\nspecific to the organization.\nNote: If there is not a default policy for teams inspect existing policies starting with step\n4. DLP rules are specific to the organization and each organization should take steps to\nprotect the data that matters to them. The default teams DLP rule will only alert on\nCredit Card matches.\nTo audit using PowerShell:\n1. Connect to the Security & Compliance PowerShell using Connect-IPPSSession.\n2. Run the following to return policies that include Teams chat and channel\nmessages:\n$DlpPolicy = Get-DlpCompliancePolicy\n$DlpPolicy | Where-Object {$_.Workload -match \"Teams\"} |\nft Name,Mode,TeamsLocation*\n3. If nothing returns, then there are no policies that include Teams and remediation\nis required.\n4. For any returned policy verify Mode is set to Enable.\n5. Verify TeamsLocation includes All.\n6. Verify TeamsLocationException includes only permitted exceptions.\nNote: Some tenants may not have a default policy for teams as Microsoft started\ncreating these by default at a particular point in time. In this case a new policy will have\nto be created that includes a rule to protect data important to the organization such as\ncredit cards and PII.\nPage 134\nRemediation:\nTo remediate using the UI:\n1. Navigate to Microsoft Purview compliance portal\nhttps://compliance.microsoft.com.\n2. Under Solutions select Data loss prevention then Policies.\n3. Click Policies tab.\n4. Check Default policy for Teams then click Edit policy.\n5. The edit policy window will appear click Next\n6. At the Choose locations to apply the policy page, turn the status toggle\nto On for Teams chat and channel messages location and then click Next.\n7. On Customized advanced DLP rules page, ensure the Default Teams DLP\npolicy rule Status is On and click Next.\n8. On the Policy mode page, select the radial for Turn it on right away and\nclick Next.\n9. Review all the settings for the created policy on the Review your policy and\ncreate it page, and then click submit.\n10. Once the policy has been successfully submitted click Done.\nNote: Some tenants may not have a default policy for teams as Microsoft started\ncreating these by default at a particular point in time. In this case a new policy will have\nto be created that includes a rule to protect data important to the organization such as\ncredit cards and PII.",
        "default_value": "Enabled (On)",
        "references": "1. https://learn.microsoft.com/en-us/purview/dlp-learn-about-dlp?view=o365-\nworldwide\nPage 131"
    },
    {
        "id": "8.2.1",
        "title": "(L2) Ensure external domains are restricted in the Teams admin center (Automated)",
        "profile": "• E3 Level 2",
        "description": "This policy controls whether external domains are allowed, blocked or permitted based\non an allowlist or denylist. When external domains are allowed, users in your\norganization can chat, add users to meetings, and use audio video conferencing with\nusers in external organizations.\nThe recommended state is Allow only specific external domains or Block all\nexternal domains.",
        "rationale": "Allowlisting external domains that an organization is collaborating with allows for\nstringent controls over who an organization's users are allowed to make contact with.\nSome real-world attacks and exploits delivered via Teams over external access\nchannels include:\n• DarkGate malware\n• Social engineering / Phishing attacks by \"Midnight Blizzard\"\n• GIFShell\n• Username enumeration",
        "impact": "The impact in terms of the type of collaboration users are allowed to participate in and\nthe I.T. resources expended to manage an allowlist will increase. If a user attempts to\njoin the inviting organization's meeting they will be prevented from joining unless they\nwere created as a guest in EntraID or their domain was added to the allowed external\ndomains list.\nPage 346",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Teams admin center\nhttps://admin.teams.microsoft.com/.\n2. Click to expand Users select External access.\n3. Under Teams and Skype for Business users in external organization ensure\nChoose which external domains your users have access to is set to one\nof the following:\no Allow only specific external domains\no Block all external domains\nTo audit using PowerShell:\n1. Connect to Teams PowerShell using Connect-MicrosoftTeams\n2. Run the following command:\nGet-CsTenantFederationConfiguration | fl AllowFederatedUsers,AllowedDomains\nEnsure the following conditions:\n• State: AllowFederatedUsers is set to False OR,\n• If: AllowFederatedUsers is True then ensure AllowedDomains contains\nauthorized domain names and is not set to AllowAllKnownDomains.\nPage 347",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Teams admin center\nhttps://admin.teams.microsoft.com/.\n2. Click to expand Users select External access.\n3. Under Teams and Skype for Business users in external organizations set\nChoose which external domains your users have access to to one of\nthe following:\no\nAllow only specific external domains\no\nBlock all external domains\n4. Click Save.\nTo remediate using PowerShell:\n1. Connect to Teams PowerShell using Connect-MicrosoftTeams\n2. Run one of the following commands:\n• To allow only specific external domains run these commands replacing the\nexample domains with approved domains:\n$list = New-Object Collections.Generic.List[String]\n$list.add(\"contoso.com\")\n$list.add(\"fabrikam.com\")\nSet-CsTenantFederationConfiguration -AllowFederatedUsers $true -\nAllowedDomainsAsAList $list\n• To block all external domains:\nSet-CsTenantFederationConfiguration -AllowFederatedUsers $false",
        "default_value": "• AllowFederatedUsers : True\n• AllowedDomains : AllowAllKnownDomains\nPage 348",
        "references": "1. https://learn.microsoft.com/en-us/microsoftteams/trusted-organizations-external-\nmeetings-chat?tabs=organization-settings\n2. https://cybersecurity.att.com/blogs/security-essentials/darkgate-malware-\ndelivered-via-microsoft-teams-detection-and-response\n3. https://www.microsoft.com/en-us/security/blog/2023/08/02/midnight-blizzard-\nconducts-targeted-social-engineering-over-microsoft-teams/\n4. https://www.bitdefender.com/blog/hotforsecurity/gifshell-attack-lets-hackers-\ncreate-reverse-shell-through-microsoft-teams-gifs/"
    },
    {
        "id": "8.2.2",
        "title": "(L1) Ensure communication with unmanaged Teams users is disabled (Automated)",
        "profile": "• E3 Level 1",
        "description": "This policy setting controls chats and meetings with external unmanaged Teams users\n(those not managed by an organization, such as Microsoft Teams (free)).\nThe recommended state is: People in my organization can communicate with\nTeams users whose accounts aren't managed by an organization set to Off.",
        "rationale": "Allowing users to communicate with unmanaged Teams users presents a potential\nsecurity threat as little effort is required by threat actors to gain access to a trial or free\nMicrosoft Teams account.\nSome real-world attacks and exploits delivered via Teams over external access\nchannels include:\n• DarkGate malware\n• Social engineering / Phishing attacks by \"Midnight Blizzard\"\n• GIFShell\n• Username enumeration",
        "impact": "Users will be unable to communicate with Teams users who are not managed by an\norganization.\nNote: The settings that govern chats and meetings with external unmanaged Teams\nusers aren't available in GCC, GCC High, or DOD deployments, or in private cloud\nenvironments.\nPage 350",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Teams admin center\nhttps://admin.teams.microsoft.com/.\n2. Click to expand Users select External access.\n3. Scroll to Teams accounts not managed by an organization\n4. Ensure People in my organization can communicate with Teams users\nwhose accounts aren't managed by an organization is set to Off.\nTo audit using PowerShell:\n1. Connect to Teams PowerShell using Connect-MicrosoftTeams\n2. Run the following command:\nGet-CsTenantFederationConfiguration | fl AllowTeamsConsumer\nEnsure AllowTeamsConsumer is False",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Teams admin center\nhttps://admin.teams.microsoft.com/.\n2. Click to expand Users select External access.\n3. Scroll to Teams accounts not managed by an organization\n4. Set People in my organization can communicate with Teams users\nwhose accounts aren't managed by an organization to Off.\n5. Click Save.\nTo remediate using PowerShell:\n1. Connect to Teams PowerShell using Connect-MicrosoftTeams\n2. Run the following command:\nSet-CsTenantFederationConfiguration -AllowTeamsConsumer $false",
        "default_value": "• AllowTeamsConsumer : True\nPage 351",
        "references": "1. https://learn.microsoft.com/en-us/microsoftteams/trusted-organizations-external-\nmeetings-chat?tabs=organization-settings\n2. https://cybersecurity.att.com/blogs/security-essentials/darkgate-malware-\ndelivered-via-microsoft-teams-detection-and-response\n3. https://www.microsoft.com/en-us/security/blog/2023/08/02/midnight-blizzard-\nconducts-targeted-social-engineering-over-microsoft-teams/\n4. https://www.bitdefender.com/blog/hotforsecurity/gifshell-attack-lets-hackers-\ncreate-reverse-shell-through-microsoft-teams-gifs/"
    },
    {
        "id": "8.2.3",
        "title": "(L1) Ensure external Teams users cannot initiate conversations (Automated)",
        "profile": "• E3 Level 1",
        "description": "This setting prevents external users who are not managed by an organization from\ninitiating contact with users in the protected organization.\nThe recommended state is to uncheck External users with Teams accounts not\nmanaged by an organization can contact users in my organization.\nNote: Disabling this setting is used as an additional stop gap for the previous setting\nwhich disables communication with unmanaged Teams users entirely. If an organization\nchooses to have an exception to (L1) Ensure communication with unmanaged\nTeams users is disabled they can do so while also disabling the ability for the same\ngroup of users to initiate contact. Disabling communication entirely will also disable the\nability for unmanaged users to initiate contact.",
        "rationale": "Allowing users to communicate with unmanaged Teams users presents a potential\nsecurity threat as little effort is required by threat actors to gain access to a trial or free\nMicrosoft Teams account.\nSome real-world attacks and exploits delivered via Teams over external access\nchannels include:\n• DarkGate malware\n• Social engineering / Phishing attacks by \"Midnight Blizzard\"\n• GIFShell\n• Username enumeration",
        "impact": "The impact of disabling this is very low.\nNote: Chats and meetings with external unmanaged Teams users isn't available in\nGCC, GCC High, or DOD deployments, or in private cloud environments.\nPage 353",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Teams admin center\nhttps://admin.teams.microsoft.com/.\n2. Click to expand Users select External access.\n3. Scroll to Teams accounts not managed by an organization\n4. Ensure External users with Teams accounts not managed by an\norganization can contact users in my organization is set to\nUnchecked.\nNote: If People in my organization can communicate with Teams users whose\naccounts aren't managed by an organization is already set to Off then this\nsetting will not be visible and can be considered to be in a passing state.\nTo audit using PowerShell:\n1. Connect to Teams PowerShell using Connect-MicrosoftTeams\n2. Run the following command:\nGet-CsTenantFederationConfiguration | fl AllowTeamsConsumerInbound\nEnsure AllowTeamsConsumerInbound is False\nNote: If the previous setting AllowTeamsConsumer is already false then this setting is\nignored and can be considered to be in a passing state.\nPage 354",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Teams admin center\nhttps://admin.teams.microsoft.com/.\n2. Click to expand Users select External access.\n3. Scroll to Teams accounts not managed by an organization\n4. Uncheck External users with Teams accounts not managed by an\norganization can contact users in my organization.\n5. Click Save.\nNote: If People in my organization can communicate with Teams users whose\naccounts aren't managed by an organization is already set to Off then this\nsetting will not be visible and can be considered to be in a passing state.\nTo remediate using PowerShell:\n1. Connect to Teams PowerShell using Connect-MicrosoftTeams\n2. Run the following command:\nSet-CsTenantFederationConfiguration -AllowTeamsConsumerInbound $false",
        "default_value": "• AllowTeamsConsumerInbound : True",
        "references": "1. https://learn.microsoft.com/en-us/microsoftteams/trusted-organizations-external-\nmeetings-chat?tabs=organization-settings\n2. https://cybersecurity.att.com/blogs/security-essentials/darkgate-malware-\ndelivered-via-microsoft-teams-detection-and-response\n3. https://www.microsoft.com/en-us/security/blog/2023/08/02/midnight-blizzard-\nconducts-targeted-social-engineering-over-microsoft-teams/\n4. https://www.bitdefender.com/blog/hotforsecurity/gifshell-attack-lets-hackers-\ncreate-reverse-shell-through-microsoft-teams-gifs/"
    },
    {
        "id": "8.2.4",
        "title": "(L1) Ensure communication with Skype users is disabled (Automated)",
        "profile": "• E3 Level 1",
        "description": "This policy setting controls chat with external unmanaged Skype users.\nNote: Skype for business is deprecated as of July 31, 2021, although these settings\nmay still be valid for a period of time. See the link in the reference section for more\ninformation.",
        "rationale": "Skype was deprecated July 31, 2021. Disabling communication with skype users\nreduces the attack surface of the organization. If a partner organization or satellite office\nwishes to collaborate and has not yet moved off of Skype, then a valid exception will\nneed to be considered for this recommendation.",
        "impact": "Teams users will be unable to communicate with Skype users that are not in the same\norganization.",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Teams admin center\nhttps://admin.teams.microsoft.com/.\n2. Click to expand Users select External access.\n3. Locate Skype users\n4. Ensure Allow users in my organization to communicate with Skype\nusers is Off.\nTo audit using PowerShell:\n1. Connect to Teams PowerShell using Connect-MicrosoftTeams\n2. Run the following command:\nGet-CsTenantFederationConfiguration | fl AllowPublicUsers\nEnsure AllowPublicUsers is False\nPage 356",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Teams admin center\nhttps://admin.teams.microsoft.com/.\n2. Click to expand Users select External access.\n3. Locate Skype users\n4. Set Allow users in my organization to communicate with Skype users\nto Off.\n5. Click Save.\nTo remediate using PowerShell:\n• Connect to Teams PowerShell using Connect-MicrosoftTeams\n• Run the following command:\nSet-CsTenantFederationConfiguration -AllowPublicUsers $false",
        "default_value": "• AllowPublicUsers : True",
        "references": "1. https://learn.microsoft.com/en-us/microsoftteams/trusted-organizations-external-\nmeetings-chat\n2. https://learn.microsoft.com/en-US/microsoftteams/manage-external-\naccess?WT.mc_id=TeamsAdminCenterCSH"
    },
    {
        "id": "8.3",
        "title": "Teams devices",
        "profile": "• E3 Level 2",
        "description": "B2B collaboration is a feature within Microsoft Entra External ID that allows for guest\ninvitations to an organization.\nEnsure users can only send invitations to specified domains.\nNote: This list works independently from OneDrive for Business and SharePoint Online\nallow/block lists. To restrict individual file sharing in SharePoint Online, set up an allow\nor blocklist for OneDrive for Business and SharePoint Online. For instance, in\nSharePoint or OneDrive users can still share with external users from prohibited\ndomains by using Anyone links if they haven't been disabled.",
        "rationale": "By specifying allowed domains for collaborations, external user's companies are\nexplicitly identified. Also, this prevents internal users from inviting unknown external\nusers such as personal accounts and granting them access to resources.",
        "impact": "This could make harder collaboration if the setting is not quickly updated when a new\ndomain is identified as \"allowed\".",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Identity > External Identities select External\ncollaboration settings.\n3. Under Collaboration restrictions, verify that Allow invitations only to\nthe specified domains (most restrictive) is selected. Then verify\nallowed domains are specified under Target domains.\nPage 171",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Identity > External Identities select External\ncollaboration settings.\n3. Under Collaboration restrictions, select Allow invitations only to the\nspecified domains (most restrictive) is selected. Then specify the\nallowed domains under Target domains.",
        "default_value": "Allow invitations to be sent to any domain (most inclusive)",
        "references": "1. https://learn.microsoft.com/en-us/entra/external-id/allow-deny-list\n2. https://learn.microsoft.com/en-us/entra/external-id/what-is-b2b"
    },
    {
        "id": "8.4",
        "title": "Teams apps",
        "profile": "• E3 Level 1",
        "description": "Non-privileged users can create tenants in the Entra administration portal under\nManage tenant. The creation of a tenant is recorded in the Audit log as category\n\"DirectoryManagement\" and activity \"Create Company\". Anyone who creates a tenant\nbecomes the Global Administrator of that tenant. The newly created tenant doesn't\ninherit any settings or configurations.",
        "rationale": "Restricting tenant creation prevents unauthorized or uncontrolled deployment of\nresources and ensures that the organization retains control over its infrastructure. User\ngeneration of shadow IT could lead to multiple, disjointed environments that can make it\ndifficult for IT to manage and secure the organization's data, especially if other users in\nthe organization began using these tenants for business purposes under the\nmisunderstanding that they were secured by the organization's security team.",
        "impact": "Non-admin users will need to contact I.T. if they have a valid reason to create a tenant.",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/\n2. Click to expand Identity> Users > User settings.\n3. Ensure Restrict non-admin users from creating tenants is set to Yes\nTo audit using PowerShell:\n1. Connect to Microsoft Graph using Connect-MgGraph -Scopes\n\"Policy.Read.All\"\n2. Run the following commands:\n(Get-MgPolicyAuthorizationPolicy).DefaultUserRolePermissions |\nSelect-Object AllowedToCreateTenants\n3. Ensure the returned value is False\nPage 152",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/\n2. Click to expand Identity> Users > User settings.\n3. Set Restrict non-admin users from creating tenants to Yes then Save.\nTo remediate using PowerShell:\n1. Connect to Microsoft Graph using Connect-MgGraph -Scopes\n\"Policy.ReadWrite.Authorization\"\n2. Run the following commands:\n# Create hashtable and update the auth policy\n$params = @{ AllowedToCreateTenants = $false }\nUpdate-MgPolicyAuthorizationPolicy -DefaultUserRolePermissions $params",
        "default_value": "No - Non-administrators can create tenants.\nAllowedToCreateTenants is True",
        "references": "1. https://learn.microsoft.com/en-us/entra/fundamentals/users-default-\npermissions#restrict-member-users-default-permissions"
    },
    {
        "id": "8.4.1",
        "title": "(L1) Ensure app permission policies are configured (Manual)",
        "profile": "• E3 Level 1",
        "description": "This policy setting controls which class of apps are available for users to install.",
        "rationale": "Allowing users to install third-party or unverified apps poses a potential risk of\nintroducing malicious software to the environment.",
        "impact": "Users will only be able to install approved classes of apps.",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Teams admin center\nhttps://admin.teams.microsoft.com.\n2. Click to expand Teams apps select Manage apps.\n3. In the upper right click Actions > Org-wide app settings.\n4. For Microsoft apps verify that Let users install and use available\napps by default is On or less permissive.\n5. For Third-party apps verify Let users install and use available apps\nby default is Off.\n6. For Custom apps verify Let users install and use available apps by\ndefault is Off.\n7. For Custom apps verify Upload custom apps for personal use is Off.\nNote: The Global Reader role is not able to view the Teams apps blade, Teams\nAdministrator or higher is required.\nPage 359",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Teams admin center\nhttps://admin.teams.microsoft.com.\n2. Click to expand Teams apps select Manage apps.\n3. In the upper right click Actions > Org-wide app settings.\n4. For Microsoft apps set Let users install and use available apps by\ndefault to On or less permissive.\n5. For Third-party apps set Let users install and use available apps\nby default to Off.\n6. For Custom apps set Let users install and use available apps by\ndefault to Off.\n7. For Custom apps set Upload custom apps for personal use to Off.",
        "default_value": "Microsoft apps: On\nThird-party apps: On\nCustom apps: On",
        "references": "1. https://learn.microsoft.com/en-us/microsoftteams/app-centric-management\n2. https://learn.microsoft.com/en-us/defender-office-365/step-by-step-\nguides/reducing-attack-surface-in-microsoft-teams?view=o365-\nworldwide#disabling-third-party--custom-apps"
    },
    {
        "id": "8.5",
        "title": "Meetings",
        "profile": "• E3 Level 1",
        "description": "Exchange Online offers several methods of managing the flow of email messages.\nThese are Remote domain, Transport Rules, and Anti-spam outbound policies. These\nmethods work together to provide comprehensive coverage for potential automatic\nforwarding channels:\n• Outlook forwarding using inbox rules.\n• Outlook forwarding configured using OOF rule.\n• OWA forwarding setting (ForwardingSmtpAddress).\n• Forwarding set by the admin using EAC (ForwardingAddress).\n• Forwarding using Power Automate / Flow.\nEnsure a Transport rule and Anti-spam outbound policy are used to block mail\nforwarding.\nNOTE: Any exclusions should be implemented based on organizational policy.",
        "rationale": "Attackers often create these rules to exfiltrate data from your tenancy, this could be\naccomplished via access to an end-user account or otherwise. An insider could also use\none of these methods as a secondary channel to exfiltrate sensitive data.",
        "impact": "Care should be taken before implementation to ensure there is no business need for\ncase-by-case auto-forwarding. Disabling auto-forwarding to remote domains will affect\nall users and in an organization. Any exclusions should be implemented based on\norganizational policy.\nPage 275",
        "audit": "Note: Audit is a two step procedure as follows:\nSTEP 1: Transport rules\nTo audit using the UI:\n1. Select Exchange to open the Exchange admin center.\n2. Select Mail Flow then Rules.\n3. Review the rules and verify that none of them are forwards or redirects e-mail to\nexternal domains.\nTo audit using PowerShell:\n1. Connect to Exchange online using Connect-ExchangeOnline.\n2. Run the following PowerShell command to review the Transport Rules that are\nredirecting email:\nGet-TransportRule | Where-Object {$_.RedirectMessageTo -ne $null} | ft\nName,RedirectMessageTo\n3. Verify that none of the addresses listed belong to external domains outside of the\norganization. If nothing returns then there are no transport rules set to redirect\nmessages.\nSTEP 2: Anti-spam outbound policy\nTo audit using the UI:\n1. Navigate to Microsoft 365 Defender https://security.microsoft.com/\n2. Expand E-mail & collaboration then select Policies & rules.\n3. Select Threat policies > Anti-spam.\n4. Inspect Anti-spam outbound policy (default) and ensure Automatic\nforwarding is set to Off - Forwarding is disabled\n5. Inspect any additional custom outbound policies and ensure Automatic\nforwarding is set to Off - Forwarding is disabled, in accordance with the\norganization's exclusion policies.\nPage 276\nTo audit using PowerShell:\n1. Connect to Exchange online using Connect-ExchangeOnline.\n2. Run the following PowerShell cmdlet:\nGet-HostedOutboundSpamFilterPolicy | ft Name, AutoForwardingMode\n3. In each outbound policy verify AutoForwardingMode is Off.\nNote: According to Microsoft if a recipient is defined in multiple policies of the same\ntype (anti-spam, anti-phishing, etc.), only the policy with the highest priority is applied to\nthe recipient. Any remaining policies of that type are not evaluated for the recipient\n(including the default policy). However, it is our recommendation to audit the default\npolicy as well in the case a higher priority custom policy is removed. This will keep the\norganization's security posture strong.\nPage 277",
        "remediation": "Note: Remediation is a two step procedure as follows:\nSTEP 1: Transport rules\nTo remediate using the UI:\n1. Select Exchange to open the Exchange admin center.\n2. Select Mail Flow then Rules.\n3. For each rule that redirects email to external domains, select the rule and click\nthe 'Delete' icon.\nTo remediate using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\nRemove-TransportRule {RuleName}\nSTEP 2: Anti-spam outbound policy\nTo remediate using the UI:\n1. Navigate to Microsoft 365 Defender https://security.microsoft.com/\n2. Expand E-mail & collaboration then select Policies & rules.\n3. Select Threat policies > Anti-spam.\n4. Select Anti-spam outbound policy (default)\n5. Click Edit protection settings\n6. Set Automatic forwarding rules dropdown to Off - Forwarding is\ndisabled and click Save\n7. Repeat steps 4-6 for any additional higher priority, custom policies.\nPage 278\nTo remediate using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\nSet-HostedOutboundSpamFilterPolicy -Identity {policyName} -AutoForwardingMode\nOff\n3. To remove AutoForwarding from all outbound policies you can also run:\nGet-HostedOutboundSpamFilterPolicy | Set-HostedOutboundSpamFilterPolicy -\nAutoForwardingMode Off\nReferences:\n1. https://learn.microsoft.com/en-us/exchange/security-and-compliance/mail-flow-\nrules/mail-flow-rules\n2. https://techcommunity.microsoft.com/t5/exchange-team-blog/all-you-need-to-\nknow-about-automatic-email-forwarding-in/ba-\np/2074888#:~:text=%20%20%20Automatic%20forwarding%20option%20%20,%\n3. https://learn.microsoft.com/en-us/defender-office-365/outbound-spam-policies-\nexternal-email-forwarding?view=o365-worldwide\nCIS Controls:\nControls Version Control IG 1 IG 2 IG 3\nv8\n0.0 Explicitly Not Mapped\nExplicitly Not Mapped\nPage 279\n6.2.2 (L1) Ensure mail transport rules do not whitelist specific\ndomains (Automated)\nProfile Applicability:\n• E3 Level 1\nDescription:\nMail flow rules (transport rules) in Exchange Online are used to identify and take action\non messages that flow through the organization.\nRationale:\nWhitelisting domains in transport rules bypasses regular malware and phishing\nscanning, which can enable an attacker to launch attacks against your users from a\nsafe haven domain.\nImpact:\nCare should be taken before implementation to ensure there is no business need for\ncase-by-case whitelisting. Removing all whitelisted domains could affect incoming mail\nflow to an organization although modern systems sending legitimate mail should have\nno issue with this.\nAudit:\nTo audit using the UI:\n1. Navigate to Exchange admin center https://admin.exchange.microsoft.com..\n2. Click to expand Mail Flow and then select Rules.\n3. Review the rules and verify that none of them whitelist any specific domains.\nTo audit using PowerShell:\n1. Connect to Exchange online using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\nGet-TransportRule | Where-Object {($_.setscl -eq -1 -and $_.SenderDomainIs -\nne $null)} | ft Name,SenderDomainIs\nPage 280\nRemediation:\nTo remediate using the UI:\n1. Navigate to Exchange admin center https://admin.exchange.microsoft.com..\n2. Click to expand Mail Flow and then select Rules.\n3. For each rule that whitelists specific domains, select the rule and click the\n'Delete' icon.\nTo remediate using PowerShell:\n1. Connect to Exchange online using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\nRemove-TransportRule {RuleName}\n3. Verify the rules no longer exists.\nGet-TransportRule | Where-Object {($_.setscl -eq -1 -and $_.SenderDomainIs -\nne $null)} | ft Name,SenderDomainIs\nReferences:\n1. https://learn.microsoft.com/en-us/exchange/security-and-compliance/mail-flow-\nrules/configuration-best-practices\n2. https://learn.microsoft.com/en-us/exchange/security-and-compliance/mail-flow-\nrules/mail-flow-rules\nCIS Controls:\nControls Version Control IG 1 IG 2 IG 3\nv8\n0.0 Explicitly Not Mapped\nExplicitly Not Mapped\nPage 281\n6.2.3 (L1) Ensure email from external senders is identified\n(Automated)\nProfile Applicability:\n• E3 Level 1\nDescription:\nExternal callouts provide a native experience to identify emails from senders outside the\norganization. This is achieved by presenting a new tag on emails called \"External\" (the\nstring is localized based on the client language setting) and exposing related user\ninterface at the top of the message reading view to see and verify the real sender's\nemail address.\nOnce this feature is enabled via PowerShell, it might take 24-48 hours for users to start\nseeing the External sender tag in email messages received from external sources\n(outside of your organization), providing their Outlook version supports it.\nThe recommended state is ExternalInOutlook set to Enabled True\nNote: Mail flow rules are often used by Exchange administrators to accomplish the\nExternal email tagging by appending a tag to the front of a subject line. There are\nlimitations to this outlined here. The preferred method in the CIS Benchmark is to use\nthe native experience.\nRationale:\nTagging emails from external senders helps to inform end users about the origin of the\nemail. This can allow them to proceed with more caution and make informed decisions\nwhen it comes to identifying spam or phishing emails.\nNote: Existing emails in a user's inbox from external senders are not tagged\nretroactively.\nImpact:\nMail flow rules using external tagging will need to be disabled before enabling this to\navoid duplicate [External] tags.\nThe Outlook desktop client is the last to receive this update and the feature is only\navailable for certain versions see below:\nOutlook for Windows: Update 4/26/23: External Tag view in Outlook for Windows\n(matching other clients) released to production for Current Channel and Monthly\nEnterprise Channel in Version 2211 for builds 15831.20190 and higher. We anticipate\nthe External tag to reach Semi-Annual Preview Channel with Version 2308 on the\nSeptember 12th 2023 public update and reach Semi-Annual Enterprise Channel with\nVersion 2308 with the January 9th 2024 public update.\nPage 282\nAudit:\nTo audit using PowerShell:\n1. Connect to Exchange online using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\nGet-ExternalInOutlook\n3. For each identity verify Enabled is set to True and the AllowList only contains\nemail addresses the organization has permitted to bypass external tagging.\nRemediation:\nTo remediate using PowerShell:\n1. Connect to Exchange online using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\nSet-ExternalInOutlook -Enabled $true",
        "default_value": "Disabled (False)",
        "references": "1. https://learn.microsoft.com/en-us/exchange/security-and-compliance/mail-flow-\nrules/mail-flow-rules\n2. https://techcommunity.microsoft.com/t5/exchange-team-blog/all-you-need-to-\nknow-about-automatic-email-forwarding-in/ba-\np/2074888#:~:text=%20%20%20Automatic%20forwarding%20option%20%20,%\n3. https://learn.microsoft.com/en-us/defender-office-365/outbound-spam-policies-\nexternal-email-forwarding?view=o365-worldwide"
    },
    {
        "id": "8.5.1",
        "title": "(L2) Ensure anonymous users can't join a meeting (Automated)",
        "profile": "• E3 Level 2",
        "description": "This policy setting can prevent anyone other than invited attendees (people directly\ninvited by the organizer, or to whom an invitation was forwarded) from bypassing the\nlobby and entering the meeting.\nFor more information on how to setup a sensitive meeting, please visit Configure\nTeams meetings with protection for sensitive data - Microsoft Teams:\nhttps://learn.microsoft.com/en-us/MicrosoftTeams/configure-meetings-sensitive-\nprotection",
        "rationale": "For meetings that could contain sensitive information, it is best to allow the meeting\norganizer to vet anyone not directly sent an invite before admitting them to the meeting.\nThis will also prevent the anonymous user from using the meeting link to have meetings\nat unscheduled times.\nNote: Those companies that don't normally operate at a Level 2 environment, but do\ndeal with sensitive information, may want to consider this policy setting.",
        "impact": "Individuals who were not sent or forwarded a meeting invite will not be able to join the\nmeeting automatically.\nPage 362",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Teams admin center\nhttps://admin.teams.microsoft.com.\n2. Click to expand Meetings select Meeting policies.\n3. Click Global (Org-wide default).\n4. Under meeting join & lobby verify that Anonymous users can join a meeting\nis set to Off.\nTo audit using PowerShell:\n1. Connect to Teams PowerShell using Connect-MicrosoftTeams.\n2. Run the following command to verify the recommended state:\nGet-CsTeamsMeetingPolicy -Identity Global | fl\nAllowAnonymousUsersToJoinMeeting\n3. Ensure the returned value is False.",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Teams admin center\nhttps://admin.teams.microsoft.com.\n2. Click to expand Meetings select Meeting policies.\n3. Click Global (Org-wide default)\n4. Under meeting join & lobby set Anonymous users can join a meeting to Off.\nTo remediate using PowerShell:\n1. Connect to Teams PowerShell using Connect-MicrosoftTeams\n2. Run the following command to set the recommended state:\nSet-CsTeamsMeetingPolicy -Identity Global -AllowAnonymousUsersToJoinMeeting\n$false",
        "default_value": "On (True)",
        "references": "1. https://learn.microsoft.com/en-us/MicrosoftTeams/configure-meetings-sensitive-\nprotection\nPage 363"
    },
    {
        "id": "8.5.2",
        "title": "(L1) Ensure anonymous users and dial-in callers can't start a meeting (Automated)",
        "profile": "• E3 Level 1",
        "description": "This policy setting controls if an anonymous participant can start a Microsoft Teams\nmeeting without someone in attendance. Anonymous users and dial-in callers must wait\nin the lobby until the meeting is started by someone in the organization or an external\nuser from a trusted organization.\nAnonymous participants are classified as:\n• Participants who are not logged in to Teams with a work or school account.\n• Participants from non-trusted organizations (as configured in external access).\n• Participants from organizations where there is not mutual trust.\nNote: This setting only applies when Who can bypass the lobby is set to Everyone.\nIf the anonymous users can join a meeting organization-level setting or meeting\npolicy is Off, this setting only applies to dial-in callers.",
        "rationale": "Not allowing anonymous participants to automatically join a meeting reduces the risk of\nmeeting spamming.",
        "impact": "Anonymous participants will not be able to start a Microsoft Teams meeting.\nPage 365",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Teams admin center\nhttps://admin.teams.microsoft.com.\n2. Click to expand Meetings select Meeting policies.\n3. Click Global (Org-wide default).\n4. Under meeting join & lobby verify that Anonymous users and dial-in\ncallers can start a meeting is set to Off.\nTo audit using PowerShell:\n1. Connect to Teams PowerShell using Connect-MicrosoftTeams.\n2. Run the following command to verify the recommended state:\nGet-CsTeamsMeetingPolicy -Identity Global | fl\nAllowAnonymousUsersToStartMeeting\n3. Ensure the returned value is False.",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Teams admin center\nhttps://admin.teams.microsoft.com.\n2. Click to expand Meetings select Meeting policies.\n3. Click Global (Org-wide default).\n4. Under meeting join & lobby set Anonymous users and dial-in callers can\nstart a meeting to Off.\nTo remediate using PowerShell:\n1. Connect to Teams PowerShell using Connect-MicrosoftTeams.\n2. Run the following command to set the recommended state:\nSet-CsTeamsMeetingPolicy -Identity Global -AllowAnonymousUsersToStartMeeting\n$false",
        "default_value": "Off (False)\nPage 366",
        "references": "1. https://learn.microsoft.com/en-us/microsoftteams/anonymous-users-in-meetings\n2. https://learn.microsoft.com/en-us/microsoftteams/who-can-bypass-meeting-\nlobby#overview-of-lobby-settings-and-policies"
    },
    {
        "id": "8.5.3",
        "title": "(L1) Ensure only people in my org can bypass the lobby (Automated)",
        "profile": "• E3 Level 1",
        "description": "This policy setting controls who can join a meeting directly and who must wait in the\nlobby until they're admitted by an organizer, co-organizer, or presenter of the meeting.",
        "rationale": "For meetings that could contain sensitive information, it is best to allow the meeting\norganizer to vet anyone not directly sent an invite before admitting them to the meeting.\nThis will also prevent the anonymous user from using the meeting link to have meetings\nat unscheduled times.",
        "impact": "Individuals who are not part of the organization will have to wait in the lobby until they're\nadmitted by an organizer, co-organizer, or presenter of the meeting.\nAny individual who dials into the meeting regardless of status will also have to wait in\nthe lobby. This includes internal users who are considered unauthenticated when dialing\nin.",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Teams admin center\nhttps://admin.teams.microsoft.com.\n2. Click to expand Meetings select Meeting policies.\n3. Click Global (Org-wide default).\n4. Under meeting join & lobby verify Who can bypass the lobby is set to People\nin my org.\nTo audit using PowerShell:\n1. Connect to Teams PowerShell using Connect-MicrosoftTeams.\n2. Run the following command to verify the recommended state:\nGet-CsTeamsMeetingPolicy -Identity Global | fl AutoAdmittedUsers\n3. Ensure the returned value is EveryoneInCompanyExcludingGuests\nPage 368",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Teams admin center\nhttps://admin.teams.microsoft.com.\n2. Click to expand Meetings select Meeting policies.\n3. Click Global (Org-wide default).\n4. Under meeting join & lobby set Who can bypass the lobby to People in my\norg.\nTo remediate using PowerShell:\n1. Connect to Teams PowerShell using Connect-MicrosoftTeams.\n2. Run the following command to set the recommended state:\nSet-CsTeamsMeetingPolicy -Identity Global -AutoAdmittedUsers\n\"EveryoneInCompanyExcludingGuests\"",
        "default_value": "People in my org and guests (EveryoneInCompany)",
        "references": "1. https://learn.microsoft.com/en-us/microsoftteams/who-can-bypass-meeting-\nlobby#overview-of-lobby-settings-and-policies\n2. https://learn.microsoft.com/en-us/powershell/module/skype/set-\ncsteamsmeetingpolicy?view=skype-ps"
    },
    {
        "id": "8.5.4",
        "title": "(L1) Ensure users dialing in can't bypass the lobby (Automated)",
        "profile": "• E3 Level 1",
        "description": "This policy setting controls if users who dial in by phone can join the meeting directly or\nmust wait in the lobby. Admittance to the meeting from the lobby is authorized by the\nmeeting organizer, co-organizer, or presenter of the meeting.",
        "rationale": "For meetings that could contain sensitive information, it is best to allow the meeting\norganizer to vet anyone not directly from the organization.",
        "impact": "Individuals who are dialing in to the meeting must wait in the lobby until a meeting\norganizer, co-organizer, or presenter admits them.",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Teams admin center\nhttps://admin.teams.microsoft.com.\n2. Click to expand Meetings select Meeting policies.\n3. Click Global (Org-wide default).\n4. Under meeting join & lobby verify that People dialing in can bypass the\nlobby is set to Off.\nTo audit using PowerShell:\n1. Connect to Teams PowerShell using Connect-MicrosoftTeams.\n2. Run the following command to verify the recommended state:\nGet-CsTeamsMeetingPolicy -Identity Global | fl AllowPSTNUsersToBypassLobby\n3. Ensure the value is False.\nPage 370",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Teams admin center\nhttps://admin.teams.microsoft.com.\n2. Click to expand Meetings select Meeting policies.\n3. Click Global (Org-wide default).\n4. Under meeting join & lobby set People dialing in can bypass the lobby to\nOff.\nTo remediate using PowerShell:\n1. Connect to Teams PowerShell using Connect-MicrosoftTeams.\n2. Run the following command to set the recommended state:\nSet-CsTeamsMeetingPolicy -Identity Global -AllowPSTNUsersToBypassLobby $false",
        "default_value": "Off (False)",
        "references": "1. https://learn.microsoft.com/en-us/microsoftteams/who-can-bypass-meeting-\nlobby#overview-of-lobby-settings-and-policies\n2. https://learn.microsoft.com/en-us/powershell/module/skype/set-\ncsteamsmeetingpolicy?view=skype-ps"
    },
    {
        "id": "8.5.5",
        "title": "(L2) Ensure meeting chat does not allow anonymous users (Automated)",
        "profile": "• E3 Level 2",
        "description": "This policy setting controls who has access to read and write chat messages during a\nmeeting.",
        "rationale": "Ensuring that only authorized individuals can read and write chat messages during a\nmeeting reduces the risk that a malicious user can inadvertently show content that is not\nappropriate or view sensitive information.",
        "impact": "Only authorized individuals will be able to read and write chat messages during a\nmeeting.",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Teams admin center\nhttps://admin.teams.microsoft.com.\n2. Click to expand Meetings select Meeting policies.\n3. Click Global (Org-wide default).\n4. Under meeting engagement verify that Meeting chat is set to On for\neveryone but anonymous users.\nTo audit using PowerShell:\n1. Connect to Teams PowerShell using Connect-MicrosoftTeams.\n2. Run the following command to verify the recommended state:\nGet-CsTeamsMeetingPolicy -Identity Global | fl MeetingChatEnabledType\n3. Ensure the returned value is EnabledExceptAnonymous.\nPage 372",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Teams admin center\nhttps://admin.teams.microsoft.com.\n2. Click to expand Meetings select Meeting policies.\n3. Click Global (Org-wide default).\n4. Under meeting engagement set Meeting chat to On for everyone but\nanonymous users.\nTo remediate using PowerShell:\n1. Connect to Teams PowerShell using Connect-MicrosoftTeams.\n2. Run the following command to set the recommended state:\nSet-CsTeamsMeetingPolicy -Identity Global -MeetingChatEnabledType\n\"EnabledExceptAnonymous\"",
        "default_value": "On for everyone (Enabled)",
        "references": "1. https://learn.microsoft.com/en-us/powershell/module/skype/set-\ncsteamsmeetingpolicy?view=skype-ps#-meetingchatenabledtype"
    },
    {
        "id": "8.5.6",
        "title": "(L2) Ensure only organizers and co-organizers can present (Automated)",
        "profile": "• E3 Level 2",
        "description": "This policy setting controls who can present in a Teams meeting.\nNote: Organizers and co-organizers can change this setting when the meeting is set up.",
        "rationale": "Ensuring that only authorized individuals are able to present reduces the risk that a\nmalicious user can inadvertently show content that is not appropriate.",
        "impact": "Only organizers and co-organizers will be able to present without being granted\npermission.",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Teams admin center\nhttps://admin.teams.microsoft.com.\n2. Click to expand Meetings select Meeting policies.\n3. Click Global (Org-wide default).\n4. Under content sharing verify Who can present is set to Only organizers and\nco-organizers.\nTo audit using PowerShell:\n1. Connect to Teams PowerShell using Connect-MicrosoftTeams.\n2. Run the following command to verify the recommended state:\nGet-CsTeamsMeetingPolicy -Identity Global | fl DesignatedPresenterRoleMode\n3. Ensure the returned value is OrganizerOnlyUserOverride.\nPage 374",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Teams admin center\nhttps://admin.teams.microsoft.com.\n2. Click to expand Meetings select Meeting policies.\n3. Click Global (Org-wide default).\n4. Under content sharing set Who can present to Only organizers and co-\norganizers.\nTo remediate using PowerShell:\n1. Connect to Teams PowerShell using Connect-MicrosoftTeams.\n2. Run the following command to set the recommended state:\nSet-CsTeamsMeetingPolicy -Identity Global -DesignatedPresenterRoleMode\n\"OrganizerOnlyUserOverride\"",
        "default_value": "Everyone (EveryoneUserOverride)",
        "references": "1. https://learn.microsoft.com/en-US/microsoftteams/meeting-who-present-request-\ncontrol\n2. https://learn.microsoft.com/en-us/microsoftteams/meeting-who-present-request-\ncontrol#manage-who-can-present\n3. https://learn.microsoft.com/en-us/defender-office-365/step-by-step-\nguides/reducing-attack-surface-in-microsoft-teams?view=o365-\nworldwide#configure-meeting-settings-restrict-presenters\n4. https://learn.microsoft.com/en-us/powershell/module/skype/set-\ncsteamsmeetingpolicy?view=skype-ps"
    },
    {
        "id": "8.5.7",
        "title": "(L1) Ensure external participants can't give or request control (Automated)",
        "profile": "• E3 Level 1",
        "description": "This policy setting allows control of who can present in meetings and who can request\ncontrol of the presentation while a meeting is underway.",
        "rationale": "Ensuring that only authorized individuals and not external participants are able to\npresent and request control reduces the risk that a malicious user can inadvertently\nshow content that is not appropriate.\nExternal participants are categorized as follows: external users, guests, and anonymous\nusers.",
        "impact": "External participants will not be able to present or request control during the meeting.\nWarning: This setting also affects webinars.\nNote: At this time, to give and take control of shared content during a meeting, both\nparties must be using the Teams desktop client. Control isn't supported when either\nparty is running Teams in a browser.\nPage 376",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Teams admin center\nhttps://admin.teams.microsoft.com.\n2. Click to expand Meetings select Meeting policies.\n3. Click Global (Org-wide default).\n4. Under content sharing verify that External participants can give or\nrequest control is Off.\nTo audit using PowerShell:\n1. Connect to Teams PowerShell using Connect-MicrosoftTeams.\n2. Run the following command to verify the recommended state:\nGet-CsTeamsMeetingPolicy -Identity Global | fl\nAllowExternalParticipantGiveRequestControl\n3. Ensure the returned value is False.",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Teams admin center\nhttps://admin.teams.microsoft.com.\n2. Click to expand Meetings select Meeting policies.\n3. Click Global (Org-wide default).\n4. Under content sharing set External participants can give or request\ncontrol to Off.\nTo remediate using PowerShell:\n1. Connect to Teams PowerShell using Connect-MicrosoftTeams.\n2. Run the following command to set the recommended state:\nSet-CsTeamsMeetingPolicy -Identity Global -\nAllowExternalParticipantGiveRequestControl $false",
        "default_value": "Off (False)\nPage 377",
        "references": "1. https://learn.microsoft.com/en-us/microsoftteams/meeting-who-present-request-\ncontrol\n2. https://learn.microsoft.com/en-us/powershell/module/skype/set-\ncsteamsmeetingpolicy?view=skype-ps"
    },
    {
        "id": "8.5.8",
        "title": "(L2) Ensure external meeting chat is off (Automated)",
        "profile": "• E3 Level 2",
        "description": "This meeting policy setting controls whether users can read or write messages in\nexternal meeting chats with untrusted organizations. If an external organization is on the\nlist of trusted organizations this setting will be ignored.",
        "rationale": "Restricting access to chat in meetings hosted by external organizations limits the\nopportunity for an exploit like GIFShell or DarkGate malware from being delivered to\nusers.",
        "impact": "When joining external meetings users will be unable to read or write chat messages in\nTeams meetings with organizations that they don't have a trust relationship with. This\nwill completely remove the chat functionality in meetings. From an I.T. perspective both\nthe upkeep of adding new organizations to the trusted list and the decision-making\nprocess behind whether to trust or not trust an external partner will increase time\nexpenditure.",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Teams admin center\nhttps://admin.teams.microsoft.com.\n2. Click to expand Meetings select Meeting policies.\n3. Click Global (Org-wide default).\n4. Under meeting engagement verify that External meeting chat is set to Off.\nTo audit using PowerShell:\n1. Connect to Teams PowerShell using Connect-MicrosoftTeams.\n2. Run the following command to verify the recommended state:\nGet-CsTeamsMeetingPolicy -Identity Global | fl\nAllowExternalNonTrustedMeetingChat\n3. Ensure the returned value is False.\nPage 379",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Teams admin center\nhttps://admin.teams.microsoft.com.\n2. Click to expand Meetings select Meeting policies.\n3. Click Global (Org-wide default).\n4. Under meeting engagement set External meeting chat to Off.\nTo remediate using PowerShell:\n1. Connect to Teams PowerShell using Connect-MicrosoftTeams.\n2. Run the following command to set the recommended state:\nSet-CsTeamsMeetingPolicy -Identity Global -AllowExternalNonTrustedMeetingChat\n$false",
        "default_value": "On(True)",
        "references": "1. https://learn.microsoft.com/en-us/microsoftteams/settings-policies-\nreference#meeting-engagement"
    },
    {
        "id": "8.5.9",
        "title": "(L2) Ensure meeting recording is off by default (Automated)",
        "profile": "• E3 Level 2",
        "description": "This setting controls the ability for a user to initiate a recording of a meeting in progress.\nThe recommended state is Off for the Global (Org-wide default) meeting policy.",
        "rationale": "Disabling meeting recordings in the Global meeting policy ensures that only authorized\nusers, such as organizers, co-organizers, and leads, can initiate a recording. This\nmeasure helps safeguard sensitive information by preventing unauthorized individuals\nfrom capturing and potentially sharing meeting content. Restricting recording\ncapabilities to specific roles allows organizations to exercise greater control over what is\nrecorded, aligning it with the meeting's confidentiality requirements.\nNote: Creating a separate policy for users or groups who are allowed to record is\nexpected and in compliance. This control is only for the default meeting policy.",
        "impact": "If there are no additional policies allowing anyone to record, then recording will\neffectively be disabled.",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Teams admin center\nhttps://admin.teams.microsoft.com.\n2. Click to expand Meetings select Meeting policies.\n3. Click Global (Org-wide default).\n4. Under Recording & transcription verify that Meeting recording is set to Off.\nTo audit using PowerShell:\n1. Connect to Teams PowerShell using Connect-MicrosoftTeams.\n2. Run the following command to verify the recommended state:\nGet-CsTeamsMeetingPolicy -Identity Global | fl AllowCloudRecording\n3. Ensure the returned value is False.\nPage 381",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Teams admin center\nhttps://admin.teams.microsoft.com.\n2. Click to expand Meetings select Meeting policies.\n3. Click Global (Org-wide default).\n4. Under Recording & transcription set Meeting recording to Off.\nTo remediate using PowerShell:\n1. Connect to Teams PowerShell using Connect-MicrosoftTeams.\n2. Run the following command to set the recommended state:\nSet-CsTeamsMeetingPolicy -Identity Global -AllowCloudRecording $false",
        "default_value": "On (True)",
        "references": "1. https://learn.microsoft.com/en-us/microsoftteams/settings-policies-\nreference#recording--transcription"
    },
    {
        "id": "8.6",
        "title": "Messaging"
    },
    {
        "id": "8.6.1",
        "title": "(L1) Ensure users can report security concerns in Teams (Automated)",
        "profile": "• E3 Level 1",
        "description": "User reporting settings allow a user to report a message as malicious for further\nanalysis. This recommendation is composed of 3 different settings and all be configured\nto pass:\n• In the Teams admin center: On by default and controls whether users are able\nto report messages from Teams. When this setting is turned off, users can't\nreport messages within Teams, so the corresponding setting in the Microsoft 365\nDefender portal is irrelevant.\n• In the Microsoft 365 Defender portal: On by default for new tenants. Existing\ntenants need to enable it. If user reporting of messages is turned on in the\nTeams admin center, it also needs to be turned on the Defender portal for user\nreported messages to show up correctly on the User reported tab on the\nSubmissions page.\n• Defender - Report message destinations: This applies to more than just\nMicrosoft Teams and allows for an organization to keep their reports contained.\nDue to how the parameters are configured on the backend it is included in this\nassessment as a requirement.",
        "rationale": "Users will be able to more quickly and systematically alert administrators of suspicious\nmalicious messages within Teams. The content of these messages may be sensitive in\nnature and therefore should be kept within the organization and not shared with\nMicrosoft without first consulting company policy.\nNote:\n• The reported message remains visible to the user in the Teams client.\n• Users can report the same message multiple times.\n• The message sender isn't notified that messages were reported.\nPage 384",
        "impact": "Enabling message reporting has an impact beyond just addressing security concerns.\nWhen users of the platform report a message, the content could include messages that\nare threatening or harassing in nature, possibly stemming from colleagues.\nDue to this the security staff responsible for reviewing and acting on these reports\nshould be equipped with the skills to discern and appropriately direct such messages to\nthe relevant departments, such as Human Resources (HR).",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Teams admin center\nhttps://admin.teams.microsoft.com.\n2. Click to expand Messaging select Messaging policies.\n3. Click Global (Org-wide default).\n4. Ensure Report a security concern is On.\n5. Next, navigate to Microsoft 365 Defender https://security.microsoft.com/\n6. Click on Settings > Email & collaboration > User reported settings.\n7. Scroll to Microsoft Teams.\n8. Ensure Monitor reported messages in Microsoft Teams is checked.\n9. Ensure Send reported messages to: is set to My reporting mailbox only\nwith report email addresses defined for authorized staff.\nPage 385\nTo audit using PowerShell:\n1. Connect to Teams PowerShell using Connect-MicrosoftTeams.\n2. Connect to Exchange Online PowerShell using Connect-ExchangeOnline.\n3. Run the following cmdlet for to assess Teams:\nGet-CsTeamsMessagingPolicy -Identity Global | fl\nAllowSecurityEndUserReporting\n4. Ensure the value returned is True.\n5. Run this cmdlet to assess Defender:\nGet-ReportSubmissionPolicy | fl Report*\n6. Ensure the output matches the following values with organization specific email\naddresses:\nReportJunkToCustomizedAddress : True\nReportNotJunkToCustomizedAddress : True\nReportPhishToCustomizedAddress : True\nReportJunkAddresses : {SOC@contoso.com}\nReportNotJunkAddresses : {SOC@contoso.com}\nReportPhishAddresses : {SOC@contoso.com}\nReportChatMessageEnabled : False\nReportChatMessageToCustomizedAddressEnabled : True\nPage 386",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Teams admin center\nhttps://admin.teams.microsoft.com.\n2. Click to expand Messaging select Messaging policies.\n3. Click Global (Org-wide default).\n4. Set Report a security concern to On.\n5. Next, navigate to Microsoft 365 Defender https://security.microsoft.com/\n6. Click on Settings > Email & collaboration > User reported settings.\n7. Scroll to Microsoft Teams.\n8. Check Monitor reported messages in Microsoft Teams and Save.\n9. Set Send reported messages to: to My reporting mailbox only with\nreports configured to be sent to authorized staff.\nTo remediate using PowerShell:\n1. Connect to Teams PowerShell using Connect-MicrosoftTeams.\n2. Connect to Exchange Online PowerShell using Connect-ExchangeOnline.\n3. Run the following cmdlet:\nSet-CsTeamsMessagingPolicy -Identity Global -AllowSecurityEndUserReporting\n$true\n4. To configure the Defender reporting policies, edit and run this script:\n$usersub = \"userreportedmessages@fabrikam.com\" # Change this.\n$params = @{\nIdentity = \"DefaultReportSubmissionPolicy\"\nEnableReportToMicrosoft = $false\nReportChatMessageEnabled = $false\nReportChatMessageToCustomizedAddressEnabled = $true\nReportJunkToCustomizedAddress = $true\nReportNotJunkToCustomizedAddress = $true\nReportPhishToCustomizedAddress = $true\nReportJunkAddresses = $usersub\nReportNotJunkAddresses = $usersub\nReportPhishAddresses = $usersub\n}\nSet-ReportSubmissionPolicy @params\nNew-ReportSubmissionRule -Name DefaultReportSubmissionRule -\nReportSubmissionPolicy DefaultReportSubmissionPolicy -SentTo $usersub\nPage 387",
        "default_value": "On (True)\nReport message destination: Microsoft Only",
        "references": "1. https://learn.microsoft.com/en-us/defender-office-365/submissions-\nteams?view=o365-worldwide"
    },
    {
        "id": "9.1",
        "title": "Tenant settings",
        "profile": "• E3 Level 1",
        "description": "Administrative accounts are special privileged accounts that could have varying levels\nof access to data, users, and settings. Regular user accounts should never be utilized\nfor administrative tasks and care should be taken, in the case of a hybrid environment,\nto keep Administrative accounts separated from on-prem accounts. Administrative\naccounts should not have applications assigned so that they have no access to\npotentially vulnerable services (EX. email, Teams, SharePoint, etc.) and only access to\nperform tasks as needed for administrative purposes.\nEnsure administrative accounts are not On-premises sync enabled.",
        "rationale": "In a hybrid environment, having separate accounts will help ensure that in the event of a\nbreach in the cloud, that the breach does not affect the on-prem environment and vice\nversa.",
        "impact": "Administrative users will have to switch accounts and utilizing login/logout functionality\nwhen performing administrative tasks, as well as not benefiting from SSO. This will\nrequire a migration process from the 'daily driver' account to a dedicated admin account.\nWhen migrating permissions to the admin account, both M365 and Azure RBAC roles\nshould be migrated as well. Once the new admin accounts are created both of these\npermission sets should be moved from the daily driver account to the new admin\naccount. Failure to migrate Azure RBAC roles can cause an admin to not be able to see\ntheir subscriptions/resources while using their admin accounts.\nPage 17",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Identity > Users select All users.\n3. To the right of the search box click the Add filter button.\n4. Add the On-premises sync enabled filter and click Apply.\n5. For each user account known to be in an administrative role verify it is not\npresent in the filtered list.\nTo audit using PowerShell:\n1. Connect to Microsoft Graph using Connect-MgGraph -Scopes\n\"RoleManagement.Read.Directory\",\"User.Read.All\"\n2. Run the following PowerShell script:\n# Get privileged role IDs\n$PrivilegedRoles = $DirectoryRoles | Where-Object {\n$_.DisplayName -like \"*Administrator*\" -or $_.DisplayName -eq \"Global\nReader\"\n}\n# Get the members of these various roles\n$RoleMembers = $PrivilegedRoles | ForEach-Object { Get-MgDirectoryRoleMember\n-DirectoryRoleId $_.Id } |\nSelect-Object Id -Unique\n# Retrieve details about the members in these roles\n$PrivilegedUsers = $RoleMembers | ForEach-Object {\nGet-MgUser -UserId $_.Id -Property UserPrincipalName, DisplayName, Id,\nOnPremisesSyncEnabled\n}\n$PrivilegedUsers | Where-Object { $_.OnPremisesSyncEnabled -eq $true } |\nft DisplayName,UserPrincipalName,OnPremisesSyncEnabled\n3. The script will output any hybrid users that are also members of privileged roles.\nIf nothing returns then no users with that criteria exist.",
        "remediation": "Remediation will require first identifying the privileged accounts that are synced from on-\npremises and then creating a new cloud-only account for that user. Once a replacement\naccount is established, the hybrid account should have its role reduced to that of a non-\nprivileged user or removed depending on the need.",
        "default_value": "N/A\nPage 18",
        "references": "1. https://learn.microsoft.com/en-us/microsoft-365/admin/add-users/add-\nusers?view=o365-worldwide\n2. https://learn.microsoft.com/en-us/microsoft-365/enterprise/protect-your-global-\nadministrator-accounts?view=o365-worldwide\n3. https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/best-\npractices#9-use-cloud-native-accounts-for-microsoft-entra-roles\n4. https://learn.microsoft.com/en-us/entra/fundamentals/whatis\n5. https://learn.microsoft.com/en-us/entra/identity/role-based-access-\ncontrol/permissions-reference"
    },
    {
        "id": "9.1.1",
        "title": "(L1) Ensure guest user access is restricted (Manual)",
        "profile": "• E3 Level 1",
        "description": "This setting allows business-to-business (B2B) guests access to Microsoft Fabric, and\ncontents that they have permissions to. With the setting turned off, B2B guest users\nreceive an error when trying to access Power BI.\nThe recommended state is Enabled for a subset of the organization or\nDisabled.",
        "rationale": "Establishing and enforcing a dedicated security group prevents unauthorized access to\nMicrosoft Fabric for guests collaborating in Azure that are new or assigned guest status\nfrom other applications. This upholds the principle of least privilege and uses role-based\naccess control (RBAC). These security groups can also be used for tasks like\nconditional access, enhancing risk management and user accountability across the\norganization.",
        "impact": "Security groups will need to be more closely tended to and monitored.",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal\n2. Select Tenant settings.\n3. Scroll to Export and Sharing settings.\n4. Ensure that Guest users can access Microsoft Fabric adheres to one of\nthese states:\no State 1: Disabled\no State 2: Enabled with Specific security groups selected and defined.\nImportant: If the organization doesn't actively use this feature it is recommended to\nkeep it Disabled.\nPage 391",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal\n2. Select Tenant settings.\n3. Scroll to Export and Sharing settings.\n4. Set Guest users can access Microsoft Fabric to one of these states:\no State 1: Disabled\no State 2: Enabled with Specific security groups selected and defined.\nImportant: If the organization doesn't actively use this feature it is recommended to\nkeep it Disabled.",
        "default_value": "Enabled for Entire Organization",
        "references": "1. https://learn.microsoft.com/en-us/fabric/admin/service-admin-portal-export-\nsharing"
    },
    {
        "id": "9.1.2",
        "title": "(L1) Ensure external user invitations are restricted (Manual)",
        "profile": "• E3 Level 1",
        "description": "This setting helps organizations choose whether new external users can be invited to\nthe organization through Power BI sharing, permissions, and subscription experiences.\nThis setting only controls the ability to invite through Power BI.\nThe recommended state is Enabled for a subset of the organization or\nDisabled.\nNote: To invite external users to the organization, the user must also have the Microsoft\nEntra Guest Inviter role.",
        "rationale": "Establishing and enforcing a dedicated security group prevents unauthorized access to\nMicrosoft Fabric for guests collaborating in Azure that are new or assigned guest status\nfrom other applications. This upholds the principle of least privilege and uses role-based\naccess control (RBAC). These security groups can also be used for tasks like\nconditional access, enhancing risk management and user accountability across the\norganization.",
        "impact": "Guest user invitations will be limited to only specific employees.",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal\n2. Select Tenant settings.\n3. Scroll to Export and Sharing settings.\n4. Ensure that Users can invite guest users to collaborate through\nitem sharing and permissions adheres to one of these states:\no State 1: Disabled\no State 2: Enabled with Specific security groups selected and defined.\nImportant: If the organization doesn't actively use this feature it is recommended to\nkeep it Disabled.\nPage 393",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal\n2. Select Tenant settings.\n3. Scroll to Export and Sharing settings.\n4. Set Users can invite guest users to collaborate through item\nsharing and permissions to one of these states:\no State 1: Disabled\no State 2: Enabled with Specific security groups selected and defined.\nImportant: If the organization doesn't actively use this feature it is recommended to\nkeep it Disabled.",
        "default_value": "Enabled for the entire organization",
        "references": "1. https://learn.microsoft.com/en-us/fabric/admin/service-admin-portal-export-\nsharing\n2. https://learn.microsoft.com/en-us/power-bi/enterprise/service-admin-azure-ad-\nb2b#invite-guest-users"
    },
    {
        "id": "9.1.3",
        "title": "(L1) Ensure guest access to content is restricted (Manual)",
        "profile": "• E3 Level 1",
        "description": "This setting allows Microsoft Entra B2B guest users to have full access to the browsing\nexperience using the left-hand navigation pane in the organization. Guest users who\nhave been assigned workspace roles or specific item permissions will continue to have\nthose roles and/or permissions, even if this setting is disabled.\nThe recommended state is Enabled for a subset of the organization or\nDisabled.",
        "rationale": "Establishing and enforcing a dedicated security group prevents unauthorized access to\nMicrosoft Fabric for guests collaborating in Entra that are new or assigned guest status\nfrom other applications. This upholds the principle of least privilege and uses role-based\naccess control (RBAC). These security groups can also be used for tasks like\nconditional access, enhancing risk management and user accountability across the\norganization.",
        "impact": "Security groups will need to be more closely tended to and monitored.",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal\n2. Select Tenant settings.\n3. Scroll to Export and Sharing settings.\n4. Ensure that Guest users can browse and access Fabric content adheres\nto one of these states:\no State 1: Disabled\no State 2: Enabled with Specific security groups selected and defined.\nImportant: If the organization doesn't actively use this feature it is recommended to\nkeep it Disabled.\nPage 395",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal\n2. Select Tenant settings.\n3. Scroll to Export and Sharing settings.\n4. Set Guest users can browse and access Fabric content to one of these\nstates:\no State 1: Disabled\no State 2: Enabled with Specific security groups selected and defined.\nImportant: If the organization doesn't actively use this feature it is recommended to\nkeep it Disabled.",
        "default_value": "Disabled",
        "references": "1. https://learn.microsoft.com/en-us/fabric/admin/service-admin-portal-export-\nsharing"
    },
    {
        "id": "9.1.4",
        "title": "(L1) Ensure 'Publish to web' is restricted (Manual)",
        "profile": "• E3 Level 1",
        "description": "Power BI enables users to share reports and materials directly on the internet from both\nthe application's desktop version and its web user interface. This functionality generates\na publicly reachable web link that doesn't necessitate authentication or the need to be\nan Entra ID user in order to access and view it.\nThe recommended state is Enabled for a subset of the organization or\nDisabled.",
        "rationale": "When using Publish to Web anyone on the Internet can view a published report or\nvisual. Viewing requires no authentication. It includes viewing detail-level data that your\nreports aggregate. By disabling the feature, restricting access to certain users and\nallowing existing embed codes organizations can mitigate the exposure of confidential\nor proprietary information.",
        "impact": "Depending on the organization's utilization administrators may experience more\noverhead managing embed codes, and requests.",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal\n2. Select Tenant settings.\n3. Scroll to Export and Sharing settings.\n4. Ensure that Publish to web adheres to one of these states:\no State 1: Disabled\no State 2: Enabled with Choose how embed codes work set to Only\nallow existing codes AND Specific security groups selected and\ndefined\nImportant: If the organization doesn't actively use this feature it is recommended to\nkeep it Disabled.\nPage 397",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal\n2. Select Tenant settings.\n3. Scroll to Export and Sharing settings.\n4. Set Publish to web to one of these states:\no State 1: Disabled\no State 2: Enabled with Choose how embed codes work set to Only\nallow existing codes AND Specific security groups selected and\ndefined\nImportant: If the organization doesn't actively use this feature it is recommended to\nkeep it Disabled.",
        "default_value": "Enabled for the entire organization\nOnly allow existing codes",
        "references": "1. https://learn.microsoft.com/en-us/power-bi/collaborate-share/service-publish-to-\nweb\n2. https://learn.microsoft.com/en-us/fabric/admin/service-admin-portal-export-\nsharing#publish-to-web"
    },
    {
        "id": "9.1.5",
        "title": "(L2) Ensure 'Interact with and share R and Python' visuals is 'Disabled' (Manual)",
        "profile": "• E3 Level 2",
        "description": "Power BI allows the integration of R and Python scripts directly into visuals. This feature\nallows data visualizations by incorporating custom calculations, statistical analyses,\nmachine learning models, and more using R or Python scripts. Custom visuals can be\ncreated by embedding them directly into Power BI reports. Users can then interact with\nthese visuals and see the results of the custom code within the Power BI interface.",
        "rationale": "Disabling this feature can reduce the attack surface by preventing potential malicious\ncode execution leading to data breaches, or unauthorized access. The potential for\nsensitive or confidential data being leaked to unintended users is also increased with\nthe use of scripts.",
        "impact": "Use of R and Python scripting will require exceptions for developers, along with more\nstringent code review.",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal\n2. Select Tenant settings.\n3. Scroll to R and Python visuals settings.\n4. Ensure that Interact with and share R and Python visuals is Disabled",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal\n2. Select Tenant settings.\n3. Scroll to R and Python visuals settings.\n4. Set Interact with and share R and Python visuals to Disabled",
        "default_value": "Enabled\nPage 399",
        "references": "1. https://learn.microsoft.com/en-us/fabric/admin/service-admin-portal-r-python-\nvisuals\n2. https://learn.microsoft.com/en-us/power-bi/visuals/service-r-visuals\n3. https://www.r-project.org/"
    },
    {
        "id": "9.1.6",
        "title": "(L1) Ensure 'Allow users to apply sensitivity labels for content' is 'Enabled' (Manual)",
        "profile": "• E3 Level 1",
        "description": "Information protection tenant settings help to protect sensitive information in the Power\nBI tenant. Allowing and applying sensitivity labels to content ensures that information is\nonly seen and accessed by the appropriate users.\nThe recommended state is Enabled or Enabled for a subset of the\norganization.\nNote: Sensitivity labels and protection are only applied to files exported to Excel,\nPowerPoint, or PDF files, that are controlled by \"Export to Excel\" and \"Export reports as\nPowerPoint presentation or PDF documents\" settings. All other export and sharing\noptions do not support the application of sensitivity labels and protection.\nNote 2: There are some prerequisite steps that need to be completed in order to fully\nutilize labeling. See here.",
        "rationale": "Establishing data classifications and affixing labels to data at creation enables\norganizations to discern the data's criticality, sensitivity, and value. This initial\nidentification enables the implementation of appropriate protective measures, utilizing\ntechnologies like Data Loss Prevention (DLP) to avert inadvertent exposure and\nenforcing access controls to safeguard against unauthorized access.\nThis practice can also promote user awareness and responsibility in regard to the\nnature of the data they interact with. Which in turn can foster awareness in other areas\nof data management across the organization.",
        "impact": "Additional license requirements like Power BI Pro are required, as outlined in the\nLicensed and requirements page linked in the description and references sections.\nPage 401",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal\n2. Select Tenant settings.\n3. Scroll to Information protection.\n4. Ensure that Allow users to apply sensitivity labels for content\nadheres to one of these states:\no State 1: Enabled\no State 2: Enabled with Specific security groups selected and defined.",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal\n2. Select Tenant settings.\n3. Scroll to Information protection.\n4. Set Allow users to apply sensitivity labels for content to one of\nthese states:\no State 1: Enabled\no State 2: Enabled with Specific security groups selected and defined.",
        "default_value": "Disabled",
        "references": "1. https://learn.microsoft.com/en-us/power-bi/enterprise/service-security-enable-\ndata-sensitivity-labels\n2. https://learn.microsoft.com/en-us/fabric/governance/data-loss-prevention-\noverview\n3. https://learn.microsoft.com/en-us/power-bi/enterprise/service-security-enable-\ndata-sensitivity-labels#licensing-and-requirements\nPage 402"
    },
    {
        "id": "9.1.7",
        "title": "(L1) Ensure shareable links are restricted (Manual)",
        "profile": "• E3 Level 1",
        "description": "Creating a shareable link allows a user to create a link to a report or dashboard, then\nadd that link to an email or another messaging application.\nThere are 3 options that can be selected when creating a shareable link:\n• People in your organization\n• People with existing access\n• Specific people\nThis setting solely deals with restrictions to People in the organization. External\nusers by default are not included in any of these categories, and therefore cannot use\nany of these links regardless of the state of this setting.\nThe recommended state is Enabled for a subset of the organization or\nDisabled.",
        "rationale": "While external users are unable to utilize shareable links, disabling or restricting this\nfeature ensures that a user cannot generate a link accessible by individuals within the\nsame organization who lack the necessary clearance to the shared data. For example,\na member of Human Resources intends to share sensitive information with a particular\nemployee or another colleague within their department. The owner would be prompted\nto specify either People with existing access or Specific people when\ngenerating the link requiring the person clicking the link to pass a first layer access\ncontrol list. This measure along with proper file and folder permissions can help prevent\nunintended access and potential information leakage.",
        "impact": "If the setting is Enabled then only specific people in the organization would be allowed\nto create general links viewable by the entire organization.\nPage 404",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal\n2. Select Tenant settings.\n3. Scroll to Export and Sharing settings.\n4. Ensure that Allow shareable links to grant access to everyone in\nyour organization adheres to one of these states:\no State 1: Disabled\no State 2: Enabled with Specific security groups selected and defined.\nImportant: If the organization doesn't actively use this feature it is recommended to\nkeep it Disabled.",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal\n2. Select Tenant settings.\n3. Scroll to Export and Sharing settings.\n4. Set Allow shareable links to grant access to everyone in your\norganization to one of these states:\no State 1: Disabled\no State 2: Enabled with Specific security groups selected and defined.\nImportant: If the organization doesn't actively use this feature it is recommended to\nkeep it Disabled.",
        "default_value": "Enabled for Entire Organization",
        "references": "1. https://learn.microsoft.com/en-us/power-bi/collaborate-share/service-share-\ndashboards?wt.mc_id=powerbi_inproduct_sharedialog#link-settings\n2. https://learn.microsoft.com/en-us/fabric/admin/service-admin-portal-export-\nsharing\nPage 405"
    },
    {
        "id": "9.1.8",
        "title": "(L1) Ensure enabling of external data sharing is restricted (Manual)",
        "profile": "• E3 Level 1",
        "description": "Power BI admins can specify which users or user groups can share datasets externally\nwith guests from a different tenant through the in-place mechanism. Disabling this\nsetting prevents any user from sharing datasets externally by restricting the ability of\nusers to turn on external sharing for datasets they own or manage.\nThe recommended state is Enabled for a subset of the organization or\nDisabled.",
        "rationale": "Establishing and enforcing a dedicated security group prevents unauthorized access to\nMicrosoft Fabric for guests collaborating in Azure that are new or from other\napplications. This upholds the principle of least privilege and uses role-based access\ncontrol (RBAC). These security groups can also be used for tasks like conditional\naccess, enhancing risk management and user accountability across the organization.",
        "impact": "Security groups will need to be more closely tended to and monitored.",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal\n2. Select Tenant settings.\n3. Scroll to Export and Sharing settings.\n4. Ensure that Allow specific users to turn on external data sharing\nadheres to one of these states:\no State 1: Disabled\no State 2: Enabled with Specific security groups selected and defined.\nImportant: If the organization doesn't actively use this feature it is recommended to\nkeep it Disabled.\nPage 407",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal\n2. Select Tenant settings.\n3. Scroll to Export and Sharing settings.\n4. Set Allow specific users to turn on external data sharing to one of\nthese states:\no State 1: Disabled\no State 2: Enabled with Specific security groups selected and defined.\nImportant: If the organization doesn't actively use this feature it is recommended to\nkeep it Disabled.",
        "default_value": "Enabled for the entire organization",
        "references": "1. https://learn.microsoft.com/en-us/fabric/admin/service-admin-portal-export-\nsharing"
    },
    {
        "id": "9.1.9",
        "title": "(L1) Ensure 'Block ResourceKey Authentication' is 'Enabled' (Manual)",
        "profile": "• E3 Level 1",
        "description": "This setting blocks the use of resource key based authentication. The Block\nResourceKey Authentication setting applies to streaming and PUSH datasets. If blocked\nusers will not be allowed send data to streaming and PUSH datasets using the API with\na resource key.\nThe recommended state is Enabled.",
        "rationale": "Resource keys are a form of authentication that allows users to access Power BI\nresources (such as reports, dashboards, and datasets) without requiring individual user\naccounts. While convenient, this method bypasses the organization's centralized\nidentity and access management controls. Enabling ensures that access to Power BI\nresources is tied to the organization's authentication mechanisms, providing a more\nsecure and controlled environment.",
        "impact": "Developers will need to request a special exception in order to use this feature.",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal\n2. Select Tenant settings.\n3. Scroll to Developer settings.\n4. Ensure that Block ResourceKey Authentication is Enabled",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal\n2. Select Tenant settings.\n3. Scroll to Developer settings.\n4. Set Block ResourceKey Authentication to Enabled\nPage 409",
        "default_value": "Disabled for the entire organization",
        "references": "1. https://learn.microsoft.com/en-us/fabric/admin/service-admin-portal-developer\n2. https://learn.microsoft.com/en-us/power-bi/connect-data/service-real-time-\nstreaming"
    },
    {
        "id": "9.1.10",
        "title": "(L1) Ensure access to APIs by Service Principals is restricted (Manual)",
        "profile": "• E3 Level 1",
        "description": "Web apps registered in Microsoft Entra ID use an assigned service principal to access\nPower BI APIs without a signed-in user. This setting allows an app to use service\nprincipal authentication.\nThe recommended state is Enabled for a subset of the organization or\nDisabled.",
        "rationale": "Leaving API access unrestricted increases the attack surface in the event an adversary\ngains access to a Service Principal. APIs are a feature-rich method for programmatic\naccess to many areas of Power Bi and should be guarded closely.",
        "impact": "Disabled is the default behavior.",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal\n2. Select Tenant settings.\n3. Scroll to Developer settings.\n4. Ensure that Service principals can use Fabric APIs adheres to one of\nthese states:\no State 1: Disabled\no State 2: Enabled with Specific security groups selected and defined.\nImportant: If the organization doesn't actively use this feature it is recommended to\nkeep it Disabled.\nPage 411",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal\n2. Select Tenant settings.\n3. Scroll to Developer settings.\n4. Set Service principals can use Fabric APIs to one of these states:\no State 1: Disabled\no State 2: Enabled with Specific security groups selected and defined.\nImportant: If the organization doesn't actively use this feature it is recommended to\nkeep it Disabled.",
        "default_value": "Disabled for the entire organization",
        "references": "1. https://learn.microsoft.com/en-us/fabric/admin/service-admin-portal-developer"
    },
    {
        "id": "9.1.11",
        "title": "(L1) Ensure Service Principals cannot create and use profiles (Manual)",
        "profile": "• E3 Level 1",
        "description": "Service principal profiles provide a flexible solution for apps used in a multitenancy\ndeployment. The profiles enable customer data isolation and tighter security boundaries\nbetween customers that are utilizing the app.\nThe recommended state is Enabled for a subset of the organization or\nDisabled.",
        "rationale": "Service Principals should be restricted to a security group to limit which Service\nPrincipals can interact with profiles. This supports the principle of least privilege",
        "impact": "Disabled is the default behavior.",
        "audit": "To audit using the UI:\n1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal\n2. Select Tenant settings.\n3. Scroll to Developer settings.\n4. Ensure that Allow service principals to create and use profiles\nadheres to one of these states:\no State 1: Disabled\no State 2: Enabled with Specific security groups selected and defined.\nImportant: If the organization doesn't actively use this feature it is recommended to\nkeep it Disabled.\nPage 413",
        "remediation": "To remediate using the UI:\n1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal\n2. Select Tenant settings.\n3. Scroll to Developer settings.\n4. Set Allow service principals to create and use profiles to one of\nthese states:\no State 1: Disabled\no State 2: Enabled with Specific security groups selected and defined.\nImportant: If the organization doesn't actively use this feature it is recommended to\nkeep it Disabled.",
        "default_value": "Disabled for the entire organization",
        "references": "1. https://learn.microsoft.com/en-us/fabric/admin/service-admin-portal-developer\n2. https://learn.microsoft.com/en-us/power-bi/developer/embedded/embed-multi-\ntenancy"
    }
]